{
  "version": 3,
  "sources": ["../src/gl/shader.js", "../src/math/vec3.js", "../src/math/mat4.js", "../src/gl/scene.js", "../src/gl/buffer.js", "../src/util/collisionMesh.js", "../src/util/modelBuilder.js", "../src/math/geometry.js", "../src/viewer/pointViewer.js", "../src/viewer/viewerStartPoints.js", "../src/viewer/pathViewer.js", "../src/viewer/viewerEnemyPaths.js", "../src/viewer/viewerItemPaths.js", "../src/viewer/viewerCheckpoints.js", "../src/viewer/viewerObjects.js", "../src/viewer/viewerRoutes.js", "../src/viewer/viewerAreas.js", "../src/viewer/viewerCameras.js", "../src/viewer/viewerRespawnPoints.js", "../src/viewer/viewerCannonPoints.js", "../src/viewer/viewerFinishPoints.js", "../src/viewer/viewerTrackInformation.js", "../src/viewer/viewer.js", "../src/util/binaryParser.js", "../src/util/binaryWriter.js", "../src/util/kmpData.js", "../src/util/kclLoader.js", "../src/util/szs.js", "../src/util/objLoader.js", "../src/util/brresLoader.js", "../src/mainWindowWeb.js"],
  "sourcesContent": ["class GLShader\r\n{\r\n\tstatic makeVertex(gl, src)\r\n\t{\r\n\t\treturn GLShader.make(gl, src, gl.VERTEX_SHADER)\r\n\t}\r\n\t\r\n\t\r\n\tstatic makeFragment(gl, src)\r\n\t{\r\n\t\treturn GLShader.make(gl, src, gl.FRAGMENT_SHADER)\r\n\t}\r\n\t\r\n\t\r\n\tstatic make(gl, src, kind)\r\n\t{\r\n\t\tlet shader = gl.createShader(kind)\r\n\t\tgl.shaderSource(shader, src)\r\n\t\tgl.compileShader(shader)\r\n\t\t\r\n\t\tif (!gl.getShaderParameter(shader, gl.COMPILE_STATUS))\r\n\t\t{\r\n\t\t\tconsole.error(\"Error compiling shader: \\n\\n\" + gl.getShaderInfoLog(shader))\r\n\t\t\tgl.deleteShader(shader)\r\n\t\t\treturn null\r\n\t\t}\r\n\r\n\t\treturn new GLShader(shader)\r\n\t}\r\n\t\r\n\t\r\n\tconstructor(id)\r\n\t{\r\n\t\tthis.id = id\r\n\t}\r\n}\r\n\r\n\r\nclass GLProgram\r\n{\r\n\tstatic makeFromSrc(gl, vertexSrc, fragmentSrc)\r\n\t{\r\n\t\tlet vertexShader = GLShader.makeVertex(gl, vertexSrc)\r\n\t\tif (vertexShader == null)\r\n\t\t\treturn\r\n\t\t\r\n\t\tlet fragmentShader = GLShader.makeFragment(gl, fragmentSrc)\r\n\t\tif (fragmentShader == null)\r\n\t\t\treturn\r\n\t\t\r\n\t\treturn GLProgram.make(gl, vertexShader, fragmentShader)\r\n\t}\r\n\t\r\n\t\r\n\tstatic make(gl, vertexShader, fragmentShader)\r\n\t{\r\n\t\tlet program = gl.createProgram()\r\n\t\tgl.attachShader(program, vertexShader.id)\r\n\t\tgl.attachShader(program, fragmentShader.id)\r\n\t\tgl.linkProgram(program)\r\n\t\t\r\n\t\tif (!gl.getProgramParameter(program, gl.LINK_STATUS))\r\n\t\t{\r\n\t\t\tconsole.error(\"Error creating program: \\n\\n\" + gl.getProgramInfoLog(program))\r\n\t\t\tgl.deleteProgram(program)\r\n\t\t\treturn null\r\n\t\t}\r\n\r\n\t\treturn new GLProgram(program)\r\n\t}\r\n\t\r\n\t\r\n\tconstructor(id)\r\n\t{\r\n\t\tthis.id = id\r\n\t\tthis.attributes = { }\r\n\t\tthis.uniforms = { }\r\n\t\t\r\n\t\tthis.hasColor = false\r\n\t}\r\n\t\r\n\t\r\n\tregisterLocations(gl, attrbs, unifs)\r\n\t{\r\n\t\tfor (let attrb of attrbs)\r\n\t\t\tthis.attributes[attrb] = gl.getAttribLocation(this.id, attrb)\r\n\t\t\r\n\t\tfor (let unif of unifs)\r\n\t\t\tthis.uniforms[unif] = gl.getUniformLocation(this.id, unif)\r\n\t\t\r\n\t\tthis.hasColor = (attrbs.find(a => a == \"aColor\") != null)\r\n\t\t\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tuse(gl)\r\n\t{\r\n\t\tgl.useProgram(this.id)\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tbindPosition(gl, attrb, buffer)\r\n\t{\r\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, buffer.id)\r\n\t\tgl.vertexAttribPointer(this.attributes[attrb], 3, gl.FLOAT, false, 0, 0)\r\n\t\tgl.enableVertexAttribArray(this.attributes[attrb])\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tbindNormals(gl, attrb, buffer)\r\n\t{\r\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, buffer.id)\r\n\t\tgl.vertexAttribPointer(this.attributes[attrb], 3, gl.FLOAT, false, 0, 0)\r\n\t\tgl.enableVertexAttribArray(this.attributes[attrb])\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tbindColors(gl, attrb, buffer)\r\n\t{\r\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, buffer.id)\r\n\t\tgl.vertexAttribPointer(this.attributes[attrb], 4, gl.FLOAT, false, 0, 0)\r\n\t\tgl.enableVertexAttribArray(this.attributes[attrb])\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetFloat(gl, unif, x)\r\n\t{\r\n\t\tgl.uniform1f(this.uniforms[unif], x)\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetMat4(gl, unif, matrix)\r\n\t{\r\n\t\tgl.uniformMatrix4fv(this.uniforms[unif], false, matrix.asFloat32Array())\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetVec4(gl, unif, vec)\r\n\t{\r\n\t\tgl.uniform4fv(this.uniforms[unif], new Float32Array(vec))\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tdrawTriangles(gl, count, offset = 0)\r\n\t{\r\n\t\tgl.drawArrays(gl.TRIANGLES, offset, count)\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tdrawTriangleStrip(gl, count, offset = 0)\r\n\t{\r\n\t\tgl.drawArrays(gl.TRIANGLE_STRIP, offset, count)\r\n\t\treturn this\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { GLShader, GLProgram }", "class Vec3\r\n{\r\n\tconstructor(x, y, z)\r\n\t{\r\n\t\tthis.x = x\r\n\t\tthis.y = y\r\n\t\tthis.z = z\r\n\t}\r\n\t\r\n\t\r\n\tclone()\r\n\t{\r\n\t\treturn new Vec3(this.x, this.y, this.z)\r\n\t}\r\n\r\n\r\n\tmagn()\r\n\t{\r\n\t\treturn Math.sqrt(this.dot(this))\r\n\t}\r\n\r\n\r\n\tnormalize()\r\n\t{\r\n\t\tconst magn = this.magn()\r\n\t\t\r\n\t\treturn new Vec3(\r\n\t\t\tthis.x / magn,\r\n\t\t\tthis.y / magn,\r\n\t\t\tthis.z / magn)\r\n\t}\r\n\r\n\r\n\tadd(other)\r\n\t{\r\n\t\treturn new Vec3(\r\n\t\t\tthis.x + other.x,\r\n\t\t\tthis.y + other.y,\r\n\t\t\tthis.z + other.z)\r\n\t}\r\n\r\n\r\n\tsub(other)\r\n\t{\r\n\t\treturn new Vec3(\r\n\t\t\tthis.x - other.x,\r\n\t\t\tthis.y - other.y,\r\n\t\t\tthis.z - other.z)\r\n\t}\r\n\r\n\r\n\tneg()\r\n\t{\r\n\t\treturn new Vec3(\r\n\t\t\t-this.x,\r\n\t\t\t-this.y,\r\n\t\t\t-this.z)\r\n\t}\r\n\r\n\r\n\tscale(f)\r\n\t{\r\n\t\treturn new Vec3(\r\n\t\t\tthis.x * f,\r\n\t\t\tthis.y * f,\r\n\t\t\tthis.z * f)\r\n\t}\r\n\r\n\r\n\tmul(other)\r\n\t{\r\n\t\treturn new Vec3(\r\n\t\t\tthis.x * other.x,\r\n\t\t\tthis.y * other.y,\r\n\t\t\tthis.z * other.z)\r\n\t}\r\n\r\n\r\n\tdot(other)\r\n\t{\r\n\t\treturn (this.x * other.x + this.y * other.y + this.z * other.z)\r\n\t}\r\n\r\n\r\n\tcross(other)\r\n\t{\r\n\t\treturn new Vec3(\r\n\t\t\tthis.y * other.z - this.z * other.y,\r\n\t\t\tthis.z * other.x - this.x * other.z,\r\n\t\t\tthis.x * other.y - this.y * other.x)\r\n\t}\r\n\t\r\n\t\r\n\tlerp(other, amount)\r\n\t{\r\n\t\treturn new Vec3(\r\n\t\t\tthis.x + (other.x - this.x) * amount,\r\n\t\t\tthis.y + (other.y - this.y) * amount,\r\n\t\t\tthis.z + (other.z - this.z) * amount)\r\n\t}\r\n\t\r\n\t\r\n\tmin(other)\r\n\t{\r\n\t\tif (other == null)\r\n\t\t\treturn this\r\n\t\t\r\n\t\treturn new Vec3(\r\n\t\t\tMath.min(this.x, other.x),\r\n\t\t\tMath.min(this.y, other.y),\r\n\t\t\tMath.min(this.z, other.z))\r\n\t}\r\n\t\r\n\t\r\n\tmax(other)\r\n\t{\r\n\t\tif (other == null)\r\n\t\t\treturn this\r\n\t\t\r\n\t\treturn new Vec3(\r\n\t\t\tMath.max(this.x, other.x),\r\n\t\t\tMath.max(this.y, other.y),\r\n\t\t\tMath.max(this.z, other.z))\r\n\t}\r\n\t\r\n\t\r\n\tproject(other)\r\n\t{\r\n\t\treturn other.scale(this.dot(other) / other.dot(other))\r\n\t}\r\n\r\n\t\r\n\tprojectOnPlane(planeNormal)\r\n\t{\r\n\t\treturn this.sub(this.project(planeNormal))\r\n\t}\r\n\t\r\n\t\r\n\tdirectionToPlane(planeNormal, pointOnPlane)\r\n\t{\r\n\t\tlet vec = this.sub(pointOnPlane)\r\n\t\tlet proj = vec.projectOnPlane(planeNormal)\r\n\t\t\r\n\t\treturn pointOnPlane.add(proj).sub(this)\r\n\t}\r\n\t\r\n\t\r\n\tasArray()\r\n\t{\r\n\t\treturn [this.x, this.y, this.z]\r\n\t}\r\n\t\r\n\t\r\n\tisFinite()\r\n\t{\r\n\t\treturn isFinite(this.x) && isFinite(this.y) && isFinite(this.z)\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { Vec3 }", "const { Vec3 } = require(\"./vec3.js\")\r\n\r\n\r\nclass Mat4\r\n{\r\n\tconstructor(cells)\r\n\t{\r\n\t\tthis.m = cells\r\n\t}\r\n\r\n\r\n\tstatic identity()\r\n\t{\r\n\t\treturn new Mat4(\r\n\t\t[\r\n\t\t\t[1, 0, 0, 0],\r\n\t\t\t[0, 1, 0, 0],\r\n\t\t\t[0, 0, 1, 0],\r\n\t\t\t[0, 0, 0, 1]\r\n\t\t])\r\n\t}\r\n\r\n\r\n\tstatic translation(x, y, z)\r\n\t{\r\n\t\treturn new Mat4(\r\n\t\t[\r\n\t\t\t[1, 0, 0, 0],\r\n\t\t\t[0, 1, 0, 0],\r\n\t\t\t[0, 0, 1, 0],\r\n\t\t\t[x, y, z, 1]\r\n\t\t])\r\n\t}\r\n\r\n\r\n\tstatic scale(x, y, z)\r\n\t{\r\n\t\treturn new Mat4(\r\n\t\t[\r\n\t\t\t[x, 0, 0, 0],\r\n\t\t\t[0, y, 0, 0],\r\n\t\t\t[0, 0, z, 0],\r\n\t\t\t[0, 0, 0, 1]\r\n\t\t])\r\n\t}\r\n\r\n\r\n\tstatic rotation(vec, radians)\r\n\t{\r\n\t\tconst x = vec.x\r\n\t\tconst y = vec.y\r\n\t\tconst z = vec.z\r\n\t\tconst c = Math.cos(radians)\r\n\t\tconst s = Math.sin(radians)\r\n\t\tconst t = 1 - c\r\n\r\n\t\treturn new Mat4(\r\n\t\t[\r\n\t\t\t[t*x*x + c,    t*x*y - z*s,  t*x*z + y*s, 0],\r\n\t\t\t[t*x*y + z*s,  t*y*y + c,    t*y*z - x*s, 0],\r\n\t\t\t[t*x*z - y*s,  t*y*z + x*s,  t*z*z + c,   0],\r\n\t\t\t[          0,            0,          0,   1]\r\n\t\t])\r\n\t}\r\n\t\r\n\t\r\n\tstatic rotationFromTo(fromVec, toVec)\r\n\t{\r\n\t\tconst axis = fromVec.cross(toVec).normalize()\r\n\t\tconst angle = Math.acos(fromVec.dot(toVec))\r\n\r\n\t\tif (angle == 0)\r\n\t\t\treturn Mat4.identity()\r\n\t\tif (angle == Math.PI && fromVec.magn() == Math.abs(fromVec.z))\r\n\t\t\treturn Mat4.rotation(new Vec3(1, 0, 0), Math.PI)\r\n\t\tif (angle == Math.PI)\r\n\t\t\treturn Mat4.rotation(new Vec3(0, 0, 1), Math.PI)\r\n\t\t\r\n\t\treturn Mat4.rotation(axis, -angle)\r\n\t}\r\n\t\r\n\t\r\n\tstatic basisRotation(i1, j1, k1, i2, j2, k2)\r\n\t{\r\n\t\tconst basis1 = new Mat4(\r\n\t\t[\r\n\t\t\t[i1.x, j1.x, k1.x, 0],\r\n\t\t\t[i1.y, j1.y, k1.y, 0],\r\n\t\t\t[i1.z, j1.z, k1.z, 0],\r\n\t\t\t[   0,    0,    0, 1],\r\n\t\t])\r\n\t\t\r\n\t\tconst basis2 = new Mat4(\r\n\t\t[\r\n\t\t\t[i2.x, j2.x, k2.x, 0],\r\n\t\t\t[i2.y, j2.y, k2.y, 0],\r\n\t\t\t[i2.z, j2.z, k2.z, 0],\r\n\t\t\t[   0,    0,    0, 1],\r\n\t\t])\r\n\t\t\r\n\t\treturn basis1.mul(basis2.transpose())\r\n\t}\r\n\r\n\r\n\tstatic ortho(left, right, top, bottom, near, far)\r\n\t{\r\n\t\treturn new Mat4(\r\n\t\t[\r\n\t\t\t[               2 / (right - left),                                0,                            0, 0 ],\r\n\t\t\t[                                0,               2 / (top - bottom),                            0, 0 ],\r\n\t\t\t[                                0,                                0,            -2 / (far - near), 0 ],\r\n\t\t\t[ -(right + left) / (right - left), -(top + bottom) / (top - bottom), -(far + near) / (far - near), 1 ]\r\n\t\t])\r\n\t}\r\n\r\n\r\n\tstatic frustum(left, right, top, bottom, near, far)\r\n\t{\r\n\t\treturn new Mat4(\r\n\t\t[\r\n\t\t\t[       2 * near / (right - left),                               0,                                0,  0 ],\r\n\t\t\t[                               0,       2 * near / (top - bottom),                                0,  0 ],\r\n\t\t\t[ (right + left) / (right - left), (top + bottom) / (top - bottom),     -(far + near) / (far - near), -1 ],\r\n\t\t\t[                               0,                               0, -(2 * far * near) / (far - near),  0 ]\r\n\t\t])\r\n\t}\r\n\r\n\r\n\tstatic perspective(fovyRadians, aspectWidthByHeight, near, far)\r\n\t{\r\n\t\tconst h = Math.tan(fovyRadians) * near\r\n\t\tconst w = h * aspectWidthByHeight\r\n\t\t\r\n\t\treturn Mat4.frustum(-w, w, -h, h, near, far)\r\n\t}\r\n\r\n\r\n\tstatic lookat(eye, target, up)\r\n\t{\r\n\t\tconst zaxis = eye.sub(target).normalize()\r\n\t\tconst xaxis = zaxis.cross(up).normalize()\r\n\t\tconst yaxis = zaxis.cross(xaxis)\r\n\r\n\t\treturn new Mat4(\r\n\t\t[\r\n\t\t\t[         xaxis.x,         yaxis.x,         zaxis.x, 0 ],\r\n\t\t\t[         xaxis.y,         yaxis.y,         zaxis.y, 0 ],\r\n\t\t\t[         xaxis.z,         yaxis.z,         zaxis.z, 0 ],\r\n\t\t\t[ -xaxis.dot(eye), -yaxis.dot(eye), -zaxis.dot(eye), 1 ]\r\n\t\t])\r\n\t}\r\n\r\n\r\n\ttranspose()\r\n\t{\r\n\t\treturn new Mat4(\r\n\t\t[\r\n\t\t\t[ this.m[0][0], this.m[1][0], this.m[2][0], this.m[3][0] ],\r\n\t\t\t[ this.m[0][1], this.m[1][1], this.m[2][1], this.m[3][1] ],\r\n\t\t\t[ this.m[0][2], this.m[1][2], this.m[2][2], this.m[3][2] ],\r\n\t\t\t[ this.m[0][3], this.m[1][3], this.m[2][3], this.m[3][3] ]\r\n\t\t])\r\n\t}\r\n\r\n\r\n\tmul(other)\r\n\t{\r\n\t\tconst a00 = +this.m[0][0]\r\n\t\tconst a01 = +this.m[0][1]\r\n\t\tconst a02 = +this.m[0][2]\r\n\t\tconst a03 = +this.m[0][3]\r\n\t\tconst a10 = +this.m[1][0]\r\n\t\tconst a11 = +this.m[1][1]\r\n\t\tconst a12 = +this.m[1][2]\r\n\t\tconst a13 = +this.m[1][3]\r\n\t\tconst a20 = +this.m[2][0]\r\n\t\tconst a21 = +this.m[2][1]\r\n\t\tconst a22 = +this.m[2][2]\r\n\t\tconst a23 = +this.m[2][3]\r\n\t\tconst a30 = +this.m[3][0]\r\n\t\tconst a31 = +this.m[3][1]\r\n\t\tconst a32 = +this.m[3][2]\r\n\t\tconst a33 = +this.m[3][3]\r\n\t\t\r\n\t\tconst b00 = +other.m[0][0]\r\n\t\tconst b01 = +other.m[0][1]\r\n\t\tconst b02 = +other.m[0][2]\r\n\t\tconst b03 = +other.m[0][3]\r\n\t\tconst b10 = +other.m[1][0]\r\n\t\tconst b11 = +other.m[1][1]\r\n\t\tconst b12 = +other.m[1][2]\r\n\t\tconst b13 = +other.m[1][3]\r\n\t\tconst b20 = +other.m[2][0]\r\n\t\tconst b21 = +other.m[2][1]\r\n\t\tconst b22 = +other.m[2][2]\r\n\t\tconst b23 = +other.m[2][3]\r\n\t\tconst b30 = +other.m[3][0]\r\n\t\tconst b31 = +other.m[3][1]\r\n\t\tconst b32 = +other.m[3][2]\r\n\t\tconst b33 = +other.m[3][3]\r\n\t\t\r\n\t\tconst m00 = (a00 * b00) + (a01 * b10) + (a02 * b20) + (a03 * b30) \r\n\t\tconst m01 = (a00 * b01) + (a01 * b11) + (a02 * b21) + (a03 * b31) \r\n\t\tconst m02 = (a00 * b02) + (a01 * b12) + (a02 * b22) + (a03 * b32) \r\n\t\tconst m03 = (a00 * b03) + (a01 * b13) + (a02 * b23) + (a03 * b33) \r\n\t\tconst m10 = (a10 * b00) + (a11 * b10) + (a12 * b20) + (a13 * b30) \r\n\t\tconst m11 = (a10 * b01) + (a11 * b11) + (a12 * b21) + (a13 * b31) \r\n\t\tconst m12 = (a10 * b02) + (a11 * b12) + (a12 * b22) + (a13 * b32) \r\n\t\tconst m13 = (a10 * b03) + (a11 * b13) + (a12 * b23) + (a13 * b33) \r\n\t\tconst m20 = (a20 * b00) + (a21 * b10) + (a22 * b20) + (a23 * b30) \r\n\t\tconst m21 = (a20 * b01) + (a21 * b11) + (a22 * b21) + (a23 * b31) \r\n\t\tconst m22 = (a20 * b02) + (a21 * b12) + (a22 * b22) + (a23 * b32) \r\n\t\tconst m23 = (a20 * b03) + (a21 * b13) + (a22 * b23) + (a23 * b33) \r\n\t\tconst m30 = (a30 * b00) + (a31 * b10) + (a32 * b20) + (a33 * b30) \r\n\t\tconst m31 = (a30 * b01) + (a31 * b11) + (a32 * b21) + (a33 * b31) \r\n\t\tconst m32 = (a30 * b02) + (a31 * b12) + (a32 * b22) + (a33 * b32) \r\n\t\tconst m33 = (a30 * b03) + (a31 * b13) + (a32 * b23) + (a33 * b33) \r\n\r\n\t\treturn new Mat4(\r\n\t\t[\r\n\t\t\t[m00, m01, m02, m03],\r\n\t\t\t[m10, m11, m12, m13],\r\n\t\t\t[m20, m21, m22, m23],\r\n\t\t\t[m30, m31, m32, m33]\r\n\t\t])\r\n\t\t\r\n\t\t/*let result =\r\n\t\t[\r\n\t\t\t[0, 0, 0, 0],\r\n\t\t\t[0, 0, 0, 0],\r\n\t\t\t[0, 0, 0, 0],\r\n\t\t\t[0, 0, 0, 0]\r\n\t\t]\r\n\r\n\t\tfor (let j = 0; j < 4; j++)\r\n\t\t{\r\n\t\t\tfor (let i = 0; i < 4; i++)\r\n\t\t\t{\r\n\t\t\t\tlet acc = 0\r\n\t\t\t\tfor (let k = 0; k < 4; k++)\r\n\t\t\t\t\tacc += this.m[j][k] * other.m[k][i]\r\n\t\t\t\t\r\n\t\t\t\tresult[j][i] = acc\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn new Mat4(result)*/\r\n\t}\r\n\r\n\r\n\tmulVec4(v)\r\n\t{\r\n\t\tlet result = [0, 0, 0, 0]\r\n\r\n\t\tfor (let i = 0; i < 4; i++)\r\n\t\t{\r\n\t\t\tlet acc = 0\r\n\t\t\tfor (let k = 0; k < 4; k++)\r\n\t\t\t\tacc += this.m[i][k] * v[k]\r\n\t\t\t\r\n\t\t\tresult[i] = acc\r\n\t\t}\r\n\r\n\t\treturn result\r\n\t}\r\n\r\n\r\n\tmulPoint(vec)\r\n\t{\r\n\t\tconst v = [vec.x, vec.y, vec.z, 1]\r\n\t\tlet result = [0, 0, 0, 0]\r\n\r\n\t\tfor (let i = 0; i < 4; i++)\r\n\t\t{\r\n\t\t\tlet acc = 0\r\n\t\t\tfor (let k = 0; k < 4; k++)\r\n\t\t\t\tacc += this.m[i][k] * v[k]\r\n\t\t\t\r\n\t\t\tresult[i] = acc\r\n\t\t}\r\n\r\n\t\treturn new Vec3(result[0], result[1], result[2])\r\n\t}\r\n\r\n\r\n\tmulDirection(vec)\r\n\t{\r\n\t\tconst v = [vec.x, vec.y, vec.z, 0]\r\n\t\tlet result = [0, 0, 0, 0]\r\n\r\n\t\tfor (let i = 0; i < 4; i++)\r\n\t\t{\r\n\t\t\tlet acc = 0\r\n\t\t\tfor (let k = 0; k < 4; k++)\r\n\t\t\t\tacc += this.m[i][k] * v[k]\r\n\t\t\t\r\n\t\t\tresult[i] = acc\r\n\t\t}\r\n\r\n\t\treturn new Vec3(result[0], result[1], result[2])\r\n\t}\r\n\t\r\n\t\r\n\tasFloat32Array()\r\n\t{\r\n\t\treturn new Float32Array([\r\n\t\t\tthis.m[0][0], this.m[0][1], this.m[0][2], this.m[0][3],\r\n\t\t\tthis.m[1][0], this.m[1][1], this.m[1][2], this.m[1][3],\r\n\t\t\tthis.m[2][0], this.m[2][1], this.m[2][2], this.m[2][3],\r\n\t\t\tthis.m[3][0], this.m[3][1], this.m[3][2], this.m[3][3]])\r\n\t}\r\n\t\r\n\t\r\n\tinvert()\r\n\t{\r\n\t\t// From https://stackoverflow.com/questions/1148309/inverting-a-4x4-matrix\r\n\t\t\r\n\t\tconst a2323 = this.m[2][2] * this.m[3][3] - this.m[2][3] * this.m[3][2]\r\n\t\tconst a1323 = this.m[2][1] * this.m[3][3] - this.m[2][3] * this.m[3][1]\r\n\t\tconst a1223 = this.m[2][1] * this.m[3][2] - this.m[2][2] * this.m[3][1]\r\n\t\tconst a0323 = this.m[2][0] * this.m[3][3] - this.m[2][3] * this.m[3][0]\r\n\t\tconst a0223 = this.m[2][0] * this.m[3][2] - this.m[2][2] * this.m[3][0]\r\n\t\tconst a0123 = this.m[2][0] * this.m[3][1] - this.m[2][1] * this.m[3][0]\r\n\t\tconst a2313 = this.m[1][2] * this.m[3][3] - this.m[1][3] * this.m[3][2]\r\n\t\tconst a1313 = this.m[1][1] * this.m[3][3] - this.m[1][3] * this.m[3][1]\r\n\t\tconst a1213 = this.m[1][1] * this.m[3][2] - this.m[1][2] * this.m[3][1]\r\n\t\tconst a2312 = this.m[1][2] * this.m[2][3] - this.m[1][3] * this.m[2][2]\r\n\t\tconst a1312 = this.m[1][1] * this.m[2][3] - this.m[1][3] * this.m[2][1]\r\n\t\tconst a1212 = this.m[1][1] * this.m[2][2] - this.m[1][2] * this.m[2][1]\r\n\t\tconst a0313 = this.m[1][0] * this.m[3][3] - this.m[1][3] * this.m[3][0]\r\n\t\tconst a0213 = this.m[1][0] * this.m[3][2] - this.m[1][2] * this.m[3][0]\r\n\t\tconst a0312 = this.m[1][0] * this.m[2][3] - this.m[1][3] * this.m[2][0]\r\n\t\tconst a0212 = this.m[1][0] * this.m[2][2] - this.m[1][2] * this.m[2][0]\r\n\t\tconst a0113 = this.m[1][0] * this.m[3][1] - this.m[1][1] * this.m[3][0]\r\n\t\tconst a0112 = this.m[1][0] * this.m[2][1] - this.m[1][1] * this.m[2][0]\r\n\r\n\t\tconst det = 1 / (\r\n\t\t\tthis.m[0][0] * (this.m[1][1] * a2323 - this.m[1][2] * a1323 + this.m[1][3] * a1223) -\r\n\t\t\tthis.m[0][1] * (this.m[1][0] * a2323 - this.m[1][2] * a0323 + this.m[1][3] * a0223) + \r\n\t\t\tthis.m[0][2] * (this.m[1][0] * a1323 - this.m[1][1] * a0323 + this.m[1][3] * a0123) -\r\n\t\t\tthis.m[0][3] * (this.m[1][0] * a1223 - this.m[1][1] * a0223 + this.m[1][2] * a0123))\r\n\t\t\r\n\t\treturn new Mat4(\r\n\t\t[\r\n\t\t\t[\r\n\t\t\t\tdet *  (this.m[1][1] * a2323 - this.m[1][2] * a1323 + this.m[1][3] * a1223),\r\n\t\t\t\tdet * -(this.m[0][1] * a2323 - this.m[0][2] * a1323 + this.m[0][3] * a1223),\r\n\t\t\t\tdet *  (this.m[0][1] * a2313 - this.m[0][2] * a1313 + this.m[0][3] * a1213),\r\n\t\t\t\tdet * -(this.m[0][1] * a2312 - this.m[0][2] * a1312 + this.m[0][3] * a1212)\r\n\t\t\t],\r\n\t\t\t[\r\n\t\t\t\tdet * -(this.m[1][0] * a2323 - this.m[1][2] * a0323 + this.m[1][3] * a0223),\r\n\t\t\t\tdet *  (this.m[0][0] * a2323 - this.m[0][2] * a0323 + this.m[0][3] * a0223),\r\n\t\t\t\tdet * -(this.m[0][0] * a2313 - this.m[0][2] * a0313 + this.m[0][3] * a0213),\r\n\t\t\t\tdet *  (this.m[0][0] * a2312 - this.m[0][2] * a0312 + this.m[0][3] * a0212)\r\n\t\t\t],\r\n\t\t\t[\r\n\t\t\t\tdet *  (this.m[1][0] * a1323 - this.m[1][1] * a0323 + this.m[1][3] * a0123),\r\n\t\t\t\tdet * -(this.m[0][0] * a1323 - this.m[0][1] * a0323 + this.m[0][3] * a0123),\r\n\t\t\t\tdet *  (this.m[0][0] * a1313 - this.m[0][1] * a0313 + this.m[0][3] * a0113),\r\n\t\t\t\tdet * -(this.m[0][0] * a1312 - this.m[0][1] * a0312 + this.m[0][3] * a0112)\r\n\t\t\t],\r\n\t\t\t[\r\n\t\t\t\tdet * -(this.m[1][0] * a1223 - this.m[1][1] * a0223 + this.m[1][2] * a0123),\r\n\t\t\t\tdet *  (this.m[0][0] * a1223 - this.m[0][1] * a0223 + this.m[0][2] * a0123),\r\n\t\t\t\tdet * -(this.m[0][0] * a1213 - this.m[0][1] * a0213 + this.m[0][2] * a0113),\r\n\t\t\t\tdet *  (this.m[0][0] * a1212 - this.m[0][1] * a0212 + this.m[0][2] * a0112)\r\n\t\t\t]\r\n\t\t]).transpose()\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { Mat4 }", "const { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\n\r\n\r\nclass GfxScene\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.root = new GfxNode()\r\n\t}\r\n\t\r\n\t\r\n\tclear(gl, r = 0, g = 0, b = 0, a = 1, depth = 1)\r\n\t{\r\n\t\tgl.clearColor(r, g, b, a)\r\n\t\tgl.clearDepth(depth)\r\n\t\t\r\n\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)\r\n\t}\r\n\t\r\n\t\r\n\tclearDepth(gl, depth = 1)\r\n\t{\r\n\t\tgl.clearDepth(depth)\r\n\t\t\r\n\t\tgl.clear(gl.DEPTH_BUFFER_BIT)\r\n\t}\r\n\t\r\n\t\r\n\trender(gl, camera)\r\n\t{\r\n\t\tthis.renderNode(gl, camera, null, this.root)\r\n\t}\r\n\t\r\n\t\r\n\trenderNode(gl, camera, transform, node)\r\n\t{\r\n\t\tif (!node.enabled)\r\n\t\t\treturn\r\n\t\t\r\n\t\tif ((node instanceof GfxNodeTransform) || (node instanceof GfxNodeRendererTransform))\r\n\t\t{\r\n\t\t\tlet nodeMatrix = node.computeMatrix()\r\n\t\t\ttransform = (transform == null ? nodeMatrix : transform.mul(nodeMatrix))\r\n\t\t}\r\n\t\t\r\n\t\tif ((node instanceof GfxNodeRenderer) || (node instanceof GfxNodeRendererTransform))\r\n\t\t{\r\n\t\t\tif (node.material != null && node.model != null)\r\n\t\t\t{\t\t\t\r\n\t\t\t\tnode.material.program.use(gl)\r\n\t\t\t\tnode.material.program.bindPosition(gl, \"aPosition\", node.model.positions)\r\n\t\t\t\tnode.material.program.bindNormals(gl, \"aNormal\", node.model.normals)\r\n\t\t\t\t\r\n\t\t\t\tif (node.material.program.hasColor)\r\n\t\t\t\t\tnode.material.program.bindColors(gl, \"aColor\", node.model.colors)\r\n\t\t\t\t\r\n\t\t\t\tif (node.material.lastProjectionMatrix !== camera.projection)\r\n\t\t\t\t{\r\n\t\t\t\t\tnode.material.lastProjectionMatrix = camera.projection\r\n\t\t\t\t\tnode.material.program.setMat4(gl, \"uMatProj\", camera.projection)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (node.material.lastViewMatrix !== camera.view)\r\n\t\t\t\t{\r\n\t\t\t\t\tnode.material.lastViewMatrix = camera.view\r\n\t\t\t\t\tnode.material.program.setMat4(gl, \"uMatView\", camera.view)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tnode.material.program.setMat4(gl, \"uMatModel\", transform != null ? transform : Mat4.identity())\r\n\t\t\t\tnode.material.program.setVec4(gl, \"uDiffuseColor\", node.diffuseColor)\r\n\t\t\t\tnode.material.program.drawTriangles(gl, node.model.positions.count / 3)\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfor (let child of node.children)\r\n\t\t\tthis.renderNode(gl, camera, transform, child)\t\r\n\t}\r\n}\r\n\r\n\r\nclass GfxCamera\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.projection = Mat4.identity()\r\n\t\tthis.view = Mat4.identity()\r\n\t}\r\n\t\r\n\t\r\n\tsetProjection(matrix)\r\n\t{\r\n\t\tthis.projection = matrix\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetView(matrix)\r\n\t{\r\n\t\tthis.view = matrix\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tcomputeMatrix()\r\n\t{\r\n\t\treturn this.projection.mul(this.view)\r\n\t}\t\r\n}\r\n\r\n\r\nclass GfxMaterial\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.program = null\r\n\t}\r\n\t\r\n\t\r\n\tsetProgram(program)\r\n\t{\r\n\t\tthis.program = program\r\n\t\treturn this\r\n\t}\r\n}\r\n\r\n\r\nclass GfxModel\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.positions = null\r\n\t\tthis.normals = null\r\n\t\tthis.colors = null\r\n\t}\r\n\t\r\n\t\r\n\tsetPositions(positions)\r\n\t{\r\n\t\tthis.positions = positions\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetNormals(normals)\r\n\t{\r\n\t\tthis.normals = normals\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetColors(colors)\r\n\t{\r\n\t\tthis.colors = colors\r\n\t\treturn this\r\n\t}\r\n}\r\n\r\n\r\nclass GfxNode\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.parent = null\r\n\t\tthis.children = []\r\n\t\tthis.enabled = true\r\n\t}\r\n\t\r\n\t\r\n\tattach(parent)\r\n\t{\r\n\t\tthis.detach()\r\n\t\tparent.children.push(this)\r\n\t\tthis.parent = parent\r\n\t\t\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tdetach()\r\n\t{\r\n\t\tif (this.parent != null)\r\n\t\t{\r\n\t\t\tthis.parent.children.splice(this.parent.children.indexOf(this), 1)\r\n\t\t\tthis.parent = null\r\n\t\t}\r\n\t\t\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetEnabled(enabled)\r\n\t{\r\n\t\tthis.enabled = enabled\r\n\t\treturn this\r\n\t}\r\n}\r\n\r\n\r\nclass GfxNodeTransform extends GfxNode\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tsuper()\r\n\t\tthis.translation = null\r\n\t\tthis.scaling = null\r\n\t\tthis.rotationAxis = null\r\n\t\tthis.rotationAngle = null\r\n\t\tthis.customMatrix = null\r\n\t}\r\n\t\r\n\t\r\n\tsetTranslation(vec)\r\n\t{\r\n\t\tthis.translation = vec\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetRotation(axis, angle)\r\n\t{\r\n\t\tthis.rotationAxis = axis\r\n\t\tthis.rotationAngle = angle\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetScaling(vec)\r\n\t{\r\n\t\tthis.scaling = vec\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetCustom(matrix)\r\n\t{\r\n\t\tthis.customMatrix = matrix\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tcomputeMatrix()\r\n\t{\r\n\t\tlet matrix = Mat4.identity()\r\n\t\t\r\n\t\tif (this.customMatrix != null)\r\n\t\t\tmatrix = this.customMatrix\r\n\t\t\t\r\n\t\tif (this.translation != null)\r\n\t\t\tmatrix = matrix.mul(Mat4.translation(this.translation.x, this.translation.y, this.translation.z))\r\n\t\t\r\n\t\tif (this.scaling != null)\r\n\t\t\tmatrix = matrix.mul(Mat4.scale(this.scaling.x, this.scaling.y, this.scaling.z))\r\n\t\t\r\n\t\tif (this.rotationAxis != null)\r\n\t\t\tmatrix = matrix.mul(Mat4.rotation(this.rotationAxis, this.rotationAngle))\r\n\t\t\t\r\n\t\treturn matrix\r\n\t}\r\n}\r\n\r\n\r\nclass GfxNodeRenderer extends GfxNode\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tsuper()\r\n\t\tthis.model = null\r\n\t\tthis.material = null\r\n\t\tthis.diffuseColor = [1, 1, 1, 1]\r\n\t}\r\n\t\r\n\t\r\n\tsetModel(model)\r\n\t{\r\n\t\tthis.model = model\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetMaterial(material)\r\n\t{\r\n\t\tthis.material = material\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetDiffuseColor(color)\r\n\t{\r\n\t\tthis.diffuseColor = color\r\n\t\treturn this\r\n\t}\r\n}\r\n\r\n\r\nclass GfxNodeRendererTransform extends GfxNode\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tsuper()\r\n\t\tthis.model = null\r\n\t\tthis.material = null\r\n\t\tthis.diffuseColor = [1, 1, 1, 1]\r\n\t\t\r\n\t\tthis.translation = null\r\n\t\tthis.scaling = null\r\n\t\tthis.rotationAxis = null\r\n\t\tthis.rotationAngle = null\r\n\t\tthis.customMatrix = null\r\n\t}\r\n\t\r\n\t\r\n\tsetModel(model)\r\n\t{\r\n\t\tthis.model = model\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetMaterial(material)\r\n\t{\r\n\t\tthis.material = material\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetDiffuseColor(color)\r\n\t{\r\n\t\tthis.diffuseColor = color\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetTranslation(vec)\r\n\t{\r\n\t\tthis.translation = vec\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetRotation(axis, angle)\r\n\t{\r\n\t\tthis.rotationAxis = axis\r\n\t\tthis.rotationAngle = angle\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetScaling(vec)\r\n\t{\r\n\t\tthis.scaling = vec\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tsetCustomMatrix(matrix)\r\n\t{\r\n\t\tthis.customMatrix = matrix\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tcomputeMatrix()\r\n\t{\r\n\t\tlet matrix = Mat4.identity()\r\n\t\t\r\n\t\tif (this.customMatrix != null)\r\n\t\t\tmatrix = matrix.mul(this.customMatrix)\r\n\t\t\t\r\n\t\tif (this.scaling != null)\r\n\t\t\tmatrix = matrix.mul(Mat4.scale(this.scaling.x, this.scaling.y, this.scaling.z))\r\n\t\t\r\n\t\tif (this.translation != null)\r\n\t\t\tmatrix = matrix.mul(Mat4.translation(this.translation.x, this.translation.y, this.translation.z))\r\n\t\t\r\n\t\tif (this.rotationAxis != null)\r\n\t\t\tmatrix = matrix.mul(Mat4.rotation(this.rotationAxis, this.rotationAngle))\r\n\t\t\t\r\n\t\treturn matrix\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports =\r\n\t{\r\n\t\tGfxScene,\r\n\t\tGfxCamera,\r\n\t\tGfxMaterial,\r\n\t\tGfxModel,\r\n\t\tGfxNode,\r\n\t\tGfxNodeTransform,\r\n\t\tGfxNodeRenderer,\r\n\t\tGfxNodeRendererTransform\r\n\t}", "class GLBuffer\r\n{\r\n\tstatic makePosition(gl, positions)\r\n\t{\r\n\t\treturn GLBuffer.make(gl, positions)\r\n\t}\r\n\t\r\n\t\r\n\tstatic makeNormal(gl, normals)\r\n\t{\r\n\t\treturn GLBuffer.make(gl, normals)\r\n\t}\r\n\t\r\n\t\r\n\tstatic makeColor(gl, colors)\r\n\t{\r\n\t\treturn GLBuffer.make(gl, colors)\r\n\t}\r\n\t\r\n\t\r\n\tstatic make(gl, data)\r\n\t{\r\n\t\tlet buffer = gl.createBuffer()\r\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, buffer)\r\n\t\tgl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW)\r\n\t\t\r\n\t\treturn new GLBuffer(buffer, data.length)\r\n\t}\r\n\t\r\n\t\r\n\tconstructor(id, count)\r\n\t{\r\n\t\tthis.id = id\r\n\t\tthis.count = count\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { GLBuffer }", "const { Vec3 } = require(\"../math/vec3.js\")\r\n\r\n\r\nclass CollisionMesh\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.triangles = []\r\n\t\t\r\n\t\tthis.bboxMin = null\r\n\t\tthis.bboxMax = null\r\n\t\t\r\n\t\tthis.cacheSubdiv = null\r\n\t}\r\n\t\r\n\t\r\n\taddTri(v1, v2, v3)\r\n\t{\r\n\t\tlet tri = {}\r\n\t\ttri.v1 = v1,\r\n\t\ttri.v1to2 = v2.sub(v1),\r\n\t\ttri.v1to3 = v3.sub(v1),\r\n\t\ttri.normal = tri.v1to2.cross(tri.v1to3).normalize()\r\n\t\t\r\n\t\ttri.bboxMin = v1.min(v2.min(v3))\r\n\t\ttri.bboxMax = v1.max(v2.max(v3))\r\n\t\t\r\n\t\tthis.bboxMin = tri.bboxMin.min(this.bboxMin)\r\n\t\tthis.bboxMax = tri.bboxMax.max(this.bboxMax)\r\n\t\t\r\n\t\tthis.triangles.push(tri)\r\n\t\tthis.cacheSubdiv = null\r\n\t}\r\n\t\r\n\t\r\n\tbuildCacheSubdiv(xSubdivs = 10, ySubdivs = 10, zSubdivs = 10)\r\n\t{\r\n\t\tif (this.triangles.length == 0)\r\n\t\t\treturn this\r\n\t\t\r\n\t\tlet cache = \r\n\t\t{\r\n\t\t\txSubdivs: xSubdivs,\r\n\t\t\tySubdivs: ySubdivs,\r\n\t\t\tzSubdivs: zSubdivs,\r\n\t\t\tcells: []\r\n\t\t}\r\n\t\t\r\n\t\tfor (let zSubdiv = 0; zSubdiv < zSubdivs; zSubdiv++)\r\n\t\t{\r\n\t\t\tlet zCells = []\r\n\t\t\tlet zMin = this.bboxMin.z + (this.bboxMax.z - this.bboxMax.z) / zSubdivs * zSubdiv\r\n\t\t\tlet zMax = this.bboxMin.z + (this.bboxMax.z - this.bboxMax.z) / zSubdivs * (zSubdiv + 1)\r\n\t\t\t\r\n\t\t\tfor (let ySubdiv = 0; ySubdiv < ySubdivs; ySubdiv++)\r\n\t\t\t{\r\n\t\t\t\tlet yCells = []\r\n\t\t\t\tlet yMin = this.bboxMin.y + (this.bboxMax.y - this.bboxMax.y) / ySubdivs * ySubdiv\r\n\t\t\t\tlet yMax = this.bboxMin.y + (this.bboxMax.y - this.bboxMax.y) / ySubdivs * (ySubdiv + 1)\r\n\t\t\t\r\n\t\t\t\tfor (let xSubdiv = 0; xSubdiv < xSubdivs; xSubdiv++)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet xCells = []\r\n\t\t\t\t\tlet xMin = this.bboxMin.x + (this.bboxMax.x - this.bboxMax.x) / xSubdivs * xSubdiv\r\n\t\t\t\t\tlet xMax = this.bboxMin.x + (this.bboxMax.x - this.bboxMax.x) / xSubdivs * (xSubdiv + 1)\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor (let tri of this.triangles)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (tri.bboxMin.x - 1 > xMax || tri.bboxMax.x + 1 < xMin)\r\n\t\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (tri.bboxMin.y - 1 > yMax || tri.bboxMax.y + 1 < yMin)\r\n\t\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (tri.bboxMin.z - 1 > zMax || tri.bboxMax.z + 1 < zMin)\r\n\t\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\txCells.push(tri)\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tyCells.push(xCells)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tzCells.push(yCells)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tcache.cells.push(zCells)\r\n\t\t}\r\n\t\t\r\n\t\tthis.cacheSubdiv = cache\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\traycast(origin, dir, margin = 0.000001)\r\n\t{\r\n\t\tif (false)//this.cacheSubdiv != null)\r\n\t\t{\r\n\t\t\tlet cache = this.cacheSubdiv\r\n\t\t\t\r\n\t\t\tlet current = origin\r\n\t\t\tlet step = dir.normalize().scale(Math.min(\r\n\t\t\t\t(this.bboxMax.x - this.bboxMin.x) / cache.xSubdivs,\r\n\t\t\t\t(this.bboxMax.y - this.bboxMin.y) / cache.ySubdivs,\r\n\t\t\t\t(this.bboxMax.z - this.bboxMin.z) / cache.zSubdivs) * 0.9)\r\n\t\t\t\t\r\n\t\t\tlet lastZCell = -1\r\n\t\t\tlet lastYCell = -1\r\n\t\t\tlet lastXCell = -1\r\n\t\t\tfor (let i = 0; i < 500; i++)\r\n\t\t\t{\r\n\t\t\t\tif ((current.x > this.bboxMax.x && dir.x > 0) ||\r\n\t\t\t\t\t(current.x < this.bboxMin.x && dir.x < 0) ||\r\n\t\t\t\t\t(current.y > this.bboxMax.y && dir.y > 0) ||\r\n\t\t\t\t\t(current.y < this.bboxMin.y && dir.y < 0) ||\r\n\t\t\t\t\t(current.z > this.bboxMax.z && dir.z > 0) ||\r\n\t\t\t\t\t(current.z < this.bboxMin.z && dir.z < 0))\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\r\n\t\t\t\tlet xCell = Math.floor((current.x - this.bboxMin.x) / (this.bboxMax.x - this.bboxMin.x) * cache.xSubdivs)\r\n\t\t\t\tlet yCell = Math.floor((current.y - this.bboxMin.y) / (this.bboxMax.y - this.bboxMin.y) * cache.ySubdivs)\r\n\t\t\t\tlet zCell = Math.floor((current.z - this.bboxMin.z) / (this.bboxMax.z - this.bboxMin.z) * cache.zSubdivs)\r\n\t\t\t\t\r\n\t\t\t\tif (xCell >= 0 && xCell < cache.xSubdivs)\r\n\t\t\t\tif (yCell >= 0 && yCell < cache.ySubdivs)\r\n\t\t\t\tif (zCell >= 0 && zCell < cache.zSubdivs)\r\n\t\t\t\tif (xCell != lastXCell || yCell != lastYCell || zCell != lastZCell)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet hit = this.raycastTris(origin, dir, cache.cells[zCell][yCell][xCell], margin)\r\n\t\t\t\t\tif (hit != null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconsole.log(i)\r\n\t\t\t\t\t\treturn hit\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlastXCell = xCell\r\n\t\t\t\tlastYCell = yCell\r\n\t\t\t\tlastZCell = zCell\r\n\t\t\t\t\r\n\t\t\t\tcurrent = current.add(step)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn null\r\n\t\t}\r\n\t\t\t\r\n\t\t\r\n\t\treturn this.raycastTris(origin, dir, this.triangles, margin)\r\n\t}\r\n\t\r\n\t\r\n\traycastTris(origin, dir, tris, margin = 0.000001)\r\n\t{\r\n\t\tlet nearestHit = null\r\n\t\t\r\n\t\tfor (let tri of tris)\r\n\t\t{\r\n\t\t\tconst crossP = dir.cross(tri.v1to2)\r\n\t\t\tconst det = crossP.dot(tri.v1to3)\r\n\t\t\t\r\n\t\t\tif (det < margin)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tconst v1toOrigin = origin.sub(tri.v1)\r\n\t\t\tconst u = v1toOrigin.dot(crossP)\r\n\t\t\t\r\n\t\t\tif (u < 0 || u > det)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tconst crossQ = v1toOrigin.cross(tri.v1to3)\r\n\t\t\tconst v = dir.dot(crossQ)\r\n\t\t\t\r\n\t\t\tif (v < 0 || u + v > det)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tconst distScaled = Math.abs(tri.v1to2.dot(crossQ) / det)\r\n\t\t\t\r\n\t\t\tif (nearestHit == null || distScaled < nearestHit.distScaled)\r\n\t\t\t{\r\n\t\t\t\tnearestHit =\r\n\t\t\t\t{\r\n\t\t\t\t\tdistScaled: distScaled,\r\n\t\t\t\t\tposition: origin.add(dir.scale(distScaled)),\r\n\t\t\t\t\tu: u,\r\n\t\t\t\t\tv: v,\r\n\t\t\t\t\ttri: tri\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn nearestHit\r\n\t}\r\n\t\r\n\t\r\n\tsolve(pos, speed, margin = 0.1, friction = 0.01, cutoff = 0.001)\r\n\t{\r\n\t\tlet iters = 0\r\n\t\t\r\n\t\twhile (speed.magn() > 0.001 && iters < 10)\r\n\t\t{\r\n\t\t\titers += 1\r\n\t\t\t\r\n\t\t\tlet speedMagn = speed.magn()\r\n\t\t\tlet speedNorm = speed.normalize()\r\n\t\t\t\r\n\t\t\tlet hit = this.raycast(pos, speedNorm)\r\n\t\t\tif (hit == null || hit.distScaled >= speedMagn + margin)\r\n\t\t\t{\r\n\t\t\t\tpos = pos.add(speed)\r\n\t\t\t\tspeed = new Vec3(0, 0, 0)\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\t/*else if (hit.distScaled < margin)\r\n\t\t\t{\r\n\t\t\t\tlet toPlane = pos.directionToPlane(hit.tri.normal, hit.tri.v1)\r\n\t\t\t\tpos = pos.sub(toPlane.normalize().scale(-(margin - toPlane.magn())))\r\n\t\t\t}*/\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tspeed = speedNorm.scale(speedMagn - (hit.distScaled - margin) - friction).projectOnPlane(hit.tri.normal)\r\n\t\t\t\tpos = pos.add(speedNorm.scale(hit.distScaled - margin))\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn pos\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { CollisionMesh }", "const { GfxModel } = require(\"../gl/scene.js\")\r\nconst { GLBuffer } = require(\"../gl/buffer.js\")\r\nconst { CollisionMesh } = require(\"./collisionMesh.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\n\r\n\r\nclass ModelBuilder\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.positions = []\r\n\t\tthis.normals = []\r\n\t\tthis.colors = []\r\n\t}\r\n\t\r\n\t\r\n\taddTri(v1, v2, v3, c1 = null, c2 = null, c3 = null)\r\n\t{\r\n\t\tthis.positions.push(v1)\r\n\t\tthis.positions.push(v2)\r\n\t\tthis.positions.push(v3)\r\n\t\t\r\n\t\tthis.normals.push(new Vec3(0, 0, 0))\r\n\t\tthis.normals.push(new Vec3(0, 0, 0))\r\n\t\tthis.normals.push(new Vec3(0, 0, 0))\r\n\t\t\r\n\t\tthis.colors.push(c1 ? c1 : [1, 1, 1, 1])\r\n\t\tthis.colors.push(c2 ? c2 : [1, 1, 1, 1])\r\n\t\tthis.colors.push(c3 ? c3 : [1, 1, 1, 1])\r\n\t\t\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\taddQuad(v1, v2, v3, v4, c1 = null, c2 = null, c3 = null, c4 = null)\r\n\t{\r\n\t\tthis.addTri(v1, v2, v3, c1, c2, c3)\r\n\t\tthis.addTri(v1, v3, v4, c1, c3, c4)\r\n\t\t\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\taddQuadSubdiv(v1, v2, v3, v4, subdivs)\r\n\t{\r\n\t\tfor (let j = 0; j < subdivs; j++)\r\n\t\t{\r\n\t\t\tfor (let i = 0; i < subdivs; i++)\r\n\t\t\t{\r\n\t\t\t\tlet p1 = v1.lerp(v2, (i + 0) / subdivs)\r\n\t\t\t\tlet p2 = v1.lerp(v2, (i + 1) / subdivs)\r\n\t\t\t\tlet p3 = v4.lerp(v3, (i + 1) / subdivs)\r\n\t\t\t\tlet p4 = v4.lerp(v3, (i + 0) / subdivs)\r\n\t\t\t\t\r\n\t\t\t\tlet f1 = p1.lerp(p4, (j + 0) / subdivs)\r\n\t\t\t\tlet f2 = p2.lerp(p3, (j + 0) / subdivs)\r\n\t\t\t\tlet f3 = p2.lerp(p3, (j + 1) / subdivs)\r\n\t\t\t\tlet f4 = p1.lerp(p4, (j + 1) / subdivs)\r\n\t\t\t\t\r\n\t\t\t\tthis.addQuad(f1, f2, f3, f4)\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\taddCube(x1, y1, z1, x2, y2, z2, subdivs = 1)\r\n\t{\r\n\t\tlet v1Top = new Vec3(x1, y1, z1)\r\n\t\tlet v2Top = new Vec3(x2, y1, z1)\r\n\t\tlet v3Top = new Vec3(x2, y2, z1)\r\n\t\tlet v4Top = new Vec3(x1, y2, z1)\r\n\t\t\r\n\t\tlet v1Bot = new Vec3(x1, y1, z2)\r\n\t\tlet v2Bot = new Vec3(x2, y1, z2)\r\n\t\tlet v3Bot = new Vec3(x2, y2, z2)\r\n\t\tlet v4Bot = new Vec3(x1, y2, z2)\r\n\t\t\r\n\t\tthis.addQuadSubdiv(v1Top, v2Top, v3Top, v4Top, subdivs)\r\n\t\tthis.addQuadSubdiv(v1Bot, v4Bot, v3Bot, v2Bot, subdivs)\r\n\t\tthis.addQuadSubdiv(v2Top, v1Top, v1Bot, v2Bot, subdivs)\r\n\t\tthis.addQuadSubdiv(v3Top, v2Top, v2Bot, v3Bot, subdivs)\r\n\t\tthis.addQuadSubdiv(v4Top, v3Top, v3Bot, v4Bot, subdivs)\r\n\t\tthis.addQuadSubdiv(v1Top, v4Top, v4Bot, v1Bot, subdivs)\r\n\t\t\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\taddSphere(x1, y1, z1, x2, y2, z2, subdivs = 8)\r\n\t{\r\n\t\tlet index = this.positions.length\r\n\t\t\r\n\t\tthis.addCube(x1, y1, z1, x2, y2, z2, subdivs)\r\n\t\t\r\n\t\tlet c = new Vec3(\r\n\t\t\t(x1 + x2) / 2,\r\n\t\t\t(y1 + y2) / 2,\r\n\t\t\t(z1 + z2) / 2)\r\n\t\t\t\r\n\t\tlet size = new Vec3(\t\t\t\r\n\t\t\tMath.abs(x2 - x1) / 2,\r\n\t\t\tMath.abs(y2 - y1) / 2,\r\n\t\t\tMath.abs(z2 - z1) / 2)\r\n\t\t\t\r\n\t\tfor (let i = index; i < this.positions.length; i++)\r\n\t\t\tthis.positions[i] = c.add(this.positions[i].sub(c).normalize().mul(size))\r\n\t\t\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\taddCone(x1, y1, z1, x2, y2, z2, subdivs = 8, upVec = null)\r\n\t{\r\n\t\tlet index = this.positions.length\r\n\t\t\r\n\t\tlet cx = (x1 + x2) / 2\r\n\t\tlet cy = (y1 + y2) / 2\r\n\t\t\r\n\t\tlet sx = (x2 - x1) / 2\r\n\t\tlet sy = (y2 - y1) / 2\r\n\t\t\r\n\t\tfor (let i = 0; i < subdivs; i++)\r\n\t\t{\r\n\t\t\tlet angle0 = (i + 0) / subdivs * Math.PI * 2\r\n\t\t\tlet angle1 = (i + 1) / subdivs * Math.PI * 2\r\n\t\t\t\r\n\t\t\tlet cos0 = Math.cos(angle0)\r\n\t\t\tlet cos1 = Math.cos(angle1)\r\n\t\t\tlet sin0 = Math.sin(angle0)\r\n\t\t\tlet sin1 = Math.sin(angle1)\r\n\t\t\t\r\n\t\t\t// Lid\r\n\t\t\tthis.addTri(\r\n\t\t\t\tnew Vec3(cx + cos0 * sx, cy + sin0 * sy, z1),\r\n\t\t\t\tnew Vec3(cx + cos1 * sx, cy + sin1 * sy, z1),\r\n\t\t\t\tnew Vec3(cx, cy, z1))\r\n\t\t\t\t\r\n\t\t\t// Edge\r\n\t\t\tthis.addTri(\r\n\t\t\t\tnew Vec3(cx + cos1 * sx, cy + sin1 * sy, z1),\r\n\t\t\t\tnew Vec3(cx + cos0 * sx, cy + sin0 * sy, z1),\r\n\t\t\t\tnew Vec3(cx, cy, z2))\r\n\t\t}\r\n\t\t\r\n\t\tif (upVec != null)\r\n\t\t{\r\n\t\t\tlet matrix = Mat4.rotationFromTo(new Vec3(0, 0, -1), upVec)\r\n\t\t\t\r\n\t\t\tfor (let i = index; i < this.positions.length; i++)\r\n\t\t\t\tthis.positions[i] = matrix.mulPoint(this.positions[i])\r\n\t\t}\r\n\t\t\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\taddCylinder(x1, y1, z1, x2, y2, z2, subdivs = 8, upVec = null)\r\n\t{\r\n\t\tlet index = this.positions.length\r\n\t\t\r\n\t\tlet cx = (x1 + x2) / 2\r\n\t\tlet cy = (y1 + y2) / 2\r\n\t\t\r\n\t\tlet sx = (x2 - x1) / 2\r\n\t\tlet sy = (y2 - y1) / 2\r\n\t\t\r\n\t\tfor (let i = 0; i < subdivs; i++)\r\n\t\t{\r\n\t\t\tlet angle0 = (i + 0) / subdivs * Math.PI * 2\r\n\t\t\tlet angle1 = (i + 1) / subdivs * Math.PI * 2\r\n\t\t\t\r\n\t\t\tlet cos0 = Math.cos(angle0)\r\n\t\t\tlet cos1 = Math.cos(angle1)\r\n\t\t\tlet sin0 = Math.sin(angle0)\r\n\t\t\tlet sin1 = Math.sin(angle1)\r\n\t\t\t\r\n\t\t\t// Lid\r\n\t\t\tthis.addTri(\r\n\t\t\t\tnew Vec3(cx + cos0 * sx, cy + sin0 * sy, z1),\r\n\t\t\t\tnew Vec3(cx + cos1 * sx, cy + sin1 * sy, z1),\r\n\t\t\t\tnew Vec3(cx, cy, z1))\r\n\t\t\t\t\r\n\t\t\t// Bottom\r\n\t\t\tthis.addTri(\r\n\t\t\t\tnew Vec3(cx + cos1 * sx, cy + sin1 * sy, z2),\r\n\t\t\t\tnew Vec3(cx + cos0 * sx, cy + sin0 * sy, z2),\r\n\t\t\t\tnew Vec3(cx, cy, z2))\r\n\t\t\t\t\r\n\t\t\t// Edge\r\n\t\t\tthis.addQuad(\r\n\t\t\t\tnew Vec3(cx + cos1 * sx, cy + sin1 * sy, z1),\r\n\t\t\t\tnew Vec3(cx + cos0 * sx, cy + sin0 * sy, z1),\r\n\t\t\t\tnew Vec3(cx + cos0 * sx, cy + sin0 * sy, z2),\r\n\t\t\t\tnew Vec3(cx + cos1 * sx, cy + sin1 * sy, z2))\r\n\t\t}\r\n\t\t\r\n\t\tif (upVec != null)\r\n\t\t{\r\n\t\t\tlet matrix = Mat4.rotationFromTo(new Vec3(0, 0, -1), upVec)\r\n\t\t\t\r\n\t\t\tfor (let i = index; i < this.positions.length; i++)\r\n\t\t\t\tthis.positions[i] = matrix.mulPoint(this.positions[i])\r\n\t\t}\r\n\t\t\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tgetBoundingBox()\r\n\t{\r\n\t\tlet bbox = \r\n\t\t{\r\n\t\t\txMin: null,\r\n\t\t\tyMin: null,\r\n\t\t\tzMin: null,\r\n\t\t\txMax: null,\r\n\t\t\tyMax: null,\r\n\t\t\tzMax: null\r\n\t\t}\r\n\t\t\r\n\t\tfor (let pos of this.positions)\r\n\t\t{\r\n\t\t\tbbox.xMin = (bbox.xMin == null ? pos.x : Math.min(bbox.xMin, pos.x))\r\n\t\t\tbbox.yMin = (bbox.xMin == null ? pos.y : Math.min(bbox.yMin, pos.y))\r\n\t\t\tbbox.zMin = (bbox.xMin == null ? pos.z : Math.min(bbox.zMin, pos.z))\r\n\t\t\tbbox.xMax = (bbox.xMax == null ? pos.x : Math.max(bbox.xMax, pos.x))\r\n\t\t\tbbox.yMax = (bbox.xMax == null ? pos.y : Math.max(bbox.yMax, pos.y))\r\n\t\t\tbbox.zMax = (bbox.xMax == null ? pos.z : Math.max(bbox.zMax, pos.z))\r\n\t\t}\r\n\t\t\r\n\t\tbbox.xSize = (bbox.xMax - bbox.xMin)\r\n\t\tbbox.ySize = (bbox.yMax - bbox.yMin)\r\n\t\tbbox.zSize = (bbox.zMax - bbox.zMin)\r\n\t\t\r\n\t\tbbox.xCenter = (bbox.xMin + bbox.xMax) / 2\r\n\t\tbbox.yCenter = (bbox.yMin + bbox.yMax) / 2\r\n\t\tbbox.zCenter = (bbox.zMin + bbox.zMax) / 2\r\n\t\t\r\n\t\treturn bbox\r\n\t}\r\n\t\r\n\t\r\n\tgetSaneBoundingBox(maxSize = 100000)\r\n\t{\r\n\t\tlet center = this.getMedianCenter()\r\n\t\t\r\n\t\tlet bbox = \r\n\t\t{\r\n\t\t\txMin: null,\r\n\t\t\tyMin: null,\r\n\t\t\tzMin: null,\r\n\t\t\txMax: null,\r\n\t\t\tyMax: null,\r\n\t\t\tzMax: null\r\n\t\t}\r\n\t\t\r\n\t\tfor (let pos of this.positions)\r\n\t\t{\r\n\t\t\tif (Math.abs(pos.x - center.x) < maxSize)\r\n\t\t\t{\r\n\t\t\t\tbbox.xMin = (bbox.xMin == null ? pos.x : Math.min(bbox.xMin, pos.x))\r\n\t\t\t\tbbox.xMax = (bbox.xMax == null ? pos.x : Math.max(bbox.xMax, pos.x))\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (Math.abs(pos.y - center.y) < maxSize)\r\n\t\t\t{\r\n\t\t\t\tbbox.yMin = (bbox.xMin == null ? pos.y : Math.min(bbox.yMin, pos.y))\r\n\t\t\t\tbbox.yMax = (bbox.xMax == null ? pos.y : Math.max(bbox.yMax, pos.y))\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (Math.abs(pos.z - center.z) < maxSize)\r\n\t\t\t{\r\n\t\t\t\tbbox.zMin = (bbox.xMin == null ? pos.z : Math.min(bbox.zMin, pos.z))\r\n\t\t\t\tbbox.zMax = (bbox.xMax == null ? pos.z : Math.max(bbox.zMax, pos.z))\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tbbox.xSize = (bbox.xMax - bbox.xMin)\r\n\t\tbbox.ySize = (bbox.yMax - bbox.yMin)\r\n\t\tbbox.zSize = (bbox.zMax - bbox.zMin)\r\n\t\t\r\n\t\tbbox.xCenter = (bbox.xMin + bbox.xMax) / 2\r\n\t\tbbox.yCenter = (bbox.yMin + bbox.yMax) / 2\r\n\t\tbbox.zCenter = (bbox.zMin + bbox.zMax) / 2\r\n\t\t\r\n\t\treturn bbox\r\n\t}\r\n\t\r\n\t\r\n\tgetMedianCenter()\r\n\t{\r\n\t\tif (this.positions.length == 0)\r\n\t\t\treturn { x: 0, y: 0, z: 0 }\r\n\t\t\r\n\t\tlet xs = []\r\n\t\tlet ys = []\r\n\t\tlet zs = []\r\n\t\t\r\n\t\tfor (let pos of this.positions)\r\n\t\t{\r\n\t\t\txs.push(pos.x)\r\n\t\t\tys.push(pos.y)\r\n\t\t\tzs.push(pos.z)\r\n\t\t}\r\n\t\t\r\n\t\txs.sort((a, b) => a - b)\r\n\t\tys.sort((a, b) => a - b)\r\n\t\tzs.sort((a, b) => a - b)\r\n\t\t\r\n\t\treturn {\r\n\t\t\tx: xs[Math.floor(xs.length / 2)],\r\n\t\t\ty: ys[Math.floor(xs.length / 2)],\r\n\t\t\tz: zs[Math.floor(xs.length / 2)]\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tmakeDoubleSided()\r\n\t{\r\n\t\tlet len = this.positions.length\r\n\t\tfor (let i = 0; i < len; i += 3)\r\n\t\t{\r\n\t\t\tlet v1 = this.positions[i + 0]\r\n\t\t\tlet v2 = this.positions[i + 1]\r\n\t\t\tlet v3 = this.positions[i + 2]\r\n\t\t\r\n\t\t\tthis.addTri(v1, v3, v2)\r\n\t\t}\r\n\t\t\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tcalculateNormals(maxSmoothAngle = 1.5)\r\n\t{\r\n\t\tfor (let i = 0; i < this.positions.length; i += 3)\r\n\t\t{\r\n\t\t\tlet v1 = this.positions[i + 0]\r\n\t\t\tlet v2 = this.positions[i + 1]\r\n\t\t\tlet v3 = this.positions[i + 2]\r\n\t\t\t\r\n\t\t\tlet v1to2 = v2.sub(v1)\r\n\t\t\tlet v1to3 = v3.sub(v1)\r\n\t\t\t\r\n\t\t\tlet normal = v1to2.cross(v1to3).normalize()\r\n\t\t\t\r\n\t\t\tthis.normals[i + 0] = normal\r\n\t\t\tthis.normals[i + 1] = normal\r\n\t\t\tthis.normals[i + 2] = normal\r\n\t\t}\r\n\t\t\r\n\t\t// Disable slow smooth-shading calculations for now\r\n\t\treturn this\r\n\t\t\r\n\t\tconst rounding = 0.001\r\n\t\tconst hash = (vec) =>\r\n\t\t{\r\n\t\t\treturn (\r\n\t\t\t\t(Math.round(vec.x * rounding) / rounding) * 1000000 +\r\n\t\t\t\t(Math.round(vec.y * rounding) / rounding) * 1000 +\r\n\t\t\t\t(Math.round(vec.z * rounding) / rounding))\r\n\t\t}\r\n\t\t\r\n\t\tlet verticesSet = new Map()\r\n\t\tfor (let j = 0; j < this.positions.length; j++)\r\n\t\t{\r\n\t\t\tlet key = hash(this.positions[j])\r\n\t\t\t\r\n\t\t\tlet value = verticesSet.get(key)\r\n\t\t\tif (value === undefined)\r\n\t\t\t\tverticesSet.set(key, [j])\r\n\t\t\telse\r\n\t\t\t\tvalue.push(j)\r\n\t\t}\r\n\t\t\r\n\t\tlet normalAccum = []\r\n\t\tlet normalCount = []\r\n\t\tfor (let j = 0; j < this.positions.length; j++)\r\n\t\t{\r\n\t\t\tnormalAccum[j] = this.normals[j]\r\n\t\t\tnormalCount[j] = 1\r\n\t\t\t\r\n\t\t\tlet vertices = verticesSet.get(hash(this.positions[j]))\r\n\t\t\tif (vertices === undefined)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tfor (let i of vertices)\r\n\t\t\t{\r\n\t\t\t\tif (i == j)\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t\r\n\t\t\t\tif (Math.abs(Math.acos(this.normals[j].dot(this.normals[i]))) <= maxSmoothAngle)\r\n\t\t\t\t{\r\n\t\t\t\t\tnormalAccum[j] = normalAccum[j].add(this.normals[i])\r\n\t\t\t\t\tnormalCount[j] += 1\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfor (let i = 0; i < this.positions.length; i++)\r\n\t\t\tthis.normals[i] = normalAccum[i].scale(1 / normalCount[i]).normalize()\r\n\t\t\r\n\t\treturn this\r\n\t}\r\n\t\r\n\t\r\n\tmakeModel(gl)\r\n\t{\r\n\t\tlet positions = []\r\n\t\tlet normals = []\r\n\t\tlet colors = []\r\n\t\t\r\n\t\tfor (let i = 0; i < this.positions.length; i++)\r\n\t\t{\r\n\t\t\tpositions.push(this.positions[i].x)\r\n\t\t\tpositions.push(this.positions[i].y)\r\n\t\t\tpositions.push(this.positions[i].z)\r\n\t\t\t\r\n\t\t\tnormals.push(this.normals[i].x)\r\n\t\t\tnormals.push(this.normals[i].y)\r\n\t\t\tnormals.push(this.normals[i].z)\r\n\t\t\t\r\n\t\t\tcolors.push(this.colors[i][0])\r\n\t\t\tcolors.push(this.colors[i][1])\r\n\t\t\tcolors.push(this.colors[i][2])\r\n\t\t\tcolors.push(this.colors[i][3])\r\n\t\t}\r\n\t\t\r\n\t\tlet model = new GfxModel()\r\n\t\t\t.setPositions(GLBuffer.makePosition(gl, positions))\r\n\t\t\t.setNormals(GLBuffer.makeNormal(gl, normals))\r\n\t\t\t.setColors(GLBuffer.makeColor(gl, colors))\r\n\t\t\r\n\t\treturn model\r\n\t}\r\n\t\r\n\t\r\n\tmakeCollision()\r\n\t{\r\n\t\tlet col = new CollisionMesh()\r\n\t\t\r\n\t\tfor (let i = 0; i < this.positions.length; i += 3)\r\n\t\t\tcol.addTri(this.positions[i + 0], this.positions[i + 1], this.positions[i + 2])\r\n\t\t\r\n\t\treturn col\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { ModelBuilder }", "class Geometry\r\n{\r\n\tstatic linePointMinimumVec(origin, direction, point)\r\n\t{\r\n\t\tlet pointFromOrigin = point.sub(origin)\r\n\t\tlet pointOverDirection = pointFromOrigin.project(direction)\r\n\t\t\r\n\t\treturn pointFromOrigin.sub(pointOverDirection)\r\n\t}\r\n\t\r\n\t\r\n\tstatic linePointDistance(origin, direction, point)\r\n\t{\r\n\t\treturn Geometry.linePointMinimumVec(origin, direction, point).magn()\r\n\t}\r\n\t\r\n\t\r\n\tstatic lineLineDistance(origin1, direction1, origin2, direction2)\r\n\t{\r\n\t\tlet cross = direction1.cross(direction2)\r\n\t\tlet crossMagn = cross.magn()\r\n\t\t\r\n\t\tif (crossMagn < 0.001)\r\n\t\t\treturn Infinity // wrong but works\r\n\t\t\r\n\t\treturn Math.abs(cross.scale(1 / crossMagn).dot(origin2.sub(origin1)))\r\n\t}\r\n\r\n\r\n\t// Projects line 1 such that it will intersect line 2\r\n\tstatic lineLineProjection(origin1, direction1, origin2, direction2)\r\n\t{\r\n\t\tlet normal = Geometry.linePointMinimumVec(origin2, direction2, origin1).cross(direction2).normalize()\r\n\t\treturn direction1.projectOnPlane(normal)\r\n\t}\r\n\t\r\n\t\r\n\tstatic lineZPlaneIntersection(origin, direction, planeZ)\r\n\t{\r\n\t\treturn origin.add(direction.scale((planeZ - origin.z) / direction.z))\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { Geometry }", "const { GfxScene, GfxCamera, GfxMaterial, GfxModel, GfxNodeRenderer, GfxNodeRendererTransform } = require(\"../gl/scene.js\")\r\nconst { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\nconst { Geometry } = require(\"../math/geometry.js\")\r\n\r\n\r\nclass PointViewer\r\n{\r\n\tconstructor(window, viewer, data)\r\n\t{\r\n\t\tthis.window = window\r\n\t\tthis.viewer = viewer\r\n\t\tthis.data = data\r\n        this.renderers = []\r\n\t\t\r\n\t\tthis.scene = new GfxScene()\r\n\t\tthis.sceneAfter = new GfxScene()\r\n\t\t\r\n\t\tthis.hoveringOverPoint = null\r\n\t\tthis.targetPos = null\r\n\t\tthis.ctrlIsHeld = false\r\n\r\n\t\tthis.lastAxisHotkey = \"\"\r\n\t\tthis.snapCollision = this.viewer.cfg.snapToCollision\r\n\t\tthis.lockX = this.viewer.cfg.lockAxisX\r\n\t\tthis.lockY = this.viewer.cfg.lockAxisY\r\n\t\tthis.lockZ = this.viewer.cfg.lockAxisZ\r\n\t\t\r\n\t\tthis.modelPoint = new ModelBuilder()\r\n\t\t\t.addSphere(-150, -150, -150, 150, 150, 150)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\r\n\t\tthis.modelPointSelection = new ModelBuilder()\r\n\t\t\t.addSphere(-250, -250, 250, 250, 250, -250)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\t\r\n\t\tthis.modelPath = new ModelBuilder()\r\n\t\t\t.addCylinder(-150, -150, 0, 150, 150, 1000, 8, new Vec3(1, 0, 0))\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\r\n\t\tthis.modelArrow = new ModelBuilder()\r\n\t\t\t.addCone(-250, -250, 1000, 250, 250, 1300, 8, new Vec3(1, 0, 0))\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\t\r\n\t\tthis.modelArrowUp = new ModelBuilder()\r\n\t\t\t.addCone(-150, -150, 600, 150, 150, 1500, 8, new Vec3(0, 0.01, 1).normalize())\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t}\r\n\t\r\n\t\r\n\tsetData(data)\r\n\t{\r\n\t\tthis.data = data\r\n\t\tthis.refresh()\r\n\t}\r\n\t\r\n\t\r\n\tdestroy()\r\n\t{\r\n\t\tfor (let r of this.renderers)\r\n\t\t\tr.detach()\r\n\t\t\r\n\t\tthis.renderers = []\r\n\t}\r\n\t\r\n\t\r\n\trefresh()\r\n\t{\r\n\t\tfor (let r of this.renderers)\r\n\t\t\tr.detach()\r\n\t\t\r\n\t\tthis.renderers = []\r\n\t\t\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t{\r\n\t\t\tif (point.selected === undefined)\r\n\t\t\t{\r\n\t\t\t\tpoint.selected = false\r\n\t\t\t\tpoint.moveOrigin = point.pos\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpoint.renderer = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t.setModel(this.modelPoint)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\r\n\t\t\tpoint.rendererSelected = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.sceneAfter.root)\r\n\t\t\t\t.setModel(this.modelPointSelection)\r\n\t\t\t\t.setMaterial(this.viewer.materialUnshaded)\r\n\t\t\t\t.setEnabled(false)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelectedCore = new GfxNodeRenderer()\r\n\t\t\t\t.attach(point.rendererSelected)\r\n\t\t\t\t.setModel(this.modelPoint)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirection = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t.setModel(this.modelPath)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionArrow = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t.setModel(this.modelArrow)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionUp = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t.setModel(this.modelArrowUp)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\r\n\t\t\tthis.renderers.push(point.renderer)\r\n\t\t\tthis.renderers.push(point.rendererSelected)\r\n\t\t\tthis.renderers.push(point.rendererDirection)\r\n\t\t\tthis.renderers.push(point.rendererDirectionArrow)\r\n\t\t\tthis.renderers.push(point.rendererDirectionUp)\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tgetHoveringOverElement(cameraPos, ray, distToHit, includeSelected = true)\r\n\t{\r\n\t\tlet elem = null\r\n\t\t\r\n\t\tlet minDistToCamera = distToHit + 1000\r\n\t\tlet minDistToPoint = 1000000\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t{\r\n\t\t\tif (!includeSelected && point.selected)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tlet distToCamera = point.pos.sub(cameraPos).magn()\r\n\t\t\tif (distToCamera >= minDistToCamera)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tlet scale = this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tlet pointDistToRay = Geometry.linePointDistance(ray.origin, ray.direction, point.pos)\r\n\t\t\t\r\n\t\t\tif (pointDistToRay < 150 * scale * 4 && pointDistToRay < minDistToPoint)\r\n\t\t\t{\r\n\t\t\t\telem = point\r\n\t\t\t\tminDistToCamera = distToCamera\r\n\t\t\t\tminDistToPoint = pointDistToRay\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn elem\r\n\t}\r\n\t\r\n\t\r\n\tselectAll()\r\n\t{\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t\tpoint.selected = true\r\n\t\t\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\t\r\n\tunselectAll()\r\n\t{\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t\tpoint.selected = false\r\n\t\t\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\t\r\n\ttoggleAllSelection()\r\n\t{\r\n\t\tlet hasSelection = (this.points().nodes.find(p => p.selected) != null)\r\n\t\t\r\n\t\tif (hasSelection)\r\n\t\t\tthis.unselectAll()\r\n\t\telse\r\n\t\t\tthis.selectAll()\r\n\t}\r\n\t\r\n\t\r\n\tdeleteSelectedPoints()\r\n\t{\r\n\t\tlet pointsToDelete = []\r\n\t\t\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t{\r\n\t\t\tif (!point.selected)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tpointsToDelete.push(point)\r\n\t\t}\r\n\t\t\r\n\t\tfor (let point of pointsToDelete)\r\n\t\t\tthis.points().removeNode(point)\r\n\t\t\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\r\n\r\n\tsnapSelectedToY()\r\n\t{\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t{\r\n\t\t\tif (point.selected)\r\n\t\t\t{\r\n\t\t\t\tlet hit = this.viewer.collision.raycast(point.pos, new Vec3(0, 0, 1))\r\n\t\t\t\tif (hit != null && point.pos.sub(hit.position).magn() > 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet check = this.viewer.collision.raycast(hit.position, new Vec3(0, 0, 1))\r\n\t\t\t\t\tif (check != null && check.position.sub(hit.position).magn() > 1)\r\n\t\t\t\t\t\tpoint.pos = hit.position.sub(point.pos.mul(new Vec3(0, 0, 2))).mul(new Vec3(1, 1, -1))\r\n\t\t\t\t\telse \r\n\t\t\t\t\t\tpoint.pos = hit.position\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\t\r\n\t\r\n\tonKeyDown(ev)\r\n\t{\r\n\t\tif (this.viewer.mouseDown && !ev.ctrlKey && this.viewer.mouseAction == \"move\")\r\n\t\t{\r\n\t\t\tconst setAxisLocks = (s, x, y, z) =>\r\n\t\t\t{\r\n\t\t\t\tif (this.lastAxisHotkey === s)\r\n\t\t\t\t\treturn false\r\n\r\n\t\t\t\tif (!this.lastAxisHotkey)\r\n\t\t\t\t{\r\n\t\t\t\t\t// save old state\r\n\t\t\t\t\tthis.snapCollision = this.viewer.cfg.snapToCollision\r\n\t\t\t\t\tthis.lockX = this.viewer.cfg.lockAxisX\r\n\t\t\t\t\tthis.lockY = this.viewer.cfg.lockAxisY\r\n\t\t\t\t\tthis.lockZ = this.viewer.cfg.lockAxisZ\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.lastAxisHotkey = s\r\n\r\n\t\t\t\tif (this.hoveringOverPoint != null)\r\n\t\t\t\t\tthis.targetPos = this.hoveringOverPoint.pos\r\n\r\n\t\t\t\tif (x || y || z)\r\n\t\t\t\t\tthis.viewer.cfg.snapToCollision = false\r\n\t\t\t\tthis.viewer.cfg.lockAxisX = x\r\n\t\t\t\tthis.viewer.cfg.lockAxisY = y\r\n\t\t\t\tthis.viewer.cfg.lockAxisZ = z\r\n\r\n\t\t\t\tthis.window.refreshPanels()\r\n\t\t\t}\r\n\r\n\t\t\tswitch (ev.key)\r\n\t\t\t{\r\n\t\t\t\tcase \"X\":\r\n\t\t\t\t\tsetAxisLocks(\"X\", true, false, false)\r\n\t\t\t\t\treturn true\r\n\r\n\t\t\t\tcase \"x\":\r\n\t\t\t\t\tsetAxisLocks(\"x\", false, true, true)\r\n\t\t\t\t\treturn true\r\n\r\n\t\t\t\tcase \"Y\":\r\n\t\t\t\t\tsetAxisLocks(\"Y\", false, true, false)\r\n\t\t\t\t\treturn true\r\n\r\n\t\t\t\tcase \"y\":\r\n\t\t\t\t\tsetAxisLocks(\"y\", true, false, true)\r\n\t\t\t\t\treturn true\r\n\t\t\t\t\r\n\t\t\t\tcase \"Z\":\r\n\t\t\t\t\tsetAxisLocks(\"Z\", false, false, true)\r\n\t\t\t\t\treturn true\r\n\r\n\t\t\t\tcase \"z\":\r\n\t\t\t\t\tsetAxisLocks(\"z\", true, true, false)\r\n\t\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tswitch (ev.key)\r\n\t\t{\r\n\t\t\tcase \"A\":\r\n\t\t\tcase \"a\":\r\n\t\t\t\tthis.toggleAllSelection()\r\n\t\t\t\treturn true\r\n\t\t\t\r\n\t\t\tcase \"Backspace\":\r\n\t\t\tcase \"Delete\":\r\n\t\t\tcase \"X\":\r\n\t\t\tcase \"x\":\r\n\t\t\t\tthis.deleteSelectedPoints()\r\n\t\t\t\treturn true\r\n\r\n\t\t\tcase \"Y\":\r\n\t\t\tcase \"y\":\r\n\t\t\t\tthis.snapSelectedToY()\r\n\t\t\t\treturn true\r\n\t\t}\r\n\t\t\r\n\t\treturn false\r\n\t}\r\n\t\r\n\t\r\n\tonMouseDown(ev, x, y, cameraPos, ray, hit, distToHit, mouse3DPos)\r\n\t{\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t\tpoint.moveOrigin = point.pos\r\n\t\t\r\n\t\tlet hoveringOverElem = this.getHoveringOverElement(cameraPos, ray, distToHit)\r\n\t\t\r\n\t\tif (ev.altKey || (!(ev.ctrlKey || ev.metaKey) && (hoveringOverElem == null || !hoveringOverElem.selected)))\r\n\t\t\tthis.unselectAll()\r\n\r\n\t\tif (ev.ctrlKey || ev.metaKey)\r\n\t\t\tthis.ctrlIsHeld = true\r\n\t\t\r\n\t\tif (hoveringOverElem != null)\r\n\t\t{\r\n\t\t\tif (ev.altKey)\r\n\t\t\t{\r\n\t\t\t\tif (this.points().nodes.length >= this.points().maxNodes)\r\n\t\t\t\t{\r\n\t\t\t\t\talert(\"KMP error!\\n\\nMaximum number of points surpassed (\" + this.points().maxNodes + \")\")\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tlet newPoint = this.points().addNode()\r\n\t\t\t\tthis.points().onCloneNode(newPoint, hoveringOverElem)\r\n\t\t\t\t\r\n\t\t\t\tthis.refresh()\r\n\t\t\t\t\r\n\t\t\t\tnewPoint.selected = true\r\n\t\t\t\tthis.targetPos = newPoint.moveOrigin.clone()\r\n\t\t\t\tthis.viewer.setCursor(\"-webkit-grabbing\")\r\n\t\t\t\tthis.refreshPanels()\r\n\t\t\t\tthis.window.setNotSaved()\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\thoveringOverElem.selected = true\r\n\t\t\t\tthis.targetPos = hoveringOverElem.moveOrigin.clone()\r\n\t\t\t\tthis.refreshPanels()\r\n\t\t\t\tthis.viewer.setCursor(\"-webkit-grabbing\")\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (ev.altKey)\r\n\t\t{\r\n\t\t\tif (this.points().nodes.length >= this.points().maxNodes)\r\n\t\t\t{\r\n\t\t\t\talert(\"KMP error!\\n\\nMaximum number of points surpassed (\" + this.points().maxNodes + \")\")\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tlet newPoint = this.points().addNode()\r\n\t\t\tnewPoint.pos = mouse3DPos\r\n\t\t\t\r\n\t\t\tthis.refresh()\r\n\t\t\tnewPoint.selected = true\r\n\t\t\tthis.targetPos = newPoint.moveOrigin.clone()\r\n\t\t\tthis.viewer.setCursor(\"-webkit-grabbing\")\r\n\t\t\tthis.refreshPanels()\r\n\t\t\tthis.window.setNotSaved()\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tonMouseMove(ev, x, y, cameraPos, ray, hit, distToHit)\r\n\t{\r\n\t\t// Mouse not held OR mouse held, ctrl held\r\n\t\tif (!this.viewer.mouseDown || this.ctrlIsHeld)\r\n\t\t{\r\n\t\t\tlet lastHover = this.hoveringOverPoint\r\n\t\t\tthis.hoveringOverPoint = this.getHoveringOverElement(cameraPos, ray, distToHit)\r\n\t\t\t\r\n\t\t\tif (this.hoveringOverPoint != null)\r\n\t\t\t{\r\n\t\t\t\tthis.viewer.setCursor(\"-webkit-grab\")\r\n\t\t\t\tif (this.ctrlIsHeld)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.hoveringOverPoint.selected = true\r\n\t\t\t\t\tthis.refreshPanels()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this.hoveringOverPoint != lastHover)\r\n\t\t\t\tthis.viewer.render()\r\n\t\t}\r\n\t\t// Mouse held, ctrl not held, holding point(s)\r\n\t\telse if (this.viewer.mouseAction == \"move\")\r\n\t\t{\r\n\t\t\tthis.window.setNotSaved()\r\n\t\t\tthis.viewer.setCursor(\"-webkit-grabbing\")\r\n\r\n\t\t\tlet moveVector = null\r\n\t\t\t\t\t\t\t\r\n\t\t\tlet screenPosMoved = this.viewer.pointToScreen(this.targetPos)\r\n\t\t\tscreenPosMoved.x += this.viewer.mouseMoveOffsetPixels.x\r\n\t\t\tscreenPosMoved.y += this.viewer.mouseMoveOffsetPixels.y\r\n\t\t\tlet pointRayMoved = this.viewer.getScreenRay(screenPosMoved.x, screenPosMoved.y)\r\n\t\t\t\r\n\t\t\tlet hit = this.viewer.collision.raycast(pointRayMoved.origin, pointRayMoved.direction)\r\n\t\t\tif (this.viewer.cfg.snapToCollision && hit != null)\r\n\t\t\t\tmoveVector = hit.position.sub(this.targetPos)\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tlet screenPos = this.viewer.pointToScreen(this.targetPos)\r\n\t\t\t\tlet pointRay = this.viewer.getScreenRay(screenPos.x, screenPos.y)\r\n\t\t\t\tlet origDistToScreen = this.targetPos.sub(pointRay.origin).magn()\r\n\t\t\t\t\r\n\t\t\t\tlet direction = pointRayMoved.direction\r\n\r\n\t\t\t\tif (this.viewer.cfg.lockAxisX && this.viewer.cfg.lockAxisY && this.viewer.cfg.lockAxisZ)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.viewer.cfg.lockAxisX)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this.viewer.cfg.lockAxisY)\r\n\t\t\t\t\t\tdirection = Geometry.lineLineProjection(pointRayMoved.origin, direction, this.targetPos, new Vec3(0, 1, 0))\r\n\t\t\t\t\telse if (this.viewer.cfg.lockAxisZ)\r\n\t\t\t\t\t\tdirection = Geometry.lineLineProjection(pointRayMoved.origin, direction, this.targetPos, new Vec3(0, 0, 1))\r\n\t\t\t\t\tdirection = direction.scale((this.targetPos.x - pointRayMoved.origin.x) / direction.x)\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.viewer.cfg.lockAxisY)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this.viewer.cfg.lockAxisZ)\r\n\t\t\t\t\t\tdirection = Geometry.lineLineProjection(pointRayMoved.origin, direction, this.targetPos, new Vec3(1, 0, 0))\r\n\t\t\t\t\tdirection = direction.scale((this.targetPos.z - pointRayMoved.origin.z) / direction.z)\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.viewer.cfg.lockAxisZ)\r\n\t\t\t\t{\r\n\t\t\t\t\tdirection = direction.scale((this.targetPos.y - pointRayMoved.origin.y) / direction.y)\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tdirection = direction.scale(origDistToScreen)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet newPos = pointRayMoved.origin.add(direction)\r\n\r\n\t\t\t\tif (this.viewer.cfg.lockAxisX)\r\n\t\t\t\t\tnewPos.x = this.targetPos.x\r\n\t\t\t\tif (this.viewer.cfg.lockAxisY)\r\n\t\t\t\t\tnewPos.z = this.targetPos.z\r\n\t\t\t\tif (this.viewer.cfg.lockAxisZ)\r\n\t\t\t\t\tnewPos.y = this.targetPos.y\r\n\t\t\t\t\r\n\t\t\t\tmoveVector = newPos.sub(this.targetPos)\r\n\t\t\t}\r\n\r\n\t\t\tfor (let point of this.points().nodes)\r\n\t\t\t{\r\n\t\t\t\tif (!point.selected)\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t\r\n\t\t\t\tpoint.pos = point.moveOrigin.add(moveVector)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.refreshPanels()\r\n\t\t}\r\n\t}\r\n\r\n\r\n    onMouseUp(ev, x, y)\r\n\t{\r\n\t\tthis.ctrlIsHeld = false\r\n\r\n\t\tif (this.lastAxisHotkey) {\r\n\t\t\tthis.lastAxisHotkey = \"\"\r\n\t\t\tthis.viewer.cfg.snapToCollision = this.snapCollision\r\n\t\t\tthis.viewer.cfg.lockAxisX = this.lockX\r\n\t\t\tthis.viewer.cfg.lockAxisY = this.lockY\r\n\t\t\tthis.viewer.cfg.lockAxisZ = this.lockZ\r\n\t\t\tthis.window.refreshPanels()\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { PointViewer }", "const { GfxScene, GfxCamera, GfxMaterial, GfxModel, GfxNodeRenderer, GfxNodeRendererTransform } = require(\"../gl/scene.js\")\r\nconst { PointViewer } = require(\"./pointViewer.js\")\r\nconst { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\nconst { Geometry } = require(\"../math/geometry.js\")\r\n\r\n\r\nclass ViewerStartPoints extends PointViewer\r\n{\r\n\tconstructor(window, viewer, data)\r\n\t{\r\n\t\tsuper(window, viewer, data)\r\n\r\n\t\tthis.modelZoneWide = new ModelBuilder()\r\n\t\t\t.addQuad(new Vec3(0, -1000, -20), new Vec3(0, 1000, -20), new Vec3(-5300, 1000, -20), new Vec3(-5300, -1000, -20))\r\n\t\t\t.addQuad(new Vec3(-5300, -1000, -20), new Vec3(-5300, 1000, -20), new Vec3(0, 1000, -20), new Vec3(0, -1000, -20))\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\r\n\t\tthis.modelZoneNarrow = new ModelBuilder()\r\n\t\t\t.addQuad(new Vec3(0, -1000, -20), new Vec3(0, 1000, -20), new Vec3(-4800, 1000, -20), new Vec3(-4800, -1000, -20))\r\n\t\t\t.addQuad(new Vec3(-4800, -1000, -20), new Vec3(-4800, 1000, -20), new Vec3(0, 1000, -20), new Vec3(0, -1000, -20))\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t}\r\n\r\n\r\n\tpoints()\r\n\t{\r\n\t\treturn this.data.startPoints\r\n\t}\r\n\t\r\n\t\r\n\trefreshPanels()\r\n\t{\r\n\t\tlet panel = this.window.addPanel(\"Starting Points\", false, (open) => { if (open) this.viewer.setSubviewer(this) })\r\n\t\tthis.panel = panel\r\n\t\t\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Click:</strong> Create Point\")\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Drag Point:</strong> Duplicate Point\")\r\n\t\tpanel.addText(null, \"<strong>Hold Ctrl:</strong> Multiselect\")\r\n\r\n\t\tpanel.addCheckbox(null, \"Draw rotation guides\", this.viewer.cfg.enableRotationRender, (x) => this.viewer.cfg.enableRotationRender = x)\r\n\t\tpanel.addCheckbox(null, \"Draw start zone bounds\", this.viewer.cfg.startPointsEnableZoneRender, (x) => this.viewer.cfg.startPointsEnableZoneRender = x)\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tpanel.addButton(null, \"(A) Select/Unselect All\", () => this.toggleAllSelection())\r\n\t\tpanel.addButton(null, \"(X) Delete Selected\", () => this.deleteSelectedPoints())\r\n\t\tpanel.addButton(null, \"(Y) Snap To Collision Y\", () => this.snapSelectedToY())\r\n\t\tpanel.addButton(null, \"(F) Set Selected as First Point\", () => this.setSelectedAsFirstPoint())\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tlet polePosOptions =\r\n\t\t[\r\n\t\t\t{ str: \"Left\", value: 0 },\r\n\t\t\t{ str: \"Right\", value: 1 }\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(null, \"Pole Position\", this.data.trackInfo.polePosition, polePosOptions, true, false, (x) => { this.window.setNotSaved(); this.data.trackInfo.polePosition = x; this.refresh() })\r\n\t\t\r\n\t\tlet driverDistOptions =\r\n\t\t[\r\n\t\t\t{ str: \"Normal\", value: 0 },\r\n\t\t\t{ str: \"Narrow\", value: 1 }\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(null, \"Start Zone\", this.data.trackInfo.driverDistance, driverDistOptions, true, false, (x) => { this.window.setNotSaved(); this.data.trackInfo.driverDistance = x; this.refresh() })\r\n\r\n\t\tlet selectedPoints = this.data.startPoints.nodes.filter(p => p.selected)\r\n\t\t\r\n\t\tlet selectionGroup = panel.addGroup(null, \"Selection:\")\r\n\t\tlet enabled = (selectedPoints.length > 0)\r\n\t\tlet multiedit = (selectedPoints.length > 1)\r\n\r\n\t\tif (selectedPoints.length == 1)\r\n\t\t{\r\n\t\t\tlet i = this.data.startPoints.nodes.findIndex(p => p === selectedPoints[0])\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>KTPT Index:</strong> \" + i.toString() + \" (0x\" + i.toString(16) + \")\")\r\n\t\t}\r\n\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,      \"X\", -1000000, 1000000, selectedPoints.map(p =>  p.pos.x),     null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.x = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,      \"Y\", -1000000, 1000000, selectedPoints.map(p => -p.pos.z),     null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.z = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,      \"Z\", -1000000, 1000000, selectedPoints.map(p => -p.pos.y),     null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.y = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Rot. X\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.x),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.x = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Rot. Y\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.y),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.y = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Rot. Z\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.z),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.z = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Player Index\", -1,      12, selectedPoints.map(p =>  p.playerIndex),  1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].playerIndex = x })\r\n\t}\r\n\t\r\n\t\r\n\trefresh()\r\n\t{\r\n\t\tsuper.refresh()\r\n\t\t\r\n\t\tfor (let point of this.data.startPoints.nodes)\r\n\t\t{\r\n\t\t\tpoint.rendererStartZone = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t.setModel(this.data.trackInfo.driverDistance ? this.modelZoneNarrow : this.modelZoneWide)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\r\n\t\t\tthis.renderers.push(point.rendererStartZone)\r\n\t\t}\r\n\t\t\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\r\n\r\n\tsetSelectedAsFirstPoint()\r\n\t{\r\n\t\tfor (let p = 0; p < this.points().nodes.length; p++)\r\n\t\t{\r\n\t\t\tlet point = this.points().nodes[p]\r\n\t\t\t\r\n\t\t\tif (!point.selected)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tthis.points().nodes.splice(p, 1)\r\n\t\t\tthis.points().nodes.unshift(point)\r\n\t\t}\r\n\t\t\r\n\t\tthis.data.refreshIndices(this.viewer.cfg.isBattleTrack)\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\r\n\r\n\tonKeyDown(ev)\r\n\t{\r\n\t\tif (super.onKeyDown(ev))\r\n\t\t\treturn true\r\n\t\t\t\r\n\t\tswitch (ev.key)\r\n\t\t{\r\n\t\t\tcase \"F\":\r\n\t\t\tcase \"f\":\r\n\t\t\t\tthis.setSelectedAsFirstPoint()\r\n\t\t\t\treturn true\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tdrawAfterModel()\r\n\t{\r\n\t\tfor (let point of this.data.startPoints.nodes)\r\n\t\t{\r\n\t\t\tlet scale = (this.hoveringOverPoint == point ? 1.5 : 1) * this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tpoint.renderer\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([0, 0, 1, 1])\r\n\t\t\t\r\n\t\t\tpoint.rendererSelected\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([0.5, 0.5, 1, 1])\r\n\t\t\t\t.setEnabled(point.selected)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelectedCore\r\n\t\t\t\t.setDiffuseColor([0, 0, 1, 1])\r\n\t\t\t\t\r\n\t\t\tlet matrixScale = Mat4.scale(scale, scale / 1.5, scale / 1.5)\r\n\t\t\tlet matrixDirection = \r\n\t\t\t\tMat4.rotation(new Vec3(0, 0, 1), 90 * Math.PI / 180)\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(1, 0, 0), point.rotation.x * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 0, 1), -point.rotation.y * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 1, 0), -point.rotation.z * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.translation(point.pos.x, point.pos.y, point.pos.z))\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirection\r\n\t\t\t\t.setCustomMatrix(matrixScale.mul(matrixDirection))\r\n\t\t\t\t.setDiffuseColor([0.75, 0.75, 1, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionArrow\r\n\t\t\t\t.setCustomMatrix(matrixScale.mul(matrixDirection))\r\n\t\t\t\t.setDiffuseColor([0, 0, 1, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionUp\r\n\t\t\t\t.setCustomMatrix(matrixScale.mul(matrixDirection))\r\n\t\t\t\t.setDiffuseColor([0.25, 0.25, 1, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\r\n\t\t\tpoint.rendererStartZone\r\n\t\t\t\t.setCustomMatrix(matrixDirection)\r\n\t\t\t\t.setDiffuseColor([0.25, 0.25, 1, 0.5])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.startPointsEnableZoneRender && !this.viewer.cfg.isBattleTrack && (this.data.startPoints.nodes.indexOf(point) == 0))\r\n\t\t}\r\n\t\t\r\n\t\tthis.scene.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t\tthis.sceneAfter.clearDepth(this.viewer.gl)\r\n\t\tthis.sceneAfter.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { ViewerStartPoints }", "const { GfxScene, GfxCamera, GfxMaterial, GfxModel, GfxNodeRenderer, GfxNodeRendererTransform } = require(\"../gl/scene.js\")\r\nconst { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\nconst { Geometry } = require(\"../math/geometry.js\")\r\n\r\n\r\nclass PathViewer\r\n{\r\n\tconstructor(window, viewer, data)\r\n\t{\r\n\t\tthis.window = window\r\n\t\tthis.viewer = viewer\r\n\t\tthis.data = data\r\n        this.renderers = []\r\n\t\t\r\n\t\tthis.scene = new GfxScene()\r\n\t\tthis.sceneAfter = new GfxScene()\r\n\t\tthis.sceneSizeCircles = new GfxScene()\r\n\t\t\r\n\t\tthis.hoveringOverPoint = null\r\n\t\tthis.linkingPoints = false\r\n\t\tthis.targetPos = null\r\n\t\tthis.ctrlIsHeld = false\r\n\t\tthis.altIsHeld = false\r\n\t\t\r\n\t\tthis.lastAxisHotkey = \"\"\r\n\t\tthis.snapCollision = this.viewer.cfg.snapToCollision\r\n\t\tthis.lockX = this.viewer.cfg.lockAxisX\r\n\t\tthis.lockY = this.viewer.cfg.lockAxisY\r\n\t\tthis.lockZ = this.viewer.cfg.lockAxisZ\r\n\t\t\r\n\t\tthis.modelPoint = new ModelBuilder()\r\n\t\t\t.addSphere(-150, -150, -150, 150, 150, 150)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\r\n\t\tthis.modelPointSelection = new ModelBuilder()\r\n\t\t\t.addSphere(-250, -250, 250, 250, 250, -250)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\t\r\n\t\tthis.modelPath = new ModelBuilder()\r\n\t\t\t.addCylinder(-100, -100, 0, 100, 100, 1)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\r\n\t\tthis.modelArrow = new ModelBuilder()\r\n\t\t\t.addCone(-250, -250, -500, 250, 250, 0)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\t\r\n\t\tthis.modelSizeCircle = new ModelBuilder()\r\n\t\t\t.addSphere(-1, -1, -1, 1, 1, 1, 8)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t}\r\n\t\r\n\t\r\n\tsetData(data)\r\n\t{\r\n\t\tthis.data = data\r\n\t\tthis.refresh()\r\n\t}\r\n\t\r\n\t\r\n\tdestroy()\r\n\t{\r\n\t\tfor (let r of this.renderers)\r\n\t\t\tr.detach()\r\n\t\t\r\n\t\tthis.renderers = []\r\n\t}\r\n\t\r\n\t\r\n\trefresh()\r\n\t{\r\n\t\tfor (let r of this.renderers)\r\n\t\t\tr.detach()\r\n\t\t\r\n\t\tthis.renderers = []\r\n\t\t\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t{\r\n\t\t\tif (point.selected === undefined)\r\n\t\t\t{\r\n\t\t\t\tpoint.selected = false\r\n\t\t\t\tpoint.moveOrigin = point.pos\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpoint.renderer = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t.setModel(this.modelPoint)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\r\n\t\t\tpoint.rendererSelected = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.sceneAfter.root)\r\n\t\t\t\t.setModel(this.modelPointSelection)\r\n\t\t\t\t.setMaterial(this.viewer.materialUnshaded)\r\n\t\t\t\t.setEnabled(false)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelectedCore = new GfxNodeRenderer()\r\n\t\t\t\t.attach(point.rendererSelected)\r\n\t\t\t\t.setModel(this.modelPoint)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSizeCircle = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.sceneSizeCircles.root)\r\n\t\t\t\t.setModel(this.modelSizeCircle)\r\n\t\t\t\t.setMaterial(this.viewer.materialUnshaded)\r\n\t\t\t\t\r\n\t\t\tthis.renderers.push(point.renderer)\r\n\t\t\tthis.renderers.push(point.rendererSelected)\r\n\t\t\tthis.renderers.push(point.rendererSizeCircle)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererOutgoingPaths = []\r\n\t\t\tpoint.rendererOutgoingPathArrows = []\r\n\t\t\t\r\n\t\t\tfor (let next of point.next)\r\n\t\t\t{\r\n\t\t\t\tlet rPath = new GfxNodeRendererTransform()\r\n\t\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t\t.setModel(this.modelPath)\r\n\t\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\t\r\n\t\t\t\tlet rArrow = new GfxNodeRendererTransform()\r\n\t\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t\t.setModel(this.modelArrow)\r\n\t\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\t\r\n\t\t\t\tpoint.rendererOutgoingPaths.push(rPath)\r\n\t\t\t\tpoint.rendererOutgoingPathArrows.push(rArrow)\r\n\t\t\t\t\t\r\n\t\t\t\tthis.renderers.push(rPath)\r\n\t\t\t\tthis.renderers.push(rArrow)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tgetHoveringOverElement(cameraPos, ray, distToHit, includeSelected = true)\r\n\t{\r\n\t\tlet elem = null\r\n\t\t\r\n\t\tlet minDistToCamera = distToHit + 1000\r\n\t\tlet minDistToPoint = 1000000\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t{\r\n\t\t\tif (!includeSelected && point.selected)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tlet distToCamera = point.pos.sub(cameraPos).magn()\r\n\t\t\tif (distToCamera >= minDistToCamera)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tlet scale = this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tlet pointDistToRay = Geometry.linePointDistance(ray.origin, ray.direction, point.pos)\r\n\t\t\t\r\n\t\t\tif (pointDistToRay < 150 * scale * 4 && pointDistToRay < minDistToPoint)\r\n\t\t\t{\r\n\t\t\t\telem = point\r\n\t\t\t\tminDistToCamera = distToCamera\r\n\t\t\t\tminDistToPoint = pointDistToRay\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn elem\r\n\t}\r\n\t\r\n\t\r\n\tselectAll()\r\n\t{\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t\tpoint.selected = true\r\n\t\t\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\t\r\n\tunselectAll()\r\n\t{\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t\tpoint.selected = false\r\n\t\t\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\t\r\n\ttoggleAllSelection()\r\n\t{\r\n\t\tlet hasSelection = (this.points().nodes.find(p => p.selected) != null)\r\n\t\t\r\n\t\tif (hasSelection)\r\n\t\t\tthis.unselectAll()\r\n\t\telse\r\n\t\t\tthis.selectAll()\r\n\t}\r\n\t\r\n\t\r\n\tdeleteSelectedPoints()\r\n\t{\r\n\t\tlet pointsToDelete = []\r\n\t\t\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t{\r\n\t\t\tif (!point.selected)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tpointsToDelete.push(point)\r\n\t\t}\r\n\t\t\r\n\t\tfor (let point of pointsToDelete)\r\n\t\t\tthis.points().removeNode(point)\r\n\t\t\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\r\n\r\n\tsnapSelectedToY()\r\n\t{\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t{\r\n\t\t\tif (point.selected)\r\n\t\t\t{\r\n\t\t\t\tlet hit = this.viewer.collision.raycast(point.pos, new Vec3(0, 0, 1))\r\n\t\t\t\tif (hit != null && point.pos.sub(hit.position).magn() > 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet check = this.viewer.collision.raycast(hit.position, new Vec3(0, 0, 1))\r\n\t\t\t\t\tif (check != null && check.position.sub(hit.position).magn() > 1)\r\n\t\t\t\t\t\tpoint.pos = hit.position.sub(point.pos.mul(new Vec3(0, 0, 2))).mul(new Vec3(1, 1, -1))\r\n\t\t\t\t\telse \r\n\t\t\t\t\t\tpoint.pos = hit.position\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\t\r\n\t\r\n\tunlinkSelectedPoints()\r\n\t{\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t{\r\n\t\t\tif (!point.selected)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tlet nextPointsToUnlink = []\r\n\t\t\t\r\n\t\t\tfor (let next of point.next)\r\n\t\t\t{\r\n\t\t\t\tif (!next.node.selected)\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t\r\n\t\t\t\tnextPointsToUnlink.push(next.node)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let next of nextPointsToUnlink)\r\n\t\t\t\tthis.points().unlinkNodes(point, next)\r\n\t\t}\r\n\t\t\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\t\r\n\t\r\n\tsetSelectedAsFirstPoint()\r\n\t{\r\n\t\tfor (let p = 0; p < this.points().nodes.length; p++)\r\n\t\t{\r\n\t\t\tlet point = this.points().nodes[p]\r\n\t\t\t\r\n\t\t\tif (!point.selected)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tthis.points().nodes.splice(p, 1)\r\n\t\t\tthis.points().nodes.unshift(point)\r\n\t\t}\r\n\t\t\r\n\t\tthis.data.refreshIndices(this.viewer.cfg.isBattleTrack)\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\t\r\n\t\r\n\tonKeyDown(ev)\r\n\t{\r\n\t\tif (this.viewer.mouseDown && !(ev.ctrlKey || ev.metaKey) && this.viewer.mouseAction == \"move\")\r\n\t\t{\r\n\t\t\tconst setAxisLocks = (s, x, y, z) =>\r\n\t\t\t{\r\n\t\t\t\tif (this.lastAxisHotkey === s)\r\n\t\t\t\t\treturn false\r\n\r\n\t\t\t\tif (!this.lastAxisHotkey)\r\n\t\t\t\t{\r\n\t\t\t\t\t// save old state\r\n\t\t\t\t\tthis.snapCollision = this.viewer.cfg.snapToCollision\r\n\t\t\t\t\tthis.lockX = this.viewer.cfg.lockAxisX\r\n\t\t\t\t\tthis.lockY = this.viewer.cfg.lockAxisY\r\n\t\t\t\t\tthis.lockZ = this.viewer.cfg.lockAxisZ\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.lastAxisHotkey = s\r\n\r\n\t\t\t\tif (this.hoveringOverPoint != null)\r\n\t\t\t\t\tthis.targetPos = this.hoveringOverPoint.pos\r\n\r\n\t\t\t\tif (x || y || z)\r\n\t\t\t\t\tthis.viewer.cfg.snapToCollision = false\r\n\t\t\t\tthis.viewer.cfg.lockAxisX = x\r\n\t\t\t\tthis.viewer.cfg.lockAxisY = y\r\n\t\t\t\tthis.viewer.cfg.lockAxisZ = z\r\n\r\n\t\t\t\tthis.window.refreshPanels()\r\n\t\t\t}\r\n\r\n\t\t\tswitch (ev.key)\r\n\t\t\t{\r\n\t\t\t\tcase \"X\":\r\n\t\t\t\t\tsetAxisLocks(\"X\", true, false, false)\r\n\t\t\t\t\treturn true\r\n\r\n\t\t\t\tcase \"x\":\r\n\t\t\t\t\tsetAxisLocks(\"x\", false, true, true)\r\n\t\t\t\t\treturn true\r\n\r\n\t\t\t\tcase \"Y\":\r\n\t\t\t\t\tsetAxisLocks(\"Y\", false, true, false)\r\n\t\t\t\t\treturn true\r\n\r\n\t\t\t\tcase \"y\":\r\n\t\t\t\t\tsetAxisLocks(\"y\", true, false, true)\r\n\t\t\t\t\treturn true\r\n\t\t\t\t\r\n\t\t\t\tcase \"Z\":\r\n\t\t\t\t\tsetAxisLocks(\"Z\", false, false, true)\r\n\t\t\t\t\treturn true\r\n\r\n\t\t\t\tcase \"z\":\r\n\t\t\t\t\tsetAxisLocks(\"z\", true, true, false)\r\n\t\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tswitch (ev.key)\r\n\t\t{\r\n\t\t\tcase \"A\":\r\n\t\t\tcase \"a\":\r\n\t\t\t\tthis.toggleAllSelection()\r\n\t\t\t\treturn true\r\n\t\t\t\r\n\t\t\tcase \"Backspace\":\r\n\t\t\tcase \"Delete\":\r\n\t\t\tcase \"X\":\r\n\t\t\tcase \"x\":\r\n\t\t\t\tthis.deleteSelectedPoints()\r\n\t\t\t\treturn true\r\n\r\n\t\t\tcase \"Y\":\r\n\t\t\tcase \"y\":\r\n\t\t\t\tthis.snapSelectedToY()\r\n\t\t\t\treturn true\r\n\t\t\t\t\r\n\t\t\tcase \"U\":\r\n\t\t\tcase \"u\":\r\n\t\t\t\tthis.unlinkSelectedPoints()\r\n\t\t\t\treturn true\r\n\t\t\t\t\r\n\t\t\tcase \"F\":\r\n\t\t\tcase \"f\":\r\n\t\t\t\tthis.setSelectedAsFirstPoint()\r\n\t\t\t\treturn true\r\n\t\t}\r\n\t\t\r\n\t\treturn false\r\n\t}\r\n\t\r\n\t\r\n\tonMouseDown(ev, x, y, cameraPos, ray, hit, distToHit, mouse3DPos)\r\n\t{\r\n\t\tthis.linkingPoints = false\r\n\t\t\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t\tpoint.moveOrigin = point.pos\r\n\t\t\r\n\t\tlet hoveringOverElem = this.getHoveringOverElement(cameraPos, ray, distToHit)\r\n\t\t\r\n\t\tif (ev.altKey || (!(ev.ctrlKey || ev.metaKey) && (hoveringOverElem == null || !hoveringOverElem.selected)))\r\n\t\t\tthis.unselectAll()\r\n\r\n\t\tif (ev.ctrlKey || ev.metaKey)\r\n\t\t\tthis.ctrlIsHeld = true\r\n\r\n\t\tif (ev.altKey)\r\n\t\t\tthis.altIsHeld = true\r\n\t\t\r\n\t\tif (hoveringOverElem != null)\r\n\t\t{\r\n\t\t\tif (ev.altKey)\r\n\t\t\t{\r\n\t\t\t\tif (this.points().nodes.length >= this.points().maxNodes)\r\n\t\t\t\t{\r\n\t\t\t\t\talert(\"KMP error!\\n\\nMaximum number of points surpassed (\" + this.points().maxNodes + \")\")\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\telse if (hoveringOverElem.next.length >= this.points().maxNextNodes)\r\n\t\t\t\t{\r\n\t\t\t\t\talert(\"Node link error!\\n\\nMax outgoing connections to a point surpassed (maximum \" + this.points().maxNextNodes + \")\")\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet newPoint = this.points().addNode()\r\n\t\t\t\tthis.points().onCloneNode(newPoint, hoveringOverElem)\r\n\t\t\t\tnewPoint.pos = hoveringOverElem.pos\r\n\t\t\t\tnewPoint.size = hoveringOverElem.size\r\n\t\t\t\t\r\n\t\t\t\tthis.points().linkNodes(hoveringOverElem, newPoint)\r\n\t\t\t\t\r\n\t\t\t\tthis.refresh()\r\n\t\t\t\t\r\n\t\t\t\tnewPoint.selected = true\r\n\t\t\t\tthis.targetPos = newPoint.moveOrigin.clone()\r\n\t\t\t\tthis.linkingPoints = true\r\n\t\t\t\tthis.data.refreshIndices(this.viewer.cfg.isBattleTrack)\r\n\t\t\t\tthis.viewer.setCursor(\"-webkit-grabbing\")\r\n\t\t\t\tthis.refreshPanels()\r\n\t\t\t\tthis.window.setNotSaved()\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\thoveringOverElem.selected = true\r\n\t\t\t\tthis.targetPos = hoveringOverElem.moveOrigin.clone()\r\n\t\t\t\tthis.refreshPanels()\r\n\t\t\t\tthis.viewer.setCursor(\"-webkit-grabbing\")\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (ev.altKey)\r\n\t\t{\r\n\t\t\tif (this.points().nodes.length >= this.points().maxNodes)\r\n\t\t\t{\r\n\t\t\t\talert(\"KMP error!\\n\\nMaximum number of points surpassed (\" + this.points().maxNodes + \")\")\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tlet newPoint = this.points().addNode()\r\n\t\t\tnewPoint.pos = mouse3DPos\r\n\t\t\t\r\n\t\t\tthis.refresh()\r\n\t\t\tnewPoint.selected = true\r\n\t\t\tthis.targetPos = newPoint.moveOrigin.clone()\r\n\t\t\tthis.data.refreshIndices(this.viewer.cfg.isBattleTrack)\r\n\t\t\tthis.viewer.setCursor(\"-webkit-grabbing\")\r\n\t\t\tthis.refreshPanels()\r\n\t\t\tthis.window.setNotSaved()\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tonMouseMove(ev, x, y, cameraPos, ray, hit, distToHit)\r\n\t{\r\n\t\t// Mouse not held OR mouse held, ctrl held\r\n\t\tif (!this.viewer.mouseDown || this.ctrlIsHeld)\r\n\t\t{\r\n\t\t\tlet lastHover = this.hoveringOverPoint\r\n\t\t\tthis.hoveringOverPoint = this.getHoveringOverElement(cameraPos, ray, distToHit)\r\n\t\t\t\r\n\t\t\tif (this.hoveringOverPoint != null)\r\n\t\t\t{\r\n\t\t\t\tthis.viewer.setCursor(\"-webkit-grab\")\r\n\t\t\t\tif (this.ctrlIsHeld)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.hoveringOverPoint.selected = true\r\n\t\t\t\t\tthis.refreshPanels()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this.hoveringOverPoint != lastHover)\r\n\t\t\t\tthis.viewer.render()\r\n\t\t}\r\n\t\t// Mouse held, ctrl not held, holding point(s)\r\n\t\telse if (this.viewer.mouseAction == \"move\")\r\n\t\t{\r\n\t\t\tlet linkToPoint = this.getHoveringOverElement(cameraPos, ray, distToHit, false)\r\n\t\t\tlet selectedPoints = []\r\n\t\t\t\r\n\t\t\tfor (let point of this.points().nodes)\r\n\t\t\t{\r\n\t\t\t\tif (!point.selected)\r\n\t\t\t\t\tcontinue\r\n\t\t\t\tselectedPoints.push(point)\r\n\t\t\t}\r\n\t\t\t// Creating new linked point\r\n\t\t\tif (selectedPoints.length == 1 && ev.altKey && !this.altIsHeld)\r\n\t\t\t{\r\n\t\t\t\tif (this.points().nodes.length >= this.points().maxNodes)\r\n\t\t\t\t{\r\n\t\t\t\t\talert(\"KMP error!\\n\\nMaximum number of points surpassed (\" + this.points().maxNodes + \")\")\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tlet point = selectedPoints[0]\r\n\r\n\t\t\t\tlet newPoint = this.points().addNode()\r\n\t\t\t\tnewPoint.pos = point.moveOrigin\r\n\t\t\t\tnewPoint.size = point.size\r\n\t\t\t\t\r\n\t\t\t\tthis.points().linkNodes(point, newPoint)\r\n\t\t\t\t\r\n\t\t\t\tthis.refresh()\r\n\t\t\t\t\r\n\t\t\t\tpoint.selected = false\r\n\t\t\t\tnewPoint.selected = true\r\n\t\t\t\tthis.targetPos = newPoint.moveOrigin.clone()\r\n\t\t\t\tthis.linkingPoints = true\r\n\t\t\t\tthis.altIsHeld = true\r\n\t\t\t\tthis.data.refreshIndices(this.viewer.cfg.isBattleTrack)\r\n\t\t\t\tthis.viewer.setCursor(\"-webkit-grabbing\")\r\n\t\t\t\tthis.refreshPanels()\r\n\t\t\t\tthis.window.setNotSaved()\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\telse if (!ev.altKey)\r\n\t\t\t{\r\n\t\t\t\tthis.altIsHeld = false\r\n\t\t\t}\r\n\r\n\t\t\tthis.window.setNotSaved()\r\n\t\t\tthis.viewer.setCursor(\"-webkit-grabbing\")\r\n\r\n\t\t\tlet moveVector = null\r\n\t\t\t\t\t\t\t\r\n\t\t\tlet screenPosMoved = this.viewer.pointToScreen(this.targetPos)\r\n\t\t\tscreenPosMoved.x += this.viewer.mouseMoveOffsetPixels.x\r\n\t\t\tscreenPosMoved.y += this.viewer.mouseMoveOffsetPixels.y\r\n\t\t\tlet pointRayMoved = this.viewer.getScreenRay(screenPosMoved.x, screenPosMoved.y)\r\n\t\t\t\r\n\t\t\tlet hit = this.viewer.collision.raycast(pointRayMoved.origin, pointRayMoved.direction)\r\n\t\t\tif (this.viewer.cfg.snapToCollision && hit != null)\r\n\t\t\t\tmoveVector = hit.position.sub(this.targetPos)\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tlet screenPos = this.viewer.pointToScreen(this.targetPos)\r\n\t\t\t\tlet pointRay = this.viewer.getScreenRay(screenPos.x, screenPos.y)\r\n\t\t\t\tlet origDistToScreen = this.targetPos.sub(pointRay.origin).magn()\r\n\t\t\t\t\r\n\t\t\t\tlet direction = pointRayMoved.direction\r\n\r\n\t\t\t\tif (this.viewer.cfg.lockAxisX && this.viewer.cfg.lockAxisY && this.viewer.cfg.lockAxisZ)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.viewer.cfg.lockAxisX)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this.viewer.cfg.lockAxisY)\r\n\t\t\t\t\t\tdirection = Geometry.lineLineProjection(pointRayMoved.origin, direction, this.targetPos, new Vec3(0, 1, 0))\r\n\t\t\t\t\telse if (this.viewer.cfg.lockAxisZ)\r\n\t\t\t\t\t\tdirection = Geometry.lineLineProjection(pointRayMoved.origin, direction, this.targetPos, new Vec3(0, 0, 1))\r\n\t\t\t\t\tdirection = direction.scale((this.targetPos.x - pointRayMoved.origin.x) / direction.x)\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.viewer.cfg.lockAxisY)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this.viewer.cfg.lockAxisZ)\r\n\t\t\t\t\t\tdirection = Geometry.lineLineProjection(pointRayMoved.origin, direction, this.targetPos, new Vec3(1, 0, 0))\r\n\t\t\t\t\tdirection = direction.scale((this.targetPos.z - pointRayMoved.origin.z) / direction.z)\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.viewer.cfg.lockAxisZ)\r\n\t\t\t\t{\r\n\t\t\t\t\tdirection = direction.scale((this.targetPos.y - pointRayMoved.origin.y) / direction.y)\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tdirection = direction.scale(origDistToScreen)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet newPos = pointRayMoved.origin.add(direction)\r\n\r\n\t\t\t\tif (this.viewer.cfg.lockAxisX)\r\n\t\t\t\t\tnewPos.x = this.targetPos.x\r\n\t\t\t\tif (this.viewer.cfg.lockAxisY)\r\n\t\t\t\t\tnewPos.z = this.targetPos.z\r\n\t\t\t\tif (this.viewer.cfg.lockAxisZ)\r\n\t\t\t\t\tnewPos.y = this.targetPos.y\r\n\t\t\t\t\r\n\t\t\t\tmoveVector = newPos.sub(this.targetPos)\r\n\t\t\t}\r\n\r\n\t\t\tfor (let point of this.points().nodes)\r\n\t\t\t{\r\n\t\t\t\tif (!point.selected)\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t\r\n\t\t\t\tif (this.linkingPoints && linkToPoint != null && linkToPoint.pos != point.moveOrigin)\r\n\t\t\t\t\tpoint.pos = linkToPoint.pos\r\n\t\t\t\telse\r\n\t\t\t\t\tpoint.pos = point.moveOrigin.add(moveVector)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.refreshPanels()\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tonMouseUp(ev, x, y)\r\n\t{\r\n\t\tthis.ctrlIsHeld = false\r\n\t\tthis.altIsHeld = false\r\n\t\t\r\n\t\tif (this.lastAxisHotkey) {\r\n\t\t\tthis.lastAxisHotkey = \"\"\r\n\t\t\tthis.viewer.cfg.snapToCollision = this.snapCollision\r\n\t\t\tthis.viewer.cfg.lockAxisX = this.lockX\r\n\t\t\tthis.viewer.cfg.lockAxisY = this.lockY\r\n\t\t\tthis.viewer.cfg.lockAxisZ = this.lockZ\r\n\t\t\tthis.window.refreshPanels()\r\n\t\t}\r\n\r\n\t\tif (this.viewer.mouseAction == \"move\")\r\n\t\t{\r\n\t\t\tif (this.linkingPoints)\r\n\t\t\t{\r\n\t\t\t\tlet pointBeingLinked = this.points().nodes.find(p => p.selected)\r\n\t\t\t\tif (pointBeingLinked == null)\r\n\t\t\t\t\treturn\r\n\t\t\t\t\r\n\t\t\t\tlet pointBeingLinkedTo = this.points().nodes.find(p => p != pointBeingLinked && p.pos == pointBeingLinked.pos)\r\n\t\t\t\t\r\n\t\t\t\tif (pointBeingLinkedTo != null)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.points().removeNode(pointBeingLinked)\r\n\r\n\t\t\t\t\tif (pointBeingLinkedTo.prev.length >= this.points().maxPrevNodes)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\talert(\"Node link error!\\n\\nMax incoming connections to a point surpassed (maximum \" + this.points().maxPrevNodes + \")\")\r\n\t\t\t\t\t\tthis.refresh()\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.points().linkNodes(pointBeingLinked.prev[0].node, pointBeingLinkedTo)\r\n\t\t\t\t\tthis.refresh()\r\n\t\t\t\t\tthis.window.setNotSaved()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tdrawSizeCircles()\r\n\t{\r\n\t\tlet gl = this.viewer.gl\r\n\t\tlet camera = this.viewer.getCurrentCamera()\r\n\t\t\r\n\t\tgl.enable(gl.STENCIL_TEST)\r\n\t\tgl.stencilFunc(gl.ALWAYS, 0, 0xff)\r\n\t\tgl.stencilMask(0xff)\r\n\t\tgl.clearStencil(0)\r\n\t\tgl.clear(gl.STENCIL_BUFFER_BIT)\r\n\r\n\t\tgl.colorMask(false, false, false, false)\r\n\t\tgl.depthMask(false)\r\n\t\tgl.cullFace(gl.FRONT)\r\n\t\tgl.stencilOp(gl.KEEP, gl.INCR, gl.KEEP)\r\n\t\tthis.sceneSizeCircles.render(gl, camera)\r\n\t\t\r\n\t\tgl.cullFace(gl.BACK)\r\n\t\tgl.stencilOp(gl.KEEP, gl.DECR, gl.KEEP)\r\n\t\tthis.sceneSizeCircles.render(gl, camera)\r\n\t\t\r\n\t\tgl.cullFace(gl.BACK)\r\n\t\tgl.colorMask(true, true, true, true)\r\n\t\tgl.stencilMask(0x00)\r\n\t\tgl.stencilFunc(gl.NOTEQUAL, 0, 0xff)\r\n\r\n\t\tthis.sceneSizeCircles.render(gl, camera)\r\n\t\t\r\n\t\tgl.depthMask(true)\r\n\t\tgl.disable(gl.STENCIL_TEST)\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { PathViewer }", "const { GfxScene, GfxCamera, GfxMaterial, GfxModel, GfxNodeRenderer, GfxNodeRendererTransform } = require(\"../gl/scene.js\")\r\nconst { PathViewer } = require(\"./pathViewer.js\")\r\nconst { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\nconst { Geometry } = require(\"../math/geometry.js\")\r\n\r\n\r\nclass ViewerEnemyPaths extends PathViewer\r\n{\r\n\tconstructor(window, viewer, data)\r\n\t{\r\n\t\tsuper(window, viewer, data)\r\n\t}\r\n\t\r\n\t\r\n\tpoints()\r\n\t{\r\n\t\treturn this.data.enemyPoints\r\n\t}\r\n\t\r\n\t\r\n\trefreshPanels()\r\n\t{\r\n\t\tlet panel = this.window.addPanel(\"Enemy Paths\", false, (open) => { if (open) this.viewer.setSubviewer(this) })\r\n\t\tthis.panel = panel\r\n\t\t\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Click:</strong> Create Point\")\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Drag Point:</strong> Extend Path\")\r\n\t\tpanel.addText(null, \"<strong>Hold Ctrl:</strong> Multiselect\")\r\n\r\n\t\tpanel.addCheckbox(null, \"Show point sizes\", this.viewer.cfg.enemyPathsEnableSizeRender, (x) => this.viewer.cfg.enemyPathsEnableSizeRender = x)\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tif (this.data.enemyPoints.nodes.length == 0 && this.data.itemPoints.nodes.length > 0)\r\n\t\t\tpanel.addButton(null, \"Copy From Item Paths\", () => this.copyFromItemPaths())\r\n\r\n\t\tpanel.addButton(null, \"(A) Select/Unselect All\", () => this.toggleAllSelection())\r\n\t\tpanel.addButton(null, \"(X) Delete Selected\", () => this.deleteSelectedPoints())\r\n\t\tpanel.addButton(null, \"(Y) Snap To Collision Y\", () => this.snapSelectedToY())\r\n\t\tpanel.addButton(null, \"(U) Unlink Selected\", () => this.unlinkSelectedPoints())\r\n\t\tpanel.addButton(null, \"(F) Set Selected as First Point\", () => this.setSelectedAsFirstPoint())\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tlet selectedPoints = this.data.enemyPoints.nodes.filter(p => p.selected)\r\n\t\t\r\n\t\tlet selectionGroup = panel.addGroup(null, \"Selection:\")\r\n\t\tlet enabled = (selectedPoints.length > 0)\r\n\t\tlet multiedit = (selectedPoints.length > 1)\r\n\t\t\r\n\t\tif (selectedPoints.length == 1)\r\n\t\t{\r\n\t\t\tconst formatNum = (x) =>\r\n\t\t\t{\r\n\t\t\t\tif (x === null || x === undefined)\r\n\t\t\t\t\treturn \"\"\r\n\t\t\t\t\r\n\t\t\t\treturn x.toString()\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst formatNumHex = (x) =>\r\n\t\t\t{\r\n\t\t\t\tif (x === null || x === undefined)\r\n\t\t\t\t\treturn \"\"\r\n\t\t\t\t\r\n\t\t\t\treturn x.toString() + \" (0x\" + x.toString(16) + \")\"\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>ENPH Index:</strong> \" + formatNumHex(selectedPoints[0].pathIndex) + \", point #\" + formatNum(selectedPoints[0].pathPointIndex))\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>ENPT Index:</strong> \" + formatNumHex(selectedPoints[0].pointIndex))\r\n\t\t}\r\n\t\t\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,    \"X\", -1000000, 1000000, selectedPoints.map(p =>  p.pos.x),   null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.x = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,    \"Y\", -1000000, 1000000, selectedPoints.map(p => -p.pos.z),   null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.z = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,    \"Z\", -1000000, 1000000, selectedPoints.map(p => -p.pos.y),   null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.y = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Deviation\",   1,    1000, selectedPoints.map(p =>  p.deviation), null, 0.1, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].deviation = x })\r\n\t\t\r\n\t\tlet setting1Options =\r\n\t\t[\r\n\t\t\t{ str: \"None\", value: 0 },\r\n\t\t\t{ str: \"Requires Mushroom\", value: 1 },\r\n\t\t\t{ str: \"Use Mushroom\", value: 2 },\r\n\t\t\t{ str: \"Allow Wheelie\", value: 3 },\r\n\t\t\t{ str: \"End Wheelie\", value: 4 },\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(selectionGroup, \"Setting 1\", selectedPoints.map(p => p.setting1), setting1Options, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting1 = x })\r\n\t\t\r\n\t\tlet setting2Options =\r\n\t\t[\r\n\t\t\t{ str: \"None\", value: 0 },\r\n\t\t\t{ str: \"End Drift\", value: 1 },\r\n\t\t\t{ str: \"Forbid Drift(?)\", value: 2 },\r\n\t\t\t{ str: \"Force Drift\", value: 3 },\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(selectionGroup, \"Setting 2\", selectedPoints.map(p => p.setting2), setting2Options, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting2 = x })\r\n\t\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Setting 3\", 0, 0xff, selectedPoints.map(p => p.setting3), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting3 = x })\r\n\t}\r\n\t\r\n\t\r\n\trefresh()\r\n\t{\r\n\t\tsuper.refresh()\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\r\n\r\n\tcopyFromItemPaths()\r\n\t{\r\n\t\tlet newGraph = this.data.itemPoints.clone()\r\n\t\tnewGraph.onAddNode = (node) => \r\n\t\t{\r\n\t\t\tnode.pos = new Vec3(0, 0, 0)\r\n\t\t\tnode.deviation = 10\r\n\t\t\tnode.setting1 = 0\r\n\t\t\tnode.setting2 = 0\r\n\t\t\tnode.setting3 = 0\r\n\t\t}\r\n\t\tnewGraph.onCloneNode = (newNode, oldNode) => \r\n\t\t{\r\n\t\t\tnewNode.pos = oldNode.pos.clone()\r\n\t\t\tnewNode.deviation = oldNode.deviation\r\n\t\t\tnewNode.setting1 = oldNode.setting1\r\n\t\t\tnewNode.setting2 = oldNode.setting2\r\n\t\t\tnewNode.setting3 = oldNode.setting3\r\n\t\t}\r\n\r\n\t\tfor (let point of newGraph.nodes)\r\n\t\t{\r\n\t\t\tpoint.setting1 = 0\r\n\t\t\tpoint.setting2 = 0\r\n\t\t\tpoint.setting3 = 0\r\n\t\t}\r\n\r\n\t\tthis.data.enemyPoints = newGraph\r\n\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\t\r\n\t\r\n\tdrawAfterModel()\r\n\t{\r\n\t\tlet cameraPos = this.viewer.getCurrentCameraPosition()\r\n\t\t\r\n\t\tfor (let p = 0; p < this.data.enemyPoints.nodes.length; p++)\r\n\t\t{\r\n\t\t\tlet point = this.data.enemyPoints.nodes[p]\r\n\t\t\t\r\n\t\t\tlet scale = (this.hoveringOverPoint == point ? 1.5 : 1) * this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tlet useMushroom = (point.setting1 == 2)\r\n\t\t\t\r\n\t\t\tpoint.renderer\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor(p == 0 ? [0.6, 0, 0, 1] : useMushroom ? [1, 0.5, 0.95, 1] : [1, 0, 0, 1])\r\n\t\t\t\t\r\n\t\t\tlet sizeCircleScale = point.deviation * 50\r\n\t\t\tpoint.rendererSizeCircle\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(sizeCircleScale, sizeCircleScale, sizeCircleScale))\r\n\t\t\t\t.setDiffuseColor([1, 0.5, 0, 0.5])\r\n\t\t\t\t\r\n\t\t\tfor (let n = 0; n < point.next.length; n++)\r\n\t\t\t{\r\n\t\t\t\tlet nextPos = point.next[n].node.pos\r\n\t\t\t\t\r\n\t\t\t\tlet scale2 = Math.min(scale, this.viewer.getElementScale(nextPos))\r\n\t\t\t\t\r\n\t\t\t\tlet requiresMushroom = (point.next[n].node.setting1 == 1)\r\n\t\t\t\t\r\n\t\t\t\tlet matrixScale = Mat4.scale(scale2, scale2, nextPos.sub(point.pos).magn())\r\n\t\t\t\tlet matrixAlign = Mat4.rotationFromTo(new Vec3(0, 0, 1), nextPos.sub(point.pos).normalize())\r\n\t\t\t\tlet matrixTranslate = Mat4.translation(point.pos.x, point.pos.y, point.pos.z)\r\n\t\t\t\t\r\n\t\t\t\tlet matrixScaleArrow = Mat4.scale(scale2, scale2, scale2)\r\n\t\t\t\tlet matrixTranslateArrow = Mat4.translation(nextPos.x, nextPos.y, nextPos.z)\r\n\t\t\t\t\r\n\t\t\t\tpoint.rendererOutgoingPaths[n]\r\n\t\t\t\t\t.setCustomMatrix(matrixScale.mul(matrixAlign.mul(matrixTranslate)))\r\n\t\t\t\t\t.setDiffuseColor(requiresMushroom ? [1, 0.5, 0.75, 1] : [1, 0.5, 0, 1])\r\n\t\t\t\t\t\r\n\t\t\t\tpoint.rendererOutgoingPathArrows[n]\r\n\t\t\t\t\t.setCustomMatrix(matrixScaleArrow.mul(matrixAlign.mul(matrixTranslateArrow)))\r\n\t\t\t\t\t.setDiffuseColor([1, 0.75, 0, 1])\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (this.viewer.cfg.enemyPathsEnableSizeRender)\r\n\t\t\tthis.drawSizeCircles()\r\n\t\t\r\n\t\tthis.scene.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t\t\r\n\t\tfor (let p = 0; p < this.data.enemyPoints.nodes.length; p++)\r\n\t\t{\r\n\t\t\tlet point = this.data.enemyPoints.nodes[p]\r\n\t\t\t\r\n\t\t\tlet scale = (this.hoveringOverPoint == point ? 1.5 : 1) * this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tpoint.rendererSelected\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([1, 0.5, 0.5, 1])\r\n\t\t\t\t.setEnabled(point.selected)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelectedCore\r\n\t\t\t\t.setDiffuseColor(p == 0 ? [0.6, 0, 0, 1] : [1, 0, 0, 1])\r\n\t\t}\r\n\t\t\r\n\t\tthis.sceneAfter.clearDepth(this.viewer.gl)\r\n\t\tthis.sceneAfter.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { ViewerEnemyPaths }", "const { GfxScene, GfxCamera, GfxMaterial, GfxModel, GfxNodeRenderer, GfxNodeRendererTransform } = require(\"../gl/scene.js\")\r\nconst { PathViewer } = require(\"./pathViewer.js\")\r\nconst { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\nconst { Geometry } = require(\"../math/geometry.js\")\r\n\r\n\r\nclass ViewerItemPaths extends PathViewer\r\n{\r\n\tconstructor(window, viewer, data)\r\n\t{\r\n\t\tsuper(window, viewer, data)\r\n\t}\r\n\t\r\n\t\r\n\tpoints()\r\n\t{\r\n\t\treturn this.data.itemPoints\r\n\t}\r\n\t\r\n\t\r\n\trefreshPanels()\r\n\t{\r\n\t\tlet panel = this.window.addPanel(\"Item Paths\", false, (open) => { if (open) this.viewer.setSubviewer(this) })\r\n\t\tthis.panel = panel\r\n\t\t\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Click:</strong> Create Point\")\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Drag Point:</strong> Extend Path\")\r\n\t\tpanel.addText(null, \"<strong>Hold Ctrl:</strong> Multiselect\")\r\n\r\n\t\tpanel.addCheckbox(null, \"Show point sizes\", this.viewer.cfg.enemyPathsEnableSizeRender, (x) => this.viewer.cfg.enemyPathsEnableSizeRender = x)\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tif (this.data.itemPoints.nodes.length == 0 && this.data.enemyPoints.nodes.length > 0)\r\n\t\t\tpanel.addButton(null, \"Copy From Enemy Paths\", () => this.copyFromEnemyPaths())\r\n\t\t\r\n\t\tpanel.addButton(null, \"(A) Select/Unselect All\", () => this.toggleAllSelection())\r\n\t\tpanel.addButton(null, \"(X) Delete Selected\", () => this.deleteSelectedPoints())\r\n\t\tpanel.addButton(null, \"(Y) Snap To Collision Y\", () => this.snapSelectedToY())\r\n\t\tpanel.addButton(null, \"(U) Unlink Selected\", () => this.unlinkSelectedPoints())\r\n\t\tpanel.addButton(null, \"(F) Set Selected as First Point\", () => this.setSelectedAsFirstPoint())\r\n\t\tpanel.addButton(null, \"(D) Set as Default Bill Route\", () => this.setDefaultBillRoute())\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tlet selectedPoints = this.data.itemPoints.nodes.filter(p => p.selected)\r\n\t\t\r\n\t\tlet selectionGroup = panel.addGroup(null, \"Selection:\")\r\n\t\tlet enabled = (selectedPoints.length > 0)\r\n\t\tlet multiedit = (selectedPoints.length > 1)\r\n\t\t\r\n\t\tif (selectedPoints.length == 1)\r\n\t\t{\r\n\t\t\tconst formatNum = (x) =>\r\n\t\t\t{\r\n\t\t\t\tif (x === null || x === undefined)\r\n\t\t\t\t\treturn \"\"\r\n\t\t\t\t\r\n\t\t\t\treturn x.toString()\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst formatNumHex = (x) =>\r\n\t\t\t{\r\n\t\t\t\tif (x === null || x === undefined)\r\n\t\t\t\t\treturn \"\"\r\n\t\t\t\t\r\n\t\t\t\treturn x.toString() + \" (0x\" + x.toString(16) + \")\"\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>ITPH Index:</strong> \" + formatNumHex(selectedPoints[0].pathIndex) + \", point #\" + formatNum(selectedPoints[0].pathPointIndex))\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>ITPT Index:</strong> \" + formatNumHex(selectedPoints[0].pointIndex))\r\n\t\t}\r\n\t\t\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,    \"X\", -1000000, 1000000, selectedPoints.map(p =>  p.pos.x),   null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.x = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,    \"Y\", -1000000, 1000000, selectedPoints.map(p => -p.pos.z),   null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.z = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,    \"Z\", -1000000, 1000000, selectedPoints.map(p => -p.pos.y),   null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.y = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Deviation\",   1,    1000, selectedPoints.map(p =>  p.deviation), null, 0.1, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].deviation = x })\r\n\t\t\r\n\t\tlet setting1Options =\r\n\t\t[\r\n\t\t\t{ str: \"None\", value: 0 },\r\n\t\t\t{ str: \"B.Bill uses gravity\", value: 1 },\r\n\t\t\t{ str: \"B.Bill disregards gravity\", value: 2 }\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(selectionGroup, \"Setting 1\", selectedPoints.map(p => p.setting1), setting1Options, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting1 = x })\r\n\t\t\r\n\t\tlet setting2Options =\r\n\t\t[\r\n\t\t\t{ str: \"None\", value: 0 },\r\n\t\t\t{ str: \"B.Bill can't stop\", value: 1 },\r\n\t\t\t{ str: \"Low-priority route\", value: 0xa },\r\n\t\t\t{ str: \"B.Bill can't stop & Low-priority route\", value: 0xb },\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(selectionGroup, \"Setting 2\", selectedPoints.map(p => p.setting2), setting2Options, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting2 = x })\r\n\t}\r\n\t\r\n\t\r\n\trefresh()\r\n\t{\r\n\t\tsuper.refresh()\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\r\n\r\n\tsetDefaultBillRoute()\r\n\t{\r\n\t\tfor (let point of this.data.itemPoints.nodes)\r\n\t\t\tif (point.selected)\r\n\t\t\t\tfor (let prev of point.prev)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet i = prev.node.next.findIndex(p => p.node == point)\r\n\t\t\t\t\tlet prevLink = prev.node.next.splice(i, 1)[0]\r\n\t\t\t\t\tprev.node.next.unshift(prevLink)\r\n\t\t\t\t}\r\n\t\t\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\r\n\r\n\tcopyFromEnemyPaths()\r\n\t{\r\n\t\tlet newGraph = this.data.enemyPoints.clone()\r\n\t\tnewGraph.onAddNode = (node) => \r\n\t\t{\r\n\t\t\tnode.pos = new Vec3(0, 0, 0)\r\n\t\t\tnode.deviation = 10\r\n\t\t\tnode.setting1 = 0\r\n\t\t\tnode.setting2 = 0\r\n\t\t}\r\n\t\tnewGraph.onCloneNode = (newNode, oldNode) => \r\n\t\t{\r\n\t\t\tnewNode.pos = oldNode.pos.clone()\r\n\t\t\tnewNode.deviation = oldNode.deviation\r\n\t\t\tnewNode.setting1 = oldNode.setting1\r\n\t\t\tnewNode.setting2 = oldNode.setting2\r\n\t\t}\r\n\r\n\t\tfor (let point of newGraph.nodes)\r\n\t\t{\r\n\t\t\tpoint.setting1 = 0\r\n\t\t\tpoint.setting2 = 0\r\n\t\t\tdelete point.setting3\r\n\t\t}\r\n\r\n\t\tthis.data.itemPoints = newGraph\r\n\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\r\n\r\n\tonKeyDown(ev)\r\n\t{\r\n\t\tif (super.onKeyDown(ev))\r\n\t\t\treturn true\r\n\t\t\r\n\t\tswitch (ev.key)\r\n\t\t{\r\n\t\t\tcase \"D\":\r\n\t\t\tcase \"d\":\r\n\t\t\t\tthis.setDefaultBillRoute()\r\n\t\t\t\treturn true\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tdrawAfterModel()\r\n\t{\r\n\t\tlet cameraPos = this.viewer.getCurrentCameraPosition()\r\n\t\t\r\n\t\tfor (let p = 0; p < this.data.itemPoints.nodes.length; p++)\r\n\t\t{\r\n\t\t\tlet point = this.data.itemPoints.nodes[p]\r\n\t\t\t\r\n\t\t\tlet scale = (this.hoveringOverPoint == point ? 1.5 : 1) * this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tlet bbillCantStop = (point.setting2 & 0x1) != 0\r\n\t\t\t\r\n\t\t\tpoint.renderer\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor(p == 0 ? [0, 0.4, 0, 1] : bbillCantStop ? [0.75, 0.75, 0.75, 1] : [0, 0.8, 0, 1])\r\n\t\t\t\t\r\n\t\t\tlet sizeCircleScale = point.deviation * 50\r\n\t\t\tpoint.rendererSizeCircle\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(sizeCircleScale, sizeCircleScale, sizeCircleScale))\r\n\t\t\t\t.setDiffuseColor([0.25, 0.8, 0, 0.5])\r\n\t\t\t\t\r\n\t\t\tfor (let n = 0; n < point.next.length; n++)\r\n\t\t\t{\r\n\t\t\t\tlet nextPos = point.next[n].node.pos\r\n\t\t\t\t\r\n\t\t\t\tlet scale2 = Math.min(scale, this.viewer.getElementScale(nextPos))\r\n\t\t\t\t\r\n\t\t\t\tlet nextBbillCantStop = (point.next[n].node.setting2 & 0x1) != 0\r\n\t\t\t\tlet lowPriority = (point.next[n].node.setting2 & 0xa) != 0\r\n\t\t\t\t\r\n\t\t\t\tlet matrixScale = Mat4.scale(scale2, scale2, nextPos.sub(point.pos).magn())\r\n\t\t\t\tlet matrixAlign = Mat4.rotationFromTo(new Vec3(0, 0, 1), nextPos.sub(point.pos).normalize())\r\n\t\t\t\tlet matrixTranslate = Mat4.translation(point.pos.x, point.pos.y, point.pos.z)\r\n\t\t\t\t\r\n\t\t\t\tlet matrixScaleArrow = Mat4.scale(scale2, scale2, scale2)\r\n\t\t\t\tlet matrixTranslateArrow = Mat4.translation(nextPos.x, nextPos.y, nextPos.z)\r\n\t\t\t\t\r\n\t\t\t\tpoint.rendererOutgoingPaths[n]\r\n\t\t\t\t\t.setCustomMatrix(matrixScale.mul(matrixAlign.mul(matrixTranslate)))\r\n\t\t\t\t\t.setDiffuseColor(nextBbillCantStop ? [0.5, 0.5, 0.5, 1] : lowPriority ? [0.5, 1, 0.8, 1] : n != 0 ? [0.8, 1, 0.5, 1] : [0.5, 1, 0, 1])\r\n\t\t\t\t\t\r\n\t\t\t\tpoint.rendererOutgoingPathArrows[n]\r\n\t\t\t\t\t.setCustomMatrix(matrixScaleArrow.mul(matrixAlign.mul(matrixTranslateArrow)))\r\n\t\t\t\t\t.setDiffuseColor(nextBbillCantStop ? [0.85, 0.85, 0.85, 1] : [0.1, 0.8, 0, 1])\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (this.viewer.cfg.enemyPathsEnableSizeRender)\r\n\t\t\tthis.drawSizeCircles()\r\n\t\t\r\n\t\tthis.scene.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t\t\r\n\t\tfor (let p = 0; p < this.data.itemPoints.nodes.length; p++)\r\n\t\t{\r\n\t\t\tlet point = this.data.itemPoints.nodes[p]\r\n\t\t\t\r\n\t\t\tlet scale = (this.hoveringOverPoint == point ? 1.5 : 1) * this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tpoint.rendererSelected\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([0.4, 1, 0.1, 1])\r\n\t\t\t\t.setEnabled(point.selected)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelectedCore\r\n\t\t\t\t.setDiffuseColor(p == 0 ? [0, 0.4, 0, 1] :[0, 0.8, 0, 1])\r\n\t\t}\r\n\t\t\r\n\t\tthis.sceneAfter.clearDepth(this.viewer.gl)\r\n\t\tthis.sceneAfter.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { ViewerItemPaths }", "const { GfxScene, GfxCamera, GfxMaterial, GfxModel, GfxNodeRenderer, GfxNodeRendererTransform } = require(\"../gl/scene.js\")\r\nconst { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\nconst { Geometry } = require(\"../math/geometry.js\")\r\n\r\n\r\nclass ViewerCheckpoints\r\n{\r\n\tconstructor(window, viewer, data)\r\n\t{\r\n\t\tthis.window = window\r\n\t\tthis.viewer = viewer\r\n\t\tthis.data = data\r\n\t\t\r\n\t\tthis.scene = new GfxScene()\r\n\t\tthis.sceneAfter = new GfxScene()\r\n\t\tthis.scenePanels = new GfxScene()\r\n\t\tthis.sceneSidePanels = new GfxScene()\r\n\t\t\r\n\t\tthis.hoveringOverPoint = null\r\n\t\tthis.linkingPoints = false\r\n\t\tthis.multiSelect = false\r\n\t\t\r\n\t\tthis.zTop = 0\r\n\t\tthis.zBottom = 0\r\n\t\t\r\n\t\tthis.modelPoint = new ModelBuilder()\r\n\t\t\t.addSphere(-150, -150, -150, 150, 150, 150)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\r\n\t\tthis.modelPointSelection = new ModelBuilder()\r\n\t\t\t.addSphere(-250, -250, 250, 250, 250, -250)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\t\r\n\t\tthis.modelPath = new ModelBuilder()\r\n\t\t\t.addCylinder(-100, -100, 0, 100, 100, 1)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\r\n\t\tthis.modelArrow = new ModelBuilder()\r\n\t\t\t.addCone(-250, -250, -500, 250, 250, 0)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\r\n\t\tthis.modelDirArrow = new ModelBuilder()\r\n\t\t\t.addCone(-100, -200, 0, 100, 200, 400, 8, new Vec3(1, 0, 0))\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\r\n\t\tlet panelFrontColor = [1, 1, 1, 1]\r\n\t\tlet panelBackColor = [1, 1, 1, 0.5]\r\n\t\tthis.modelPanel = new ModelBuilder()\r\n\t\t\t.addQuad(new Vec3(0, 0, 1), new Vec3(1, 0, 1), new Vec3(1, 0, 0), new Vec3(0, 0, 0), panelFrontColor, panelFrontColor, panelFrontColor, panelFrontColor)\r\n\t\t\t.addQuad(new Vec3(0, 0, 0), new Vec3(1, 0, 0), new Vec3(1, 0, 1), new Vec3(0, 0, 1), panelBackColor, panelBackColor, panelBackColor, panelBackColor)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\t\r\n\t\tthis.modelPanelWithoutBacksize = new ModelBuilder()\r\n\t\t\t.addQuad(new Vec3(0, 0, 1), new Vec3(1, 0, 1), new Vec3(1, 0, 0), new Vec3(0, 0, 0), panelFrontColor, panelFrontColor, panelFrontColor, panelFrontColor)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t\t\t\r\n\t\tthis.renderers = []\r\n\t}\r\n\t\r\n\t\r\n\tsetModel(model)\r\n\t{\r\n\t\tif (this.window.noModelLoaded)\r\n\t\t{\r\n\t\t\tlet bbox = model.getBoundingBox()\r\n\t\t\tthis.zTop = bbox.zMin - 1000\r\n\t\t\tthis.refreshPanels()\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tsetData(data)\r\n\t{\r\n\t\tthis.data = data\r\n\t\tthis.refresh()\r\n\t}\r\n\t\r\n\t\r\n\tdestroy()\r\n\t{\r\n\t\tfor (let r of this.renderers)\r\n\t\t\tr.detach()\r\n\t\t\r\n\t\tthis.renderers = []\r\n\t}\r\n\t\r\n\t\r\n\trefreshPanels()\r\n\t{\r\n\t\tlet panel = this.window.addPanel(\"Checkpoints\", false, (open) => { if (open) this.viewer.setSubviewer(this) })\r\n\t\tthis.panel = panel\r\n\t\t\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Click:</strong> Create Checkpoint\")\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Drag Point:</strong> Extend Path\")\r\n\t\tpanel.addText(null, \"<strong>Hold Ctrl:</strong> Multiselect\")\r\n\r\n\t\tpanel.addCheckbox(null, \"Render vertical panels\", this.viewer.cfg.checkpointsEnableVerticalPanels, (x) => this.viewer.cfg.checkpointsEnableVerticalPanels = x)\r\n\t\tpanel.addCheckbox(null, \"Render respawn point links\", this.viewer.cfg.checkpointsEnableRespawnPointLinks, (x) => this.viewer.cfg.checkpointsEnableRespawnPointLinks = x)\r\n\t\tpanel.addCheckbox(null, \"Render direction indicators\", this.viewer.cfg.checkpointsEnableDirectionArrows, (x) => this.viewer.cfg.checkpointsEnableDirectionArrows = x)\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tpanel.addButton(null, \"(A) Select/Unselect All\", () => this.toggleAllSelection())\r\n\t\tpanel.addButton(null, \"(X) Delete Selected\", () => this.deleteSelectedPoints())\r\n\t\tpanel.addButton(null, \"(U) Unlink Selected\", () => this.unlinkSelectedPoints())\r\n\t\tpanel.addButton(null, \"(S) Toggle Show Loaded Checkpoints\", () => this.toggleShowLoaded())\r\n\t\tpanel.addButton(null, \"(E) Clear Respawn Point Assignment\", () => this.clearRespawnPoints())\r\n\t\tpanel.addButton(null, \"(R) Assign Selected Respawn Point\", () => this.assignRespawnPoints())\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tpanel.addSelectionNumericInput(null, \"Editing Y\", -1000000, 1000000, -this.zTop, null, 100.0, true, false, (x, i) => { this.zTop = -x })\r\n\r\n\t\tlet selectedPoints = this.data.checkpointPoints.nodes.filter(p => p.selected[0] || p.selected[1])\r\n\t\t\r\n\t\tlet selectionGroup = panel.addGroup(null, \"Selection:\")\r\n\t\tlet enabled = (selectedPoints.length > 0)\r\n\t\tlet multiedit = (selectedPoints.length > 1)\r\n\t\t\r\n\t\tif (selectedPoints.length == 1)\r\n\t\t{\r\n\t\t\tconst formatNum = (x) =>\r\n\t\t\t{\r\n\t\t\t\tif (x === null || x === undefined)\r\n\t\t\t\t\treturn \"\"\r\n\t\t\t\t\r\n\t\t\t\treturn x.toString()\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst formatNumHex = (x) =>\r\n\t\t\t{\r\n\t\t\t\tif (x === null || x === undefined)\r\n\t\t\t\t\treturn \"\"\r\n\t\t\t\t\r\n\t\t\t\treturn x.toString() + \" (0x\" + x.toString(16) + \")\"\r\n\t\t\t}\r\n\r\n\t\t\tconst setPath = (x) => \r\n\t\t\t{\r\n\t\t\t\tif (selectedPoints[0].pointIndex != 0 && selectedPoints[0].prev.length == 1 && selectedPoints[0].prev[0].node.next.length == 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.window.setNotSaved()\r\n\t\t\t\t\tselectedPoints[0].firstInPath = x\r\n\t\t\t\t\tthis.refresh()\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tselectedPoints[0].firstInPath = true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst getCompletion = () =>\r\n\t\t\t{\r\n\t\t\t\tlet maxLayer = this.data.checkpointPoints.maxLayer\r\n\t\t\t\tlet groupCompletion = selectedPoints[0].pathPointIndex / selectedPoints[0].pathLen\r\n\t\t\t\tlet overallCompletion = (groupCompletion + selectedPoints[0].pathLayer) / (maxLayer + 1)\r\n\t\t\t\treturn overallCompletion !== NaN ? (100 * overallCompletion).toFixed(4).toString() + \"%\" : \"N/A\"\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>CKPH Index:</strong> \" + formatNumHex(selectedPoints[0].pathIndex) + \", point #\" + formatNum(selectedPoints[0].pathPointIndex))\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>CKPT Index:</strong> \" + formatNumHex(selectedPoints[0].pointIndex))\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>Group Layer:</strong> \" + formatNum(selectedPoints[0].pathLayer))\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>Lap Completion:</strong> \" + getCompletion())\r\n\t\t\tpanel.addCheckbox(selectionGroup, \"Start new checkpoint group\", selectedPoints[0].firstInPath, setPath)\r\n\t\t}\r\n\t\t\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,    \"X1\", -1000000, 1000000, selectedPoints.map(p =>  p.pos[0].x), null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos[0].x =  x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,    \"Z1\", -1000000, 1000000, selectedPoints.map(p => -p.pos[0].y), null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos[0].y = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,    \"X2\", -1000000, 1000000, selectedPoints.map(p =>  p.pos[1].x), null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos[1].x =  x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,    \"Z2\", -1000000, 1000000, selectedPoints.map(p => -p.pos[1].y), null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos[1].y = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,  \"Type\",        0,     255, selectedPoints.map(p =>  p.type),     null, 1.0,   enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].type     =  x })\r\n\t\t\r\n\t\tlet respawnCount = this.data.respawnPoints.nodes.length\r\n\t\tconst respawnIndex = (node) => { return this.data.respawnPoints.nodes.indexOf(node.respawnNode) }\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Respawn\", 0, respawnCount - 1, selectedPoints.map(p => respawnIndex(p)), null, 1.0, enabled, multiedit, (x, i) => \r\n\t\t\t{ this.window.setNotSaved(); selectedPoints[i].respawnNode = this.data.respawnPoints.nodes[x] })\r\n\t\t\r\n\t\tpanel.addText(selectionGroup, \"<strong>Type 0:</strong> Lap Counter\")\r\n\t\tpanel.addText(selectionGroup, \"<strong>Type 1-254:</strong> Key Checkpoints\")\r\n\t\tpanel.addText(selectionGroup, \"<strong>Type 255:</strong> Regular Checkpoint\")\r\n\t}\r\n\t\r\n\t\r\n\trefresh()\r\n\t{\r\n\t\tfor (let r of this.renderers)\r\n\t\t\tr.detach()\r\n\t\t\r\n\t\tthis.renderers = []\r\n\t\t\r\n\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t{\r\n\t\t\tif (point.selected === undefined)\r\n\t\t\t{\r\n\t\t\t\tpoint.selected = [false, false]\r\n\t\t\t\tpoint.moveOrigin = [point.pos[0], point.pos[1]]\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet renderer1 = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t.setModel(this.modelPoint)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\r\n\t\t\tlet renderer2 = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t.setModel(this.modelPoint)\r\n\t\t\t\t.setMaterial(this.viewer.materialColor)\r\n\t\t\t\t\r\n\t\t\tpoint.renderer = [renderer1, renderer2]\r\n\t\t\t\r\n\t\t\tpoint.rendererCheckbar = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t.setModel(this.modelPath)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\r\n\t\t\tpoint.rendererDirArrow = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t.setModel(this.modelDirArrow)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererCheckpanel = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.scenePanels.root)\r\n\t\t\t\t.setModel(this.modelPanelWithoutBacksize)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\r\n\t\t\tpoint.rendererRespawnLink = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t.setModel(this.modelPath)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\r\n\t\t\tlet rendererSelected1 = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.sceneAfter.root)\r\n\t\t\t\t.setModel(this.modelPointSelection)\r\n\t\t\t\t.setMaterial(this.viewer.materialUnshaded)\r\n\t\t\t\t.setEnabled(false)\r\n\t\t\t\t\r\n\t\t\tlet rendererSelectedCore1 = new GfxNodeRenderer()\r\n\t\t\t\t.attach(rendererSelected1)\r\n\t\t\t\t.setModel(this.modelPoint)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\r\n\t\t\tlet rendererSelected2 = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.sceneAfter.root)\r\n\t\t\t\t.setModel(this.modelPointSelection)\r\n\t\t\t\t.setMaterial(this.viewer.materialUnshaded)\r\n\t\t\t\t.setEnabled(false)\r\n\t\t\t\t\r\n\t\t\tlet rendererSelectedCore2 = new GfxNodeRenderer()\r\n\t\t\t\t.attach(rendererSelected2)\r\n\t\t\t\t.setModel(this.modelPoint)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelected = [rendererSelected1, rendererSelected2]\r\n\t\t\tpoint.rendererSelectedCore = [rendererSelectedCore1, rendererSelectedCore2]\r\n\t\t\t\r\n\t\t\tthis.renderers.push(renderer1)\r\n\t\t\tthis.renderers.push(renderer2)\r\n\t\t\tthis.renderers.push(rendererSelected1)\r\n\t\t\tthis.renderers.push(rendererSelected2)\r\n\t\t\tthis.renderers.push(point.rendererCheckbar)\r\n\t\t\tthis.renderers.push(point.rendererDirArrow)\r\n\t\t\tthis.renderers.push(point.rendererCheckpanel)\r\n\t\t\tthis.renderers.push(point.rendererRespawnLink)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererOutgoingPaths = []\r\n\t\t\tpoint.rendererOutgoingPathArrows = []\r\n\t\t\tpoint.rendererOutgoingPathPanels = []\r\n\t\t\tpoint.rendererOutgoingQuads = []\r\n\t\t\t\r\n\t\t\tfor (let next of point.next)\r\n\t\t\t{\r\n\t\t\t\tlet rPath1 = new GfxNodeRendererTransform()\r\n\t\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t\t.setModel(this.modelPath)\r\n\t\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\t\r\n\t\t\t\tlet rArrow1 = new GfxNodeRendererTransform()\r\n\t\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t\t.setModel(this.modelArrow)\r\n\t\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\t\r\n\t\t\t\tlet rPath2 = new GfxNodeRendererTransform()\r\n\t\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t\t.setModel(this.modelPath)\r\n\t\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\t\r\n\t\t\t\tlet rArrow2 = new GfxNodeRendererTransform()\r\n\t\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t\t.setModel(this.modelArrow)\r\n\t\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\t\r\n\t\t\t\tlet rPanel1 = new GfxNodeRendererTransform()\r\n\t\t\t\t\t.attach(this.sceneSidePanels.root)\r\n\t\t\t\t\t.setModel(this.modelPanel)\r\n\t\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\t\r\n\t\t\t\tlet rPanel2 = new GfxNodeRendererTransform()\r\n\t\t\t\t\t.attach(this.sceneSidePanels.root)\r\n\t\t\t\t\t.setModel(this.modelPanel)\r\n\t\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t/*\r\n\t\t\t\tlet modelQuad = new ModelBuilder()\r\n\t\t\t\t\t.addQuad(point.pos[0], point.pos[1], next.node.pos[1], next.node.pos[0])\r\n\t\t\t\t\t.calculateNormals()\r\n\t\t\t\t\t.makeModel(this.viewer.gl)\r\n\t\t\t\tlet rQuad = new GfxNodeRendererTransform()\r\n\t\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t\t.setModel(modelQuad)\r\n\t\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t*/\r\n\t\t\t\tpoint.rendererOutgoingPaths.push([rPath1, rPath2])\r\n\t\t\t\tpoint.rendererOutgoingPathArrows.push([rArrow1, rArrow2])\r\n\t\t\t\tpoint.rendererOutgoingPathPanels.push([rPanel1, rPanel2])\r\n\t\t\t\t//point.rendererOutgoingQuads.push(rQuad)\r\n\t\t\t\t\t\r\n\t\t\t\tthis.renderers.push(rPath1)\r\n\t\t\t\tthis.renderers.push(rPath2)\r\n\t\t\t\tthis.renderers.push(rArrow1)\r\n\t\t\t\tthis.renderers.push(rArrow2)\r\n\t\t\t\tthis.renderers.push(rPanel1)\r\n\t\t\t\tthis.renderers.push(rPanel2)\r\n\t\t\t\t//this.renderers.push(rQuad)\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\t\r\n\tgetHoveringOverElement(cameraPos, ray, distToHit, includeSelected = true)\r\n\t{\r\n\t\tlet elem = null\r\n\t\t\r\n\t\tlet minDistToCamera = distToHit + 1000\r\n\t\tlet minDistToPoint = 1000000\r\n\t\tfor (let which = 0; which < 2; which++)\r\n\t\t{\r\n\t\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t\t{\r\n\t\t\t\tif (!includeSelected && point.selected[which])\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t\r\n\t\t\t\tlet distToCamera = point.pos[which].sub(cameraPos).magn()\r\n\t\t\t\tif (distToCamera >= minDistToCamera)\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t\r\n\t\t\t\tlet scale = this.viewer.getElementScale(point.pos[which])\r\n\t\t\t\t\r\n\t\t\t\tlet pointDistToRay = Geometry.linePointDistance(ray.origin, ray.direction, point.pos[which])\r\n\t\t\t\t\r\n\t\t\t\tif (pointDistToRay < 150 * scale * 4 && pointDistToRay < minDistToPoint)\r\n\t\t\t\t{\r\n\t\t\t\t\telem = { point, which }\r\n\t\t\t\t\tminDistToCamera = distToCamera\r\n\t\t\t\t\tminDistToPoint = pointDistToRay\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn elem\r\n\t}\r\n\t\r\n\t\r\n\tselectAll()\r\n\t{\r\n\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t\tpoint.selected = [true, true]\r\n\t\t\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\t\r\n\tunselectAll()\r\n\t{\r\n\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t\tpoint.selected = [false, false]\r\n\t\t\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\t\r\n\ttoggleAllSelection()\r\n\t{\r\n\t\tlet hasSelection = (this.data.checkpointPoints.nodes.find(p => p.selected[0] || p.selected[1]) != null)\r\n\t\t\r\n\t\tif (hasSelection)\r\n\t\t\tthis.unselectAll()\r\n\t\telse\r\n\t\t\tthis.selectAll()\r\n\t}\r\n\t\r\n\t\r\n\tdeleteSelectedPoints()\r\n\t{\r\n\t\tlet pointsToDelete = []\r\n\t\t\r\n\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t{\r\n\t\t\tif (!point.selected[0] && !point.selected[1])\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tpointsToDelete.push(point)\r\n\t\t}\r\n\t\t\r\n\t\tfor (let point of pointsToDelete)\r\n\t\t{\r\n\t\t\tlet nextPoints = point.next.map((x) => x)\r\n\t\t\tlet prevPoints = point.prev.map((x) => x)\r\n\r\n\t\t\tthis.data.checkpointPoints.removeNode(point)\r\n\t\t\t\r\n\t\t\tfor (let next of nextPoints)\r\n\t\t\t{\r\n\t\t\t\tif (next.node.pointIndex != 0 && next.node.prev.length == 1 && next.node.prev[0].node.next.length == 1)\r\n\t\t\t\t\tnext.node.firstInPath = false\r\n\t\t\t\telse\r\n\t\t\t\t\tnext.node.firstInPath = true\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let prev of prevPoints)\r\n\t\t\t\tfor (let adj of prev.node.next)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (adj.node.pointIndex != 0 && adj.node.prev.length == 1 && adj.node.prev[0].node.next.length == 1)\r\n\t\t\t\t\t\tadj.node.firstInPath = false\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tadj.node.firstInPath = true\r\n\t\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\t\r\n\t\r\n\tunlinkSelectedPoints()\r\n\t{\r\n\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t{\r\n\t\t\tif (!point.selected[0] && !point.selected[1])\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tlet nextPointsToUnlink = []\r\n\t\t\t\r\n\t\t\tfor (let next of point.next)\r\n\t\t\t{\r\n\t\t\t\tif (!next.node.selected[0] && !next.node.selected[1])\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t\r\n\t\t\t\tnextPointsToUnlink.push(next.node)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let next of nextPointsToUnlink)\r\n\t\t\t{\r\n\t\t\t\tthis.data.checkpointPoints.unlinkNodes(point, next)\r\n\r\n\t\t\t\tif (next.pointIndex != 0 && next.prev.length == 1 && next.prev[0].node.next.length == 1)\r\n\t\t\t\t\tnext.firstInPath = false\r\n\t\t\t\telse\r\n\t\t\t\t\tnext.firstInPath = true\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let next of point.next)\r\n\t\t\t{\r\n\t\t\t\tif (next.node.pointIndex != 0 && next.node.prev.length == 1 && next.node.prev[0].node.next.length == 1)\r\n\t\t\t\t\tnext.node.firstInPath = false\r\n\t\t\t\telse\r\n\t\t\t\t\tnext.node.firstInPath = true\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\t\r\n\t\r\n\tclearRespawnPoints()\r\n\t{\r\n\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t{\r\n\t\t\tif (!point.selected[0] && !point.selected[1])\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tpoint.respawnNode = null\r\n\t\t}\r\n\t\t\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\t\r\n\t\r\n\tassignRespawnPoints()\r\n\t{\r\n\t\tlet selectedRespawnNodes = this.data.respawnPoints.nodes.filter(p => p.selected === true)\r\n\t\tif (selectedRespawnNodes.length != 1)\r\n\t\t{\r\n\t\t\talert(\"Select a single point using the Respawn Points panel.\")\r\n\t\t\treturn\r\n\t\t}\r\n\t\t\r\n\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t{\r\n\t\t\tif (!point.selected[0] && !point.selected[1])\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tpoint.respawnNode = selectedRespawnNodes[0]\r\n\t\t}\r\n\t\t\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\r\n\r\n\ttoggleShowLoaded()\r\n\t{\r\n\t\tlet notAllRendered = this.data.checkpointPoints.nodes.some(p => !p.isRendered)\r\n\r\n\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t\tpoint.isRendered = notAllRendered\r\n\r\n\t\tif (notAllRendered)\r\n\t\t\treturn\r\n\r\n\r\n\t\tlet selectedPoints = []\r\n\r\n\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t{\r\n\t\t\tif (!point.selected[0] && !point.selected[1])\r\n\t\t\t\tcontinue\r\n\r\n\t\t\tpoint.isRendered = true\r\n\t\t\tselectedPoints.push(point)\r\n\t\t}\r\n\r\n\t\twhile (selectedPoints.length > 0)\r\n\t\t{\r\n\t\t\tlet point = selectedPoints.pop()\r\n\r\n\t\t\tfor (let prev of point.prev)\r\n\t\t\t{\r\n\t\t\t\tif (prev.node.isRendered)\r\n\t\t\t\t\tcontinue\r\n\r\n\t\t\t\tprev.node.isRendered = true\r\n\r\n\t\t\t\tif (prev.node.type == 255)\r\n\t\t\t\t\tselectedPoints.push(prev.node)\r\n\t\t\t}\r\n\r\n\t\t\tfor (let next of point.next)\r\n\t\t\t{\r\n\t\t\t\tif (next.node.isRendered)\r\n\t\t\t\t\tcontinue\r\n\r\n\t\t\t\tnext.node.isRendered = true\r\n\r\n\t\t\t\tif (next.node.type == 255)\r\n\t\t\t\t\tselectedPoints.push(next.node)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tonKeyDown(ev)\r\n\t{\r\n\t\tif (ev.ctrlKey || ev.metaKey)\r\n\t\t\treturn false\r\n\t\t\r\n\t\tswitch (ev.key)\r\n\t\t{\r\n\t\t\tcase \"A\":\r\n\t\t\tcase \"a\":\r\n\t\t\t\tthis.toggleAllSelection()\r\n\t\t\t\treturn true\r\n\t\t\t\r\n\t\t\tcase \"Backspace\":\r\n\t\t\tcase \"Delete\":\r\n\t\t\tcase \"X\":\r\n\t\t\tcase \"x\":\r\n\t\t\t\tthis.deleteSelectedPoints()\r\n\t\t\t\treturn true\r\n\t\t\t\t\r\n\t\t\tcase \"U\":\r\n\t\t\tcase \"u\":\r\n\t\t\t\tthis.unlinkSelectedPoints()\r\n\t\t\t\treturn true\r\n\t\t\t\t\r\n\t\t\tcase \"E\":\r\n\t\t\tcase \"e\":\r\n\t\t\t\tthis.clearRespawnPoints()\r\n\t\t\t\treturn true\r\n\r\n\t\t\tcase \"S\":\r\n\t\t\tcase \"s\":\r\n\t\t\t\tthis.toggleShowLoaded()\r\n\t\t\t\treturn true\r\n\t\t\t\t\r\n\t\t\tcase \"R\":\r\n\t\t\tcase \"r\":\r\n\t\t\t\tthis.assignRespawnPoints()\r\n\t\t\t\treturn true\r\n\t\t}\r\n\t\t\r\n\t\treturn false\r\n\t}\r\n\t\r\n\t\r\n\tonMouseDown(ev, x, y, cameraPos, ray, hit, distToHit, mouse3DPos)\r\n\t{\r\n\t\tthis.linkingPoints = false\r\n\t\t\r\n\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t\tpoint.moveOrigin = [point.pos[0], point.pos[1]]\r\n\t\t\r\n\t\tlet hoveringOverElem = this.getHoveringOverElement(cameraPos, ray, distToHit)\r\n\t\t\r\n\t\tif (ev.altKey || (!(ev.ctrlKey || ev.metaKey) && (hoveringOverElem == null || !hoveringOverElem.point.selected[hoveringOverElem.which])))\r\n\t\t\tthis.unselectAll()\r\n\r\n\t\tif (ev.ctrlKey || ev.metaKey)\r\n\t\t\tthis.multiSelect = true\r\n\t\t\r\n\t\tif (hoveringOverElem != null)\r\n\t\t{\r\n\t\t\tif (ev.altKey)\r\n\t\t\t{\r\n\t\t\t\tif (hoveringOverElem.point.next.length >= this.data.checkpointPoints.maxNextNodes)\r\n\t\t\t\t{\r\n\t\t\t\t\talert(\"Node link error!\\n\\nMax outgoing connections to a point surpassed (maximum \" + this.data.checkpointPoints.maxNextNodes + \")\")\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet newPoint = this.data.checkpointPoints.addNode()\r\n\t\t\t\tnewPoint.pos = [hoveringOverElem.point.pos[0], hoveringOverElem.point.pos[1]]\r\n\t\t\t\tnewPoint.respawnNode = hoveringOverElem.point.respawnNode\r\n\t\t\t\t\r\n\t\t\t\tthis.data.checkpointPoints.linkNodes(hoveringOverElem.point, newPoint)\r\n\r\n\t\t\t\tif (hoveringOverElem.point.next.length > 1)\r\n\t\t\t\t\tfor (let next of hoveringOverElem.point.next)\r\n\t\t\t\t\t\tnext.node.firstInPath = true\r\n\t\t\t\t\r\n\t\t\t\tthis.refresh()\r\n\t\t\t\t\r\n\t\t\t\tnewPoint.selected = [true, true]\r\n\t\t\t\tthis.linkingPoints = true\r\n\t\t\t\tthis.data.refreshIndices(this.viewer.cfg.isBattleTrack)\r\n\t\t\t\tthis.viewer.setCursor(\"-webkit-grabbing\")\r\n\t\t\t\tthis.refreshPanels()\r\n\t\t\t\tthis.window.setNotSaved()\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\thoveringOverElem.point.selected[hoveringOverElem.which] = true\r\n\t\t\t\tthis.refreshPanels()\r\n\t\t\t\tthis.viewer.setCursor(\"-webkit-grabbing\")\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (ev.altKey)\r\n\t\t{\r\n\t\t\tlet newPoint = this.data.checkpointPoints.addNode()\r\n\t\t\t\r\n\t\t\tlet zTopHit = Geometry.lineZPlaneIntersection(ray.origin, ray.direction, this.zTop)\r\n\t\t\t\r\n\t\t\tnewPoint.pos[0] = zTopHit\r\n\t\t\tnewPoint.pos[1] = zTopHit.add(new Vec3(1000, 0, 0))\r\n\t\t\t\r\n\t\t\tnewPoint.pos[0].z = 0\r\n\t\t\tnewPoint.pos[1].z = 0\r\n\r\n\t\t\tnewPoint.firstInPath = true\r\n\t\t\t\r\n\t\t\tthis.refresh()\r\n\t\t\tnewPoint.selected[0] = true\r\n\t\t\tnewPoint.selected[1] = true\r\n\t\t\tthis.data.refreshIndices(this.viewer.cfg.isBattleTrack)\r\n\t\t\tthis.viewer.setCursor(\"-webkit-grabbing\")\r\n\t\t\tthis.refreshPanels()\r\n\t\t\tthis.window.setNotSaved()\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tonMouseMove(ev, x, y, cameraPos, ray, hit, distToHit)\r\n\t{\r\n\t\tif (!this.viewer.mouseDown)\r\n\t\t{\r\n\t\t\tlet lastHover = this.hoveringOverPoint\r\n\t\t\tthis.hoveringOverPoint = this.getHoveringOverElement(cameraPos, ray, distToHit)\r\n\t\t\t\r\n\t\t\tif (this.hoveringOverPoint != null)\r\n\t\t\t{\r\n\t\t\t\tthis.viewer.setCursor(\"-webkit-grab\")\r\n\t\t\t\r\n\t\t\t\tif (lastHover == null ||\r\n\t\t\t\t\tthis.hoveringOverPoint.point != lastHover.point ||\r\n\t\t\t\t\tthis.hoveringOverPoint.which != lastHover.which)\r\n\t\t\t\t\tthis.viewer.render()\r\n\t\t\t}\r\n\t\t\telse if (lastHover != null)\r\n\t\t\t\tthis.viewer.render()\r\n\t\t}\r\n\t\telse if (ev.ctrlKey || ev.metaKey)\r\n\t\t{\r\n\t\t\tlet lastHover = this.hoveringOverPoint\r\n\t\t\tthis.hoveringOverPoint = this.getHoveringOverElement(cameraPos, ray, distToHit)\r\n\t\t\t\r\n\t\t\tif (this.hoveringOverPoint != null)\r\n\t\t\t{\r\n\t\t\t\tthis.viewer.setCursor(\"-webkit-grab\")\r\n\t\t\t\tthis.hoveringOverPoint.point.selected[this.hoveringOverPoint.which] = true\r\n\t\t\t\tthis.refreshPanels()\r\n\r\n\t\t\t\tif (lastHover == null ||\r\n\t\t\t\t\tthis.hoveringOverPoint.point != lastHover.point ||\r\n\t\t\t\t\tthis.hoveringOverPoint.which != lastHover.which)\r\n\t\t\t\t\tthis.viewer.render()\r\n\t\t\t}\r\n\t\t\telse if (lastHover != null)\r\n\t\t\t\tthis.viewer.render()\r\n\t\t}\r\n\t\telse if (!this.multiSelect && this.viewer.mouseAction == \"move\")\r\n\t\t{\r\n\t\t\tlet linkToPoint = this.getHoveringOverElement(cameraPos, ray, distToHit, false)\r\n\t\t\t\r\n\t\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t\t{\r\n\t\t\t\tfor (let which = 0; which < 2; which++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!point.selected[which])\r\n\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.window.setNotSaved()\r\n\t\t\t\t\tthis.viewer.setCursor(\"-webkit-grabbing\")\r\n\t\t\t\t\r\n\t\t\t\t\tif (this.linkingPoints && linkToPoint != null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpoint.pos[which] = linkToPoint.point.pos[which]\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet screenPosMoved = this.viewer.pointToScreen(point.moveOrigin[which])\r\n\t\t\t\t\t\tscreenPosMoved.x += this.viewer.mouseMoveOffsetPixels.x\r\n\t\t\t\t\t\tscreenPosMoved.y += this.viewer.mouseMoveOffsetPixels.y\r\n\t\t\t\t\t\tlet pointRayMoved = this.viewer.getScreenRay(screenPosMoved.x, screenPosMoved.y)\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tpoint.pos[which] = Geometry.lineZPlaneIntersection(pointRayMoved.origin, pointRayMoved.direction, this.zTop)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.refreshPanels()\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tonMouseUp(ev, x, y)\r\n\t{\r\n\t\tthis.multiSelect = false\r\n\r\n\t\tif (this.viewer.mouseAction == \"move\")\r\n\t\t{\r\n\t\t\tif (this.linkingPoints)\r\n\t\t\t{\r\n\t\t\t\tlet pointBeingLinked = this.data.checkpointPoints.nodes.find(p => p.selected[0] || p.selected[1])\r\n\t\t\t\tif (pointBeingLinked == null)\r\n\t\t\t\t\treturn\r\n\t\t\t\t\r\n\t\t\t\tlet pointBeingLinkedTo = this.data.checkpointPoints.nodes.find(p =>\r\n\t\t\t\t\tp != pointBeingLinked &&\r\n\t\t\t\t\t(p.pos[0] == pointBeingLinked.pos[0] ||\r\n\t\t\t\t\tp.pos[0] == pointBeingLinked.pos[1] ||\r\n\t\t\t\t\tp.pos[1] == pointBeingLinked.pos[0] ||\r\n\t\t\t\t\tp.pos[1] == pointBeingLinked.pos[1]))\r\n\t\t\t\t\r\n\t\t\t\tif (pointBeingLinkedTo != null)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.data.checkpointPoints.removeNode(pointBeingLinked)\r\n\r\n\t\t\t\t\tif (pointBeingLinkedTo.prev.length >= this.data.checkpointPoints.maxPrevNodes)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\talert(\"Node link error!\\n\\nMax incoming connections to a point surpassed (maximum \" + this.data.checkpointPoints.maxPrevNodes + \")\")\r\n\t\t\t\t\t\tthis.refresh()\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.data.checkpointPoints.linkNodes(pointBeingLinked.prev[0].node, pointBeingLinkedTo)\r\n\r\n\t\t\t\t\tif (pointBeingLinkedTo.pointIndex != 0 && pointBeingLinkedTo.prev.length == 1 && pointBeingLinkedTo.prev[0].node.next.length == 1)\r\n\t\t\t\t\t\tpointBeingLinkedTo.firstInPath = false\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tpointBeingLinkedTo.firstInPath = true\r\n\r\n\t\t\t\t\tthis.refresh()\r\n\t\t\t\t\tthis.window.setNotSaved()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tdrawAfterModel()\r\n\t{\r\n\t\tlet cameraPos = this.viewer.getCurrentCameraPosition()\r\n\t\tlet camera = this.viewer.getCurrentCamera()\r\n\t\t\r\n\t\tlet setupPanelMatrices = (renderer, v1, v2) =>\r\n\t\t{\r\n\t\t\tlet v = v2.sub(v1)\r\n\t\t\tlet matrixScale = Mat4.scale(v.magn(), 1, this.zBottom - this.zTop)\r\n\t\t\tlet matrixAlign = Mat4.rotationFromTo(new Vec3(1, 0, 0), v.normalize())\r\n\t\t\tlet matrixTranslate = Mat4.translation(v1.x, v1.y, v1.z)\r\n\t\t\t\r\n\t\t\trenderer.setCustomMatrix(matrixScale.mul(matrixAlign.mul(matrixTranslate)))\r\n\t\t}\r\n\t\t\r\n\t\tlet setupPathMatrices = (renderer, scale, v1, v2) =>\r\n\t\t{\r\n\t\t\tlet v = v2.sub(v1)\r\n\t\t\tlet matrixScale = Mat4.scale(scale, scale, v.magn())\r\n\t\t\tlet matrixAlign = Mat4.rotationFromTo(new Vec3(0, 0, 1), v.normalize())\r\n\t\t\tlet matrixTranslate = Mat4.translation(v1.x, v1.y, v1.z)\r\n\t\t\t\r\n\t\t\trenderer.setCustomMatrix(matrixScale.mul(matrixAlign.mul(matrixTranslate)))\r\n\t\t}\r\n\r\n\t\tlet setupArrowMatrices = (renderer, scale, v1, v2) =>\r\n\t\t{\r\n\t\t\tlet midpoint = v1.add(v2).scale(0.5)\r\n\t\t\tlet facing = v2.sub(v1).normalize().cross(new Vec3(0, 0, -1))\r\n\r\n\t\t\tlet matrixScale = Mat4.scale(scale, scale, scale)\r\n\t\t\tlet matrixAlign = Mat4.rotationFromTo(new Vec3(1, 0, 0), facing)\r\n\t\t\tlet matrixTranslate = Mat4.translation(midpoint.x, midpoint.y, midpoint.z)\r\n\r\n\t\t\trenderer.setCustomMatrix(matrixScale.mul(matrixAlign.mul(matrixTranslate)))\r\n\t\t}\r\n\t\t\r\n\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t{\r\n\t\t\tpoint.pos[0].z = this.zTop\r\n\t\t\tpoint.pos[1].z = this.zTop\r\n\t\t}\t\r\n\t\t\r\n\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t{\r\n\t\t\tlet scales = [0, 0]\r\n\t\t\tlet prevIsRendered = point.prev.some(p => p.node.isRendered)\r\n\t\t\t\r\n\t\t\tfor (let which = 0; which < 2; which++)\r\n\t\t\t{\r\n\t\t\t\tlet hovering = (this.hoveringOverPoint != null && this.hoveringOverPoint.point == point && this.hoveringOverPoint.which == which)\r\n\t\t\t\tlet scale = (hovering ? 1.5 : 1) * this.viewer.getElementScale(point.pos[which])\r\n\t\t\t\tscales[which] = scale\r\n\t\t\t\t\r\n\t\t\t\tpoint.renderer[which]\r\n\t\t\t\t\t.setTranslation(point.pos[which])\r\n\t\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t\t.setDiffuseColor(point.type == 0 ? [1, 0.5, 1, 1] : point.type != 0xff ? [1, 0, 1, 1] : [0, 0, 1, 1])\r\n\t\t\t\t\t.setEnabled(point.isRendered || prevIsRendered)\r\n\t\t\t\t\r\n\t\t\t\tfor (let n = 0; n < point.next.length; n++)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet nextPos = point.next[n].node.pos[which]\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet scale2 = Math.min(scale, this.viewer.getElementScale(nextPos))\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet matrixScale = Mat4.scale(scale2, scale2, nextPos.sub(point.pos[which]).magn())\r\n\t\t\t\t\tlet matrixAlign = Mat4.rotationFromTo(new Vec3(0, 0, 1), nextPos.sub(point.pos[which]).normalize())\r\n\t\t\t\t\tlet matrixTranslate = Mat4.translation(point.pos[which].x, point.pos[which].y, point.pos[which].z)\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet matrixScaleArrow = Mat4.scale(scale2, scale2, scale2)\r\n\t\t\t\t\tlet matrixTranslateArrow = Mat4.translation(nextPos.x, nextPos.y, nextPos.z)\r\n\t\t\t\t\t\r\n\t\t\t\t\tpoint.rendererOutgoingPaths[n][which]\r\n\t\t\t\t\t\t.setCustomMatrix(matrixScale.mul(matrixAlign.mul(matrixTranslate)))\r\n\t\t\t\t\t\t.setDiffuseColor(point.next[n].node.firstInPath ? [0, 0.8, 0.7, 1] : [0, 0.5, 1, 1])\r\n\t\t\t\t\t\t.setEnabled(point.isRendered)\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tpoint.rendererOutgoingPathArrows[n][which]\r\n\t\t\t\t\t\t.setCustomMatrix(matrixScaleArrow.mul(matrixAlign.mul(matrixTranslateArrow)))\r\n\t\t\t\t\t\t.setDiffuseColor(point.next[n].node.firstInPath ? [0, 0.9, 0.8, 1] : [0, 0.75, 1, 1])\r\n\t\t\t\t\t\t.setEnabled(point.isRendered)\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tsetupPanelMatrices(point.rendererOutgoingPathPanels[n][which], point.pos[which], nextPos)\r\n\t\t\t\t\tpoint.rendererOutgoingPathPanels[n][which].setDiffuseColor([0, 0.25, 1, 0.3])\r\n\t\t\t\t\t\t.setEnabled(point.isRendered)\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tpoint.rendererOutgoingQuads[n]\r\n\t\t\t\t\t\t.setTranslation(new Vec3(0, 0, this.zTop))\r\n\t\t\t\t\t\t.setDiffuseColor(point.type == 0 ? [1, 0.5, 1, 0.6] : point.type != 0xff ? [1, 0.25, 1, 0.6] : [0, 0.25, 1, 0.6])\r\n\t\t\t\t\t\t.setEnabled(true)\r\n\t\t\t\t\t*/\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet barScale = (this.hoveringOverPoint != null && this.hoveringOverPoint.point == point ? 1.5 : 1) * Math.min(scales[0], scales[1]) / 1.5\r\n\t\t\t\r\n\t\t\tsetupPathMatrices(point.rendererCheckbar, barScale, point.pos[0], point.pos[1])\r\n\t\t\tpoint.rendererCheckbar\r\n\t\t\t\t.setDiffuseColor(point.type == 0 ? [1, 0.5, 1, 1] : point.type != 0xff ? [1, 0, 1, 1] : [0, 0, 1, 1])\r\n\t\t\t\t.setEnabled(point.isRendered || prevIsRendered)\r\n\t\t\t\r\n\t\t\tsetupPanelMatrices(point.rendererCheckpanel, point.pos[0], point.pos[1])\r\n\t\t\tpoint.rendererCheckpanel\r\n\t\t\t\t.setDiffuseColor(point.type == 0 ? [1, 0.5, 1, 0.6] : point.type != 0xff ? [1, 0.25, 1, 0.6] : [0, 0.25, 1, 0.6])\r\n\t\t\t\t.setEnabled(point.isRendered || prevIsRendered)\r\n\t\t\t\r\n\t\t\tsetupArrowMatrices(point.rendererDirArrow, barScale, point.pos[0], point.pos[1])\r\n\t\t\tpoint.rendererDirArrow\r\n\t\t\t\t.setDiffuseColor(point.type == 0 ? [1, 0.5, 1, 1] : point.type != 0xff ? [1, 0, 1, 1] : [0, 0, 1, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.checkpointsEnableDirectionArrows && (point.isRendered || prevIsRendered))\r\n\t\t\t\r\n\t\t\tlet respawnNode = point.respawnNode\r\n\t\t\tif (respawnNode == null && this.data.respawnPoints.nodes.length > 0)\r\n\t\t\t\trespawnNode = this.data.respawnPoints.nodes[0]\r\n\t\t\t\r\n\t\t\tif (respawnNode != null)\r\n\t\t\t{\r\n\t\t\t\tsetupPathMatrices(point.rendererRespawnLink, barScale, point.pos[0], respawnNode.pos)\r\n\t\t\t\t\r\n\t\t\t\tpoint.rendererRespawnLink\r\n\t\t\t\t\t.setDiffuseColor([0.85, 0.85, 0, 1])\r\n\t\t\t\t\t.setEnabled(this.viewer.cfg.checkpointsEnableRespawnPointLinks && point.isRendered)\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tpoint.rendererRespawnLink.setEnabled(false)\r\n\t\t}\r\n\t\t\r\n\t\tthis.scene.render(this.viewer.gl, camera)\r\n\t\t\r\n\t\tif (this.viewer.cfg.checkpointsEnableVerticalPanels)\r\n\t\t{\r\n\t\t\tthis.scenePanels.render(this.viewer.gl, camera)\r\n\t\t\tthis.sceneSidePanels.render(this.viewer.gl, camera)\r\n\t\t}\r\n\t\t\r\n\t\tfor (let point of this.data.checkpointPoints.nodes)\r\n\t\t{\r\n\t\t\tfor (let which = 0; which < 2; which++)\r\n\t\t\t{\r\n\t\t\t\tlet hovering = (this.hoveringOverPoint != null && this.hoveringOverPoint.point == point && this.hoveringOverPoint.which == which)\r\n\t\t\t\tlet scale = (hovering ? 1.5 : 1) * this.viewer.getElementScale(point.pos[which])\r\n\t\t\t\t\r\n\t\t\t\tpoint.rendererSelected[which]\r\n\t\t\t\t\t.setTranslation(point.pos[which])\r\n\t\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t\t.setDiffuseColor([0.5, 0.5, 1, 1])\r\n\t\t\t\t\t.setEnabled(point.selected[which] && (point.isRendered || prevIsRendered))\r\n\t\t\t\t\t\r\n\t\t\t\tpoint.rendererSelectedCore[which]\r\n\t\t\t\t\t.setDiffuseColor([0, 0, 1, 1])\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.sceneAfter.clearDepth(this.viewer.gl)\r\n\t\tthis.sceneAfter.render(this.viewer.gl, camera)\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { ViewerCheckpoints }", "const { GfxScene, GfxCamera, GfxMaterial, GfxModel, GfxNodeRenderer, GfxNodeRendererTransform } = require(\"../gl/scene.js\")\r\nconst { PointViewer } = require(\"./pointViewer.js\")\r\nconst { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\nconst { Geometry } = require(\"../math/geometry.js\")\r\n\r\nlet objectNames = []\r\nobjectNames[0x1]   = \"airblock          \"\r\nobjectNames[0x2]   = \"Psea              \"\r\nobjectNames[0x3]   = \"lensFX            \"\r\nobjectNames[0x4]   = \"venice_nami       \"\r\nobjectNames[0x5]   = \"sound_river       \"\r\nobjectNames[0x6]   = \"sound_water_fall  \"\r\nobjectNames[0x7]   = \"pocha             \"\r\nobjectNames[0x8]   = \"sound_lake        \"\r\nobjectNames[0x9]   = \"sound_big_fall    \"\r\nobjectNames[0xa]   = \"sound_sea         \"\r\nobjectNames[0xb]   = \"sound_fountain    \"\r\nobjectNames[0xc]   = \"sound_volcano     \"\r\nobjectNames[0xd]   = \"sound_audience    \"\r\nobjectNames[0xe]   = \"sound_big_river   \"\r\nobjectNames[0xf]   = \"sound_sand_fall   \"\r\nobjectNames[0x10]  = \"sound_lift        \"\r\nobjectNames[0x11]  = \"pochaYogan        \"\r\nobjectNames[0x12]  = \"entry             \"\r\nobjectNames[0x13]  = \"pochaMori         \"\r\nobjectNames[0x14]  = \"eline_control     \"\r\nobjectNames[0x15]  = \"sound_Mii         \"\r\nobjectNames[0x16]  = \"begoman_manager   \"\r\nobjectNames[0x17]  = \"ice               \"\r\nobjectNames[0x18]  = \"startline2D       \"\r\nobjectNames[0x65]  = \"itembox           \"\r\nobjectNames[0x66]  = \"DummyPole         \"\r\nobjectNames[0x67]  = \"flag              \"\r\nobjectNames[0x68]  = \"flagBlend         \"\r\nobjectNames[0x69]  = \"gnd_sphere        \"\r\nobjectNames[0x6a]  = \"gnd_trapezoid     \"\r\nobjectNames[0x6b]  = \"gnd_wave1         \"\r\nobjectNames[0x6c]  = \"gnd_wave2         \"\r\nobjectNames[0x6d]  = \"gnd_wave3         \"\r\nobjectNames[0x6e]  = \"gnd_wave4         \"\r\nobjectNames[0x6f]  = \"sun               \"\r\nobjectNames[0x70]  = \"woodbox           \"\r\nobjectNames[0x71]  = \"KmoonZ            \"\r\nobjectNames[0x72]  = \"sunDS             \"\r\nobjectNames[0x73]  = \"coin              \"\r\nobjectNames[0x74]  = \"ironbox           \"\r\nobjectNames[0x75]  = \"ItemDirect        \"\r\nobjectNames[0x76]  = \"s_itembox         \"\r\nobjectNames[0x77]  = \"pile_coin         \"\r\nobjectNames[0xc9]  = \"f_itembox         \"\r\nobjectNames[0xca]  = \"MashBalloonGC     \"\r\nobjectNames[0xcb]  = \"WLwallGC          \"\r\nobjectNames[0xcc]  = \"CarA1             \"\r\nobjectNames[0xcd]  = \"basabasa          \"\r\nobjectNames[0xce]  = \"HeyhoShipGBA      \"\r\nobjectNames[0xcf]  = \"koopaBall         \"\r\nobjectNames[0xd0]  = \"kart_truck        \"\r\nobjectNames[0xd1]  = \"car_body          \"\r\nobjectNames[0xd2]  = \"skyship           \"\r\nobjectNames[0xd3]  = \"w_woodbox         \"\r\nobjectNames[0xd4]  = \"w_itembox         \"\r\nobjectNames[0xd5]  = \"w_itemboxline     \"\r\nobjectNames[0xd6]  = \"VolcanoBall1      \"\r\nobjectNames[0xd7]  = \"penguin_s         \"\r\nobjectNames[0xd8]  = \"penguin_m         \"\r\nobjectNames[0xd9]  = \"penguin_l         \"\r\nobjectNames[0xda]  = \"castleballoon1    \"\r\nobjectNames[0xdb]  = \"dossunc           \"\r\nobjectNames[0xdc]  = \"dossunc_soko      \"\r\nobjectNames[0xdd]  = \"boble             \"\r\nobjectNames[0xde]  = \"K_bomb_car        \"\r\nobjectNames[0xdf]  = \"K_bomb_car_dummy  \"\r\nobjectNames[0xe0]  = \"car_body_dummy    \"\r\nobjectNames[0xe1]  = \"kart_truck_dummy  \"\r\nobjectNames[0xe2]  = \"hanachan          \"\r\nobjectNames[0xe3]  = \"seagull           \"\r\nobjectNames[0xe4]  = \"moray             \"\r\nobjectNames[0xe5]  = \"crab              \"\r\nobjectNames[0xe6]  = \"basabasa_dummy    \"\r\nobjectNames[0xe7]  = \"CarA2             \"\r\nobjectNames[0xe8]  = \"CarA3             \"\r\nobjectNames[0xe9]  = \"Hwanwan           \"\r\nobjectNames[0xea]  = \"HeyhoBallGBA      \"\r\nobjectNames[0xeb]  = \"Twanwan           \"\r\nobjectNames[0xec]  = \"cruiserR          \"\r\nobjectNames[0xed]  = \"bird              \"\r\nobjectNames[0xee]  = \"sin_itembox       \"\r\nobjectNames[0xef]  = \"Twanwan_ue        \"\r\nobjectNames[0xf0]  = \"BossHanachan      \"\r\nobjectNames[0xf1]  = \"Kdossunc          \"\r\nobjectNames[0xf2]  = \"BossHanachanHead  \"\r\nobjectNames[0xf3]  = \"K_bomb_car1       \"\r\nobjectNames[0x12d] = \"dummy             \"\r\nobjectNames[0x12e] = \"dokan_sfc         \"\r\nobjectNames[0x12f] = \"castletree1       \"\r\nobjectNames[0x130] = \"castletree1c      \"\r\nobjectNames[0x131] = \"castletree2       \"\r\nobjectNames[0x132] = \"castleflower1     \"\r\nobjectNames[0x133] = \"mariotreeGC       \"\r\nobjectNames[0x134] = \"mariotreeGCc      \"\r\nobjectNames[0x135] = \"donkytree1GC      \"\r\nobjectNames[0x136] = \"donkytree2GC      \"\r\nobjectNames[0x137] = \"peachtreeGC       \"\r\nobjectNames[0x138] = \"peachtreeGCc      \"\r\nobjectNames[0x139] = \"npc_mii_a         \"\r\nobjectNames[0x13a] = \"npc_mii_b         \"\r\nobjectNames[0x13b] = \"npc_mii_c         \"\r\nobjectNames[0x13c] = \"obakeblockSFCc    \"\r\nobjectNames[0x13d] = \"WLarrowGC         \"\r\nobjectNames[0x13e] = \"WLscreenGC        \"\r\nobjectNames[0x13f] = \"WLdokanGC         \"\r\nobjectNames[0x140] = \"MarioGo64c        \"\r\nobjectNames[0x141] = \"PeachHunsuiGC     \"\r\nobjectNames[0x142] = \"kinokoT1          \"\r\nobjectNames[0x143] = \"kinokoT2          \"\r\nobjectNames[0x144] = \"pylon01           \"\r\nobjectNames[0x145] = \"PalmTree          \"\r\nobjectNames[0x146] = \"parasol           \"\r\nobjectNames[0x147] = \"cruiser           \"\r\nobjectNames[0x148] = \"K_sticklift00     \"\r\nobjectNames[0x149] = \"heyho2            \"\r\nobjectNames[0x14a] = \"HeyhoTreeGBAc     \"\r\nobjectNames[0x14b] = \"MFaceBill         \"\r\nobjectNames[0x14c] = \"truckChimSmk      \"\r\nobjectNames[0x14d] = \"MiiObj01          \"\r\nobjectNames[0x14e] = \"MiiObj02          \"\r\nobjectNames[0x14f] = \"MiiObj03          \"\r\nobjectNames[0x150] = \"gardentreeDS      \"\r\nobjectNames[0x151] = \"gardentreeDSc     \"\r\nobjectNames[0x152] = \"FlagA1            \"\r\nobjectNames[0x153] = \"FlagA2            \"\r\nobjectNames[0x154] = \"FlagB1            \"\r\nobjectNames[0x155] = \"FlagB2            \"\r\nobjectNames[0x156] = \"FlagA3            \"\r\nobjectNames[0x157] = \"DKtreeA64         \"\r\nobjectNames[0x158] = \"DKtreeA64c        \"\r\nobjectNames[0x159] = \"DKtreeB64         \"\r\nobjectNames[0x15a] = \"DKtreeB64c        \"\r\nobjectNames[0x15b] = \"TownTreeDSc       \"\r\nobjectNames[0x15c] = \"Piston            \"\r\nobjectNames[0x15d] = \"oilSFC            \"\r\nobjectNames[0x15e] = \"DKmarutaGCc       \"\r\nobjectNames[0x15f] = \"DKropeGCc         \"\r\nobjectNames[0x160] = \"mii_balloon       \"\r\nobjectNames[0x161] = \"windmill          \"\r\nobjectNames[0x162] = \"dossun            \"\r\nobjectNames[0x163] = \"TownTreeDS        \"\r\nobjectNames[0x164] = \"Ksticketc         \"\r\nobjectNames[0x165] = \"monte_a           \"\r\nobjectNames[0x166] = \"MiiStatueM1       \"\r\nobjectNames[0x167] = \"ShMiiObj01        \"\r\nobjectNames[0x168] = \"ShMiiObj02        \"\r\nobjectNames[0x169] = \"ShMiiObj03        \"\r\nobjectNames[0x16a] = \"Hanabi            \"\r\nobjectNames[0x16b] = \"miiposter         \"\r\nobjectNames[0x16c] = \"dk_miiobj00       \"\r\nobjectNames[0x16d] = \"light_house       \"\r\nobjectNames[0x16e] = \"r_parasol         \"\r\nobjectNames[0x16f] = \"obakeblock2SFCc   \"\r\nobjectNames[0x170] = \"obakeblock3SFCc   \"\r\nobjectNames[0x171] = \"koopaFigure       \"\r\nobjectNames[0x172] = \"pukupuku          \"\r\nobjectNames[0x173] = \"v_stand1          \"\r\nobjectNames[0x174] = \"v_stand2          \"\r\nobjectNames[0x175] = \"leaf_effect       \"\r\nobjectNames[0x176] = \"karehayama        \"\r\nobjectNames[0x177] = \"EarthRing         \"\r\nobjectNames[0x178] = \"SpaceSun          \"\r\nobjectNames[0x179] = \"BlackHole         \"\r\nobjectNames[0x17a] = \"StarRing          \"\r\nobjectNames[0x17b] = \"M_obj_kanban      \"\r\nobjectNames[0x17c] = \"MiiStatueL1       \"\r\nobjectNames[0x17d] = \"MiiStatueD1       \"\r\nobjectNames[0x17e] = \"MiiSphinxY1       \"\r\nobjectNames[0x17f] = \"MiiSphinxY2       \"\r\nobjectNames[0x180] = \"FlagA5            \"\r\nobjectNames[0x181] = \"CarB              \"\r\nobjectNames[0x182] = \"FlagA4            \"\r\nobjectNames[0x183] = \"Steam             \"\r\nobjectNames[0x184] = \"Alarm             \"\r\nobjectNames[0x185] = \"group_monte_a     \"\r\nobjectNames[0x186] = \"MiiStatueL2       \"\r\nobjectNames[0x187] = \"MiiStatueD2       \"\r\nobjectNames[0x188] = \"MiiStatueP1       \"\r\nobjectNames[0x189] = \"SentakuDS         \"\r\nobjectNames[0x18a] = \"fks_screen_wii    \"\r\nobjectNames[0x18b] = \"KoopaFigure64     \"\r\nobjectNames[0x18c] = \"b_teresa          \"\r\nobjectNames[0x18d] = \"MiiStatueDK1      \"\r\nobjectNames[0x18e] = \"MiiKanban         \"\r\nobjectNames[0x18f] = \"BGteresaSFC       \"\r\nobjectNames[0x191] = \"kuribo            \"\r\nobjectNames[0x192] = \"choropu           \"\r\nobjectNames[0x193] = \"cow               \"\r\nobjectNames[0x194] = \"pakkun_f          \"\r\nobjectNames[0x195] = \"WLfirebarGC       \"\r\nobjectNames[0x196] = \"wanwan            \"\r\nobjectNames[0x197] = \"poihana           \"\r\nobjectNames[0x198] = \"DKrockGC          \"\r\nobjectNames[0x199] = \"sanbo             \"\r\nobjectNames[0x19a] = \"choropu2          \"\r\nobjectNames[0x19b] = \"TruckWagon        \"\r\nobjectNames[0x19c] = \"heyho             \"\r\nobjectNames[0x19d] = \"Press             \"\r\nobjectNames[0x19e] = \"Press_soko        \"\r\nobjectNames[0x19f] = \"pile              \"\r\nobjectNames[0x1a0] = \"choropu_ground    \"\r\nobjectNames[0x1a1] = \"WLfireringGC      \"\r\nobjectNames[0x1a2] = \"pakkun_dokan      \"\r\nobjectNames[0x1a3] = \"begoman_spike     \"\r\nobjectNames[0x1a4] = \"FireSnake         \"\r\nobjectNames[0x1a5] = \"koopaFirebar      \"\r\nobjectNames[0x1a6] = \"Epropeller        \"\r\nobjectNames[0x1a7] = \"dc_pillar_c       \"\r\nobjectNames[0x1a8] = \"FireSnake_v       \"\r\nobjectNames[0x1a9] = \"honeBall          \"\r\nobjectNames[0x1aa] = \"puchi_pakkun      \"\r\nobjectNames[0x1ab] = \"sanbo_big         \"\r\nobjectNames[0x1ac] = \"sanbo_big         \"\r\nobjectNames[0x1f5] = \"kinoko_ud         \"\r\nobjectNames[0x1f6] = \"kinoko_bend       \"\r\nobjectNames[0x1f7] = \"VolcanoRock1      \"\r\nobjectNames[0x1f8] = \"bulldozer_left    \"\r\nobjectNames[0x1f9] = \"bulldozer_right   \"\r\nobjectNames[0x1fa] = \"kinoko_nm         \"\r\nobjectNames[0x1fb] = \"Crane             \"\r\nobjectNames[0x1fc] = \"VolcanoPiece      \"\r\nobjectNames[0x1fd] = \"FlamePole         \"\r\nobjectNames[0x1fe] = \"TwistedWay        \"\r\nobjectNames[0x1ff] = \"TownBridgeDSc     \"\r\nobjectNames[0x200] = \"DKship64          \"\r\nobjectNames[0x201] = \"kinoko_kuki       \"\r\nobjectNames[0x202] = \"DKturibashiGCc    \"\r\nobjectNames[0x203] = \"FlamePoleEff      \"\r\nobjectNames[0x204] = \"aurora            \"\r\nobjectNames[0x205] = \"venice_saku       \"\r\nobjectNames[0x206] = \"casino_roulette   \"\r\nobjectNames[0x207] = \"BossField01_OBJ1  \"\r\nobjectNames[0x208] = \"dc_pillar         \"\r\nobjectNames[0x209] = \"dc_sandcone       \"\r\nobjectNames[0x20a] = \"venice_hasi       \"\r\nobjectNames[0x20b] = \"venice_gondola    \"\r\nobjectNames[0x20c] = \"quicksand         \"\r\nobjectNames[0x20d] = \"bblock            \"\r\nobjectNames[0x20e] = \"ami               \"\r\nobjectNames[0x20f] = \"M_obj_jump        \"\r\nobjectNames[0x210] = \"starGate          \"\r\nobjectNames[0x211] = \"RM_ring1          \"\r\nobjectNames[0x212] = \"FlamePole_v       \"\r\nobjectNames[0x213] = \"M_obj_s_jump      \"\r\nobjectNames[0x214] = \"InsekiA           \"\r\nobjectNames[0x215] = \"InsekiB           \"\r\nobjectNames[0x216] = \"FlamePole_v_big   \"\r\nobjectNames[0x217] = \"Mdush             \"\r\nobjectNames[0x218] = \"HP_pipe           \"\r\nobjectNames[0x219] = \"DemoCol           \"\r\nobjectNames[0x21a] = \"M_obj_s_jump2     \"\r\nobjectNames[0x21b] = \"M_obj_jump2       \"\r\nobjectNames[0x259] = \"DonkyCannonGC     \"\r\nobjectNames[0x25a] = \"BeltEasy          \"\r\nobjectNames[0x25b] = \"BeltCrossing      \"\r\nobjectNames[0x25c] = \"BeltCurveA        \"\r\nobjectNames[0x25d] = \"BeltCurveB        \"\r\nobjectNames[0x25e] = \"escalator         \"\r\nobjectNames[0x25f] = \"DonkyCannon_wii   \"\r\nobjectNames[0x260] = \"escalator_group   \"\r\nobjectNames[0x261] = \"tree_cannon       \"\r\nobjectNames[0x2bd] = \"group_enemy_b     \"\r\nobjectNames[0x2be] = \"group_enemy_c     \"\r\nobjectNames[0x2bf] = \"taimatsu          \"\r\nobjectNames[0x2c0] = \"truckChimSmkW     \"\r\nobjectNames[0x2c1] = \"Mstand            \"\r\nobjectNames[0x2c2] = \"dkmonitor         \"\r\nobjectNames[0x2c3] = \"group_enemy_a     \"\r\nobjectNames[0x2c4] = \"FlagB3            \"\r\nobjectNames[0x2c5] = \"spot              \"\r\nobjectNames[0x2c6] = \"group_enemy_d     \"\r\nobjectNames[0x2c7] = \"FlagB4            \"\r\nobjectNames[0x2c8] = \"group_enemy_e     \"\r\nobjectNames[0x2c9] = \"group_monte_L     \"\r\nobjectNames[0x2ca] = \"group_enemy_f     \"\r\nobjectNames[0x2cb] = \"FallBsA           \"\r\nobjectNames[0x2cc] = \"FallBsB           \"\r\nobjectNames[0x2cd] = \"FallBsC           \"\r\nobjectNames[0x2ce] = \"volsmk            \"\r\nobjectNames[0x2cf] = \"ridgemii00        \"\r\nobjectNames[0x2d0] = \"Flash_L           \"\r\nobjectNames[0x2d1] = \"Flash_B           \"\r\nobjectNames[0x2d2] = \"Flash_W           \"\r\nobjectNames[0x2d3] = \"Flash_M           \"\r\nobjectNames[0x2d4] = \"Flash_S           \"\r\nobjectNames[0x2d5] = \"MiiSignNoko       \"\r\nobjectNames[0x2d6] = \"UtsuboDokan       \"\r\nobjectNames[0x2d7] = \"Spot64            \"\r\nobjectNames[0x2d8] = \"DemoEf            \"\r\nobjectNames[0x2d9] = \"Fall_MH           \"\r\nobjectNames[0x2da] = \"Fall_Y            \"\r\nobjectNames[0x2db] = \"DemoJugemu        \"\r\nobjectNames[0x2dc] = \"group_enemy_a_demo\"\r\nobjectNames[0x2dd] = \"group_monte_a_demo\"\r\nobjectNames[0x2de] = \"volfall           \"\r\nobjectNames[0x2df] = \"MiiStatueM2       \"\r\nobjectNames[0x2e0] = \"RhMiiKanban       \"\r\nobjectNames[0x2e1] = \"MiiStatueL3       \"\r\nobjectNames[0x2e2] = \"MiiSignWario      \"\r\nobjectNames[0x2e3] = \"MiiStatueBL1      \"\r\nobjectNames[0x2e4] = \"MiiStatueBD1      \"\r\nobjectNames[0x2e5] = \"Kamifubuki        \"\r\nobjectNames[0x2e6] = \"Crescent64        \"\r\nobjectNames[0x2e7] = \"MiiSighKino       \"\r\nobjectNames[0x2e8] = \"MiiObjD01         \"\r\nobjectNames[0x2e9] = \"MiiObjD02         \"\r\nobjectNames[0x2ea] = \"MiiObjD03         \"\r\nobjectNames[0x2eb] = \"mare_a            \"\r\nobjectNames[0x2ec] = \"mare_b            \"\r\nobjectNames[0x2ed] = \"EnvKareha         \"\r\nobjectNames[0x2ee] = \"EnvFire           \"\r\nobjectNames[0x2ef] = \"EnvSnow           \"\r\nobjectNames[0x2f0] = \"M_obj_start       \"\r\nobjectNames[0x2f1] = \"EnvKarehaUp       \"\r\nobjectNames[0x2f2] = \"M_obj_kanban_y    \"\r\nobjectNames[0x2f3] = \"DKfalls           \"\r\n\r\nconst conditionalModeOptions = [\r\n\t{ str: \"None\", value: 0 },\r\n\t{ str: \"Lap Range\", value: 1 },\r\n\t{ str: \"Checkpoint Range\", value: 2 },\r\n\t{ str: \"Lap Range (Inverted)\", value: 3 },\r\n\t{ str: \"Checkpoint Range (Inverted)\", value: 4 },\r\n\t{ str: \"Lap Progress Range\", value: 5 },\r\n\t{ str: \"Lap Progress Range (Inverted)\", value: 6 },\r\n]\r\n\r\nfunction clampCondIndex(value)\r\n{\r\n\tvalue = Math.round(value)\r\n\tif (!isFinite(value))\r\n\t\tvalue = 0\r\n\treturn Math.max(0, Math.min(7, value))\r\n}\r\n\r\nfunction clampCondPercent(value)\r\n{\r\n\tvalue = Math.round(value)\r\n\tif (!isFinite(value))\r\n\t\tvalue = 0\r\n\treturn Math.max(0, Math.min(100, value))\r\n}\r\n\r\nfunction isLapCondMode(mode)\r\n{\r\n\treturn mode == 1 || mode == 3 || mode == 5 || mode == 6\r\n}\r\n\r\nfunction isLapProgressCondMode(mode)\r\n{\r\n\treturn mode == 5 || mode == 6\r\n}\r\n\r\nfunction isInvertedCondMode(mode)\r\n{\r\n\treturn mode == 3 || mode == 4 || mode == 6\r\n}\r\n\r\nfunction getCondPadding(p)\r\n{\r\n\treturn (p.xpfThing ?? 0) & 0xffff\r\n}\r\n\r\nfunction getCondProgressStartPercent(p)\r\n{\r\n\treturn clampCondPercent((getCondPadding(p) >> 8) & 0xff)\r\n}\r\n\r\nfunction getCondProgressEndPercent(p)\r\n{\r\n\treturn clampCondPercent(getCondPadding(p) & 0xff)\r\n}\r\n\r\nfunction setCondProgressStartPercent(p, value)\r\n{\r\n\tlet padding = getCondPadding(p)\r\n\tp.xpfThing = ((clampCondPercent(value) << 8) | (padding & 0xff)) & 0xffff\r\n}\r\n\r\nfunction setCondProgressEndPercent(p, value)\r\n{\r\n\tlet padding = getCondPadding(p)\r\n\tp.xpfThing = ((padding & 0xff00) | clampCondPercent(value)) & 0xffff\r\n}\r\n\r\nfunction getCondDisplayStart(p)\r\n{\r\n\tlet mode = p.condMode || 0\r\n\tlet start = p.condStart || 0\r\n\tif (isLapCondMode(mode))\r\n\t\treturn clampCondIndex(start) + 1\r\n\treturn clampCondIndex(start)\r\n}\r\n\r\nfunction getCondDisplayEnd(p)\r\n{\r\n\tlet mode = p.condMode || 0\r\n\tlet end = p.condEnd || 0\r\n\tif (isLapCondMode(mode))\r\n\t\treturn clampCondIndex(end) + 1\r\n\treturn clampCondIndex(end)\r\n}\r\n\r\nfunction condDisplayToRaw(mode, value)\r\n{\r\n\tif (isLapCondMode(mode))\r\n\t\treturn clampCondIndex(value - 1)\r\n\treturn clampCondIndex(value)\r\n}\r\n\r\nfunction describeConditional(p)\r\n{\r\n\tlet mode = p.condMode || 0\r\n\tif (mode == 0)\r\n\t\treturn \"<strong>Conditional State:</strong> Disabled\"\r\n\r\n\tlet start = clampCondIndex(p.condStart || 0)\r\n\tlet end = clampCondIndex(p.condEnd || 0)\r\n\t\r\n\tif (isLapCondMode(mode))\r\n\t{\r\n\t\tstart += 1\r\n\t\tend += 1\r\n\t}\r\n\r\n\tif (isLapProgressCondMode(mode))\r\n\t{\r\n\t\tlet startPercent = getCondProgressStartPercent(p)\r\n\t\tlet endPercent = getCondProgressEndPercent(p)\r\n\t\tlet startValue = clampCondIndex(p.condStart || 0) * 100 + startPercent\r\n\t\tlet endValue = clampCondIndex(p.condEnd || 0) * 100 + endPercent\r\n\t\tlet wraps = startValue > endValue ? \" (wrap-around)\" : \"\"\r\n\t\tlet rangeText = \"lap \" + start + \" @ \" + startPercent + \"% to lap \" + end + \" @ \" + endPercent + \"%\"\r\n\t\tif (isInvertedCondMode(mode))\r\n\t\t\treturn \"<strong>Conditional State:</strong> OFF in \" + rangeText + wraps + \", ON elsewhere\"\r\n\t\treturn \"<strong>Conditional State:</strong> ON in \" + rangeText + wraps + \", OFF elsewhere\"\r\n\t}\r\n\r\n\tlet targetName = isLapCondMode(mode) ? \"laps\" : \"checkpoint regions\"\r\n\tlet wraps = (p.condStart || 0) > (p.condEnd || 0) ? \" (wrap-around)\" : \"\"\r\n\tif (isInvertedCondMode(mode))\r\n\t\treturn \"<strong>Conditional State:</strong> OFF in \" + targetName + \" \" + start + \" to \" + end + wraps + \", ON elsewhere\"\r\n\treturn \"<strong>Conditional State:</strong> ON in \" + targetName + \" \" + start + \" to \" + end + wraps + \", OFF elsewhere\"\r\n}\r\n\r\nfunction getCheckpointCompletion(point, maxLayer)\r\n{\r\n\tif (point == null || point.pathLen == null || point.pathLen <= 0 || point.pathPointIndex == null || point.pathLayer == null || maxLayer < 0)\r\n\t\treturn null\r\n\r\n\tlet groupCompletion = point.pathPointIndex / point.pathLen\r\n\tlet overallCompletion = (groupCompletion + point.pathLayer) / (maxLayer + 1)\r\n\treturn isFinite(overallCompletion) ? overallCompletion : null\r\n}\r\n\r\nfunction getCheckpointCenter(point)\r\n{\r\n\treturn point.pos[0].add(point.pos[1]).scale(0.5)\r\n}\r\n\r\nfunction projectPointOntoSegment2D(point, start, end)\r\n{\r\n\tlet dx = end.x - start.x\r\n\tlet dy = end.y - start.y\r\n\tlet lenSq = dx * dx + dy * dy\r\n\tif (lenSq <= 0)\r\n\t{\r\n\t\tlet offsetX = point.x - start.x\r\n\t\tlet offsetY = point.y - start.y\r\n\t\treturn { t: 0, distSq: offsetX * offsetX + offsetY * offsetY }\r\n\t}\r\n\r\n\tlet t = ((point.x - start.x) * dx + (point.y - start.y) * dy) / lenSq\r\n\tt = Math.max(0, Math.min(1, t))\r\n\r\n\tlet projX = start.x + dx * t\r\n\tlet projY = start.y + dy * t\r\n\tlet distX = point.x - projX\r\n\tlet distY = point.y - projY\r\n\r\n\treturn { t, distSq: distX * distX + distY * distY }\r\n}\r\n\r\nfunction normalizeProgress(progress)\r\n{\r\n\tif (!isFinite(progress))\r\n\t\treturn null\r\n\r\n\tlet wrapped = progress % 1\r\n\tif (wrapped < 0)\r\n\t\twrapped += 1\r\n\treturn wrapped\r\n}\r\n\r\nfunction getLapProgressPercentForObject(data, objectPoint)\r\n{\r\n\tif (objectPoint == null || objectPoint.pos == null || data == null || data.checkpointPoints == null)\r\n\t\treturn null\r\n\r\n\tlet checkpointPoints = data.checkpointPoints.nodes\r\n\tif (checkpointPoints == null || checkpointPoints.length == 0)\r\n\t\treturn null\r\n\r\n\tlet maxLayer = data.checkpointPoints.maxLayer\r\n\tif (!isFinite(maxLayer) || maxLayer < 0)\r\n\t{\r\n\t\tmaxLayer = -1\r\n\t\tfor (let point of checkpointPoints)\r\n\t\t{\r\n\t\t\tif (point.pathLayer != null && isFinite(point.pathLayer))\r\n\t\t\t\tmaxLayer = Math.max(maxLayer, point.pathLayer)\r\n\t\t}\r\n\t}\r\n\tif (maxLayer < 0)\r\n\t\treturn null\r\n\r\n\tlet bestDistSq = Infinity\r\n\tlet bestProgress = null\r\n\r\n\tfor (let point of checkpointPoints)\r\n\t{\r\n\t\tlet pointCompletion = getCheckpointCompletion(point, maxLayer)\r\n\t\tif (pointCompletion == null)\r\n\t\t\tcontinue\r\n\r\n\t\tlet pointCenter = getCheckpointCenter(point)\r\n\t\tif (!pointCenter.isFinite())\r\n\t\t\tcontinue\r\n\r\n\t\tlet hasSegment = false\r\n\r\n\t\tfor (let next of point.next)\r\n\t\t{\r\n\t\t\tif (next == null || next.node == null)\r\n\t\t\t\tcontinue\r\n\r\n\t\t\tlet nextCompletion = getCheckpointCompletion(next.node, maxLayer)\r\n\t\t\tif (nextCompletion == null)\r\n\t\t\t\tcontinue\r\n\r\n\t\t\tlet nextCenter = getCheckpointCenter(next.node)\r\n\t\t\tif (!nextCenter.isFinite())\r\n\t\t\t\tcontinue\r\n\r\n\t\t\tlet projection = projectPointOntoSegment2D(objectPoint.pos, pointCenter, nextCenter)\r\n\t\t\tlet segmentStart = pointCompletion\r\n\t\t\tlet segmentEnd = nextCompletion\r\n\t\t\tif (segmentEnd < segmentStart)\r\n\t\t\t\tsegmentEnd += 1\r\n\r\n\t\t\tlet progress = normalizeProgress(segmentStart + (segmentEnd - segmentStart) * projection.t)\r\n\t\t\tif (progress != null && projection.distSq < bestDistSq)\r\n\t\t\t{\r\n\t\t\t\tbestDistSq = projection.distSq\r\n\t\t\t\tbestProgress = progress\r\n\t\t\t}\r\n\r\n\t\t\thasSegment = true\r\n\t\t}\r\n\r\n\t\tif (hasSegment)\r\n\t\t\tcontinue\r\n\r\n\t\tlet distX = objectPoint.pos.x - pointCenter.x\r\n\t\tlet distY = objectPoint.pos.y - pointCenter.y\r\n\t\tlet distSq = distX * distX + distY * distY\r\n\t\tlet progress = normalizeProgress(pointCompletion)\r\n\t\tif (progress != null && distSq < bestDistSq)\r\n\t\t{\r\n\t\t\tbestDistSq = distSq\r\n\t\t\tbestProgress = progress\r\n\t\t}\r\n\t}\r\n\r\n\treturn bestProgress != null ? bestProgress * 100 : null\r\n}\r\n\r\n\r\nclass ViewerObjects extends PointViewer\r\n{\r\n\tconstructor(window, viewer, data)\r\n\t{\r\n\t\tsuper(window, viewer, data)\r\n\t\tthis.interCloneCount = 3\r\n\t}\r\n\t\r\n\t\r\n\tpoints()\r\n\t{\r\n\t\treturn this.data.objects\r\n\t}\r\n\t\r\n\t\r\n\trefreshPanels()\r\n\t{\r\n\t\tlet panel = this.window.addPanel(\"Objects\", false, (open) => { if (open) this.viewer.setSubviewer(this) })\r\n\t\tthis.panel = panel\r\n\t\t\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Click:</strong> Create Object\")\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Drag Object:</strong> Duplicate Object\")\r\n\t\tpanel.addText(null, \"<strong>Hold Ctrl:</strong> Multiselect\")\r\n\t\t\r\n\t\tpanel.addCheckbox(null, \"Draw rotation guides\", this.viewer.cfg.enableRotationRender, (x) => this.viewer.cfg.enableRotationRender = x)\r\n\t\tpanel.addCheckbox(null, \"Use signed settings (-32768...32767)\", this.viewer.cfg.objectsEnableSignedSettings, (x) => { this.viewer.cfg.objectsEnableSignedSettings = x; this.refreshPanels(); })\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tpanel.addButton(null, \"(A) Select/Unselect All\", () => this.toggleAllSelection())\r\n\t\tpanel.addButton(null, \"(T) Select All With Same ID\", () => this.toggleAllSelectionByID())\r\n\t\tpanel.addButton(null, \"(X) Delete Selected\", () => this.deleteSelectedPoints())\r\n\t\tpanel.addButton(null, \"(Y) Snap To Collision Y\", () => this.snapSelectedToY())\r\n\t\tpanel.addSpacer(null)\r\n\t\tpanel.addButton(null, \"Add Duplicates Between 2 Selected\", () => this.interClone(this.interCloneCount))\r\n\t\tpanel.addSelectionNumericInput(null, \"Dupe Count\", 1, 100, this.interCloneCount, 1, 1, true, false, (x) => { this.interCloneCount = x })\r\n\r\n\t\tpanel.addSpacer(null, 2)\r\n\t\t\r\n\t\tpanel.addButton(null, \"Open Object Database\", () => this.window.openExternalLink(\"https://szs.wiimm.de/cgi/mkw/object\"))\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tlet selectedPoints = this.data.objects.nodes.filter(p => p.selected)\r\n\t\t\r\n\t\tlet selectionGroup = panel.addGroup(null, \"Selection:\")\r\n\t\tlet enabled = (selectedPoints.length > 0)\r\n\t\tlet multiedit = (selectedPoints.length > 1)\r\n\r\n\t\tif (selectedPoints.length == 1)\r\n\t\t{\r\n\t\t\tlet i = this.data.objects.nodes.findIndex(p => p === selectedPoints[0])\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>GOBJ Index:</strong> \" + i.toString() + \" (0x\" + i.toString(16) + \")\")\r\n\r\n\t\t\tlet lapProgress = getLapProgressPercentForObject(this.data, selectedPoints[0])\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>Lap Progress:</strong> \" + (lapProgress != null ? (lapProgress.toFixed(4).toString() + \"%\") : \"N/A\"))\r\n\t\t}\r\n\t\t\r\n\t\tlet objName = panel.addText(selectionGroup, \"<strong>Name:</strong> \" + (selectedPoints.length > 0 ? objectNames[selectedPoints[0].id] : \"\"))\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,      \"ID\",        0,  0xffff, selectedPoints.map(p =>  p.id),           1.0, 1.0, enabled, multiedit, (x, i) => {\r\n\t\t\tthis.window.setNotSaved()\r\n\t\t\tselectedPoints[i].id = x\r\n\t\t\tobjName.innerHTML = \"<strong>Name:</strong> \" + objectNames[x]\r\n\t\t})\r\n\t\t\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,       \"X\", -1000000, 1000000, selectedPoints.map(p =>  p.pos.x),       null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.x = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,       \"Y\", -1000000, 1000000, selectedPoints.map(p => -p.pos.z),       null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.z = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,       \"Z\", -1000000, 1000000, selectedPoints.map(p => -p.pos.y),       null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.y = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,  \"Rot. X\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.x),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.x = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,  \"Rot. Y\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.y),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.y = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,  \"Rot. Z\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.z),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.z = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Scale X\", -1000000, 1000000, selectedPoints.map(p =>  p.scale.x),     null, 0.1, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].scale.x = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Scale Y\", -1000000, 1000000, selectedPoints.map(p =>  p.scale.z),     null, 0.1, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].scale.z = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Scale Z\", -1000000, 1000000, selectedPoints.map(p =>  p.scale.y),     null, 0.1, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].scale.y = x })\r\n\t\t\r\n\t\tlet routeOptions = [{ str: \"None\", value: 0xffff }]\r\n\t\tfor (let i = 0; i < this.data.routes.length; i++)\r\n\t\t\trouteOptions.push({ str: \"Route \" + i + \" (0x\" + i.toString(16) + \")\", value: i })\r\n\t\tpanel.addSelectionDropdown(selectionGroup, \"Route\", selectedPoints.map(p => p.routeIndex), routeOptions, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].routeIndex = x })\r\n\t\t\r\n\t\tfor (let s = 0; s < 8; s++)\r\n\t\t\tif (this.viewer.cfg.objectsEnableSignedSettings)\r\n\t\t\t\tpanel.addSelectionNumericInput(selectionGroup, \"Setting \" + (s + 1), -0x8000, 0x7fff, selectedPoints.map(p => p.settings[s] >= 0x8000 ? p.settings[s] - 0x10000 : p.settings[s]), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].settings[s] = (x < 0 ? 0x10000 + x : x) })\r\n\t\t\telse\r\n\t\t\t\tpanel.addSelectionNumericInput(selectionGroup, \"Setting \" + (s + 1), 0, 0xffff, selectedPoints.map(p => p.settings[s]), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].settings[s] = x })\r\n\r\n\t\tpanel.addSpacer(selectionGroup)\r\n\t\tpanel.addText(selectionGroup, \"<strong>Conditional Objects (Presence Flags bits 3-11, Padding for Lap Progress %):</strong>\")\r\n\t\tpanel.addSelectionDropdown(selectionGroup, \"Cond. Mode\", selectedPoints.map(p => p.condMode || 0), conditionalModeOptions, enabled, multiedit, (x, i) => {\r\n\t\t\tthis.window.setNotSaved()\r\n\t\t\tselectedPoints[i].condMode = x\r\n\t\t})\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Cond. Start\", 0, 8, selectedPoints.map(p => getCondDisplayStart(p)), 1.0, 1.0, enabled, multiedit, (x, i) => {\r\n\t\t\tthis.window.setNotSaved()\r\n\t\t\tlet mode = selectedPoints[i].condMode || 0\r\n\t\t\tif (mode == 0) { selectedPoints[i].condMode = 1; mode = 1 }\r\n\t\t\tselectedPoints[i].condStart = condDisplayToRaw(mode, x)\r\n\t\t})\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Cond. End\", 0, 8, selectedPoints.map(p => getCondDisplayEnd(p)), 1.0, 1.0, enabled, multiedit, (x, i) => {\r\n\t\t\tthis.window.setNotSaved()\r\n\t\t\tlet mode = selectedPoints[i].condMode || 0\r\n\t\t\tif (mode == 0) { selectedPoints[i].condMode = 1; mode = 1 }\r\n\t\t\tselectedPoints[i].condEnd = condDisplayToRaw(mode, x)\r\n\t\t})\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Cond. Start %\", 0, 100, selectedPoints.map(p => getCondProgressStartPercent(p)), 1.0, 1.0, enabled, multiedit, (x, i) => {\r\n\t\t\tthis.window.setNotSaved()\r\n\t\t\tlet mode = selectedPoints[i].condMode || 0\r\n\t\t\tif (!isLapProgressCondMode(mode))\r\n\t\t\t\tselectedPoints[i].condMode = 5\r\n\t\t\tsetCondProgressStartPercent(selectedPoints[i], x)\r\n\t\t})\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Cond. End %\", 0, 100, selectedPoints.map(p => getCondProgressEndPercent(p)), 1.0, 1.0, enabled, multiedit, (x, i) => {\r\n\t\t\tthis.window.setNotSaved()\r\n\t\t\tlet mode = selectedPoints[i].condMode || 0\r\n\t\t\tif (!isLapProgressCondMode(mode))\r\n\t\t\t\tselectedPoints[i].condMode = 5\r\n\t\t\tsetCondProgressEndPercent(selectedPoints[i], x)\r\n\t\t})\r\n\t\tif (enabled && selectedPoints.length > 0)\r\n\t\t{\r\n\t\t\tlet first = selectedPoints[0]\r\n\t\t\tlet allSame = selectedPoints.every(p => (p.condMode || 0) === (first.condMode || 0) && (p.condStart || 0) === (first.condStart || 0) && (p.condEnd || 0) === (first.condEnd || 0))\r\n\t\t\tif (allSame && isLapProgressCondMode(first.condMode || 0))\r\n\t\t\t\tallSame = selectedPoints.every(p => getCondProgressStartPercent(p) === getCondProgressStartPercent(first) && getCondProgressEndPercent(p) === getCondProgressEndPercent(first))\r\n\t\t\tif (allSame)\r\n\t\t\t\tpanel.addText(selectionGroup, describeConditional(first))\r\n\t\t\telse\r\n\t\t\t\tpanel.addText(selectionGroup, \"<strong>Conditional State:</strong> Multiple selected objects have different conditional values\")\r\n\t\t}\r\n\r\n\t\tpanel.addSpacer(selectionGroup)\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Padding\", 0, 0xffff, selectedPoints.map(p => p.xpfThing ?? 0), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].xpfThing = x })\r\n\t\t\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Presence\", 0, 0x7, selectedPoints.map(p => p.presence & 0x7), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].presence = x & 0x7 })\r\n\t}\r\n\t\r\n\t\r\n\trefresh()\r\n\t{\r\n\t\tsuper.refresh()\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\t\r\n\ttoggleAllSelectionByID()\r\n\t{\r\n\t\tlet selectedObjs = this.data.objects.nodes.filter(p => p.selected)\r\n\t\t\r\n\t\tfor (let point of this.data.objects.nodes)\r\n\t\t\tpoint.selected = (selectedObjs.find(p => p.id == point.id) != null)\r\n\t\t\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\r\n\tinterClone(count) {\r\n\t\tlet selectedObjs = this.data.objects.nodes.filter(p => p.selected)\r\n\r\n\t\tif (selectedObjs.length !== 2)\r\n\t\t\treturn\r\n\r\n\t\tif (this.points().nodes.length + count > this.points().maxNodes)\r\n\t\t{\r\n\t\t\talert(\"KMP error!\\n\\nMaximum number of points surpassed (\" + this.points().maxNodes + \")\")\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tlet newPoints = []\r\n\t\tfor (let i = 0; i < count; i++)\r\n\t\t{\r\n\t\t\tnewPoints.push(this.points().addNode())\r\n\t\t\tthis.points().onCloneNode(newPoints[i], selectedObjs[0])\r\n\t\t\tnewPoints[i].pos.x = (selectedObjs[0].pos.x * (i+1) + selectedObjs[1].pos.x * (count-i)) / (count+1)\r\n\t\t\tnewPoints[i].pos.y = (selectedObjs[0].pos.y * (i+1) + selectedObjs[1].pos.y * (count-i)) / (count+1)\r\n\t\t\tnewPoints[i].pos.z = (selectedObjs[0].pos.z * (i+1) + selectedObjs[1].pos.z * (count-i)) / (count+1)\r\n\t\t\tnewPoints[i].selected = true\r\n\t\t}\r\n\r\n\t\tthis.refresh()\r\n\t\tthis.refreshPanels()\r\n\t\tthis.window.setNotSaved()\r\n\t}\r\n\t\r\n\t\r\n\tonKeyDown(ev)\r\n\t{\r\n\t\tif (super.onKeyDown(ev))\r\n\t\t\treturn true\r\n\t\t\r\n\t\tswitch (ev.key)\r\n\t\t{\r\n\t\t\tcase \"T\":\r\n\t\t\tcase \"t\":\r\n\t\t\t\tthis.toggleAllSelectionByID()\r\n\t\t\t\treturn true\r\n\t\t}\r\n\t\t\r\n\t\treturn false\r\n\t}\r\n\t\r\n\t\r\n\tdrawAfterModel()\r\n\t{\r\n\t\tfor (let point of this.data.objects.nodes)\r\n\t\t{\r\n\t\t\tlet scale = (this.hoveringOverPoint == point ? 1.5 : 1) * this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tpoint.renderer\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([1, 0, 1, 1])\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelected\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([1, 0.5, 1, 1])\r\n\t\t\t\t.setEnabled(point.selected)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelectedCore\r\n\t\t\t\t.setDiffuseColor([1, 0, 1, 1])\r\n\t\t\t\t\r\n\t\t\tlet matrixDirection =\r\n\t\t\t\tMat4.scale(scale, scale / 1.5, scale / 1.5)\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 0, 1), 90 * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(1, 0, 0), point.rotation.x * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 0, 1), -point.rotation.y * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 1, 0), -point.rotation.z * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.translation(point.pos.x, point.pos.y, point.pos.z))\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirection\r\n\t\t\t\t.setCustomMatrix(matrixDirection)\r\n\t\t\t\t.setDiffuseColor([1, 0.5, 1, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionArrow\r\n\t\t\t\t.setCustomMatrix(matrixDirection)\r\n\t\t\t\t.setDiffuseColor([1, 0.35, 1, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionUp\r\n\t\t\t\t.setCustomMatrix(matrixDirection)\r\n\t\t\t\t.setDiffuseColor([0.75, 0, 0.75, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t}\r\n\t\t\r\n\t\tthis.scene.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t\tthis.sceneAfter.clearDepth(this.viewer.gl)\r\n\t\tthis.sceneAfter.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { ViewerObjects }\r\n", "const { GfxScene, GfxCamera, GfxMaterial, GfxModel, GfxNodeRenderer, GfxNodeRendererTransform } = require(\"../gl/scene.js\")\r\nconst { PathViewer } = require(\"./pathViewer.js\")\r\nconst { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\nconst { Geometry } = require(\"../math/geometry.js\")\r\n\r\n\r\nclass ViewerRoutes extends PathViewer\r\n{\r\n\tconstructor(window, viewer, data)\r\n\t{\r\n\t\tsuper(window, viewer, data)\r\n\t\tthis.currentRouteIndex = 0\r\n\t}\r\n\t\r\n\t\r\n\tpoints()\r\n\t{\r\n\t\tif (this.currentRouteIndex < 0 || this.currentRouteIndex >= this.data.routes.length)\r\n\t\t\treturn { nodes: [] }\r\n\r\n\t\treturn this.data.routes[this.currentRouteIndex].points\r\n\t}\r\n\t\r\n\t\r\n\trefreshPanels()\r\n\t{\r\n\t\tlet panel = this.window.addPanel(\"Routes\", false, (open) => { if (open) this.viewer.setSubviewer(this) })\r\n\t\tthis.panel = panel\r\n\t\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Click:</strong> Create Point\")\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Drag Point:</strong> Extend Path\")\r\n\t\tpanel.addText(null, \"<strong>Hold Ctrl:</strong> Multiselect\")\r\n\t\tpanel.addSpacer(null)\r\n\t\t\r\n\t\tpanel.addButton(null, \"(A) Select/Unselect All\", () => this.toggleAllSelection())\r\n\t\tpanel.addButton(null, \"(X) Delete Selected\", () => this.deleteSelectedPoints())\r\n\t\tpanel.addButton(null, \"(Y) Snap To Collision Y\", () => this.snapSelectedToY())\r\n\t\tpanel.addButton(null, \"(U) Unlink Selected\", () => this.unlinkSelectedPoints())\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tlet routeOptions = []\r\n\t\tfor (let i = 0; i < this.data.routes.length; i++)\r\n\t\t\trouteOptions.push({ str: \"Route \" + i + \" (0x\" + i.toString(16) + \")\", value: i })\r\n\t\t\r\n\t\tpanel.addText(null, \"\u26A0\uFE0F <strong>Does not currently auto-manage route references from objects, cameras, and areas!</strong>\")\r\n\t\tpanel.addSelectionDropdown(null, \"Current\", this.currentRouteIndex, routeOptions, true, false, (x, i) => { this.currentRouteIndex = x; this.refresh() })\r\n\t\tpanel.addButton(null, \"Create New Route\", () => this.createRoute())\r\n\t\tpanel.addButton(null, \"Delete Current Route\", () => this.deleteRoute())\r\n\t\tpanel.addSpacer(null)\r\n\t\t\r\n\t\tif (this.currentRouteIndex < 0 || this.currentRouteIndex >= this.data.routes.length)\r\n\t\t\treturn\r\n\t\t\r\n\t\tlet route = this.data.routes[this.currentRouteIndex]\r\n\t\t\r\n\t\tlet setting1Options =\r\n\t\t[\r\n\t\t\t{ str: \"Straight Edges\", value: 0 },\r\n\t\t\t{ str: \"Curved Edges\", value: 1 },\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(null, \"Setting 1\", route.setting1, setting1Options, true, false, (x, i) => { this.window.setNotSaved(); route.setting1 = x; this.refresh() })\r\n\t\t\r\n\t\tlet setting2Options =\r\n\t\t[\r\n\t\t\t{ str: \"Cyclic Motion\", value: 0 },\r\n\t\t\t{ str: \"Back-and-Forth Motion\", value: 1 },\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(null, \"Setting 2\", route.setting2, setting2Options, true, false, (x, i) => { this.window.setNotSaved(); route.setting2 = x })\r\n\t\t\r\n\t\t//if (route.points.nodes.length < 2 || route.setting1 && route.points.nodes.length < 3)\r\n\t\t\t//panel.addText(null, \"\u26A0\uFE0F <strong>WARNING! Less than \" + (2 + route.setting1) + \" points may cause a crash!</strong>\")\r\n\r\n\t\tlet selectedPoints = route.points.nodes.filter(p => p.selected)\r\n\t\t\r\n\t\tlet selectionGroup = panel.addGroup(null, \"Selection:\")\r\n\t\tlet enabled = (selectedPoints.length > 0)\r\n\t\tlet multiedit = (selectedPoints.length > 1)\r\n\r\n\t\tif (selectedPoints.length == 1)\r\n\t\t{\r\n\t\t\tlet i = route.points.nodes.findIndex(p => p === selectedPoints[0])\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>Point Index:</strong> \" + i.toString() + \" (0x\" + i.toString(16) + \")\")\r\n\t\t}\r\n\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,    \"X\", -1000000, 1000000, selectedPoints.map(p =>  p.pos.x), null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.x = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,    \"Y\", -1000000, 1000000, selectedPoints.map(p => -p.pos.z), null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.z = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,    \"Z\", -1000000, 1000000, selectedPoints.map(p => -p.pos.y), null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.y = -x })\r\n\t\t\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Setting 1\", 0, 0xffff, selectedPoints.map(p => p.setting1), null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting1 = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Setting 2\", 0, 0xffff, selectedPoints.map(p => p.setting2), null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting2 = x })\r\n\t}\r\n\t\r\n\t\r\n\trefresh()\r\n\t{\r\n\t\tsuper.refresh()\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\t\r\n\tcreateRoute()\r\n\t{\r\n\t\tthis.data.addNewRoute()\r\n\t\tthis.currentRouteIndex = this.data.routes.length - 1\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\t\r\n\t\r\n\tdeleteRoute()\r\n\t{\r\n\t\tif (this.currentRouteIndex < 0 || this.currentRouteIndex >= this.data.routes.length)\r\n\t\t\treturn\r\n\t\t\r\n\t\tthis.data.routes.splice(this.currentRouteIndex, 1)\r\n\t\tthis.currentRouteIndex = Math.min(this.currentRouteIndex, this.data.routes.length - 1)\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\r\n\r\n\tonKeyDown(ev)\r\n\t{\r\n\t\tswitch (ev.key)\r\n\t\t{\r\n\t\t\tcase \"A\":\r\n\t\t\tcase \"a\":\r\n\t\t\t\tthis.toggleAllSelection()\r\n\t\t\t\treturn true\r\n\t\t\t\r\n\t\t\tcase \"Backspace\":\r\n\t\t\tcase \"Delete\":\r\n\t\t\tcase \"X\":\r\n\t\t\tcase \"x\":\r\n\t\t\t\tthis.deleteSelectedPoints()\r\n\t\t\t\treturn true\r\n\r\n\t\t\tcase \"Y\":\r\n\t\t\tcase \"y\":\r\n\t\t\t\tthis.snapSelectedToY()\r\n\t\t\t\treturn true\r\n\t\t\t\t\r\n\t\t\tcase \"U\":\r\n\t\t\tcase \"u\":\r\n\t\t\t\tthis.unlinkSelectedPoints()\r\n\t\t\t\treturn true\r\n\t\t}\r\n\t\t\r\n\t\treturn false\r\n\t}\r\n\t\r\n\t\r\n\tdrawAfterModel()\r\n\t{\r\n\t\tif (this.currentRouteIndex < 0 || this.currentRouteIndex >= this.data.routes.length)\r\n\t\t\treturn\r\n\t\t\r\n\t\tlet route = this.data.routes[this.currentRouteIndex]\r\n\t\t\r\n\t\tlet cameraPos = this.viewer.getCurrentCameraPosition()\r\n\t\t\r\n\t\tfor (let point of route.points.nodes)\r\n\t\t{\r\n\t\t\tlet scale = (this.hoveringOverPoint == point ? 1.5 : 1) * this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tpoint.renderer\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([0, 0.75, 0.75, 1])\r\n\t\t\t\t\r\n\t\t\tfor (let n = 0; n < point.next.length; n++)\r\n\t\t\t{\r\n\t\t\t\tlet nextPos = point.next[n].node.pos\r\n\t\t\t\t\r\n\t\t\t\tlet scale2 = Math.min(scale, this.viewer.getElementScale(nextPos))\r\n\t\t\t\t\r\n\t\t\t\tlet matrixScale = Mat4.scale(scale2, scale2, nextPos.sub(point.pos).magn())\r\n\t\t\t\tlet matrixAlign = Mat4.rotationFromTo(new Vec3(0, 0, 1), nextPos.sub(point.pos).normalize())\r\n\t\t\t\tlet matrixTranslate = Mat4.translation(point.pos.x, point.pos.y, point.pos.z)\r\n\t\t\t\t\r\n\t\t\t\tlet matrixScaleArrow = Mat4.scale(scale2, scale2, scale2)\r\n\t\t\t\tlet matrixTranslateArrow = Mat4.translation(nextPos.x, nextPos.y, nextPos.z)\r\n\t\t\t\t\r\n\t\t\t\tpoint.rendererOutgoingPaths[n]\r\n\t\t\t\t\t.setCustomMatrix(matrixScale.mul(matrixAlign.mul(matrixTranslate)))\r\n\t\t\t\t\t.setDiffuseColor([0.5, 1, 1, 1])\r\n\t\t\t\t\t\r\n\t\t\t\tpoint.rendererOutgoingPathArrows[n]\r\n\t\t\t\t\t.setCustomMatrix(matrixScaleArrow.mul(matrixAlign.mul(matrixTranslateArrow)))\r\n\t\t\t\t\t.setDiffuseColor([0, 0.55, 0.75, 1])\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.scene.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t\t\r\n\t\tfor (let point of route.points.nodes)\r\n\t\t{\r\n\t\t\tlet scale = (this.hoveringOverPoint == point ? 1.5 : 1) * this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tpoint.rendererSelected\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([0.5, 1, 1, 1])\r\n\t\t\t\t.setEnabled(point.selected)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelectedCore\r\n\t\t\t\t.setDiffuseColor([0, 0.75, 0.75, 1])\r\n\t\t}\r\n\t\t\r\n\t\tthis.sceneAfter.clearDepth(this.viewer.gl)\r\n\t\tthis.sceneAfter.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { ViewerRoutes }", "const { GfxScene, GfxCamera, GfxMaterial, GfxModel, GfxNodeRenderer, GfxNodeRendererTransform } = require(\"../gl/scene.js\")\r\nconst { PointViewer } = require(\"./pointViewer.js\")\r\nconst { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\nconst { Geometry } = require(\"../math/geometry.js\")\r\n\r\n\r\nclass ViewerAreas extends PointViewer\r\n{\r\n    constructor(window, viewer, data)\r\n\t{\r\n\t\tsuper(window, viewer, data)\r\n        \r\n        this.modelAreaBox = new ModelBuilder()\r\n            .addCube(5000, 5000, -10000, -5000, -5000, 0)\r\n            .calculateNormals()\r\n            .makeModel(viewer.gl)\r\n\r\n        this.modelAreaCylinder = new ModelBuilder()\r\n            .addCylinder(5000, 5000, -10000, -5000, -5000, 0, 24)\r\n            .calculateNormals()\r\n            .makeModel(viewer.gl)\r\n\t}\r\n\r\n\r\n\tpoints()\r\n\t{\r\n\t\treturn this.data.areaPoints\r\n\t}\r\n\r\n\r\n    refreshPanels()\r\n\t{\r\n\t\tlet panel = this.window.addPanel(\"Area\", false, (open) => { if (open) this.viewer.setSubviewer(this) })\r\n\t\tthis.panel = panel\r\n        \r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Click:</strong> Create Area\")\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Drag Object:</strong> Duplicate Area\")\r\n\t\tpanel.addText(null, \"<strong>Hold Ctrl:</strong> Multiselect\")\r\n\r\n        panel.addCheckbox(null, \"Draw rotation guides\", this.viewer.cfg.enableRotationRender, (x) => this.viewer.cfg.enableRotationRender = x)\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tpanel.addButton(null, \"(A) Select/Unselect All\", () => this.toggleAllSelection())\r\n\t\tpanel.addButton(null, \"(T) Select All With Same Type\", () => this.toggleAllSelectionByType())\r\n        panel.addButton(null, \"(X) Delete Selected\", () => this.deleteSelectedPoints())\r\n\t\tpanel.addButton(null, \"(Y) Snap To Collision Y\", () => this.snapSelectedToY())\r\n\t\tpanel.addSpacer(null)\r\n\r\n        let selectedPoints = this.data.areaPoints.nodes.filter(p => p.selected)\r\n\t\t\r\n\t\tlet selectionGroup = panel.addGroup(null, \"Selection:\")\r\n\t\tlet enabled = (selectedPoints.length > 0)\r\n\t\tlet multiedit = (selectedPoints.length > 1)\r\n\r\n\t\tif (selectedPoints.length == 1)\r\n\t\t{\r\n\t\t\tlet i = this.data.areaPoints.nodes.findIndex(p => p === selectedPoints[0])\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>AREA Index:</strong> \" + i.toString() + \" (0x\" + i.toString(16) + \")\")\r\n\t\t}\r\n\t\t\r\n\t\tpanel.addCheckbox(selectionGroup, \"Render Area\", (!enabled ? false : multiedit ? selectedPoints.every(p => p.isRendered) : selectedPoints[0].isRendered), (x) => {\r\n            for (let point of selectedPoints)\r\n                point.isRendered = x\r\n         })\r\n\r\n        let typeOptions =\r\n\t\t[\r\n\t\t\t{ str: \"Camera\", value: 0 },\r\n\t\t\t{ str: \"Env Effect\", value: 1 },\r\n            { str: \"Fog Effect\", value: 2 },\r\n            { str: \"Moving Water\", value: 3 },\r\n            { str: \"Force Recalc\", value: 4 },\r\n            { str: \"Minimap Control\", value: 5 },\r\n            { str: \"Bloom Effect\", value: 6 },\r\n            { str: \"Enable Boos\", value: 7 },\r\n            { str: \"Object Group\", value: 8 },\r\n            { str: \"Object Unload\", value: 9 },\r\n            { str: \"Fall Boundary\", value: 10 },\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(selectionGroup, \"Type\", selectedPoints.map(p => p.type), typeOptions, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].type = x; this.refresh() })\r\n\t\t\r\n        let shapeOptions =\r\n\t\t[\r\n\t\t\t{ str: \"Box\", value: 0 },\r\n\t\t\t{ str: \"Cylinder\", value: 1 },\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(selectionGroup, \"Shape\", selectedPoints.map(p => p.shape), shapeOptions, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].shape = x; this.refresh() })\r\n\t\t\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,       \"X\", -1000000, 1000000, selectedPoints.map(p =>  p.pos.x),       null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.x = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,       \"Y\", -1000000, 1000000, selectedPoints.map(p => -p.pos.z),       null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.z = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,       \"Z\", -1000000, 1000000, selectedPoints.map(p => -p.pos.y),       null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.y = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,  \"Rot. X\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.x),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.x = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,  \"Rot. Y\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.y),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.y = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,  \"Rot. Z\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.z),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.z = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Scale X\", -1000000, 1000000, selectedPoints.map(p =>  p.scale.x),     null, 0.1, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].scale.x = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Scale Y\", -1000000, 1000000, selectedPoints.map(p =>  p.scale.y),     null, 0.1, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].scale.y = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Scale Z\", -1000000, 1000000, selectedPoints.map(p =>  p.scale.z),     null, 0.1, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].scale.z = x })\r\n        panel.addSelectionNumericInput(selectionGroup, \"Priority\", 0, 0xff, selectedPoints.map(p => p.priority), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].priority = x })\r\n\t\t\r\n        let selectionType = (enabled && selectedPoints.every(p => p.type == selectedPoints[0].type) ? selectedPoints[0].type : -1)\r\n\r\n\t\tswitch (selectionType)\r\n\t\t{\r\n\t\t\tcase 0:\r\n\t\t\t\tlet camOptions = [{ str: \"None\", value: 0xff }]\r\n\t\t\t\tfor (let i = 0; i < this.data.cameras.nodes.length; i++)\r\n\t\t\t\t\tcamOptions.push({ str: \"Camera \" + i + \" (0x\" + i.toString(16) + \")\", value: i })\r\n\t\t\t\tpanel.addSelectionDropdown(selectionGroup, \"Camera\", selectedPoints.map(p => p.cameraIndex), camOptions, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].cameraIndex = x })\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\tlet envOptions =\r\n\t\t\t\t[\r\n\t\t\t\t\t{ str: \"EnvKareha\", value: 0 },\r\n\t\t\t\t\t{ str: \"EnvKarehaUp\", value: 1 },\r\n\t\t\t\t]\r\n\t\t\t\tpanel.addSelectionDropdown(selectionGroup, \"Object\", selectedPoints.map(p => p.setting1), envOptions, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting1 = x })\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase 2:\r\n\t\t\t\tpanel.addSelectionNumericInput(selectionGroup, \"BFG entry\", 0, 0xffff, selectedPoints.map(p => p.setting1), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting1 = x })\r\n\t\t\t\tpanel.addSelectionNumericInput(selectionGroup, \"Setting 2\", 0, 0xffff, selectedPoints.map(p => p.setting2), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting2 = x })\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase 3:\r\n\t\t\t\tlet routeOptions = [{ str: \"None\", value: 0xff }]\r\n\t\t\t\tfor (let i = 0; i < this.data.routes.length; i++)\r\n\t\t\t\t\trouteOptions.push({ str: \"Route \" + i + \" (0x\" + i.toString(16) + \")\", value: i })\r\n\t\t\t\tpanel.addSelectionDropdown(selectionGroup, \"Route\", selectedPoints.map(p => p.routeIndex), routeOptions, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].routeIndex = x })\r\n\t\t\t\r\n\t\t\t\tpanel.addSelectionNumericInput(selectionGroup, \"Acceleration\", 0, 0xffff, selectedPoints.map(p => p.setting1), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting1 = x })\r\n\t\t\t\tpanel.addSelectionNumericInput(selectionGroup, \"Route Speed\", 0, 0xffff, selectedPoints.map(p => p.setting2), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting2 = x })\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase 4:\r\n\t\t\t\tpanel.addSelectionNumericInput(selectionGroup, \"Enemy Point\", 0, 0xff, selectedPoints.map(p => p.enemyIndex), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].enemyIndex = x })\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase 5:\r\n\t\t\t\tpanel.addSelectionNumericInput(selectionGroup, \"Setting 1\", 0, 0xffff, selectedPoints.map(p => p.setting1), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting1 = x })\r\n\t\t\t\tpanel.addSelectionNumericInput(selectionGroup, \"Setting 2\", 0, 0xffff, selectedPoints.map(p => p.setting2), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting2 = x })\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase 6:\r\n\t\t\t\tpanel.addSelectionNumericInput(selectionGroup, \"BBLM File\", 0, 0xffff, selectedPoints.map(p => p.setting1), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting1 = x })\r\n\t\t\t\tpanel.addSelectionNumericInput(selectionGroup, \"Fade Time\", 0, 0xffff, selectedPoints.map(p => p.setting2), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting2 = x })\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase 7:\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase 8:\r\n\t\t\tcase 9:\r\n\t\t\t\tpanel.addSelectionNumericInput(selectionGroup, \"Group ID\", 0, 0xffff, selectedPoints.map(p => p.setting1), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting1 = x })\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase 10:\r\n\t\t\t\tpanel.addCheckbox(selectionGroup, \"Enable Conditional OOB (requires LE-CODE)\", this.data.areaPoints.enableCOOB, (x) => { this.data.areaPoints.enableCOOB = x; this.refreshPanels() })\r\n\t\t\t\tif (this.data.areaPoints.enableCOOB)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet coobPoints = this.data.areaPoints.nodes.filter(p => p.type === 10)\r\n\t\t\t\t\tlet modeOptions =\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t{ str: \"Checkpoint Range\", value: 0xff },\r\n\t\t\t\t\t\t{ str: \"KCP Region\", value: 1 },\r\n\t\t\t\t\t]\r\n\t\t\t\t\tpanel.addSelectionDropdown(selectionGroup, \"Mode\", coobPoints.map(p => p.routeIndex), modeOptions, enabled, multiedit, (x, i) => { coobPoints[i].routeIndex = x; this.refreshPanels() })\r\n\t\t\t\t\t\r\n\t\t\t\t\tpanel.addSelectionNumericInput(selectionGroup, (coobPoints[0].routeIndex == 1 ? \"Setting\" : \"Start Index\"), 0, 0xffff, selectedPoints.map(p => p.setting1), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting1 = x })\r\n\t\t\t\t\tpanel.addSelectionNumericInput(selectionGroup, (coobPoints[0].routeIndex == 1 ? \"KCP Number\" : \"End Index\"), 0, 0xffff, selectedPoints.map(p => p.setting2), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].setting2 = x })\r\n\t\t\t\t}\r\n\t\t\t\tbreak\r\n\t\t}\r\n    }\r\n\r\n\r\n    refresh()\r\n\t{\r\n\t\tsuper.refresh()\r\n\t\t\r\n\t\tfor (let point of this.data.areaPoints.nodes)\r\n\t\t{\r\n            point.rendererArea = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t.setModel(point.shape ? this.modelAreaCylinder : this.modelAreaBox)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\r\n            this.renderers.push(point.rendererArea)\r\n\t\t}\r\n\t\t\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\r\n\r\n    toggleAllSelectionByType()\r\n\t{\r\n\t\tlet selectedPoints = this.data.areaPoints.nodes.filter(p => p.selected)\r\n\t\t\r\n\t\tfor (let point of this.data.areaPoints.nodes)\r\n\t\t\tpoint.selected = (selectedPoints.find(p => p.type == point.type) != null)\r\n\t\t\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\r\n\r\n    onKeyDown(ev)\r\n\t{\r\n\t\tif (super.onKeyDown(ev))\r\n\t\t\treturn true\r\n\t\t\r\n\t\tswitch (ev.key)\r\n\t\t{\r\n\t\t\tcase \"T\":\r\n\t\t\tcase \"t\":\r\n\t\t\t\tthis.toggleAllSelectionByType()\r\n\t\t\t\treturn true\r\n\t\t}\r\n\t\t\r\n\t\treturn false\r\n\t}\r\n\r\n\r\n\tonMouseDown(ev, x, y, cameraPos, ray, hit, distToHit, mouse3DPos)\r\n\t{\r\n\t\tsuper.onMouseDown(ev, x, y, cameraPos, ray, hit, distToHit, mouse3DPos)\r\n\r\n\t\tif (ev.altKey)\r\n\t\t{\r\n\t\t\tlet newPointIndex = this.data.areaPoints.nodes.findIndex(p => p.selected)\r\n\t\t\tif (newPointIndex > 0)\r\n\t\t\t{\r\n\t\t\t\tthis.data.areaPoints.nodes[newPointIndex].isRendered = true\r\n\t\t\t\tthis.refresh()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n    drawAfterModel()\r\n\t{\r\n\t\tfor (let point of this.data.areaPoints.nodes)\r\n\t\t{\r\n\t\t\tlet scale = (this.hoveringOverPoint == point ? 1.5 : 1) * this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tpoint.renderer\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([1, 0.5, 0, 1])\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelected\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([1, 0.7, 0, 1])\r\n\t\t\t\t.setEnabled(point.selected)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelectedCore\r\n\t\t\t\t.setDiffuseColor([1, 0.5, 0, 1])\r\n\t\t\t\t\r\n            let pointScale = Mat4.scale(scale, scale / 1.5, scale / 1.5)\r\n            let areaScale = \r\n\t\t\t\tMat4.scale(point.scale.x, point.scale.z, point.scale.y)\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 0, 1), 90 * Math.PI / 180))\r\n\t\t\tlet matrixDirection =\r\n\t\t\t\tMat4.rotation(new Vec3(0, 0, 1), 90 * Math.PI / 180)\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(1, 0, 0), point.rotation.x * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 0, 1), -point.rotation.y * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 1, 0), -point.rotation.z * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.translation(point.pos.x, point.pos.y, point.pos.z))\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirection\r\n\t\t\t\t.setCustomMatrix(pointScale.mul(matrixDirection))\r\n\t\t\t\t.setDiffuseColor([1, 0.7, 0, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionArrow\r\n\t\t\t\t.setCustomMatrix(pointScale.mul(matrixDirection))\r\n\t\t\t\t.setDiffuseColor([1, 0.35, 0, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionUp\r\n\t\t\t\t.setCustomMatrix(pointScale.mul(matrixDirection))\r\n\t\t\t\t.setDiffuseColor([0.75, 0.5, 0, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\r\n            point.rendererArea\r\n                .setCustomMatrix(areaScale.mul(matrixDirection))\r\n                .setDiffuseColor([1, 0.7, 0, 0.5])\r\n                .setEnabled(point.isRendered)\r\n\t\t}\r\n\t\t\r\n\t\tthis.scene.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t\tthis.sceneAfter.clearDepth(this.viewer.gl)\r\n\t\tthis.sceneAfter.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { ViewerAreas }", "const { GfxScene, GfxCamera, GfxMaterial, GfxModel, GfxNodeRenderer, GfxNodeRendererTransform } = require(\"../gl/scene.js\")\r\nconst { PointViewer } = require(\"./pointViewer.js\")\r\nconst { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\nconst { Geometry } = require(\"../math/geometry.js\")\r\n\r\n\r\nclass ViewerCameras extends PointViewer\r\n{\r\n    constructor(window, viewer, data)\r\n\t{\r\n\t\tsuper(window, viewer, data)\r\n\t}\r\n\r\n\r\n\tpoints()\r\n\t{\r\n\t\treturn this.data.cameras\r\n\t}\r\n\r\n\r\n    refreshPanels()\r\n\t{\r\n\t\tlet panel = this.window.addPanel(\"Cameras\", false, (open) => { if (open) this.viewer.setSubviewer(this) })\r\n\t\tthis.panel = panel\r\n        \r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Click:</strong> Create Camera\")\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Drag Object:</strong> Duplicate Camera\")\r\n\t\tpanel.addText(null, \"<strong>Hold Ctrl:</strong> Multiselect\")\r\n\r\n        panel.addCheckbox(null, \"Draw rotation guides\", this.viewer.cfg.enableRotationRender, (x) => this.viewer.cfg.enableRotationRender = x)\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tpanel.addButton(null, \"(A) Select/Unselect All\", () => this.toggleAllSelection())\r\n\t\tpanel.addButton(null, \"(T) Select All With Same Type\", () => this.toggleAllSelectionByType())\r\n        panel.addButton(null, \"(X) Delete Selected\", () => this.deleteSelectedPoints())\r\n\t\tpanel.addButton(null, \"(Y) Snap To Collision Y\", () => this.snapSelectedToY())\r\n\t\tpanel.addSpacer(null)\r\n\r\n        let firstOptions = []\r\n\t\tfor (let i = 0; i < this.data.cameras.nodes.length; i++)\r\n            firstOptions.push({ str: \"Camera \" + i + \" (0x\" + i.toString(16) + \")\", value: i })\r\n\t\tpanel.addSelectionDropdown(null, \"Intro Start\", this.data.firstIntroCam, firstOptions, true, false, (x, i) => { this.window.setNotSaved(); this.data.firstIntroCam = x })\r\n\r\n        let selectedPoints = this.data.cameras.nodes.filter(p => p.selected)\r\n\t\t\r\n\t\tlet selectionGroup = panel.addGroup(null, \"Selection:\")\r\n\t\tlet enabled = (selectedPoints.length > 0)\r\n\t\tlet multiedit = (selectedPoints.length > 1)\r\n\r\n\t\tif (selectedPoints.length == 1)\r\n\t\t{\r\n\t\t\tlet i = this.data.cameras.nodes.findIndex(p => p === selectedPoints[0])\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>CAME Index:</strong> \" + i.toString() + \" (0x\" + i.toString(16) + \")\")\r\n\t\t}\r\n\r\n        let typeOptions =\r\n\t\t[\r\n\t\t\t{ str: \"Goal\", value: 0 },\r\n\t\t\t{ str: \"FixSearch\", value: 1 },\r\n            { str: \"PathSearch\", value: 2 },\r\n            { str: \"KartFollow\", value: 3 },\r\n            { str: \"KartPathFollow\", value: 4 },\r\n            { str: \"OP_FixMoveAt\", value: 5 },\r\n            { str: \"OP_PathMoveAt\", value: 6 },\r\n            { str: \"MiniGame\", value: 7 },\r\n            { str: \"MissionSuccess\", value: 8 },\r\n            { str: \"Unknown\", value: 9 },\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(selectionGroup, \"Type\", selectedPoints.map(p => p.type), typeOptions, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].type = x; this.refresh() })\r\n\t\t\r\n        let nextOptions = [{ str: \"None\", value: 0xff }]\r\n\t\tfor (let i = 0; i < this.data.cameras.nodes.length; i++)\r\n            nextOptions.push({ str: \"Camera \" + i + \" (0x\" + i.toString(16) + \")\", value: i })\r\n\t\tpanel.addSelectionDropdown(selectionGroup, \"Next Camera\", selectedPoints.map(p => p.nextCam), nextOptions, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].nextCam = x })\r\n\r\n        let routeOptions = [{ str: \"None\", value: 0xff }]\r\n\t\tfor (let i = 0; i < this.data.routes.length; i++)\r\n\t\t\trouteOptions.push({ str: \"Route \" + i + \" (0x\" + i.toString(16) + \")\", value: i })\r\n\t\tpanel.addSelectionDropdown(selectionGroup, \"Route\", selectedPoints.map(p => p.routeIndex), routeOptions, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].routeIndex = x })\r\n\t\t\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,       \"X\", -1000000, 1000000, selectedPoints.map(p =>  p.pos.x),       null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.x = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,       \"Y\", -1000000, 1000000, selectedPoints.map(p => -p.pos.z),       null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.z = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,       \"Z\", -1000000, 1000000, selectedPoints.map(p => -p.pos.y),       null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.y = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,  \"Rot. X\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.x),  null, 1.0,   enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.x = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,  \"Rot. Y\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.y),  null, 1.0,   enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.y = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,  \"Rot. Z\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.z),  null, 1.0,   enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.z = x % 360 }, x => { return x % 360 })\r\n\t\t\r\n        panel.addSelectionNumericInput(selectionGroup, \"Time\", 0, 1000000, selectedPoints.map(p => p.time), null, 10.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].time = x })\r\n\t\t\r\n        panel.addSelectionNumericInput(selectionGroup, \"Point Speed\", 0, 0xffff, selectedPoints.map(p => p.vCam),  1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].vCam = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Zoom Speed\",  0, 0xffff, selectedPoints.map(p => p.vZoom), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].vZoom = x })\r\n        panel.addSelectionNumericInput(selectionGroup, \"View Speed\",  0, 0xffff, selectedPoints.map(p => p.vView), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].vView = x })\r\n        \r\n        panel.addSelectionNumericInput(selectionGroup, \"Zoom Start\", -1000000, 1000000, selectedPoints.map(p => p.zoomStart), null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].zoomStart = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Zoom End\",   -1000000, 1000000, selectedPoints.map(p => p.zoomEnd),   null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].zoomEnd   = x % 360 }, x => { return x % 360 })\r\n\t\t\r\n        panel.addSelectionNumericInput(selectionGroup, \"View Start X\", -1000000, 1000000, selectedPoints.map(p =>  p.viewPosStart.x), null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].viewPosStart.x = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"View Start Y\", -1000000, 1000000, selectedPoints.map(p => -p.viewPosStart.z), null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].viewPosStart.z = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"View Start Z\", -1000000, 1000000, selectedPoints.map(p => -p.viewPosStart.y), null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].viewPosStart.y = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,   \"View End X\", -1000000, 1000000, selectedPoints.map(p =>  p.viewPosEnd.x),   null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].viewPosEnd.x = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,   \"View End Y\", -1000000, 1000000, selectedPoints.map(p => -p.viewPosEnd.z),   null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].viewPosEnd.z = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,   \"View End Z\", -1000000, 1000000, selectedPoints.map(p => -p.viewPosEnd.y),   null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].viewPosEnd.y = -x })\r\n\t\t\r\n        panel.addSelectionNumericInput(selectionGroup, \"Shake(?)\",  0, 0xff, selectedPoints.map(p => p.shake), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].shake = x })\r\n        panel.addSelectionNumericInput(selectionGroup, \"Start(?)\",  0, 0xff, selectedPoints.map(p => p.start), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].start = x })\r\n        panel.addSelectionNumericInput(selectionGroup, \"Movie(?)\",  0, 0xff, selectedPoints.map(p => p.movie), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].movie = x })\r\n    }\r\n\r\n\r\n    refresh()\r\n\t{\r\n\t\tsuper.refresh()\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\r\n\r\n    toggleAllSelectionByType()\r\n\t{\r\n\t\tlet selectedPoints = this.data.cameras.nodes.filter(p => p.selected)\r\n\t\t\r\n\t\tfor (let point of this.data.cameras.nodes)\r\n\t\t\tpoint.selected = (selectedPoints.find(p => p.type == point.type) != null)\r\n\t\t\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\r\n\r\n    onKeyDown(ev)\r\n\t{\r\n\t\tif (super.onKeyDown(ev))\r\n\t\t\treturn true\r\n\t\t\r\n\t\tswitch (ev.key)\r\n\t\t{\r\n\t\t\tcase \"T\":\r\n\t\t\tcase \"t\":\r\n\t\t\t\tthis.toggleAllSelectionByType()\r\n\t\t\t\treturn true\r\n\t\t}\r\n\t\t\r\n\t\treturn false\r\n\t}\r\n\r\n\r\n    drawAfterModel()\r\n\t{\r\n\t\tfor (let point of this.data.cameras.nodes)\r\n\t\t{\r\n\t\t\tlet scale = (this.hoveringOverPoint == point ? 1.5 : 1) * this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tpoint.renderer\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([0.5, 0.1, 0.7, 1])\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelected\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([0.7, 0.1, 1, 1])\r\n\t\t\t\t.setEnabled(point.selected)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelectedCore\r\n\t\t\t\t.setDiffuseColor([0.5, 0.1, 0.7, 1])\r\n\t\t\t\t\r\n            let pointScale = Mat4.scale(scale, scale / 1.5, scale / 1.5)\r\n            let matrixDirection =\r\n\t\t\t\tMat4.rotation(new Vec3(0, 0, 1), 90 * Math.PI / 180)\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(1, 0, 0), point.rotation.x * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 0, 1), -point.rotation.y * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 1, 0), -point.rotation.z * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.translation(point.pos.x, point.pos.y, point.pos.z))\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirection\r\n\t\t\t\t.setCustomMatrix(pointScale.mul(matrixDirection))\r\n\t\t\t\t.setDiffuseColor([0.7, 0.1, 1, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionArrow\r\n\t\t\t\t.setCustomMatrix(pointScale.mul(matrixDirection))\r\n\t\t\t\t.setDiffuseColor([0.5, 0.1, 0.8, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionUp\r\n\t\t\t\t.setCustomMatrix(pointScale.mul(matrixDirection))\r\n\t\t\t\t.setDiffuseColor([0.75, 0.1, 1, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t}\r\n\t\t\r\n\t\tthis.scene.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t\tthis.sceneAfter.clearDepth(this.viewer.gl)\r\n\t\tthis.sceneAfter.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { ViewerCameras }", "const { GfxScene, GfxCamera, GfxMaterial, GfxModel, GfxNodeRenderer, GfxNodeRendererTransform } = require(\"../gl/scene.js\")\r\nconst { PointViewer } = require(\"./pointViewer.js\")\r\nconst { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\nconst { Geometry } = require(\"../math/geometry.js\")\r\n\r\n\r\nclass ViewerRespawnPoints extends PointViewer\r\n{\r\n\tconstructor(window, viewer, data)\r\n\t{\r\n\t\tsuper(window, viewer, data)\r\n\t\t\r\n\t\tthis.modelPlayerPos = new ModelBuilder()\r\n\t\t\t//.addCone(-80, -80, -125, 80, 80, 125, 8, new Vec3(1, 0, 0))\r\n\t\t\t.addSphere(-60, -60, -60, 60, 60, 60)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t}\r\n\t\r\n\t\r\n\tpoints()\r\n\t{\r\n\t\treturn this.data.respawnPoints\r\n\t}\r\n\t\r\n\t\r\n\trefreshPanels()\r\n\t{\r\n\t\tlet panel = this.window.addPanel(\"Respawn Points\", false, (open) => { if (open) this.viewer.setSubviewer(this) })\r\n\t\tthis.panel = panel\r\n\t\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Click:</strong> Create Point\")\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Drag Point:</strong> Duplicate Point\")\r\n\t\tpanel.addText(null, \"<strong>Hold Ctrl:</strong> Multiselect\")\r\n\r\n\t\tpanel.addCheckbox(null, \"Draw rotation guides\", this.viewer.cfg.enableRotationRender, (x) => this.viewer.cfg.enableRotationRender = x)\r\n\t\tpanel.addCheckbox(null, \"Draw player respawn positions\", this.viewer.cfg.respawnsEnablePlayerSlots, (x) => this.viewer.cfg.respawnsEnablePlayerSlots = x)\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tpanel.addButton(null, \"(A) Select/Unselect All\", () => this.toggleAllSelection())\r\n\t\tpanel.addButton(null, \"(X) Delete Selected\", () => this.deleteSelectedPoints())\r\n\t\tpanel.addButton(null, \"(Y) Snap To Collision Y\", () => this.snapSelectedToY())\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tlet selectedPoints = this.data.respawnPoints.nodes.filter(p => p.selected)\r\n\t\t\r\n\t\tlet selectionGroup = panel.addGroup(null, \"Selection:\")\r\n\t\tlet enabled = (selectedPoints.length > 0)\r\n\t\tlet multiedit = (selectedPoints.length > 1)\r\n\r\n\t\tif (selectedPoints.length == 1)\r\n\t\t{\r\n\t\t\tlet i = this.data.respawnPoints.nodes.findIndex(p => p === selectedPoints[0])\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>JGPT Index:</strong> \" + i.toString() + \" (0x\" + i.toString(16) + \")\")\r\n\t\t}\r\n\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,      \"X\", -1000000, 1000000, selectedPoints.map(p =>  p.pos.x),     null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.x = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,      \"Y\", -1000000, 1000000, selectedPoints.map(p => -p.pos.z),     null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.z = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,      \"Z\", -1000000, 1000000, selectedPoints.map(p => -p.pos.y),     null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.y = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Rot. X\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.x),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.x = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Rot. Y\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.y),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.y = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Rot. Z\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.z),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.z = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,     \"ID\",        0,  0xffff, selectedPoints.map(p =>  p.id),          null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].id = x })\r\n\t\t\r\n\t\tconst toSoundTrig   = (soundData) => { if (soundData == 0xffff) return -1; else return ((soundData - 199) / 100) | 0 }\r\n\t\tconst fromSoundTrig = (soundTrig) => { if (soundTrig == -1) return 0xffff; else return (soundTrig * 100) + 199 }\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Sound Trig.\", -1, 7, selectedPoints.map(p => toSoundTrig(p.soundData)), 1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].soundData = fromSoundTrig(x) })\r\n\t}\r\n\t\r\n\t\r\n\trefresh()\r\n\t{\r\n\t\tsuper.refresh()\r\n\t\t\r\n\t\tfor (let point of this.data.respawnPoints.nodes)\r\n\t\t{\r\n\t\t\tpoint.rendererPlayerPositions = []\r\n\r\n\t\t\tfor (let i = 0; i < 12; i++)\r\n\t\t\t{\r\n\t\t\t\tlet rPlayerPos = new GfxNodeRendererTransform()\r\n\t\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t\t.setModel(this.modelPlayerPos)\r\n\t\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\r\n\t\t\t\tpoint.rendererPlayerPositions.push(rPlayerPos)\r\n\t\t\t\tthis.renderers.push(rPlayerPos)\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\r\n\tdeleteSelectedPoints()\r\n\t{\r\n\t\tlet pointsToDelete = []\r\n\t\t\r\n\t\tfor (let point of this.points().nodes)\r\n\t\t{\r\n\t\t\tif (!point.selected)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tpointsToDelete.push(point)\r\n\t\t}\r\n\t\t\r\n\t\tfor (let point of pointsToDelete)\r\n\t\t{\r\n\t\t\tthis.data.removeRespawnPointLinks(point)\r\n\t\t\tthis.points().removeNode(point)\r\n\t\t}\r\n\t\t\r\n\t\tthis.refresh()\r\n\t\tthis.window.setNotSaved()\r\n\t\tthis.window.setUndoPoint()\r\n\t}\r\n\r\n\t\r\n\tdrawAfterModel()\r\n\t{\r\n\t\tfor (let point of this.data.respawnPoints.nodes)\r\n\t\t{\r\n\t\t\tlet scale = (this.hoveringOverPoint == point ? 1.5 : 1) * this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tpoint.renderer\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([0.55, 0.55, 0, 1])\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelected\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([0.95, 0.95, 0, 1])\r\n\t\t\t\t.setEnabled(point.selected)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelectedCore\r\n\t\t\t\t.setDiffuseColor([0.55, 0.55, 0, 1])\r\n\t\t\t\r\n\t\t\tlet matrixScale = Mat4.scale(scale, scale / 1.5, scale / 1.5)\r\n\t\t\tlet matrixDirection =\r\n\t\t\t\tMat4.rotation(new Vec3(0, 0, 1), 90 * Math.PI / 180)\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(1, 0, 0), point.rotation.x * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 0, 1), -point.rotation.y * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 1, 0), -point.rotation.z * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.translation(point.pos.x, point.pos.y, point.pos.z))\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirection\r\n\t\t\t\t.setCustomMatrix(matrixScale.mul(matrixDirection))\r\n\t\t\t\t.setDiffuseColor([0.85, 0.85, 0, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionArrow\r\n\t\t\t\t.setCustomMatrix(matrixScale.mul(matrixDirection))\r\n\t\t\t\t.setDiffuseColor([0.75, 0.75, 0, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionUp\r\n\t\t\t\t.setCustomMatrix(matrixScale.mul(matrixDirection))\r\n\t\t\t\t.setDiffuseColor([0.5, 0.5, 0, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\r\n\t\t\tlet k = 0\r\n\t\t\tfor (let i = -600; i <= 0; i += 300)\r\n\t\t\t\tfor (let j = -450; j <= 450; j += 300)\r\n\t\t\t\t{\r\n\t\t\t\t\tpoint.rendererPlayerPositions[k]\r\n\t\t\t\t\t\t.setCustomMatrix(Mat4.translation(i, j, 0).mul(matrixDirection).mul(Mat4.translation(0, 0, -550)))\r\n\t\t\t\t\t\t.setDiffuseColor([0.75, 0.75, 0, 1])\r\n\t\t\t\t\t\t.setEnabled(this.viewer.cfg.respawnsEnablePlayerSlots)\r\n\t\t\t\t\tk++\r\n\t\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.scene.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t\tthis.sceneAfter.clearDepth(this.viewer.gl)\r\n\t\tthis.sceneAfter.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { ViewerRespawnPoints }", "const { GfxScene, GfxCamera, GfxMaterial, GfxModel, GfxNodeRenderer, GfxNodeRendererTransform } = require(\"../gl/scene.js\")\r\nconst { PointViewer } = require(\"./pointViewer.js\")\r\nconst { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\nconst { Geometry } = require(\"../math/geometry.js\")\r\n\r\n\r\nclass ViewerCannonPoints extends PointViewer\r\n{\r\n\tconstructor(window, viewer, data)\r\n\t{\r\n\t\tsuper(window, viewer, data)\r\n\t\t\t\r\n\t\tlet panelColor = [1, 0.5, 0.5, 1]\r\n\t\tthis.modelPanel = new ModelBuilder()\r\n\t\t\t.addQuad(new Vec3(0, 0, 1), new Vec3(1, 0, 1), new Vec3(1, 0, -1), new Vec3(0, 0, -1), panelColor, panelColor, panelColor, panelColor)\r\n\t\t\t.addQuad(new Vec3(0, 0, -1), new Vec3(1, 0, -1), new Vec3(1, 0, 1), new Vec3(0, 0, 1), panelColor, panelColor, panelColor, panelColor)\r\n\t\t\t.calculateNormals()\r\n\t\t\t.makeModel(viewer.gl)\r\n\t}\r\n\r\n\r\n\tpoints()\r\n\t{\r\n\t\treturn this.data.cannonPoints\r\n\t}\r\n\t\r\n\t\r\n\trefreshPanels()\r\n\t{\r\n\t\tlet panel = this.window.addPanel(\"Cannon Points\", false, (open) => { if (open) this.viewer.setSubviewer(this) })\r\n\t\tthis.panel = panel\r\n\r\n\t\tlet selectedPoints = this.data.cannonPoints.nodes.filter(p => p.selected)\r\n\t\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Click:</strong> Create Point\")\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Drag Point:</strong> Duplicate Point\")\r\n\t\tpanel.addText(null, \"<strong>Hold Ctrl:</strong> Multiselect\")\r\n\r\n\t\tpanel.addCheckbox(null, \"Draw rotation guides\", this.viewer.cfg.enableRotationRender, (x) => this.viewer.cfg.enableRotationRender = x)\r\n\t\tpanel.addCheckbox(null, \"Draw backwards Y rotation guides\", this.viewer.cfg.cannonsEnableDirectionRender, (x) => this.viewer.cfg.cannonsEnableDirectionRender = x)\r\n\t\tpanel.addCheckbox(null, \"Highlight selected trigger KCL\", this.viewer.cfg.cannonsEnableKclHighlight, (x) => { \r\n\t\t\tthis.viewer.cfg.cannonsEnableKclHighlight = x\r\n\t\t\tif (selectedPoints.length == 1)\r\n\t\t\t{\r\n\t\t\t\tlet selectedIndex = this.data.cannonPoints.nodes.findIndex(p => p === selectedPoints[0])\r\n\t\t\t\tthis.window.hl.reset()\r\n\t\t\t\tthis.window.hl.baseType = x ? 0x11 : -1\r\n\t\t\t\tthis.window.hl.basicEffect = x ? selectedIndex : -1\r\n\t\t\t\tthis.window.openKcl(this.window.currentKclFilename)\r\n\t\t\t\tthis.highlighting = true\r\n\t\t\t}\r\n\t\t})\r\n\t\tpanel.addSpacer(null)\r\n\t\t\r\n\t\tpanel.addButton(null, \"(A) Select/Unselect All\", () => this.toggleAllSelection())\r\n\t\tpanel.addButton(null, \"(X) Delete Selected\", () => this.deleteSelectedPoints())\r\n\t\tpanel.addButton(null, \"(Y) Snap To Collision Y\", () => this.snapSelectedToY())\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tlet selectionGroup = panel.addGroup(null, \"Selection:\")\r\n\t\tlet enabled = (selectedPoints.length > 0)\r\n\t\tlet multiedit = (selectedPoints.length > 1)\r\n\t\t\r\n\t\tif (selectedPoints.length == 1)\r\n\t\t{\r\n\t\t\tlet selectedIndex = this.data.cannonPoints.nodes.findIndex(p => p === selectedPoints[0])\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>CNPT Index:</strong> \" + selectedIndex + \" (0x\" + selectedIndex.toString(16) + \")\")\r\n\r\n\t\t\tif (this.viewer.cfg.cannonsEnableKclHighlight)\r\n\t\t\t{\r\n\t\t\t\tthis.window.hl.reset()\r\n\t\t\t\tthis.window.hl.baseType = 0x11\r\n\t\t\t\tthis.window.hl.basicEffect = selectedIndex\r\n\t\t\t\tthis.window.openKcl(this.window.currentKclFilename)\r\n\t\t\t\tthis.highlighting = true\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (this.highlighting)\r\n\t\t{\r\n\t\t\tthis.window.hl.reset()\r\n\t\t\tthis.window.openKcl(this.window.currentKclFilename)\r\n\t\t\tthis.highlighting = false\r\n\t\t}\r\n\t\t\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Dest. X\", -1000000, 1000000, selectedPoints.map(p =>  p.pos.x),     null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.x = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Dest. Y\", -1000000, 1000000, selectedPoints.map(p => -p.pos.z),     null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.z = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Dest. Z\", -1000000, 1000000, selectedPoints.map(p => -p.pos.y),     null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.y = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,  \"Rot. X\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.x),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.x = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,  \"Rot. Y\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.y),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.y = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,  \"Rot. Z\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.z),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.z = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,      \"ID\",        0,  0xffff, selectedPoints.map(p =>  p.id),           1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].id = x })\r\n\t\t\r\n\t\tlet effectOptions =\r\n\t\t[\r\n\t\t\t{ str: \"Fast, Straight Line\", value: 0 },\r\n\t\t\t{ str: \"Curved\", value: 1 },\r\n\t\t\t{ str: \"Curved (and Slow?)\", value: 2 },\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(selectionGroup, \"Effect\", selectedPoints.map(p => p.effect), effectOptions, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].effect = x })\r\n\t}\r\n\t\r\n\t\r\n\trefresh()\r\n\t{\r\n\t\tsuper.refresh()\r\n\r\n\t\tfor (let point of this.data.cannonPoints.nodes)\r\n\t\t{\r\n\t\t\tpoint.rendererPanel = new GfxNodeRendererTransform()\r\n\t\t\t\t.attach(this.scene.root)\r\n\t\t\t\t.setModel(this.modelPanel)\r\n\t\t\t\t.setMaterial(this.viewer.material)\r\n\t\t\t\t\r\n\t\t\tthis.renderers.push(point.rendererPanel)\r\n\t\t}\r\n\t\t\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\t\r\n\tdrawAfterModel()\r\n\t{\r\n\t\tfor (let point of this.data.cannonPoints.nodes)\r\n\t\t{\r\n\t\t\tlet scale = (this.hoveringOverPoint == point ? 1.5 : 1) * this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tpoint.renderer\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([1, 0, 0, 1])\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelected\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([1, 0.5, 0.5, 1])\r\n\t\t\t\t.setEnabled(point.selected)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelectedCore\r\n\t\t\t\t.setDiffuseColor([1, 0, 0, 1])\r\n\t\t\t\t\r\n\t\t\tlet matrixDirection =\r\n\t\t\t\tMat4.scale(scale, scale / 1.5, scale / 1.5)\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 0, 1), 90 * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(1, 0, 0), point.rotation.x * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 0, 1), -point.rotation.y * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 1, 0), -point.rotation.z * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.translation(point.pos.x, point.pos.y, point.pos.z))\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirection\r\n\t\t\t\t.setCustomMatrix(matrixDirection)\r\n\t\t\t\t.setDiffuseColor([1, 0.75, 0.75, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionArrow\r\n\t\t\t\t.setCustomMatrix(matrixDirection)\r\n\t\t\t\t.setDiffuseColor([1, 0, 0, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionUp\r\n\t\t\t\t.setCustomMatrix(matrixDirection)\r\n\t\t\t\t.setDiffuseColor([1, 0.25, 0.25, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tif (point.selected && this.viewer.cfg.cannonsEnableDirectionRender)\r\n\t\t\t{\r\n\t\t\t\tlet matrixScale = Mat4.scale(1000000, 1, 100000)\r\n\t\t\t\tlet matrixAlign = Mat4.rotation(new Vec3(0, 0, 1), (-90 - point.rotation.y) * Math.PI / 180)\r\n\t\t\t\tlet matrixTranslate = Mat4.translation(point.pos.x, point.pos.y, point.pos.z)\r\n\t\t\t\t\r\n\t\t\t\tpoint.rendererPanel\r\n\t\t\t\t\t.setCustomMatrix(matrixScale.mul(matrixAlign.mul(matrixTranslate)))\r\n\t\t\t\t\t//.setTranslation(point.pos)\r\n\t\t\t\t\t//.setScaling(new Vec3(100000, 1, 100000))\r\n\t\t\t\t\t//.setRotation(new Vec3(0, 0, 1), point.rotation.y * Math.PI / 180)\r\n\t\t\t\t\t.setDiffuseColor([1, 0.5, 0.5, 0.5])\r\n\t\t\t\t\t.setEnabled(true)\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tpoint.rendererPanel.setEnabled(false)\r\n\t\t}\r\n\t\t\r\n\t\tthis.scene.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t\tthis.sceneAfter.clearDepth(this.viewer.gl)\r\n\t\tthis.sceneAfter.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { ViewerCannonPoints }", "const { GfxScene, GfxCamera, GfxMaterial, GfxModel, GfxNodeRenderer, GfxNodeRendererTransform } = require(\"../gl/scene.js\")\r\nconst { PointViewer } = require(\"./pointViewer.js\")\r\nconst { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\nconst { Geometry } = require(\"../math/geometry.js\")\r\n\r\n\r\nclass ViewerFinishPoints extends PointViewer\r\n{\r\n\tconstructor(window, viewer, data)\r\n\t{\r\n\t\tsuper(window, viewer, data)\r\n\t}\r\n\t\r\n\t\r\n\tpoints()\r\n\t{\r\n\t\treturn this.data.finishPoints\r\n\t}\r\n\t\r\n\t\r\n\trefreshPanels()\r\n\t{\r\n\t\tlet panel = this.window.addPanel(\"Battle Finish Points\", false, (open) => { if (open) this.viewer.setSubviewer(this) })\r\n\t\tthis.panel = panel\r\n\t\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Click:</strong> Create Point\")\r\n\t\tpanel.addText(null, \"<strong>Hold Alt + Drag Point:</strong> Duplicate Point\")\r\n\t\tpanel.addText(null, \"<strong>Hold Ctrl:</strong> Multiselect\")\r\n\r\n\t\tpanel.addCheckbox(null, \"Draw rotation guides\", this.viewer.cfg.enableRotationRender, (x) => this.viewer.cfg.enableRotationRender = x)\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tpanel.addButton(null, \"(A) Select/Unselect All\", () => this.toggleAllSelection())\r\n\t\tpanel.addButton(null, \"(X) Delete Selected\", () => this.deleteSelectedPoints())\r\n\t\tpanel.addButton(null, \"(Y) Snap To Collision Y\", () => this.snapSelectedToY())\r\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tlet selectedPoints = this.data.finishPoints.nodes.filter(p => p.selected)\r\n\t\t\r\n\t\tlet selectionGroup = panel.addGroup(null, \"Selection:\")\r\n\t\tlet enabled = (selectedPoints.length > 0)\r\n\t\tlet multiedit = (selectedPoints.length > 1)\r\n\r\n\t\tif (selectedPoints.length == 1)\r\n\t\t{\r\n\t\t\tlet i = this.data.finishPoints.nodes.findIndex(p => p === selectedPoints[0])\r\n\t\t\tpanel.addText(selectionGroup, \"<strong>MSPT Index:</strong> \" + i.toString() + \" (0x\" + i.toString(16) + \")\")\r\n\t\t}\r\n\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,      \"X\", -1000000, 1000000, selectedPoints.map(p =>  p.pos.x),     null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.x = x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,      \"Y\", -1000000, 1000000, selectedPoints.map(p => -p.pos.z),     null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.z = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,      \"Z\", -1000000, 1000000, selectedPoints.map(p => -p.pos.y),     null, 100.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].pos.y = -x })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Rot. X\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.x),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.x = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Rot. Y\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.y),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.y = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup, \"Rot. Z\", -1000000, 1000000, selectedPoints.map(p =>  p.rotation.z),  null, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].rotation.z = x % 360 }, x => { return x % 360 })\r\n\t\tpanel.addSelectionNumericInput(selectionGroup,     \"ID\",        0,  0xffff, selectedPoints.map(p =>  p.id),           1.0, 1.0, enabled, multiedit, (x, i) => { this.window.setNotSaved(); selectedPoints[i].id = x })\r\n\t}\r\n\t\r\n\t\r\n\trefresh()\r\n\t{\r\n\t\tsuper.refresh()\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\t\r\n\tdrawAfterModel()\r\n\t{\r\n\t\tfor (let point of this.data.finishPoints.nodes)\r\n\t\t{\r\n\t\t\tlet scale = (this.hoveringOverPoint == point ? 1.5 : 1) * this.viewer.getElementScale(point.pos)\r\n\t\t\t\r\n\t\t\tpoint.renderer\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([0.5, 0, 1, 1])\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelected\r\n\t\t\t\t.setTranslation(point.pos)\r\n\t\t\t\t.setScaling(new Vec3(scale, scale, scale))\r\n\t\t\t\t.setDiffuseColor([0.75, 0.5, 1, 1])\r\n\t\t\t\t.setEnabled(point.selected)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererSelectedCore\r\n\t\t\t\t.setDiffuseColor([0.5, 0, 1, 1])\r\n\t\t\t\t\r\n\t\t\tlet matrixDirection =\r\n\t\t\t\tMat4.scale(scale, scale / 1.5, scale / 1.5)\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 0, 1), 90 * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(1, 0, 0), point.rotation.x * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 0, 1), -point.rotation.y * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.rotation(new Vec3(0, 1, 0), -point.rotation.z * Math.PI / 180))\r\n\t\t\t\t.mul(Mat4.translation(point.pos.x, point.pos.y, point.pos.z))\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirection\r\n\t\t\t\t.setCustomMatrix(matrixDirection)\r\n\t\t\t\t.setDiffuseColor([0.87, 0.75, 1, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionArrow\r\n\t\t\t\t.setCustomMatrix(matrixDirection)\r\n\t\t\t\t.setDiffuseColor([0.5, 0, 1, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t\t\t\r\n\t\t\tpoint.rendererDirectionUp\r\n\t\t\t\t.setCustomMatrix(matrixDirection)\r\n\t\t\t\t.setDiffuseColor([0.5, 0.25, 1, 1])\r\n\t\t\t\t.setEnabled(this.viewer.cfg.enableRotationRender)\r\n\t\t}\r\n\t\t\r\n\t\tthis.scene.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t\tthis.sceneAfter.clearDepth(this.viewer.gl)\r\n\t\tthis.sceneAfter.render(this.viewer.gl, this.viewer.getCurrentCamera())\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { ViewerFinishPoints }", "\r\n\r\nclass ViewerTrackInformation\r\n{\r\n\tconstructor(window, viewer, data)\r\n\t{\r\n\t\tthis.window = window\r\n\t\tthis.viewer = viewer\r\n\t\tthis.data = data\r\n\t}\r\n\t\r\n\t\r\n\tsetData(data)\r\n\t{\r\n\t\tthis.data = data\r\n\t\tthis.refresh()\r\n\t}\r\n\t\r\n\t\r\n\tdestroy()\r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\trefreshPanels()\r\n\t{\r\n\t\tlet panel = this.window.addPanel(\"Track Info\", false, (open) => { if (open) this.viewer.setSubviewer(this) })\r\n\t\tthis.panel = panel\r\n\t\t\r\n\t\tpanel.addSpacer(null)\r\n\t\t\r\n\t\tlet trackModeOptions =\r\n\t\t[\r\n\t\t\t{ str: \"Race\", value: false },\r\n\t\t\t{ str: \"Battle\", value: true }\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(null, \"Course Type\", this.viewer.cfg.isBattleTrack, trackModeOptions, true, false, (x) => { this.window.setNotSaved(); this.viewer.cfg.isBattleTrack = x; this.viewer.refreshPanels() })\r\n\t\t\r\n\t\tpanel.addSelectionNumericInput(null, \"Lap Count\", 1, 9, this.data.trackInfo.lapCount, 1.0, 1.0, true, false, (x) => { this.window.setNotSaved(); this.data.trackInfo.lapCount = x })\r\n\r\n\t\tconst convertFloat32MSB2 = (x) =>\r\n\t\t{\r\n\t\t\tlet view = new DataView(new ArrayBuffer(4))\r\n\t\t\tview.setFloat32(0, x)\r\n\t\t\tview.setUint8(2, 0)\r\n\t\t\tview.setUint8(3, 0)\r\n\r\n\t\t\treturn view.getFloat32(0)\r\n\t\t}\r\n\t\tpanel.addSelectionNumericInput(null, \"Speed Mod.\", 0, 99999, this.data.trackInfo.speedMod, null, 0.1, true, false, (x) => { this.window.setNotSaved(); this.data.trackInfo.speedMod = convertFloat32MSB2(x) }, convertFloat32MSB2)\r\n\r\n\t\tlet flareGroup = panel.addGroup(null, \"Lens Flare:\")\r\n\t\r\n\t\tpanel.addSelectionNumericInput(flareGroup, \"Red\", 0, 255, this.data.trackInfo.flareColor[0], 1.0, 1.0, true, false, (x) => { this.window.setNotSaved(); this.data.trackInfo.flareColor[0] = x })\r\n\t\tpanel.addSelectionNumericInput(flareGroup, \"Green\", 0, 255, this.data.trackInfo.flareColor[1], 1.0, 1.0, true, false, (x) => { this.window.setNotSaved(); this.data.trackInfo.flareColor[1] = x })\r\n\t\tpanel.addSelectionNumericInput(flareGroup, \"Blue\", 0, 255, this.data.trackInfo.flareColor[2], 1.0, 1.0, true, false, (x) => { this.window.setNotSaved(); this.data.trackInfo.flareColor[2] = x })\r\n\t\tpanel.addSelectionNumericInput(flareGroup, \"Alpha\", 0, 255, this.data.trackInfo.flareColor[3], 1.0, 1.0, true, false, (x) => { this.window.setNotSaved(); this.data.trackInfo.flareColor[3] = x })\r\n\t\t\r\n\t\tlet lensFlareOptions =\r\n\t\t[\r\n\t\t\t{ str: \"Disabled\", value: 0 },\r\n\t\t\t{ str: \"Enabled\", value: 1 }\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(flareGroup, \"Flashing\", this.data.trackInfo.lensFlareFlash, lensFlareOptions, true, false, (x) => { this.window.setNotSaved(); this.data.trackInfo.lensFlareFlash = x; this.refreshPanels() })\r\n\t}\r\n\t\r\n\t\r\n\trefresh()\r\n\t{\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\t\r\n\tonKeyDown(ev)\r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\tonMouseDown(ev, x, y, cameraPos, ray, hit, distToHit, mouse3DPos)\r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\tonMouseMove(ev, x, y, cameraPos, ray, hit, distToHit)\r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\tonMouseUp(ev, x, y)\r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\tdrawAfterModel()\r\n\t{\r\n\t\t\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { ViewerTrackInformation }", "const { GLProgram } = require(\"../gl/shader.js\")\r\nconst { GfxScene, GfxCamera, GfxMaterial, GfxModel, GfxNodeRenderer, GfxNodeRendererTransform } = require(\"../gl/scene.js\")\r\nconst { ViewerStartPoints } = require(\"./viewerStartPoints.js\")\r\nconst { ViewerEnemyPaths } = require(\"./viewerEnemyPaths.js\")\r\nconst { ViewerItemPaths } = require(\"./viewerItemPaths.js\")\r\nconst { ViewerCheckpoints } = require(\"./viewerCheckpoints.js\")\r\nconst { ViewerObjects } = require(\"./viewerObjects.js\")\r\nconst { ViewerRoutes } = require(\"./viewerRoutes.js\")\r\nconst { ViewerAreas } = require(\"./viewerAreas.js\")\r\nconst { ViewerCameras } = require(\"./viewerCameras.js\")\r\nconst { ViewerRespawnPoints } = require(\"./viewerRespawnPoints.js\")\r\nconst { ViewerCannonPoints } = require(\"./viewerCannonPoints.js\")\r\nconst { ViewerFinishPoints } = require(\"./viewerFinishPoints.js\")\r\nconst { ViewerTrackInformation } = require(\"./viewerTrackInformation.js\")\r\nconst { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\nconst { Mat4 } = require(\"../math/mat4.js\")\r\n\r\n\r\nclass Viewer\r\n{\r\n\tconstructor(mainWindow, canvas, cfg, data)\r\n\t{\r\n\t\tthis.window = mainWindow\r\n\t\tthis.cfg = cfg\r\n\t\tthis.data = data\r\n\t\t\r\n\t\tthis.canvas = canvas\r\n\t\tthis.canvas.onresize = () => this.resize()\r\n\t\tthis.canvas.onmousedown = (ev) => this.onMouseDown(ev)\r\n\t\tdocument.addEventListener(\"mousemove\", (ev) => this.onMouseMove(ev))\r\n\t\tdocument.addEventListener(\"mouseup\", (ev) => this.onMouseUp(ev))\r\n\t\tdocument.addEventListener(\"mouseleave\", (ev) => this.onMouseUp(ev))\r\n\t\tthis.canvas.onwheel = (ev) => this.onMouseWheel(ev)\r\n\t\tthis.canvas.oncontextmenu = (ev) => ev.preventDefault()\r\n\t\tdocument.onkeydown = (ev) => this.onKeyDown(ev)\r\n\t\tdocument.addEventListener(\"keyup\", (ev) => this.onKeyUp(ev))\r\n\t\tglobalThis.window.addEventListener(\"blur\", () =>\r\n\t\t{\r\n\t\t\tthis.keysDown = {}\r\n\t\t\tthis.stopFlyMovementLoop()\r\n\t\t})\r\n\t\t\r\n\t\tthis.subviewer = null\r\n\t\t\r\n\t\tthis.mouseDown = false\r\n\t\tthis.mouseDownOrigin = null\r\n\t\tthis.mouseDownRaycast = null\r\n\t\tthis.mouseLastClickDate = new Date()\r\n\t\tthis.mouseAction = null\r\n\t\tthis.mouseLast = null\r\n\t\t\r\n\t\tthis.mouseMoveOffsetPixels = { x: 0, y: 0 }\r\n\t\tthis.mouseMoveOffsetPan = new Vec3(0, 0, 0)\r\n\t\tthis.mouseMoveOffsetPanDelta = new Vec3(0, 0, 0)\r\n\t\tthis.mouseMoveOffsetRaycast = new Vec3(0, 0, 0)\r\n\t\tthis.keysDown = {}\r\n\t\tthis.flyMoveAnimFrame = null\r\n\t\tthis.flyMoveLastTime = 0\r\n\t\t\r\n\t\tthis.cameraFocus = new Vec3(0, 0, 0)\r\n\t\tthis.cameraHorzAngle = Math.PI / 2\r\n\t\tthis.cameraVertAngle = 1\r\n\t\tthis.cameraDist = 10000\r\n\t\t\r\n\t\tthis.gl = canvas.getContext(\"webgl\", { stencil: true })\r\n\t\t\r\n\t\tthis.resize()\r\n\t\t\r\n\t\tthis.gl.clearColor(0, 0, 0, 1)\r\n\t\tthis.gl.clearDepth(1.0)\r\n\t\t\r\n\t\tthis.gl.enable(this.gl.DEPTH_TEST)\r\n\t\tthis.gl.enable(this.gl.CULL_FACE)\r\n\t\tthis.gl.depthFunc(this.gl.LEQUAL)\r\n\t\tthis.gl.enable(this.gl.BLEND)\r\n\t\tthis.gl.blendFunc(this.gl.SRC_ALPHA, this.gl.ONE_MINUS_SRC_ALPHA)\r\n\r\n\t\tthis.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT)\r\n\t\t\r\n\t\tthis.scene = new GfxScene()\r\n\t\t\r\n\t\tthis.material = new GfxMaterial()\r\n\t\t\t.setProgram(\r\n\t\t\t\tGLProgram.makeFromSrc(this.gl, vertexSrc, fragmentSrc)\r\n\t\t\t\t.registerLocations(this.gl, [\"aPosition\", \"aNormal\"], [\"uMatProj\", \"uMatView\", \"uMatModel\", \"uAmbientColor\", \"uDiffuseColor\"]))\r\n\t\t\t\t\r\n\t\tthis.materialColor = new GfxMaterial()\r\n\t\t\t.setProgram(\r\n\t\t\t\tGLProgram.makeFromSrc(this.gl, vertexSrcColor, fragmentSrcColor)\r\n\t\t\t\t.registerLocations(this.gl, [\"aPosition\", \"aNormal\", \"aColor\"], [\"uMatProj\", \"uMatView\", \"uMatModel\", \"uAmbientColor\", \"uDiffuseColor\", \"uFogDensity\"]))\r\n\t\t\t\t\r\n\t\tthis.materialUnshaded = new GfxMaterial()\r\n\t\t\t.setProgram(\r\n\t\t\t\tGLProgram.makeFromSrc(this.gl, vertexSrc, fragmentSrcUnshaded)\r\n\t\t\t\t.registerLocations(this.gl, [\"aPosition\", \"aNormal\"], [\"uMatProj\", \"uMatView\", \"uMatModel\", \"uDiffuseColor\"]))\r\n\t\t\t\t\r\n\t\tthis.model = null\r\n\t\tthis.collision = null\r\n\t\t\t\r\n\t\tthis.renderer = new GfxNodeRenderer()\r\n\t\t\t.attach(this.scene.root)\r\n\t\t\t.setMaterial(this.materialColor)\r\n\t\t\t.setDiffuseColor([1, 1, 1, 1])\r\n\t\t\t\r\n\t\tthis.cachedCamera = new GfxCamera()\r\n\t\tthis.cachedCameraPos = new Vec3(0, 0, 0)\r\n\r\n\t\t\t\r\n\t\tthis.enableDebugRaycast = false\r\n\r\n\t\tlet debugRaycastBuilder = new ModelBuilder()\r\n\t\t\t.addSphere(-100, -100, -100, 100, 100, 100)\r\n\t\t\t.calculateNormals()\r\n\t\t\t\r\n\t\tthis.debugRaycastRenderer = new GfxNodeRendererTransform()\r\n\t\t\t.attach(this.scene.root)\r\n\t\t\t.setModel(debugRaycastBuilder.makeModel(this.gl))\r\n\t\t\t.setMaterial(this.material)\r\n\t\t\t.setDiffuseColor([1, 0, 1, 1])\r\n\t\t\t.setEnabled(this.enableDebugRaycast)\r\n\t\t\t\r\n\t\t\t\r\n\t\tthis.subviewers =\r\n\t\t[\r\n\t\t\tnew ViewerTrackInformation(this.window, this, this.data),\r\n\t\t\tnew ViewerStartPoints(this.window, this, this.data),\r\n\t\t\tnew ViewerEnemyPaths(this.window, this, this.data),\r\n\t\t\tnew ViewerItemPaths(this.window, this, this.data),\r\n\t\t\tnew ViewerCheckpoints(this.window, this, this.data),\r\n\t\t\tnew ViewerRespawnPoints(this.window, this, this.data),\r\n\t\t\tnew ViewerObjects(this.window, this, this.data),\r\n\t\t\tnew ViewerRoutes(this.window, this, this.data),\r\n\t\t\tnew ViewerAreas(this.window, this, this.data),\r\n\t\t\tnew ViewerCameras(this.window, this, this.data),\r\n\t\t\tnew ViewerCannonPoints(this.window, this, this.data),\r\n\t\t\tnew ViewerFinishPoints(this.window, this, this.data),\r\n\t\t]\r\n\t\t\r\n\t\tthis.subviewerRoutes = this.subviewers[7]\r\n\t\t\r\n\t\tthis.currentSubviewer = this.subviewers[0]\r\n\t\t\r\n\t\tthis.render()\r\n\t}\r\n\t\r\n\t\r\n\tresize()\r\n\t{\r\n\t\tlet width = this.canvas.getBoundingClientRect().width\r\n\t\tlet height = window.innerHeight // client height may be erroneously larger to try to preserve original canvas aspect ratio\r\n\t\t\r\n\t\tthis.width = this.canvas.width = width\r\n\t\tthis.height = this.canvas.height = height\r\n\t\t\r\n\t\tthis.gl.viewport(0, 0, width, height)\r\n\t}\r\n\t\r\n\t\r\n\trefreshPanels()\r\n\t{\r\n\t\tfor (let subviewer of this.subviewers)\r\n\t\t{\r\n\t\t\tif (subviewer)\r\n\t\t\t\tsubviewer.refreshPanels()\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tsetData(data)\r\n\t{\r\n\t\tthis.data = data\r\n\t\tfor (let subviewer of this.subviewers)\r\n\t\t{\r\n\t\t\tif (subviewer)\r\n\t\t\t\tsubviewer.setData(data)\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tsetModel(modelBuilder)\r\n\t{\r\n\t\tthis.modelBuilder = modelBuilder\r\n\t\tthis.model = modelBuilder.makeModel(this.gl)\r\n\t\tif (this.renderer && this.renderer.setModel)\r\n\t\t\tthis.renderer.setModel(this.model)\r\n\t\t\r\n\t\tthis.collision = modelBuilder.makeCollision().buildCacheSubdiv()\r\n\t\t\r\n\t\tfor (let subviewer of this.subviewers)\r\n\t\t{\r\n\t\t\tif (subviewer && subviewer.setModel)\r\n\t\t\t\tsubviewer.setModel(modelBuilder)\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tsetSubviewer(subviewer)\n\t{\n\t\tif (this.currentSubviewer != null && this.currentSubviewer != subviewer)\n\t\t{\n\t\t\tthis.currentSubviewer.destroy()\r\n\t\t\tthis.currentSubviewer.panel.setOpen(false)\r\n\t\t}\r\n\t\t\r\n\t\tthis.currentSubviewer = subviewer\r\n\t\t\r\n\t\tif (this.currentSubviewer != null)\n\t\t{\n\t\t\tthis.currentSubviewer.refresh()\n\t\t\tthis.currentSubviewer.panel.setOpen(true)\n\t\t}\n\n\t\tif (this.window != null && this.window.onSubviewerChanged)\n\t\t\tthis.window.onSubviewerChanged(this.currentSubviewer)\n\t\t\n\t\tthis.render()\n\t}\n\t\r\n\t\r\n\tcenterView()\r\n\t{\r\n\t\tif (this.modelBuilder == null)\r\n\t\t\treturn\r\n\t\t\r\n\t\tlet bbox = this.modelBuilder.getSaneBoundingBox()\r\n\t\t\r\n\t\tthis.cameraFocus = new Vec3(bbox.xCenter, bbox.yCenter, bbox.zCenter)\r\n\t\tthis.cameraHorzAngle = Math.PI / 2\r\n\t\tthis.cameraVertAngle = 1\r\n\t\tthis.cameraDist = Math.max(bbox.xSize, bbox.ySize, bbox.zSize) / 2\r\n\t}\r\n\t\r\n\t\r\n\trender()\r\n\t{\r\n\t\t// Cache camera position\r\n\t\tthis.cachedCameraPos = this.cameraFocus.add(this.getCameraEyeOffset())\r\n\t\t\r\n\t\t// Cache camera\r\n\t\tif (this.cfg.useOrthoProjection)\r\n\t\t{\r\n\t\t\tlet scale = this.cameraDist / 1000\r\n\t\t\tthis.cachedCamera = new GfxCamera()\r\n\t\t\t\t.setProjection(Mat4.ortho(-this.width * scale, this.width * scale, -this.height * scale, this.height * scale, -500000, 1000000))\r\n\t\t\t\t.setView(Mat4.lookat(this.getCurrentCameraPosition(), this.cameraFocus, new Vec3(0, 0, -1)))\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.cachedCamera = new GfxCamera()\r\n\t\t\t\t.setProjection(Mat4.perspective(30 * Math.PI / 180, this.width / this.height, 100, 1000000))\r\n\t\t\t\t.setView(Mat4.lookat(this.getCurrentCameraPosition(), this.cameraFocus, new Vec3(0, 0, -1)))\r\n\t\t}\r\n\t\t\r\n\t\t// Render scene\r\n\t\tthis.scene.clear(this.gl)\r\n\t\t\r\n\t\tlet ambient = 1 - this.cfg.shadingFactor\r\n\t\tthis.material.program.use(this.gl).setVec4(this.gl, \"uAmbientColor\", [ambient, ambient, ambient, 1])\r\n\t\tthis.materialColor.program.use(this.gl).setVec4(this.gl, \"uAmbientColor\", [ambient, ambient, ambient, 1])\r\n\t\tthis.materialColor.program.use(this.gl).setFloat(this.gl, \"uFogDensity\", this.cfg.fogFactor)\r\n\t\t\r\n\t\tif (this.currentSubviewer != null && this.currentSubviewer.drawBeforeModel)\r\n\t\t\tthis.currentSubviewer.drawBeforeModel()\r\n\t\t\r\n\t\tthis.scene.render(this.gl, this.getCurrentCamera())\r\n\t\t\r\n\t\tif (this.currentSubviewer != null && this.currentSubviewer.drawAfterModel)\r\n\t\t\tthis.currentSubviewer.drawAfterModel()\r\n\t}\r\n\t\r\n\t\r\n\tgetElementScale(pos)\r\n\t{\r\n\t\tif (this.cfg.useOrthoProjection)\r\n\t\t\treturn this.cameraDist / 15000 * this.cfg.pointScale\r\n\t\telse\r\n\t\t\treturn pos.sub(this.getCurrentCameraPosition()).magn() / 20000 * this.cfg.pointScale\r\n\t}\r\n\t\r\n\t\r\n\tgetCurrentCameraPosition()\r\n\t{\r\n\t\treturn this.cachedCameraPos\r\n\t}\r\n\t\r\n\t\r\n\tgetCurrentCamera()\r\n\t{\r\n\t\treturn this.cachedCamera\r\n\t}\r\n\r\n\r\n\tgetCameraEyeOffset()\r\n\t{\r\n\t\tlet eyeZDist = Math.cos(this.cameraVertAngle)\r\n\t\treturn new Vec3(\r\n\t\t\tMath.cos(this.cameraHorzAngle) * this.cameraDist * eyeZDist,\r\n\t\t\t-Math.sin(this.cameraHorzAngle) * this.cameraDist * eyeZDist,\r\n\t\t\t-Math.sin(this.cameraVertAngle) * this.cameraDist)\r\n\t}\r\n\r\n\r\n\tisFlyMovementKey(ev)\r\n\t{\r\n\t\treturn ev.code == \"KeyW\" || ev.code == \"KeyA\" || ev.code == \"KeyS\" || ev.code == \"KeyD\" || ev.code == \"KeyQ\" || ev.code == \"KeyE\"\r\n\t}\r\n\r\n\r\n\thasFlyMovementInput()\r\n\t{\r\n\t\treturn !!(this.keysDown[\"KeyW\"] || this.keysDown[\"KeyA\"] || this.keysDown[\"KeyS\"] || this.keysDown[\"KeyD\"] || this.keysDown[\"KeyQ\"] || this.keysDown[\"KeyE\"])\r\n\t}\r\n\r\n\r\n\tstartFlyMovementLoop()\r\n\t{\r\n\t\tif (this.flyMoveAnimFrame != null)\r\n\t\t\treturn\r\n\t\t\r\n\t\tif (!this.mouseDown || this.mouseAction != \"fly\")\r\n\t\t\treturn\r\n\t\t\r\n\t\tif (!this.hasFlyMovementInput())\r\n\t\t\treturn\r\n\t\t\r\n\t\tthis.flyMoveLastTime = performance.now()\r\n\t\tthis.flyMoveAnimFrame = globalThis.window.requestAnimationFrame((time) => this.updateFlyMovementFrame(time))\r\n\t}\r\n\r\n\r\n\tstopFlyMovementLoop()\r\n\t{\r\n\t\tif (this.flyMoveAnimFrame != null)\r\n\t\t\tglobalThis.window.cancelAnimationFrame(this.flyMoveAnimFrame)\r\n\t\t\r\n\t\tthis.flyMoveAnimFrame = null\r\n\t\tthis.flyMoveLastTime = 0\r\n\t}\r\n\r\n\r\n\tupdateFlyMovementFrame(time)\r\n\t{\r\n\t\tthis.flyMoveAnimFrame = null\r\n\t\t\r\n\t\tif (!this.mouseDown || this.mouseAction != \"fly\" || !this.hasFlyMovementInput())\r\n\t\t\treturn\r\n\t\t\r\n\t\tlet dt = (time - this.flyMoveLastTime) / 1000\r\n\t\tthis.flyMoveLastTime = time\r\n\t\tdt = Math.max(0.001, Math.min(0.05, dt))\r\n\t\t\r\n\t\tif (this.moveFlyCamera(dt))\r\n\t\t\tthis.render()\r\n\t\t\r\n\t\tthis.flyMoveAnimFrame = globalThis.window.requestAnimationFrame((nextTime) => this.updateFlyMovementFrame(nextTime))\r\n\t}\r\n\r\n\r\n\tmoveFlyCamera(dt)\r\n\t{\r\n\t\tlet worldUp = new Vec3(0, 0, -1)\r\n\t\tlet cameraPos = this.getCurrentCameraPosition()\r\n\t\tlet forward = this.cameraFocus.sub(cameraPos)\r\n\t\t\r\n\t\tif (forward.magn() <= 0.0001)\r\n\t\t\treturn false\r\n\t\t\r\n\t\tforward = forward.normalize()\r\n\t\tlet right = worldUp.cross(forward)\r\n\t\t\r\n\t\tif (right.magn() <= 0.0001)\r\n\t\t\tright = new Vec3(Math.sin(this.cameraHorzAngle), Math.cos(this.cameraHorzAngle), 0)\r\n\t\telse\r\n\t\t\tright = right.normalize()\r\n\t\t\r\n\t\tlet move = new Vec3(0, 0, 0)\r\n\t\t\r\n\t\tif (this.keysDown[\"KeyW\"])\r\n\t\t\tmove = move.add(forward)\r\n\t\tif (this.keysDown[\"KeyS\"])\r\n\t\t\tmove = move.sub(forward)\r\n\t\tif (this.keysDown[\"KeyA\"])\r\n\t\t\tmove = move.sub(right)\r\n\t\tif (this.keysDown[\"KeyD\"])\r\n\t\t\tmove = move.add(right)\r\n\t\tif (this.keysDown[\"KeyE\"])\r\n\t\t\tmove = move.add(worldUp)\r\n\t\tif (this.keysDown[\"KeyQ\"])\r\n\t\t\tmove = move.sub(worldUp)\r\n\t\t\r\n\t\tif (move.magn() <= 0.0001)\r\n\t\t\treturn false\r\n\t\t\r\n\t\tlet speed = Math.max(2000, this.cameraDist * 3)\n\t\tspeed *= (this.cfg.cameraMovementSpeed == null ? 0.5 : this.cfg.cameraMovementSpeed)\n\t\tif (this.keysDown[\"ShiftLeft\"] || this.keysDown[\"ShiftRight\"])\n\t\t\tspeed *= 2.5\n\t\t\r\n\t\tthis.cameraFocus = this.cameraFocus.add(move.normalize().scale(speed * dt))\r\n\t\treturn true\r\n\t}\r\n\t\r\n\t\r\n\tgetScreenRay(x, y)\r\n\t{\r\n\t\tlet camera = this.getCurrentCamera()\r\n\t\t\r\n\t\tlet xViewport = (x / this.width) * 2 - 1\r\n\t\tlet yViewport = (y / this.height) * 2 - 1\r\n\t\t\r\n\t\tlet matrix = camera.view.mul(camera.projection).invert()\r\n\t\t\r\n\t\tlet near = matrix.mulVec4([xViewport, -yViewport, -1, 1])\r\n\t\tlet far = matrix.mulVec4([xViewport, -yViewport, 1, 1])\r\n\t\t\t\r\n\t\tnear = new Vec3(near[0], near[1], near[2]).scale(1 / near[3])\r\n\t\tfar = new Vec3(far[0], far[1], far[2]).scale(1 / far[3])\r\n\t\t\r\n\t\treturn { origin: near, direction: far.sub(near).normalize() } //.add(far.normalize().scale(1000))\r\n\t}\r\n\t\r\n\t\r\n\tpointToScreen(pos)\r\n\t{\r\n\t\tlet camera = this.getCurrentCamera()\r\n\t\t\r\n\t\tlet p = camera.projection.transpose().mul(camera.view.transpose()).mulVec4([pos.x, pos.y, pos.z, 1])\r\n\t\t\r\n\t\tp[0] /= p[3]\r\n\t\tp[1] /= p[3]\r\n\t\tp[2] /= p[3]\r\n\t\t\r\n\t\treturn {\r\n\t\t\tx: (p[0] + 1) / 2 * this.width,\r\n\t\t\ty: (1 - (p[1] + 1) / 2) * this.height,\r\n\t\t\tz: p[2],\r\n\t\t\tw: p[3]\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tgetMousePosFromEvent(ev)\r\n\t{\r\n\t\tlet rect = this.canvas.getBoundingClientRect()\r\n\t\t\r\n\t\treturn {\r\n\t\t\tx: ev.clientX - rect.left,\r\n\t\t\ty: ev.clientY - rect.top\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tsetCursor(cursor)\r\n\t{\r\n\t\tthis.canvas.style.cursor = cursor\r\n\t}\r\n\t\r\n\t\r\n\tonKeyDown(ev)\r\n\t{\r\n\t\tthis.keysDown[ev.code] = true\r\n\t\t\r\n\t\tif (ev.repeat == undefined)\r\n\t\t\tthis.window.setUndoPoint()\r\n\t\t\r\n\t\tif (ev.key == \"5\")\r\n\t\t{\r\n\t\t\tthis.cfg.useOrthoProjection = !this.cfg.useOrthoProjection\r\n\t\t\tev.preventDefault()\r\n\t\t\tthis.render()\r\n\t\t\treturn\r\n\t\t}\r\n\t\t\r\n\t\tif (this.mouseDown && this.mouseAction == \"fly\" && this.isFlyMovementKey(ev))\r\n\t\t{\r\n\t\t\tthis.startFlyMovementLoop()\r\n\t\t\tev.preventDefault()\r\n\t\t\treturn\r\n\t\t}\r\n\t\t\r\n\t\tif (this.currentSubviewer != null)\r\n\t\t{\r\n\t\t\tif (this.currentSubviewer.onKeyDown(ev))\r\n\t\t\t{\r\n\t\t\t\tev.preventDefault()\r\n\t\t\t\tthis.render()\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tonKeyUp(ev)\r\n\t{\r\n\t\tdelete this.keysDown[ev.code]\r\n\t\t\r\n\t\tif (!this.hasFlyMovementInput())\r\n\t\t\tthis.stopFlyMovementLoop()\r\n\t}\r\n\t\r\n\t\r\n\tonMouseDown(ev)\r\n\t{\r\n\t\t//ev.preventDefault()\r\n\t\tthis.window.setUndoPoint()\r\n\t\t\r\n\t\tlet mouse = this.getMousePosFromEvent(ev)\r\n\t\tlet ray = this.getScreenRay(mouse.x, mouse.y)\r\n\t\tlet cameraPos = this.getCurrentCameraPosition()\r\n\t\t\r\n\t\tlet clickDelta = new Date().getTime() - this.mouseLastClickDate.getTime()\r\n\t\tlet doubleClick = clickDelta > 5 && clickDelta < 300\r\n\t\t\r\n\t\tlet hit = this.collision.raycast(ray.origin, ray.direction)\r\n\t\tlet distToHit = (hit == null ? 1000000 : hit.distScaled)\r\n\t\t\r\n\t\tthis.mouseDown = true\r\n\t\tthis.mouseDownOrigin = mouse\r\n\t\tthis.mouseDownRaycast = hit\r\n\t\tthis.mouseLast = mouse\r\n\t\tthis.mouseAction = null\r\n\t\t\r\n\t\tthis.mouseMoveOffsetPixels = { x: 0, y: 0 }\r\n\t\tthis.mouseMoveOffsetPan = new Vec3(0, 0, 0)\r\n\t\tthis.mouseMoveOffsetPanDelta = new Vec3(0, 0, 0)\r\n\t\tthis.mouseMoveOffsetRaycast = new Vec3(0, 0, 0)\r\n\t\t\r\n\t\tif (ev.button == 2)\r\n\t\t{\r\n\t\t\tev.preventDefault()\r\n\t\r\n\t\t\tif (doubleClick)\r\n\t\t\t{\r\n\t\t\t\tlet ray = this.getScreenRay(mouse.x, mouse.y)\r\n\t\t\t\tlet hit = this.collision.raycast(ray.origin, ray.direction)\r\n\t\t\t\tif (hit != null)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.cameraFocus = hit.position\r\n\t\t\t\t\tthis.cameraDist = 8000\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tthis.mouseAction = \"fly\"\r\n\t\t\t\r\n\t\t\tthis.startFlyMovementLoop()\r\n\t\t}\r\n\t\telse if (ev.button == 1)\r\n\t\t{\r\n\t\t\tev.preventDefault()\r\n\t\r\n\t\t\tif (doubleClick)\r\n\t\t\t{\r\n\t\t\t\tlet ray = this.getScreenRay(mouse.x, mouse.y)\r\n\t\t\t\tlet hit = this.collision.raycast(ray.origin, ray.direction)\r\n\t\t\t\tif (hit != null)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.cameraFocus = hit.position\r\n\t\t\t\t\tthis.cameraDist = 8000\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (ev.shiftKey)\r\n\t\t\t\tthis.mouseAction = \"pan\"\r\n\t\t\telse\r\n\t\t\t\tthis.mouseAction = \"orbit\"\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.mouseAction = \"move\"\r\n\t\t\t\r\n\t\t\tlet mouse3DPos = hit ? hit.position : ray.origin.add(ray.direction.scale(1000))\r\n\t\t\t\r\n\t\t\tif (this.currentSubviewer != null)\r\n\t\t\t\tthis.currentSubviewer.onMouseDown(ev, mouse.x, mouse.y, cameraPos, ray, hit, distToHit, mouse3DPos)\r\n\t\t}\r\n\t\t\r\n\t\tthis.mouseLastClickDate = new Date()\r\n\t\tthis.render()\r\n\t}\r\n\t\r\n\t\r\n\tonMouseMove(ev)\r\n\t{\r\n\t\tlet mouse = this.getMousePosFromEvent(ev)\r\n\t\tlet ray = this.getScreenRay(mouse.x, mouse.y)\r\n\t\tlet cameraPos = this.getCurrentCameraPosition()\r\n\t\t\r\n\t\tthis.setCursor(\"default\")\r\n\t\t\r\n\t\tlet hit = this.collision.raycast(ray.origin, ray.direction)\r\n\t\tlet distToHit = (hit == null ? 1000000 : hit.distScaled)\r\n\t\t\r\n\t\t\r\n\t\tif (this.mouseDown)\r\n\t\t{\r\n\t\t\tev.preventDefault()\r\n\t\t\t\r\n\t\t\tlet dx = mouse.x - this.mouseLast.x\r\n\t\t\tlet dy = mouse.y - this.mouseLast.y\r\n\t\t\t\r\n\t\t\tlet ox = mouse.x - this.mouseDownOrigin.x\r\n\t\t\tlet oy = mouse.y - this.mouseDownOrigin.y\r\n\t\t\t\r\n\t\t\tif (this.mouseAction == \"pan\")\r\n\t\t\t{\r\n\t\t\t\tlet matrix = this.getCurrentCamera().view\r\n\t\t\t\tlet delta = matrix.mulDirection(new Vec3(-dx * this.cameraDist / 500, -dy * this.cameraDist / 500, 0))\r\n\t\t\t\t\r\n\t\t\t\tthis.cameraFocus = this.cameraFocus.add(delta)\r\n\t\t\t}\r\n\t\t\telse if (this.mouseAction == \"orbit\")\r\n\t\t\t{\r\n\t\t\t\tthis.cameraHorzAngle += dx * 0.0075\r\n\t\t\t\tthis.cameraVertAngle += dy * 0.0075\r\n\t\t\t\t\r\n\t\t\t\tthis.cameraVertAngle = Math.max(-Math.PI / 2 + 0.0001, Math.min(Math.PI / 2 - 0.0001, this.cameraVertAngle))\r\n\t\t\t}\r\n\t\t\telse if (this.mouseAction == \"fly\")\r\n\t\t\t{\r\n\t\t\t\tlet cameraPos = this.getCurrentCameraPosition()\r\n\t\t\t\t\r\n\t\t\t\tthis.cameraHorzAngle += dx * 0.0075\r\n\t\t\t\tthis.cameraVertAngle += dy * 0.0075\r\n\t\t\t\tthis.cameraVertAngle = Math.max(-Math.PI / 2 + 0.0001, Math.min(Math.PI / 2 - 0.0001, this.cameraVertAngle))\r\n\t\t\t\tthis.cameraFocus = cameraPos.sub(this.getCameraEyeOffset())\r\n\t\t\t\tthis.startFlyMovementLoop()\r\n\t\t\t}\r\n\t\t\telse if (this.mouseAction == \"move\")\r\n\t\t\t{\r\n\t\t\t\tlet matrix = this.getCurrentCamera().view\r\n\t\t\t\tlet offset = matrix.mulDirection(new Vec3(ox * this.cameraDist / 500, oy * this.cameraDist / 500, 0))\r\n\t\t\t\tlet delta = matrix.mulDirection(new Vec3(dx * this.cameraDist / 500, dy * this.cameraDist / 500, 0))\r\n\t\t\t\t\r\n\t\t\t\tthis.mouseMoveOffsetPixels = { x: ox, y: oy }\r\n\t\t\t\tthis.mouseMoveOffsetPan = offset\r\n\t\t\t\tthis.mouseMoveOffsetPanDelta = delta\r\n\t\t\t\tthis.mouseMoveOffsetRaycast = hit\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this.currentSubviewer != null)\r\n\t\t\t\tthis.currentSubviewer.onMouseMove(ev, mouse.x, mouse.y, cameraPos, ray, hit, distToHit)\r\n\t\t\t\r\n\t\t\tthis.mouseLast = mouse\r\n\t\t\tthis.render()\r\n\t\t}\r\n\t\t\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (hit != null && this.enableDebugRaycast)\r\n\t\t\t\t  this.debugRaycastRenderer.setTranslation(hit.position)\r\n\t\t\t\r\n\t\t\tif (this.currentSubviewer != null)\r\n\t\t\t\tthis.currentSubviewer.onMouseMove(ev, mouse.x, mouse.y, cameraPos, ray, hit, distToHit)\r\n\t\t\t\r\n\t\t\t//console.log(this.pointToScreen(ray.origin.add(ray.direction.scale(10000))))\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tonMouseUp(ev)\r\n\t{\r\n\t\tif (!this.mouseDown)\r\n\t\t\treturn\r\n\t\t\r\n\t\tev.preventDefault()\r\n\t\t\r\n\t\tlet mouse = this.getMousePosFromEvent(ev)\r\n\t\t\r\n\t\tif (this.currentSubviewer != null && this.currentSubviewer.onMouseUp)\r\n\t\t\tthis.currentSubviewer.onMouseUp(ev, mouse.x, mouse.y)\r\n\t\t\r\n\t\tthis.window.setUndoPoint()\r\n\t\tthis.mouseDown = false\r\n\t\tthis.mouseLast = mouse\r\n\t\tthis.stopFlyMovementLoop()\r\n\t}\r\n\t\r\n\t\r\n\tonMouseWheel(ev)\r\n\t{\r\n\t\tif (ev.deltaY > 0)\r\n\t\t\tthis.cameraDist = Math.min(500000, this.cameraDist * 1.25)\r\n\r\n\t\telse if (ev.deltaY < 0)\r\n\t\t{\r\n\t\t\tif (this.cameraDist <= 1000)\r\n\t\t\t{\r\n\t\t\t\tlet matrix = this.getCurrentCamera().view\r\n\t\t\t\tlet delta = matrix.mulDirection(new Vec3(0, 0, ev.deltaY * 2))\r\n\t\t\t\t\r\n\t\t\t\tthis.cameraFocus = this.cameraFocus.add(delta)\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tthis.cameraDist = Math.max(1000, this.cameraDist / 1.25)\r\n\t\t}\r\n\t\tthis.render()\r\n\t}\r\n}\r\n\r\n\r\nconst vertexSrc = `\r\n\tprecision highp float;\r\n\t\r\n\tattribute vec4 aPosition;\r\n\tattribute vec4 aNormal;\r\n\r\n\tuniform mat4 uMatModel;\r\n\tuniform mat4 uMatView;\r\n\tuniform mat4 uMatProj;\r\n\t\r\n\tvarying vec4 vNormal;\r\n\tvarying vec4 vScreenNormal;\r\n\r\n\tvoid main()\r\n\t{\r\n\t\tvNormal = uMatModel * vec4(aNormal.xyz, 0);\r\n\t\tvScreenNormal = uMatView * uMatModel * vec4(aNormal.xyz, 0);\r\n\t\t\r\n\t\tgl_Position = uMatProj * uMatView * uMatModel * aPosition;\r\n\t}`\r\n\r\n\r\nconst fragmentSrc = `\r\n\tprecision highp float;\r\n\t\r\n\tvarying vec4 vNormal;\r\n\tvarying vec4 vScreenNormal;\r\n\t\r\n\tuniform vec4 uDiffuseColor;\r\n\tuniform vec4 uAmbientColor;\r\n\r\n\tvoid main()\r\n\t{\r\n\t\tvec4 lightDir = vec4(0, 0, -1, 0);\r\n\t\t\r\n\t\tvec4 ambientColor = uAmbientColor;\r\n\t\tvec4 diffuseColor = uDiffuseColor;\r\n\t\tvec4 lightColor = vec4(1, 1, 1, 1);\r\n\t\t\r\n\t\tfloat lightIncidence = max(0.0, dot(normalize(lightDir), normalize(vScreenNormal)));\r\n\t\t\r\n\t\tgl_FragColor = diffuseColor * mix(ambientColor, lightColor, lightIncidence);\r\n\t}`\r\n\r\n\r\nconst vertexSrcColor = `\r\n\tprecision highp float;\r\n\t\r\n\tattribute vec4 aPosition;\r\n\tattribute vec4 aNormal;\r\n\tattribute vec4 aColor;\r\n\r\n\tuniform mat4 uMatModel;\r\n\tuniform mat4 uMatView;\r\n\tuniform mat4 uMatProj;\r\n\t\r\n\tvarying float vDepth;\r\n\tvarying vec4 vNormal;\r\n\tvarying vec4 vScreenNormal;\r\n\tvarying vec4 vColor;\r\n\r\n\tvoid main()\r\n\t{\r\n\t\tvNormal = uMatModel * vec4(aNormal.xyz, 0);\r\n\t\tvScreenNormal = uMatView * uMatModel * vec4(aNormal.xyz, 0);\r\n\t\t\r\n\t\tvColor = aColor;\r\n\t\t\r\n\t\tvec4 position = uMatProj * uMatView * uMatModel * aPosition;\r\n\t\tgl_Position = position;\r\n\t\tvDepth = position.z / position.w;\r\n\t}`\r\n\r\n\r\nconst fragmentSrcColor = `\r\n\tprecision highp float;\r\n\t\r\n\tvarying float vDepth;\r\n\tvarying vec4 vNormal;\r\n\tvarying vec4 vScreenNormal;\r\n\tvarying vec4 vColor;\r\n\t\r\n\tuniform vec4 uDiffuseColor;\r\n\tuniform vec4 uAmbientColor;\r\n\tuniform float uFogDensity;\r\n\r\n\tvoid main()\r\n\t{\r\n\t\tvec4 lightDir = vec4(0, 0, -1, 0);\r\n\t\t\r\n\t\tvec4 ambientColor = uAmbientColor;\r\n\t\tvec4 diffuseColor = uDiffuseColor * vColor;\r\n\t\tvec4 lightColor = vec4(1, 1, 1, 1);\r\n\t\t\r\n\t\tconst float log2 = 1.442695;\r\n\t\t//const float fogDensity = 0.00001;\r\n\t\tfloat z = gl_FragCoord.z / gl_FragCoord.w;\r\n\t\tfloat fogFactor = clamp(exp2(-uFogDensity * uFogDensity * z * z * log2) + 0.01, 0.2, 1.0);\r\n\t\t\r\n\t\tfloat lightIncidence = max(0.0, dot(normalize(lightDir), normalize(vScreenNormal)));\r\n\t\t\r\n\t\tgl_FragColor = diffuseColor * mix(ambientColor, lightColor, lightIncidence) * vec4(vec3(fogFactor), 1.0);\r\n\t}`\r\n\r\n\r\nconst fragmentSrcUnshaded = `\r\n\tprecision highp float;\r\n\t\r\n\tvarying vec4 vNormal;\r\n\tvarying vec4 vScreenNormal;\r\n\t\r\n\tuniform vec4 uDiffuseColor;\r\n\r\n\tvoid main()\r\n\t{\r\n\t\tgl_FragColor = uDiffuseColor;\r\n\t}`\r\n\t\r\n\r\nmodule.exports = { Viewer }\r\n", "const { Vec3 } = require(\"../math/vec3.js\")\r\n\r\n\r\nclass BinaryParser\r\n{\r\n\tconstructor(bytes)\r\n\t{\r\n\t\tthis.bytes = bytes\r\n\t\tthis.head = 0\r\n\t\tthis.littleEndian = false\r\n\t}\r\n\t\r\n\t\r\n\tgetLength()\r\n\t{\r\n\t\treturn this.bytes.length\r\n\t}\r\n\t\r\n\t\r\n\tseek(index)\r\n\t{\r\n\t\tthis.head = index\r\n\t}\r\n\t\r\n\t\r\n\treadByte()\r\n\t{\r\n\t\tlet b = this.bytes[this.head]\r\n\t\tthis.head += 1\r\n\t\treturn b\r\n\t}\r\n\t\r\n\t\r\n\treadSByte()\r\n\t{\r\n\t\tlet x = this.readByte()\r\n\t\tif ((x & 0x80) == 0)\r\n\t\t\treturn x\r\n\t\t\r\n\t\treturn -((~x) + 1)\r\n\t}\r\n\t\r\n\t\r\n\treadBytes(length)\r\n\t{\r\n\t\tlet arr = []\r\n\t\tfor (let i = 0; i < length; i++)\r\n\t\t\tarr.push(this.readByte())\r\n\t\t\r\n\t\tif (this.littleEndian)\r\n\t\t\tarr = arr.reverse()\r\n\t\t\r\n\t\treturn arr\r\n\t}\r\n\t\r\n\t\r\n\treadUInt16()\r\n\t{\r\n\t\tlet b = this.readBytes(2)\r\n\t\t\r\n\t\tlet result = (b[0] << 8) | b[1]\r\n\t\t\r\n\t\tif (result < 0)\r\n\t\t\treturn 0x10000 + result\r\n\t\telse\r\n\t\t\treturn result\r\n\t}\r\n\t\r\n\t\r\n\treadUInt16s(length)\r\n\t{\r\n\t\tlet arr = []\r\n\t\tfor (let i = 0; i < length; i++)\r\n\t\t\tarr.push(this.readUInt16())\r\n\t\t\r\n\t\treturn arr\r\n\t}\r\n\t\r\n\t\r\n\treadUInt32()\r\n\t{\r\n\t\tlet b = this.readBytes(4)\r\n\t\t\r\n\t\tlet result = (b[0] << 24) | (b[1] << 16) | (b[2] << 8) | b[3]\r\n\t\t\r\n\t\tif (result < 0)\r\n\t\t\treturn 0x100000000 + result\r\n\t\telse\r\n\t\t\treturn result\r\n\t}\r\n\t\r\n\t\r\n\treadInt16()\r\n\t{\r\n\t\tlet x = this.readUInt16()\r\n\t\tif ((x & 0x8000) == 0)\r\n\t\t\treturn x\r\n\t\t\r\n\t\treturn -((~x) + 1)\r\n\t}\r\n\t\r\n\t\r\n\treadInt32()\r\n\t{\r\n\t\tlet x = this.readUInt32()\r\n\t\tif ((x & 0x80000000) == 0)\r\n\t\t\treturn x\r\n\t\t\r\n\t\treturn -((~x) + 1)\r\n\t}\r\n\t\r\n\t\r\n\treadFloat32()\r\n\t{\r\n\t\tlet b = this.readBytes(4)\r\n\t\t\r\n\t\tlet buf = new ArrayBuffer(4)\r\n\t\tlet view = new DataView(buf)\r\n\r\n\t\tview.setUint8(0, b[0])\r\n\t\tview.setUint8(1, b[1])\r\n\t\tview.setUint8(2, b[2])\r\n\t\tview.setUint8(3, b[3])\r\n\r\n\t\treturn view.getFloat32(0)\r\n\t}\r\n\t\r\n\t\r\n\treadFloat32MSB2()\r\n\t{\r\n\t\tlet b = this.readBytes(2)\r\n\t\t\r\n\t\tlet buf = new ArrayBuffer(4)\r\n\t\tlet view = new DataView(buf)\r\n\r\n\t\tview.setUint8(0, b[0])\r\n\t\tview.setUint8(1, b[1])\r\n\t\tview.setUint8(2, 0)\r\n\t\tview.setUint8(3, 0)\r\n\r\n\t\treturn view.getFloat32(0)\r\n\t}\r\n\t\r\n\t\r\n\treadVec3()\r\n\t{\r\n\t\tlet x = this.readFloat32()\r\n\t\tlet y = this.readFloat32()\r\n\t\tlet z = this.readFloat32()\r\n\t\t\r\n\t\treturn new Vec3(x, y, z)\r\n\t}\r\n\r\n\r\n\treadPosVec3()\r\n\t{\r\n\t\tlet x = this.readFloat32()\r\n\t\tlet y = this.readFloat32()\r\n\t\tlet z = this.readFloat32()\r\n\t\t\r\n\t\treturn new Vec3(x, -z, -y)\r\n\t}\r\n\t\r\n\t\r\n\treadAsciiLength(length)\r\n\t{\r\n\t\tlet str = \"\"\r\n\t\tfor (let i = 0; i < length; i++)\r\n\t\t\tstr += String.fromCharCode(this.readByte())\r\n\t\t\r\n\t\tif (this.littleEndian)\r\n\t\t\tstr = str.split('').reverse().join('')\r\n\t\t\r\n\t\treturn str\r\n\t}\r\n\t\r\n\t\r\n\treadAsciiZeroTerminated()\r\n\t{\r\n\t\tlet str = \"\"\r\n\t\twhile (true)\r\n\t\t{\r\n\t\t\tlet c = this.readByte()\r\n\t\t\tif (c == 0)\r\n\t\t\t\tbreak\r\n\t\t\t\r\n\t\t\tstr += String.fromCharCode(c)\r\n\t\t}\r\n\r\n\t\tif (this.littleEndian)\r\n\t\t\tstr = str.split('').reverse().join('')\r\n\t\t\r\n\t\treturn str\r\n\t}\r\n\r\n\r\n\tread(type)\r\n\t{\r\n\t\tif (type instanceof Array)\r\n\t\t\treturn this[\"read\" + type[0]](type[1])\r\n\t\telse\r\n\t\t\treturn this[\"read\" + type]()\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { BinaryParser }", "const { Vec3 } = require(\"../math/vec3.js\")\r\n\r\n\r\nclass BinaryWriter\r\n{\r\n\tconstructor(bytes)\r\n\t{\r\n\t\tthis.bytes = []\r\n\t\tthis.head = 0\r\n\t\tthis.littleEndian = false\r\n\t}\r\n\t\r\n\t\r\n\tgetBytes()\r\n\t{\r\n\t\treturn this.bytes\r\n\t}\r\n\t\r\n\t\r\n\tgetLength()\r\n\t{\r\n\t\treturn this.bytes.length\r\n\t}\r\n\t\r\n\t\r\n\tseek(index)\r\n\t{\r\n\t\twhile (index > this.bytes.length)\r\n\t\t\tthis.bytes.push(0)\r\n\t\t\r\n\t\tthis.head = index\r\n\t}\r\n\t\r\n\t\r\n\twriteByte(b)\r\n\t{\r\n\t\tthis.bytes[this.head] = (b & 0xff)\r\n\t\tthis.head += 1\r\n\t}\r\n\t\r\n\t\r\n\twriteSByte(b)\r\n\t{\r\n\t\tif (b >= 0)\r\n\t\t\tthis.writeByte(b)\r\n\t\telse\r\n\t\t\tthis.writeByte(0x100 + b)\r\n\t}\r\n\t\r\n\t\r\n\twriteBytes(bytes)\r\n\t{\r\n\t\tif (this.littleEndian)\r\n\t\t\tbytes.reverse()\r\n\r\n\t\tfor (let i = 0; i < bytes.length; i++)\r\n\t\t\tthis.writeByte(bytes[i])\r\n\t}\r\n\t\r\n\t\r\n\twriteUInt16(x)\r\n\t{\r\n\t\tthis.writeBytes([\r\n\t\t\tx >> 8,\r\n\t\t\tx >> 0\r\n\t\t])\r\n\t}\r\n\r\n\r\n\twriteUInt16s(ints)\r\n\t{\r\n\t\tfor (let i = 0; i < ints.length; i++)\r\n\t\t\tthis.writeUInt16(ints[i])\r\n\t}\r\n\t\r\n\t\r\n\twriteUInt32(x)\r\n\t{\r\n\t\tthis.writeBytes([\r\n\t\t\tx >> 24,\r\n\t\t\tx >> 16,\r\n\t\t\tx >> 8,\r\n\t\t\tx >> 0\r\n\t\t])\r\n\t}\r\n\t\r\n\t\r\n\twriteInt16(x)\r\n\t{\r\n\t\tif (x >= 0)\r\n\t\t\tthis.writeUInt16(x)\r\n\t\telse\r\n\t\t\tthis.writeUInt16(0x10000 + x)\r\n\t}\r\n\r\n\r\n\twriteInt32(x)\r\n\t{\r\n\t\tif (x >= 0)\r\n\t\t\tthis.writeUInt32(x)\r\n\t\telse\r\n\t\t\tthis.writeUInt32(0x100000000 + x)\r\n\t}\r\n\t\r\n\t\r\n\twriteFloat32(x)\r\n\t{\r\n\t\tlet view = new DataView(new ArrayBuffer(4))\r\n\t\tview.setFloat32(0, x)\r\n\t\tthis.writeBytes([\r\n\t\t\tview.getUint8(0),\r\n\t\t\tview.getUint8(1),\r\n\t\t\tview.getUint8(2),\r\n\t\t\tview.getUint8(3)\r\n\t\t])\r\n\t}\r\n\t\r\n\t\r\n\twriteFloat32MSB2(x)\r\n\t{\r\n\t\tlet view = new DataView(new ArrayBuffer(4))\r\n\t\tview.setFloat32(0, x)\r\n\t\tthis.writeBytes([\r\n\t\t\tview.getUint8(0),\r\n\t\t\tview.getUint8(1),\r\n\t\t])\r\n\t}\r\n\t\r\n\t\r\n\twriteVec3(v)\r\n\t{\r\n\t\tthis.writeFloat32(v.x)\r\n\t\tthis.writeFloat32(v.y)\r\n\t\tthis.writeFloat32(v.z)\r\n\t}\r\n\r\n\r\n\twritePosVec3(v)\r\n\t{\r\n\t\tthis.writeFloat32(v.x)\r\n\t\tthis.writeFloat32(-v.z)\r\n\t\tthis.writeFloat32(-v.y)\r\n\t}\r\n\t\r\n\t\r\n\twriteAsciiLength(str, length)\r\n\t{\r\n\t\tif (this.littleEndian)\r\n\t\t\tstr = str.split('').reverse().join('')\r\n\r\n\t\tfor (let i = 0; i < Math.min(str.length, length); i++)\r\n\t\t\tthis.writeByte(str.charCodeAt(i))\r\n\t\t\r\n\t\tfor (let i = str.length; i < length; i++)\r\n\t\t\tthis.writeByte(0)\r\n\t}\r\n\t\r\n\t\r\n\twriteAscii(str)\r\n\t{\r\n\t\tif (this.littleEndian)\r\n\t\t\tstr = str.split('').reverse().join('')\r\n\t\t\t\r\n\t\tfor (let i = 0; i < str.length; i++)\r\n\t\t\tthis.writeByte(str.charCodeAt(i))\r\n\t}\r\n\r\n\twrite(type, prop)\r\n\t{\r\n\t\tif (type instanceof Array)\r\n\t\t\tthis[\"write\" + type[0]](prop)\r\n\t\telse\r\n\t\t\tthis[\"write\" + type](prop)\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { BinaryWriter }", "const { BinaryParser } = require(\"./binaryParser.js\")\r\nconst { BinaryWriter } = require(\"./binaryWriter.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\n\r\n\r\nlet sectionOrder =\r\n[\r\n\t\"KTPT\",\r\n\t\"ENPT\",\r\n\t\"ENPH\",\r\n\t\"ITPT\",\r\n\t\"ITPH\",\r\n\t\"CKPT\",\r\n\t\"CKPH\",\r\n\t\"GOBJ\",\r\n\t\"POTI\",\r\n\t\"AREA\",\r\n\t\"CAME\",\r\n\t\"JGPT\",\r\n\t\"CNPT\",\r\n\t\"MSPT\",\r\n\t\"STGI\",\r\n]\r\n\r\nlet format = \r\n{\r\n\t\"KTPT\":\r\n\t{\r\n\t\tpos: \"PosVec3\",\r\n\t\trotation: \"Vec3\",\r\n\t\tplayerIndex: \"UInt16\",\r\n\t\tpadding: \"UInt16\",\r\n\t},\r\n\r\n\t\"ENPT\":\r\n\t{\r\n\t\tpos: \"PosVec3\",\r\n\t\tdeviation: \"Float32\",\r\n\t\tsetting1: \"UInt16\",\r\n\t\tsetting2: \"Byte\",\r\n\t\tsetting3: \"Byte\",\r\n\t},\r\n\r\n\t\"ENPH\":\r\n\t{\r\n\t\tstartIndex: \"Byte\",\r\n\t\tpointNum: \"Byte\",\r\n\t\tprevGroups: [\"Bytes\", 6],\r\n\t\tnextGroups: [\"Bytes\", 6],\r\n\t\tunknown: \"UInt16\",\r\n\t},\r\n\r\n\t\"ITPT\":\r\n\t{\r\n\t\tpos: \"PosVec3\",\r\n\t\tdeviation: \"Float32\",\r\n\t\tsetting1: \"UInt16\",\r\n\t\tsetting2: \"UInt16\",\r\n\t},\r\n\r\n\t\"ITPH\":\r\n\t{\r\n\t\tstartIndex: \"Byte\",\r\n\t\tpointNum: \"Byte\",\r\n\t\tprevGroups: [\"Bytes\", 6],\r\n\t\tnextGroups: [\"Bytes\", 6],\r\n\t\tpadding: \"UInt16\",\r\n\t},\r\n\r\n\t\"CKPT\":\r\n\t{\r\n\t\tx1: \"Float32\",\r\n\t\tz1: \"Float32\",\r\n\t\tx2: \"Float32\",\r\n\t\tz2: \"Float32\",\r\n\t\trespawnIndex: \"Byte\",\r\n\t\ttype: \"Byte\",\r\n\t\tprev: \"Byte\",\r\n\t\tnext: \"Byte\",\r\n\t},\r\n\r\n\t\"CKPH\":\r\n\t{\r\n\t\tstartIndex: \"Byte\",\r\n\t\tpointNum: \"Byte\",\r\n\t\tprevGroups: [\"Bytes\", 6],\r\n\t\tnextGroups: [\"Bytes\", 6],\r\n\t\tpadding: \"UInt16\",\r\n\t},\r\n\r\n\t\"GOBJ\":\r\n\t{\r\n\t\tid: \"UInt16\",\r\n\t\txpfThing: \"UInt16\",\r\n\t\tpos: \"PosVec3\",\r\n\t\trotation: \"Vec3\",\r\n\t\tscale: \"Vec3\",\r\n\t\trouteIndex: \"UInt16\",\r\n\t\tsettings: [\"UInt16s\", 8],\r\n\t\tpresence: \"UInt16\",\r\n\t},\r\n\r\n\t\"POTI\":\r\n\t{\r\n\t\tpointNum: \"UInt16\",\r\n\t\tsetting1: \"Byte\",\r\n\t\tsetting2: \"Byte\",\r\n\t},\r\n\r\n\t\"AREA\":\r\n\t{\r\n\t\tshape: \"Byte\",\r\n\t\ttype: \"Byte\",\r\n\t\tcameraIndex: \"Byte\",\r\n\t\tpriority: \"Byte\",\r\n\t\tpos: \"PosVec3\",\r\n\t\trotation: \"Vec3\",\r\n\t\tscale: \"Vec3\",\r\n\t\tsetting1: \"UInt16\",\r\n\t\tsetting2: \"UInt16\",\r\n\t\trouteIndex: \"Byte\",\r\n\t\tenemyIndex: \"Byte\",\r\n\t\tpadding: \"UInt16\",\r\n\t},\r\n\r\n\t\"CAME\":\r\n\t{\r\n\t\ttype: \"Byte\",\r\n\t\tnextCam: \"Byte\",\r\n\t\tshake: \"Byte\",\r\n\t\trouteIndex: \"Byte\",\r\n\t\tvCam: \"UInt16\",\r\n\t\tvZoom: \"UInt16\",\r\n\t\tvView: \"UInt16\",\r\n\t\tstart: \"Byte\",\r\n\t\tmovie: \"Byte\",\r\n\t\tpos: \"PosVec3\",\r\n\t\trotation: \"Vec3\",\r\n\t\tzoomStart: \"Float32\",\r\n\t\tzoomEnd: \"Float32\",\r\n\t\tviewPosStart: \"PosVec3\",\r\n\t\tviewPosEnd: \"PosVec3\",\r\n\t\ttime: \"Float32\",\r\n\t},\r\n\r\n\t\"JGPT\":\r\n\t{\r\n\t\tpos: \"PosVec3\",\r\n\t\trotation: \"Vec3\",\r\n\t\tid: \"UInt16\",\r\n\t\tsoundData: \"UInt16\",\r\n\t},\r\n\r\n\t\"CNPT\":\r\n\t{\r\n\t\tpos: \"PosVec3\",\r\n\t\trotation: \"Vec3\",\r\n\t\tid: \"UInt16\",\r\n\t\teffect: \"UInt16\",\r\n\t},\r\n\r\n\t\"MSPT\":\r\n\t{\r\n\t\tpos: \"PosVec3\",\r\n\t\trotation: \"Vec3\",\r\n\t\tid: \"UInt16\",\r\n\t\tpadding: \"UInt16\",\r\n\t},\r\n\r\n\t\"STGI\":\r\n\t{\r\n\t\tlapCount: \"Byte\",\r\n\t\tpolePosition: \"Byte\",\r\n\t\tdriverDistance: \"Byte\",\r\n\t\tlensFlareFlash: \"Byte\",\r\n\t\tunknown1: \"Byte\",\r\n\t\tflareColor: [\"Bytes\", 4],\r\n\t\tunknown2: \"Byte\",\r\n\t\tspeedMod: \"Float32MSB2\",\r\n\t}\r\n}\r\n\r\n\r\nfunction cloneProperties(newNode, oldNode, sectionId)\r\n{\r\n\tfor (let prop in format[sectionId]) {\r\n\t\tif (oldNode[prop] instanceof Array)\r\n\t\t{\r\n\t\t\tnewNode[prop] = []\r\n\t\t\tfor (let x of oldNode[prop])\r\n\t\t\t\tnewNode[prop].push(x)\r\n\t\t}\r\n\t\telse if (oldNode[prop] instanceof Vec3)\r\n\t\t\tnewNode[prop] = oldNode[prop].clone()\r\n\t\telse\r\n\t\t\tnewNode[prop] = oldNode[prop]\r\n\t}\r\n}\r\n\r\n\r\nclass KmpData\r\n{\r\n\tstatic load(bytes)\r\n\t{\r\n\t\t// read KMP header\r\n\t\tlet parser = new BinaryParser(bytes)\r\n\t\t\r\n\t\tif (parser.readAsciiLength(4) != \"RKMD\")\r\n\t\t\tthrow \"kmp: invalid magic number\"\r\n\t\t\r\n\t\tlet fileLenInBytes = parser.readUInt32()\r\n\t\tlet sectionNum = parser.readUInt16()\r\n\t\tif (sectionNum != 15)\r\n\t\t\tthrow \"kmp: unexpected section number: \" + sectionNum\r\n\t\tlet headerLenInBytes = parser.readUInt16()\r\n\t\tparser.readUInt32()\r\n\t\t\r\n\t\tlet sectionOffsets = []\r\n\t\tfor (let i = 0; i < sectionNum; i++)\r\n\t\t\tsectionOffsets.push(parser.readUInt32())\r\n\t\t\r\n\t\tif (parser.head != headerLenInBytes)\r\n\t\t\tthrow \"kmp: invalid header length\"\r\n\r\n\t\t// read KMP sections\r\n\t\tlet sectionData = { sectionNum, unhandled: [] }\r\n\t\tfor (let i = 0; i < sectionNum; i++)\r\n\t\t\tsectionData[sectionOrder[i]] = { headerData: 0x0, entries: [] }\r\n\r\n\t\tfor (let sectionOffset of sectionOffsets)\r\n\t\t{\r\n\t\t\tif (sectionOffset < 0 || sectionOffset + headerLenInBytes >= parser.getLength())\r\n\t\t\t\tcontinue\r\n\r\n\t\t\tparser.seek(sectionOffset + headerLenInBytes)\r\n\t\t\t\r\n\t\t\tlet sectionId = parser.readAsciiLength(4)\r\n\t\t\tlet entryNum = parser.readUInt16()\r\n\t\t\tlet headerData = parser.readUInt16()\r\n\t\t\t\r\n\t\t\tif (sectionId in format)\r\n\t\t\t{\r\n\t\t\t\tsectionData[sectionId].headerData = headerData\r\n\t\t\t\tfor (let i = 0; i < entryNum; i++) \r\n\t\t\t\t{\r\n\t\t\t\t\tlet props = {}\r\n\t\t\t\t\tfor (let prop in format[sectionId])\r\n\t\t\t\t\t\tprops[prop] = parser.read(format[sectionId][prop])\r\n\r\n\t\t\t\t\tif(sectionId == \"POTI\")\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tprops.points = []\r\n\t\t\t\t\t\tfor (let j = 0; j < props.pointNum; j++)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlet point = {}\r\n\t\t\t\t\t\t\tpoint.pos = parser.readPosVec3()\r\n\t\t\t\t\t\t\tpoint.setting1 = parser.readUInt16()\r\n\t\t\t\t\t\t\tpoint.setting2 = parser.readUInt16()\r\n\t\t\t\t\t\t\tprops.points.push(point)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsectionData[sectionId].entries.push(props)\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// After reading all GOBJ entries, unpack conditional fields from presence flags\r\n\t\t\t\tif (sectionId === \"GOBJ\" && entryNum > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (let i = 0; i < sectionData[\"GOBJ\"].entries.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet p = sectionData[\"GOBJ\"].entries[i]\r\n\t\t\t\t\t\tlet flags = p.presence || 0\r\n\t\t\t\t\t\tp.condMode = (flags >> 3) & 0x7\r\n\t\t\t\t\t\tp.condStart = (flags >> 6) & 0x7\r\n\t\t\t\t\t\tp.condEnd = (flags >> 9) & 0x7\r\n\t\t\t\t\t\tp.presence = flags & 0x7\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse  // read unhandled sections\r\n\t\t\t{\r\n\t\t\t\tlet unhandledSection = unhandledSections.find(s => s.id == sectionId)\r\n\t\t\t\tif (unhandledSection == null)\r\n\t\t\t\t\tthrow (\"kmp: section not handled: \" + sectionId)\r\n\t\t\t\t\r\n\t\t\t\tlet bytes = []\r\n\t\t\t\tfor (let i = 0; i < entryNum; i++)\r\n\t\t\t\t\tfor (let j = 0; j < unhandledSection.entryLen; j++)\r\n\t\t\t\t\t\tbytes.push(parser.readByte())\r\n\t\t\t\t\t\r\n\t\t\t\tsectionData.unhandled.push({ id: sectionId, headerData, bytes })\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn sectionData\r\n\t}\r\n\t\r\n\t\r\n\tstatic convertToWorkingFormat(loadedKmp)\r\n\t{\r\n\t\tlet data = new KmpData()\r\n\t\tdata.sectionNum = loadedKmp.sectionNum\r\n\t\tdata.trackInfo = loadedKmp[\"STGI\"].entries[0]\r\n\t\tdata.unhandledSectionData = loadedKmp.unhandled\r\n\r\n\t\t// Handle simple sections\r\n\t\tlet sectionsToGraphs =\r\n\t\t{\r\n\t\t\t\"KTPT\": \"startPoints\",\r\n\t\t\t\"ENPT\": \"enemyPoints\",\r\n\t\t\t\"ITPT\": \"itemPoints\",\r\n\t\t\t\"GOBJ\": \"objects\",\r\n\t\t\t\"AREA\": \"areaPoints\",\r\n\t\t\t\"CAME\": \"cameras\",\r\n\t\t\t\"JGPT\": \"respawnPoints\",\r\n\t\t\t\"CNPT\": \"cannonPoints\",\r\n\t\t\t\"MSPT\": \"finishPoints\",\r\n\t\t}\r\n\t\t\r\n\t\tfor (let [sectionId, graph] of Object.entries(sectionsToGraphs))\r\n\t\t{\r\n\t\t\tdata.headerData[sectionId] = loadedKmp[sectionId].headerData\r\n\r\n\t\t\tfor (let kmpPoint of loadedKmp[sectionId].entries)\r\n\t\t\t{\r\n\t\t\t\tlet node = data[graph].addNode()\r\n\t\t\t\tcloneProperties(node, kmpPoint, sectionId)\r\n\t\t\t\tif (sectionId === \"GOBJ\")\r\n\t\t\t\t{\r\n\t\t\t\t\tnode.condMode = kmpPoint.condMode || 0\r\n\t\t\t\t\tnode.condStart = kmpPoint.condStart || 0\r\n\t\t\t\t\tnode.condEnd = kmpPoint.condEnd || 0\r\n\t\t\t\t\tnode.presence = kmpPoint.presence & 0x7\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Handle complicated sections\r\n\t\tlet enemyPaths = loadedKmp[\"ENPH\"].entries\r\n\t\tfor (let i = 0; i < enemyPaths.length; i++)\r\n\t\t{\r\n\t\t\tlet kmpPath = enemyPaths[i]\r\n\t\t\r\n\t\t\tfor (let p = kmpPath.startIndex; p < kmpPath.startIndex + kmpPath.pointNum - 1; p++)\r\n\t\t\t{\r\n\t\t\t\tdata.enemyPoints.linkNodes(data.enemyPoints.nodes[p], data.enemyPoints.nodes[p + 1])\r\n\t\t\t\tdata.enemyPoints.nodes[p].pathIndex = i\r\n\t\t\t\tdata.enemyPoints.nodes[p + 1].pathIndex = i\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst emptyPrevGroups = kmpPath.prevGroups.find(g => g != 0xff && g < enemyPaths.length) == null\r\n\t\t\t\r\n\t\t\tfor (let j = 0; j < 6; j++)\r\n\t\t\t{\r\n\t\t\t\tif (kmpPath.nextGroups[j] != 0xff && kmpPath.nextGroups[j] < enemyPaths.length)\r\n\t\t\t\t{\r\n\t\t\t\t\tconst nextComesBackToThis = enemyPaths[kmpPath.nextGroups[j]].nextGroups.find(g => g == i) != null\r\n\t\t\t\t\tconst nextIsBattleDispatch = kmpPath.nextGroups[j] > i && enemyPaths[kmpPath.nextGroups[j]].prevGroups.find(g => g != 0xff && g < enemyPaths.length) == null\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (!emptyPrevGroups || (!nextComesBackToThis || nextIsBattleDispatch))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet lastPoint = kmpPath.startIndex + kmpPath.pointNum - 1\r\n\t\t\t\t\t\tlet nextPoint = enemyPaths[kmpPath.nextGroups[j]].startIndex\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdata.enemyPoints.linkNodes(data.enemyPoints.nodes[lastPoint], data.enemyPoints.nodes[nextPoint])\r\n\t\t\t\t\t\tdata.enemyPoints.nodes[lastPoint].pathIndex = i\r\n\t\t\t\t\t\tdata.enemyPoints.nodes[nextPoint].pathIndex = kmpPath.nextGroups[j]\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tlet itemPaths = loadedKmp[\"ITPH\"].entries\r\n\t\tfor (let i = 0; i < itemPaths.length; i++)\r\n\t\t{\r\n\t\t\tlet kmpPath = itemPaths[i]\r\n\t\t\r\n\t\t\tfor (let p = kmpPath.startIndex; p < kmpPath.startIndex + kmpPath.pointNum - 1; p++)\r\n\t\t\t\tdata.itemPoints.linkNodes(data.itemPoints.nodes[p], data.itemPoints.nodes[p + 1])\r\n\t\t\t\r\n\t\t\tfor (let j = 0; j < 6; j++)\r\n\t\t\t{\r\n\t\t\t\tif (kmpPath.nextGroups[j] != 0xff && kmpPath.nextGroups[j] < itemPaths.length)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet lastPoint = kmpPath.startIndex + kmpPath.pointNum - 1\r\n\t\t\t\t\tlet nextPoint = itemPaths[kmpPath.nextGroups[j]].startIndex\r\n\t\t\t\t\t\r\n\t\t\t\t\tdata.itemPoints.linkNodes(data.itemPoints.nodes[lastPoint], data.itemPoints.nodes[nextPoint])\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfor (let i = 0; i < loadedKmp[\"CKPT\"].entries.length; i++)\r\n\t\t{\r\n\t\t\tlet kmpPoint = loadedKmp[\"CKPT\"].entries[i]\r\n\t\t\t\r\n\t\t\tlet node = data.checkpointPoints.addNode()\r\n\t\t\tnode.pos = [new Vec3(kmpPoint.x1, -kmpPoint.z1, 0), new Vec3(kmpPoint.x2, -kmpPoint.z2, 0)]\r\n\t\t\tnode.type = kmpPoint.type\r\n\t\t\tnode.respawnNode = null\r\n\t\t\tnode.firstInPath = false\r\n\t\t\tnode.isRendered = true\r\n\t\t}\r\n\r\n\t\tlet checkpointPaths = loadedKmp[\"CKPH\"].entries\r\n\t\tfor (let i = 0; i < checkpointPaths.length; i++)\r\n\t\t{\r\n\t\t\tlet kmpPath = checkpointPaths[i]\r\n\t\t\r\n\t\t\tfor (let p = kmpPath.startIndex; p < kmpPath.startIndex + kmpPath.pointNum - 1; p++)\r\n\t\t\t\tdata.checkpointPoints.linkNodes(data.checkpointPoints.nodes[p], data.checkpointPoints.nodes[p + 1])\r\n\r\n\t\t\tfor (let j = 0; j < 6; j++)\r\n\t\t\t{\r\n\t\t\t\tif (kmpPath.nextGroups[j] != 0xff && kmpPath.nextGroups[j] < checkpointPaths.length)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet lastPoint = kmpPath.startIndex + kmpPath.pointNum - 1\r\n\t\t\t\t\tlet nextPoint = checkpointPaths[kmpPath.nextGroups[j]].startIndex\r\n\t\t\t\t\t\r\n\t\t\t\t\tdata.checkpointPoints.linkNodes(data.checkpointPoints.nodes[lastPoint], data.checkpointPoints.nodes[nextPoint])\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tdata.checkpointPoints.nodes[kmpPath.startIndex].firstInPath = true\r\n\t\t}\r\n\t\t\r\n\t\tfor (let i = 0; i < loadedKmp[\"POTI\"].entries.length; i++)\r\n\t\t{\r\n\t\t\tlet kmpRoute = loadedKmp[\"POTI\"].entries[i]\r\n\t\t\t\r\n\t\t\tlet route = data.addNewRoute()\r\n\t\t\troute.setting1 = kmpRoute.setting1\r\n\t\t\troute.setting2 = kmpRoute.setting2\r\n\t\t\t\r\n\t\t\tlet lastNode = null\r\n\t\t\t\r\n\t\t\tfor (let kmpPoint of kmpRoute.points)\r\n\t\t\t{\r\n\t\t\t\tlet node = route.points.addNode()\r\n\t\t\t\tnode.pos = kmpPoint.pos.clone()\r\n\t\t\t\tnode.setting1 = kmpPoint.setting1\r\n\t\t\t\tnode.setting2 = kmpPoint.setting2\r\n\t\t\t\t\r\n\t\t\t\tif (lastNode != null)\r\n\t\t\t\t\troute.points.linkNodes(lastNode, node)\r\n\t\t\t\t\r\n\t\t\t\tlastNode = node\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfor (let i = 0; i < loadedKmp[\"CKPT\"].entries.length; i++)\r\n\t\t{\r\n\t\t\tlet respawnIndex = loadedKmp[\"CKPT\"].entries[i].respawnIndex\r\n\t\t\t\r\n\t\t\tif (respawnIndex >= 0 && respawnIndex < data.respawnPoints.nodes.length)\r\n\t\t\t\tdata.checkpointPoints.nodes[i].respawnNode = data.respawnPoints.nodes[respawnIndex]\r\n\t\t}\r\n\r\n\t\tdata.firstIntroCam = (loadedKmp[\"CAME\"].headerData & 0xff00) >>> 8\r\n\t\tdata.firstSelectionCam = loadedKmp[\"CAME\"].headerData & 0xff\r\n\t\t\r\n\t\tdata.isBattleTrack = loadedKmp[\"ITPT\"].entries.length == 0 && loadedKmp[\"CKPT\"].entries.length == 0 && loadedKmp[\"MSPT\"].entries.length > 0\r\n\t\t\r\n\t\treturn data\r\n\t}\r\n\t\r\n\t\r\n\tconvertToStorageFormat(asBattle = false)\r\n\t{\r\n\t\tlet w = new BinaryWriter()\r\n\t\tlet sectionNum = 15\r\n\t\t\r\n\t\t// Write KMP header\r\n\t\tw.writeAscii(\"RKMD\")\r\n\t\t\r\n\t\tlet fileLenAddr = w.head\r\n\t\tw.writeUInt32(0)\r\n\t\t\r\n\t\tw.writeUInt16(sectionNum)\r\n\t\t\r\n\t\tlet headerLenAddr = w.head\r\n\t\tw.writeUInt16(0)\r\n\t\t\r\n\t\tw.writeUInt32(0x9d8)\r\n\t\t\r\n\t\tlet sectionOffsetsAddr = w.head\r\n\t\tfor (let i = 0; i < sectionNum; i++)\r\n\t\t\tw.writeUInt32(0xffffffff)\r\n\t\t\r\n\t\tlet headerEndAddr = w.head\r\n\t\tw.seek(headerLenAddr)\r\n\t\tw.writeUInt16(headerEndAddr)\r\n\t\tw.seek(headerEndAddr)\r\n\t\t\r\n\t\tlet writeUnhandledSection = (tag) =>\r\n\t\t{\r\n\t\t\tlet unhandledSection = this.unhandledSectionData.find(s => s.id == tag)\r\n\t\t\tif (unhandledSection == null)\r\n\t\t\t{\r\n\t\t\t\tunhandledSection =\r\n\t\t\t\t{\r\n\t\t\t\t\tid: tag,\r\n\t\t\t\t\tbytes: [],\r\n\t\t\t\t\textraData: 0\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet unhandledSectionProperties = unhandledSections.find(s => s.id == tag)\r\n\t\t\tlet order = sectionOrder.findIndex(s => s == tag)\r\n\t\t\t\r\n\t\t\tlet head = w.head\r\n\t\t\tw.seek(sectionOffsetsAddr + order * 4)\r\n\t\t\tw.writeUInt32(head - headerEndAddr)\r\n\t\t\t\r\n\t\t\tw.seek(head)\r\n\t\t\tw.writeAscii(unhandledSection.id)\r\n\t\t\tw.writeUInt16(unhandledSection.bytes.length / unhandledSectionProperties.entryLen)\r\n\t\t\tw.writeUInt16(unhandledSection.extraData)\r\n\t\t\tw.writeBytes(unhandledSection.bytes)\r\n\t\t}\r\n\t\t\r\n\t\t// Write KTPT\r\n\t\tlet sectionId = \"KTPT\"\r\n\t\tlet sectionKtptAddr = w.head\r\n\t\tlet sectionKtptOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionKtptOrder * 4)\r\n\t\tw.writeUInt32(sectionKtptAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionKtptAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(this.startPoints.nodes.length)\r\n\t\tw.writeUInt16(this.headerData[sectionId])\r\n\r\n\t\tif (this.startPoints.nodes.length > 0xff)\r\n\t\t\tthrow \"kmp encode: max start points surpassed (have \" + this.startPoints.nodes.length + \", max 255)\"\r\n\t\t\r\n\t\tfor (let p of this.startPoints.nodes)\r\n\t\t\tfor (let prop in format[sectionId])\r\n\t\t\t\tw.write(format[sectionId][prop], p[prop])\r\n\t\t\r\n\t\t// Prepare enemy points\r\n\t\tlet enemyPaths = this.enemyPoints.convertToStorageFormat(asBattle)\r\n\t\tlet enemyPoints = []\r\n\t\tenemyPaths.forEach(path => path.nodes.forEach(node => enemyPoints.push(node)))\r\n\t\t\r\n\t\tif (enemyPaths.length >= 0xff)\r\n\t\t\tthrow \"kmp encode: max enemy path number surpassed (have \" + enemyPaths.length + \", max 254)\"\r\n\t\t\r\n\t\tif (enemyPoints.length > 0xff)\r\n\t\t\tthrow \"kmp encode: max enemy point number surpassed (have \" + enemyPoints.length + \", max 255)\"\r\n\t\t\r\n\t\t// Write ENPT\r\n\t\tsectionId = \"ENPT\"\r\n\t\tlet sectionEnptAddr = w.head\r\n\t\tlet sectionEnptOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionEnptOrder * 4)\r\n\t\tw.writeUInt32(sectionEnptAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionEnptAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(enemyPoints.length)\r\n\t\tw.writeUInt16(this.headerData[sectionId])\r\n\r\n\t\tfor (let p of enemyPoints)\r\n\t\t\tfor (let prop in format[sectionId])\r\n\t\t\t\tw.write(format[sectionId][prop], p[prop])\r\n\t\t\r\n\t\t// Write ENPH\r\n\t\tsectionId = \"ENPH\"\r\n\t\tlet sectionEnphAddr = w.head\r\n\t\tlet sectionEnphOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionEnphOrder * 4)\r\n\t\tw.writeUInt32(sectionEnphAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionEnphAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(enemyPaths.length)\r\n\t\tw.writeUInt16(this.headerData[sectionId])\r\n\t\tfor (let path of enemyPaths)\r\n\t\t{\r\n\t\t\tif (path.nodes.length > 0xff)\r\n\t\t\t\tthrow \"kmp encode: max enemy point number in a path surpassed (have \" + path.nodes.length + \", max 255)\"\r\n\t\t\t\r\n\t\t\tw.writeByte(enemyPoints.findIndex(n => n == path.nodes[0]))\r\n\t\t\tw.writeByte(path.nodes.length)\r\n\t\t\t\r\n\t\t\tlet incomingPaths = path.prev.reduce((accum, p) => accum + 1, 0)\r\n\t\t\tlet outgoingPaths = path.next.reduce((accum, p) => accum + 1, 0)\r\n\t\t\t\r\n\t\t\tif (incomingPaths > 6)\r\n\t\t\t\tthrow \"kmp encode: max incoming connections to an enemy point surpassed (have \" + incomingPaths + \", max 6)\"\r\n\t\t\t\r\n\t\t\tif (outgoingPaths > 6)\r\n\t\t\t\tthrow \"kmp encode: max outgoing connections to an enemy point surpassed (have \" + outgoingPaths + \", max 6)\"\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < 6; i++)\r\n\t\t\t{\r\n\t\t\t\tif (i < path.prev.length)\r\n\t\t\t\t\tw.writeByte(enemyPaths.findIndex(p => p == path.prev[i]))\r\n\t\t\t\telse\r\n\t\t\t\t\tw.writeByte(0xff)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < 6; i++)\r\n\t\t\t{\r\n\t\t\t\tif (i < path.next.length)\r\n\t\t\t\t\tw.writeByte(enemyPaths.findIndex(p => p == path.next[i]))\r\n\t\t\t\telse\r\n\t\t\t\t\tw.writeByte(0xff)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tw.writeUInt16(0)\r\n\t\t}\r\n\t\t\r\n\t\t// Prepare item points\r\n\t\tlet itemPaths = this.itemPoints.convertToStorageFormat()\r\n\t\tlet itemPoints = []\r\n\t\titemPaths.forEach(path => path.nodes.forEach(node => itemPoints.push(node)))\r\n\t\t\r\n\t\tif (itemPaths.length >= 0xff)\r\n\t\t\tthrow \"kmp encode: max item path number surpassed (have \" + itemPaths.length + \", max 254)\"\r\n\t\t\r\n\t\tif (itemPoints.length > 0xff)\r\n\t\t\tthrow \"kmp encode: max item point number surpassed (have \" + itemPoints.length + \", max 255)\"\r\n\t\t\r\n\t\t// Write ITPT\r\n\t\tsectionId = \"ITPT\"\r\n\t\tlet sectionItptAddr = w.head\r\n\t\tlet sectionItptOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionItptOrder * 4)\r\n\t\tw.writeUInt32(sectionItptAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionItptAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(itemPoints.length)\r\n\t\tw.writeUInt16(this.headerData[sectionId])\r\n\r\n\t\tfor (let p of itemPoints)\r\n\t\t\tfor (let prop in format[sectionId])\r\n\t\t\t\tw.write(format[sectionId][prop], p[prop])\r\n\t\t\r\n\t\t// Write ITPH\r\n\t\tsectionId = \"ITPH\"\r\n\t\tlet sectionItphAddr = w.head\r\n\t\tlet sectionItphOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionItphOrder * 4)\r\n\t\tw.writeUInt32(sectionItphAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionItphAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(itemPaths.length)\r\n\t\tw.writeUInt16(this.headerData[sectionId])\r\n\t\tfor (let path of itemPaths)\r\n\t\t{\r\n\t\t\tif (path.nodes.length > 0xff)\r\n\t\t\t\tthrow \"kmp encode: max item point number in a path surpassed (have \" + path.nodes.length + \", max 255)\"\r\n\t\t\t\r\n\t\t\tw.writeByte(itemPoints.findIndex(n => n == path.nodes[0]))\r\n\t\t\tw.writeByte(path.nodes.length)\r\n\t\t\t\r\n\t\t\tlet incomingPaths = path.prev.reduce((accum, p) => accum + 1, 0)\r\n\t\t\tlet outgoingPaths = path.next.reduce((accum, p) => accum + 1, 0)\r\n\t\t\t\r\n\t\t\tif (incomingPaths > 6)\r\n\t\t\t\tthrow \"kmp encode: max incoming connections to an item point surpassed (have \" + incomingPaths + \", max 6)\"\r\n\t\t\t\r\n\t\t\tif (outgoingPaths > 6)\r\n\t\t\t\tthrow \"kmp encode: max outgoing connections to an item point surpassed (have \" + outgoingPaths + \", max 6)\"\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < 6; i++)\r\n\t\t\t{\r\n\t\t\t\tif (i < path.prev.length)\r\n\t\t\t\t\tw.writeByte(itemPaths.findIndex(p => p == path.prev[i]))\r\n\t\t\t\telse\r\n\t\t\t\t\tw.writeByte(0xff)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < 6; i++)\r\n\t\t\t{\r\n\t\t\t\tif (i < path.next.length)\r\n\t\t\t\t\tw.writeByte(itemPaths.findIndex(p => p == path.next[i]))\r\n\t\t\t\telse\r\n\t\t\t\t\tw.writeByte(0xff)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tw.writeUInt16(0)\r\n\t\t}\r\n\t\t\t\t\t\t\r\n\t\t// Prepare checkpoints\r\n\t\tlet checkpointPaths = this.checkpointPoints.convertToStorageFormat()\r\n\t\tlet checkpointPoints = []\r\n\t\tcheckpointPaths.forEach(path => path.nodes.forEach(node => checkpointPoints.push(node)))\r\n\t\t\r\n\t\tif (checkpointPaths.length >= 0xff)\r\n\t\t\tthrow \"kmp encode: max checkpoint path number surpassed (have \" + checkpointPaths.length + \", max 254)\"\r\n\t\t\r\n\t\tif (checkpointPoints.length > 0xff)\r\n\t\t\tthrow \"kmp encode: max checkpoint point number surpassed (have \" + checkpointPoints.length + \", max 255)\"\r\n\t\t\r\n\t\t// Write CKPT\r\n\t\tsectionId = \"CKPT\"\r\n\t\tlet sectionCkptAddr = w.head\r\n\t\tlet sectionCkptOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionCkptOrder * 4)\r\n\t\tw.writeUInt32(sectionCkptAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionCkptAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(checkpointPoints.length)\r\n\t\tw.writeUInt16(this.headerData[sectionId])\r\n\t\tfor (let i = 0; i < checkpointPoints.length; i++)\r\n\t\t{\r\n\t\t\tlet p = checkpointPoints[i]\r\n\t\t\t\r\n\t\t\tw.writeFloat32(p.pos[0].x)\r\n\t\t\tw.writeFloat32(-p.pos[0].y)\r\n\t\t\tw.writeFloat32(p.pos[1].x)\r\n\t\t\tw.writeFloat32(-p.pos[1].y)\r\n\t\t\t\r\n\t\t\tlet respawnIndex = this.respawnPoints.nodes.findIndex(p2 => p.respawnNode === p2)\r\n\t\t\tif (respawnIndex == -1)\r\n\t\t\t\trespawnIndex = 0\r\n\t\t\t\r\n\t\t\tw.writeByte(respawnIndex)\r\n\t\t\tw.writeByte(p.type)\r\n\t\t\t\r\n\t\t\tlet path = checkpointPaths.find(pth => pth.nodes.find(p2 => p === p2) != null)\r\n\t\t\tlet indexInPath = path.nodes.findIndex(p2 => p === p2)\r\n\t\t\t\r\n\t\t\tw.writeByte(indexInPath > 0 ? (i - 1) : 0xff)\r\n\t\t\tw.writeByte(indexInPath < path.nodes.length - 1 ? (i + 1) : 0xff)\r\n\t\t}\r\n\t\t\r\n\t\t// Write CKPH\r\n\t\tsectionId = \"CKPH\"\r\n\t\tlet sectionCkphAddr = w.head\r\n\t\tlet sectionCkphOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionCkphOrder * 4)\r\n\t\tw.writeUInt32(sectionCkphAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionCkphAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(checkpointPaths.length)\r\n\t\tw.writeUInt16(this.headerData[sectionId])\r\n\t\tfor (let path of checkpointPaths)\r\n\t\t{\r\n\t\t\tif (path.nodes.length > 0xff)\r\n\t\t\t\tthrow \"kmp encode: max checkpoint point number in a path surpassed (have \" + path.nodes.length + \", max 255)\"\r\n\t\t\t\r\n\t\t\tw.writeByte(checkpointPoints.findIndex(n => n == path.nodes[0]))\r\n\t\t\tw.writeByte(path.nodes.length)\r\n\t\t\t\r\n\t\t\tlet incomingPaths = path.prev.reduce((accum, p) => accum + 1, 0)\r\n\t\t\tlet outgoingPaths = path.next.reduce((accum, p) => accum + 1, 0)\r\n\t\t\t\r\n\t\t\tif (incomingPaths > 6)\r\n\t\t\t\tthrow \"kmp encode: max incoming connections to an checkpoint point surpassed (have \" + incomingPaths + \", max 6)\"\r\n\t\t\t\r\n\t\t\tif (outgoingPaths > 6)\r\n\t\t\t\tthrow \"kmp encode: max outgoing connections to an checkpoint point surpassed (have \" + outgoingPaths + \", max 6)\"\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < 6; i++)\r\n\t\t\t{\r\n\t\t\t\tif (i < path.prev.length)\r\n\t\t\t\t\tw.writeByte(checkpointPaths.findIndex(p => p == path.prev[i]))\r\n\t\t\t\telse\r\n\t\t\t\t\tw.writeByte(0xff)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < 6; i++)\r\n\t\t\t{\r\n\t\t\t\tif (i < path.next.length)\r\n\t\t\t\t\tw.writeByte(checkpointPaths.findIndex(p => p == path.next[i]))\r\n\t\t\t\telse\r\n\t\t\t\t\tw.writeByte(0xff)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tw.writeUInt16(0)\r\n\t\t}\r\n\t\t\r\n\t\t// Write GOBJ\r\n\t\tsectionId = \"GOBJ\"\r\n\t\tlet sectionGobjAddr = w.head\r\n\t\tlet sectionGobjOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionGobjOrder * 4)\r\n\t\tw.writeUInt32(sectionGobjAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionGobjAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(this.objects.nodes.length)\r\n\t\tw.writeUInt16(this.headerData[sectionId])\r\n\r\n\t\tif (this.objects.nodes.length > 0xff)\r\n\t\t\talert(\"Warning: More than 255 objects found (\" + this.objects.nodes.length + \").\\nTrack slot 5.3 is required for objects to load correctly.\")\r\n\r\n\t\tfor (let p of this.objects.nodes)\r\n\t\t{\r\n\t\t\t// Pack conditional fields into presence before writing\r\n\t\t\tlet packedPresence = (p.presence & 0x7)\r\n\t\t\t\t| (((p.condMode || 0) & 0x7) << 3)\r\n\t\t\t\t| (((p.condStart || 0) & 0x7) << 6)\r\n\t\t\t\t| (((p.condEnd || 0) & 0x7) << 9)\r\n\t\t\tlet saved = p.presence\r\n\t\t\tp.presence = packedPresence\r\n\t\t\tfor (let prop in format[sectionId])\r\n\t\t\t\tw.write(format[sectionId][prop], p[prop])\r\n\t\t\tp.presence = saved\r\n\t\t}\r\n\t\t\r\n\t\t// Write POTI\r\n\t\tsectionId = \"POTI\"\r\n\t\tlet sectionPotiAddr = w.head\r\n\t\tlet sectionPotiOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionPotiOrder * 4)\r\n\t\tw.writeUInt32(sectionPotiAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionPotiAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(this.routes.length)\r\n\t\tw.writeUInt16(this.routes.reduce((accum, route) => accum + route.points.nodes.length, 0))\r\n\t\tfor (let route of this.routes)\r\n\t\t{\r\n\t\t\t// Prepare route points\r\n\t\t\tlet routePaths = route.points.convertToStorageFormat()\r\n\t\t\tlet routePoints = []\r\n\t\t\troutePaths.forEach(path => path.nodes.forEach(node => routePoints.push(node)))\r\n\t\t\t\r\n\t\t\tif (routePoints.length > 0xffff)\r\n\t\t\t\tthrow \"kmp encode: max route point number surpassed (have \" + routePoints.length + \", max 65535)\"\r\n\t\t\t\r\n\t\t\tw.writeUInt16(routePoints.length)\r\n\t\t\tw.writeByte(route.setting1)\r\n\t\t\tw.writeByte(route.setting2)\r\n\t\t\t\r\n\t\t\tfor (let point of routePoints)\r\n\t\t\t{\r\n\t\t\t\tw.writeVec3(new Vec3(point.pos.x, -point.pos.z, -point.pos.y))\r\n\t\t\t\tw.writeUInt16(point.setting1)\r\n\t\t\t\tw.writeUInt16(point.setting2)\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Write AREA\r\n\t\tsectionId = \"AREA\"\r\n\t\tlet sectionAreaAddr = w.head\r\n\t\tlet sectionAreaOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionAreaOrder * 4)\r\n\t\tw.writeUInt32(sectionAreaAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionAreaAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(this.areaPoints.nodes.length)\r\n\t\tw.writeUInt16(this.headerData[sectionId])\r\n\r\n\t\tif (this.areaPoints.nodes.length > 0xff)\r\n\t\t\tthrow \"kmp encode: max AREA points surpassed (have \" + this.areaPoints.nodes.length + \", max 255)\"\r\n\t\t\t\r\n\t\tfor (let p of this.areaPoints.nodes)\r\n\t\t\tfor (let prop in format[sectionId])\r\n\t\t\t\tw.write(format[sectionId][prop], p[prop])\r\n\t\t\r\n\t\t// Write CAME\r\n\t\tsectionId = \"CAME\"\r\n\t\tlet sectionCameAddr = w.head\r\n\t\tlet sectionCameOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionCameOrder * 4)\r\n\t\tw.writeUInt32(sectionCameAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionCameAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(this.cameras.nodes.length)\r\n\t\tw.writeByte(this.firstIntroCam)\r\n\t\tw.writeByte(this.firstSelectionCam)\r\n\r\n\t\tif (this.cameras.nodes.length > 0xff)\r\n\t\t\tthrow \"kmp encode: max cameras surpassed (have \" + this.cameras.nodes.length + \", max 255)\"\r\n\t\t\t\r\n\t\tfor (let p of this.cameras.nodes)\r\n\t\t\tfor (let prop in format[sectionId])\r\n\t\t\t\tw.write(format[sectionId][prop], p[prop])\r\n\t\t\r\n\t\t// Write JGPT\r\n\t\tsectionId = \"JGPT\"\r\n\t\tlet sectionJgptAddr = w.head\r\n\t\tlet sectionJgptOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionJgptOrder * 4)\r\n\t\tw.writeUInt32(sectionJgptAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionJgptAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(this.respawnPoints.nodes.length)\r\n\t\tw.writeUInt16(this.headerData[sectionId])\r\n\r\n\t\tif (this.respawnPoints.nodes.length > 0xff)\r\n\t\t\tthrow \"kmp encode: max respawn points surpassed (have \" + this.respawnPoints.nodes.length + \", max 255)\"\r\n\t\t\t\r\n\t\tfor (let p of this.respawnPoints.nodes)\r\n\t\t\tfor (let prop in format[sectionId])\r\n\t\t\t\tw.write(format[sectionId][prop], p[prop])\r\n\t\t\r\n\t\t// Write CNPT\r\n\t\tsectionId = \"CNPT\"\r\n\t\tlet sectionCnptAddr = w.head\r\n\t\tlet sectionCnptOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionCnptOrder * 4)\r\n\t\tw.writeUInt32(sectionCnptAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionCnptAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(this.cannonPoints.nodes.length)\r\n\t\tw.writeUInt16(this.headerData[sectionId])\r\n\r\n\t\tif (this.cannonPoints.nodes.length > 0xff)\r\n\t\t\tthrow \"kmp encode: max cannon points surpassed (have \" + this.cannonPoints.nodes.length + \", max 255)\"\r\n\t\t\t\r\n\t\tfor (let p of this.cannonPoints.nodes)\r\n\t\t\tfor (let prop in format[sectionId])\r\n\t\t\t\tw.write(format[sectionId][prop], p[prop])\r\n\t\t\r\n\t\t// Write MSPT\r\n\t\tsectionId = \"MSPT\"\r\n\t\tlet sectionMsptAddr = w.head\r\n\t\tlet sectionMsptOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionMsptOrder * 4)\r\n\t\tw.writeUInt32(sectionMsptAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionMsptAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(this.finishPoints.nodes.length)\r\n\t\tw.writeUInt16(this.headerData[sectionId])\r\n\r\n\t\tif (this.finishPoints.nodes.length > 0xff)\r\n\t\t\tthrow \"kmp encode: max finish points surpassed (have \" + this.finishPoints.nodes.length + \", max 255)\"\r\n\t\t\t\r\n\t\tfor (let p of this.finishPoints.nodes)\r\n\t\t\tfor (let prop in format[sectionId])\r\n\t\t\t\tw.write(format[sectionId][prop], p[prop])\r\n\t\t\r\n\t\t// Write STGI\r\n\t\tsectionId = \"STGI\"\r\n\t\tlet sectionStgiAddr = w.head\r\n\t\tlet sectionStgiOrder = sectionOrder.findIndex(s => s == sectionId)\r\n\t\tw.seek(sectionOffsetsAddr + sectionStgiOrder * 4)\r\n\t\tw.writeUInt32(sectionStgiAddr - headerEndAddr)\r\n\t\t\r\n\t\tw.seek(sectionStgiAddr)\r\n\t\tw.writeAscii(sectionId)\r\n\t\tw.writeUInt16(1)\r\n\t\tw.writeUInt16(this.headerData[sectionId])\r\n\r\n\t\tfor (let prop in format[sectionId])\r\n\t\t\tw.write(format[sectionId][prop], this.trackInfo[prop])\r\n\t\t\r\n\t\t// Write file length\r\n\t\tw.seek(fileLenAddr)\r\n\t\tw.writeUInt32(w.getLength())\r\n\t\t\r\n\t\treturn w.getBytes()\r\n\t}\r\n\t\r\n\t\r\n\tconstructor()\r\n\t{\r\n\t\tthis.unhandledSectionData = []\r\n\t\tthis.headerData = {}\r\n\t\t\r\n\t\tthis.startPoints = new NodeGraph()\r\n\t\tthis.startPoints.onAddNode = (node) =>\r\n\t\t{\r\n\t\t\tnode.pos = new Vec3(0, 0, 0)\r\n\t\t\tnode.rotation = new Vec3(0, 0, 0)\r\n\t\t\tnode.playerIndex = 0xffff\r\n\t\t\tnode.padding = 0\r\n\t\t}\r\n\t\tthis.startPoints.onCloneNode = (newNode, oldNode) => { cloneProperties(newNode, oldNode, \"KTPT\") }\r\n\t\t\r\n\t\tthis.routes = []\r\n\t\t\r\n\t\tthis.enemyPoints = new NodeGraph()\r\n\t\tthis.enemyPoints.maxNextNodes = 6\r\n\t\tthis.enemyPoints.maxPrevNodes = 6\r\n\t\tthis.enemyPoints.onAddNode = (node) =>\r\n\t\t{\r\n\t\t\tnode.pos = new Vec3(0, 0, 0)\r\n\t\t\tnode.deviation = 10\r\n\t\t\tnode.setting1 = 0\r\n\t\t\tnode.setting2 = 0\r\n\t\t\tnode.setting3 = 0\r\n\t\t}\r\n\t\tthis.enemyPoints.onCloneNode = (newNode, oldNode) => { cloneProperties(newNode, oldNode, \"ENPT\") }\r\n\t\t\r\n\t\tthis.itemPoints = new NodeGraph()\r\n\t\tthis.itemPoints.maxNextNodes = 6\r\n\t\tthis.itemPoints.maxPrevNodes = 6\r\n\t\tthis.itemPoints.onAddNode = (node) =>\r\n\t\t{\r\n\t\t\tnode.pos = new Vec3(0, 0, 0)\r\n\t\t\tnode.deviation = 10\r\n\t\t\tnode.setting1 = 0\r\n\t\t\tnode.setting2 = 0\r\n\t\t}\r\n\t\tthis.itemPoints.onCloneNode = (newNode, oldNode) => { cloneProperties(newNode, oldNode, \"ITPT\") }\r\n\t\t\r\n\t\tthis.objects = new NodeGraph()\r\n\t\tthis.objects.maxNodes = 0xffff\r\n\t\tthis.objects.onAddNode = (node) =>\r\n\t\t{\r\n\t\t\tnode.pos = new Vec3(0, 0, 0)\r\n\t\t\tnode.rotation = new Vec3(0, 0, 0)\r\n\t\t\tnode.scale = new Vec3(1, 1, 1)\r\n\t\t\tnode.id = 0\r\n\t\t\tnode.xpfThing = 0\r\n\t\t\tnode.route = null\r\n\t\t\tnode.routeIndex = 0xffff\r\n\t\t\tnode.settings = [0, 0, 0, 0, 0, 0, 0, 0]\r\n\t\t\tnode.presence = 7\r\n\t\t\tnode.condMode = 0\r\n\t\t\tnode.condStart = 0\r\n\t\t\tnode.condEnd = 0\r\n\t\t}\r\n\t\tthis.objects.onCloneNode = (newNode, oldNode) => {\r\n\t\t\tcloneProperties(newNode, oldNode, \"GOBJ\")\r\n\t\t\tnewNode.condMode = oldNode.condMode || 0\r\n\t\t\tnewNode.condStart = oldNode.condStart || 0\r\n\t\t\tnewNode.condEnd = oldNode.condEnd || 0\r\n\t\t}\r\n\t\t\r\n\t\tthis.checkpointPoints = new NodeGraph()\r\n\t\tthis.checkpointPoints.maxNextNodes = 6\r\n\t\tthis.checkpointPoints.maxPrevNodes = 6\r\n\t\tthis.checkpointPoints.onAddNode = (node) =>\r\n\t\t{\r\n\t\t\tnode.pos = [new Vec3(0, 0, 0), new Vec3(0, 0, 0)]\r\n\t\t\tnode.respawnNode = null\r\n\t\t\tnode.respawnIndex = 0\r\n\t\t\tnode.type = 0xff\r\n\t\t\tnode.firstInPath = false\r\n\t\t\tnode.isRendered = true\r\n\t\t}\r\n\t\tthis.checkpointPoints.onCloneNode = (newNode, oldNode) =>\r\n\t\t{\r\n\t\t\tnewNode.pos = [oldNode.pos[0].clone(), oldNode.pos[1].clone()]\r\n\t\t\tnewNode.respawnNode = oldNode.respawnNode\r\n\t\t\tnewNode.respawnIndex = oldNode.respawnIndex\r\n\t\t\tnewNode.type = oldNode.type\r\n\t\t\tnewNode.firstInPath = oldNode.firstInPath\r\n\t\t\tnewNode.isRendered = oldNode.isRendered\r\n\t\t}\r\n\t\tthis.checkpointPoints.findFirstNode = (nodes) =>\r\n\t\t{\r\n\t\t\treturn nodes.find(n => n.type == 0)\r\n\t\t}\r\n\t\t\r\n\t\tthis.respawnPoints = new NodeGraph()\r\n\t\tthis.respawnPoints.onAddNode = (node) =>\r\n\t\t{\r\n\t\t\tnode.pos = new Vec3(0, 0, 0)\r\n\t\t\tnode.rotation = new Vec3(0, 0, 0)\r\n\t\t\tnode.id = 0\r\n\t\t\tnode.soundData = 0xffff\r\n\t\t}\r\n\t\tthis.respawnPoints.onCloneNode = (newNode, oldNode) => { cloneProperties(newNode, oldNode, \"JGPT\") }\r\n\t\t\r\n\t\tthis.cannonPoints = new NodeGraph()\r\n\t\tthis.cannonPoints.onAddNode = (node) =>\r\n\t\t{\r\n\t\t\tnode.pos = new Vec3(0, 0, 0)\r\n\t\t\tnode.rotation = new Vec3(0, 0, 0)\r\n\t\t\tnode.id = 0\r\n\t\t\tnode.effect = 0xffff\r\n\t\t}\r\n\t\tthis.cannonPoints.onCloneNode = (newNode, oldNode) => { cloneProperties(newNode, oldNode, \"CNPT\") }\r\n\t\t\r\n\t\tthis.finishPoints = new NodeGraph()\r\n\t\tthis.finishPoints.onAddNode = (node) =>\r\n\t\t{\r\n\t\t\tnode.pos = new Vec3(0, 0, 0)\r\n\t\t\tnode.rotation = new Vec3(0, 0, 0)\r\n\t\t\tnode.id = 0\r\n\t\t\tnode.padding = 0\r\n\t\t}\r\n\t\tthis.finishPoints.onCloneNode = (newNode, oldNode) => { cloneProperties(newNode, oldNode, \"MSPT\") }\r\n\r\n\t\tthis.areaPoints = new NodeGraph()\r\n\t\tthis.areaPoints.enableCOOB = false\r\n\t\tthis.areaPoints.onAddNode = (node) =>\r\n\t\t{\r\n\t\t\tnode.pos = new Vec3(0, 0, 0)\r\n\t\t\tnode.rotation = new Vec3(0, 0, 0)\r\n\t\t\tnode.scale = new Vec3(1, 1, 1)\r\n\t\t\tnode.shape = 0\r\n\t\t\tnode.type = 0\r\n\t\t\tnode.priority = 0\r\n\t\t\tnode.setting1 = 0\r\n\t\t\tnode.setting2 = 0\r\n\t\t\tnode.cameraIndex = 0xff\r\n\t\t\tnode.routeIndex = 0xff\r\n\t\t\tnode.enemyIndex = 0xff\r\n\t\t\tnode.isRendered = false\r\n\t\t}\r\n\t\tthis.areaPoints.onCloneNode = (newNode, oldNode) => { cloneProperties(newNode, oldNode, \"AREA\") }\r\n\r\n\t\tthis.cameras = new NodeGraph()\r\n\t\tthis.firstIntroCam = 0\r\n\t\tthis.firstSelectionCam = 0\r\n\t\tthis.cameras.onAddNode = (node) =>\r\n\t\t{\r\n\t\t\tnode.pos = new Vec3(0, 0, 0)\r\n\t\t\tnode.rotation = new Vec3(0, 0, 0)\r\n\t\t\tnode.type = 0\r\n\t\t\tnode.nextCam = 0\r\n\t\t\tnode.shake = 0\r\n\t\t\tnode.routeIndex = 0xff\r\n\t\t\tnode.vCam = 0\r\n\t\t\tnode.vZoom = 0\r\n\t\t\tnode.vView = 0\r\n\t\t\tnode.start = 0\r\n\t\t\tnode.movie = 0\r\n\t\t\tnode.zoomStart = 0\r\n\t\t\tnode.zoomEnd = 0\r\n\t\t\tnode.viewPosStart = new Vec3(0, 0, 0)\r\n\t\t\tnode.viewPosEnd = new Vec3(0, 0, 0)\r\n\t\t\tnode.time = 0\r\n\t\t}\r\n\t\tthis.cameras.onCloneNode = (newNode, oldNode) => { cloneProperties(newNode, oldNode, \"CAME\") }\r\n\t\t\r\n\t\tthis.trackInfo = {}\r\n\t\tthis.trackInfo.lapCount = 3\r\n\t\tthis.trackInfo.polePosition = 0\r\n\t\tthis.trackInfo.driverDistance = 0\r\n\t\tthis.trackInfo.lensFlareFlash = 0\r\n\t\tthis.trackInfo.unknown1 = 0\r\n\t\tthis.trackInfo.flareColor = [0xff, 0xff, 0xff, 0x00]\r\n\t\tthis.trackInfo.unknown2 = 0\r\n\t\tthis.trackInfo.speedMod = 0\r\n\t}\r\n\t\r\n\t\r\n\taddNewRoute()\r\n\t{\r\n\t\tlet route = {}\r\n\t\troute.setting1 = 0\r\n\t\troute.setting2 = 0\r\n\t\t\r\n\t\troute.points = new NodeGraph()\r\n\t\troute.points.maxNodes = 0xffff\r\n\t\troute.points.onAddNode = (node) =>\r\n\t\t{\r\n\t\t\tnode.pos = new Vec3(0, 0, 0)\r\n\t\t\tnode.setting1 = 0\r\n\t\t\tnode.setting2 = 0\r\n\t\t}\r\n\t\troute.points.onCloneNode = (newNode, oldNode) =>\r\n\t\t{\r\n\t\t\tnewNode.pos = oldNode.pos.clone()\r\n\t\t\tnewNode.setting1 = oldNode.setting1\r\n\t\t\tnewNode.setting2 = oldNode.setting2\r\n\t\t}\r\n\t\t\r\n\t\tthis.routes.push(route)\r\n\t\treturn route\r\n\t}\r\n\t\r\n\t\r\n\tremoveRespawnPointLinks(node)\r\n\t{\r\n\t\tfor (let checkpoint of this.checkpointPoints.nodes)\r\n\t\t{\r\n\t\t\tif (checkpoint.respawnNode === node)\r\n\t\t\t{\r\n                checkpoint.respawnNode = this.respawnPoints.nodes.length > 0? this.respawnPoints.nodes[0] : null\r\n            }\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\trefreshIndices(asBattle)\r\n\t{\r\n\t\tthis.enemyPoints.convertToStorageFormat(asBattle)\r\n\t\tthis.itemPoints.convertToStorageFormat()\r\n\t\tthis.checkpointPoints.convertToStorageFormat()\r\n\t}\r\n\t\r\n\t\r\n\tclone()\r\n\t{\r\n\t\tlet cloned = new KmpData()\r\n\t\t\r\n\t\tcloned.trackInfo = {}\r\n\t\tcloned.trackInfo.lapCount = this.trackInfo.lapCount\r\n\t\tcloned.trackInfo.polePosition = this.trackInfo.polePosition\r\n\t\tcloned.trackInfo.driverDistance = this.trackInfo.driverDistance\r\n\t\tcloned.trackInfo.lensFlareFlash = this.trackInfo.lensFlareFlash\r\n\t\tcloned.trackInfo.unknown1 = this.trackInfo.unknown1\r\n\t\tcloned.trackInfo.flareColor = [\r\n\t\t\tthis.trackInfo.flareColor[0],\r\n\t\t\tthis.trackInfo.flareColor[1],\r\n\t\t\tthis.trackInfo.flareColor[2],\r\n\t\t\tthis.trackInfo.flareColor[3]\r\n\t\t]\r\n\t\tcloned.trackInfo.unknown2 = this.trackInfo.unknown2\r\n\t\tcloned.trackInfo.speedMod = this.trackInfo.speedMod\r\n\r\n\t\tcloned.unhandledSectionData = this.unhandledSectionData\r\n\t\tcloned.startPoints = this.startPoints.clone()\r\n\t\tcloned.finishPoints = this.finishPoints.clone()\r\n\t\tcloned.enemyPoints = this.enemyPoints.clone()\r\n\t\tcloned.itemPoints = this.itemPoints.clone()\r\n\t\tcloned.checkpointPoints = this.checkpointPoints.clone()\r\n\t\tcloned.objects = this.objects.clone()\r\n\t\tcloned.respawnPoints = this.respawnPoints.clone()\r\n\t\tcloned.cannonPoints = this.cannonPoints.clone()\r\n\t\tcloned.areaPoints = this.areaPoints.clone()\r\n\t\tcloned.cameras = this.cameras.clone()\r\n\t\tcloned.firstIntroCam = this.firstIntroCam\r\n\t\tcloned.firstSelectionCam = this.firstSelectionCam\r\n\t\t\r\n\t\tfor (let route of this.routes)\r\n\t\t{\r\n\t\t\tlet newRoute = cloned.addNewRoute()\r\n\t\t\tnewRoute.setting1 = route.setting1\r\n\t\t\tnewRoute.setting2 = route.setting2\r\n\t\t\tnewRoute.points = route.points.clone()\r\n\t\t}\r\n\t\t\r\n\t\tfor (let checkpoint of cloned.checkpointPoints.nodes)\r\n\t\t{\r\n\t\t\tlet respawnIndex = this.respawnPoints.nodes.findIndex(p => p == checkpoint.respawnNode)\r\n\t\t\tcheckpoint.respawnNode = null\r\n\t\t\t\r\n\t\t\tif (respawnIndex >= 0)\r\n\t\t\t\tcheckpoint.respawnNode = cloned.respawnPoints.nodes[respawnIndex]\r\n\t\t}\r\n\t\t\r\n\t\treturn cloned\r\n\t}\r\n}\r\n\r\n\r\nclass NodeGraph\r\n{\r\n\tconstructor()\r\n\t{\r\n\t\tthis.nodes = []\r\n\t\tthis.maxNodes = 0xff\r\n\t\tthis.maxNextNodes = 1\r\n\t\tthis.maxPrevNodes = 1\r\n\t\tthis.onAddNode = () => { }\r\n\t\tthis.onCloneNode = () => { }\r\n\t\tthis.findFirstNode = (nodes) => (nodes.length > 0 ? nodes[0] : null)\r\n\t}\r\n\t\r\n\t\r\n\taddNode()\r\n\t{\r\n\t\tlet node =\r\n\t\t{\r\n\t\t\tnext: [],\r\n\t\t\tprev: []\r\n\t\t}\r\n\t\t\r\n\t\tthis.onAddNode(node)\r\n\t\t\r\n\t\tthis.nodes.push(node)\r\n\t\treturn node\r\n\t}\r\n\t\r\n\t\r\n\tremoveNode(node)\r\n\t{\r\n\t\tfor (let prev of node.prev)\r\n\t\t{\r\n\t\t\tlet nextIndex = prev.node.next.findIndex(n => n.node == node)\r\n\t\t\tif (nextIndex >= 0)\r\n\t\t\t\tprev.node.next.splice(nextIndex, 1)\r\n\t\t}\r\n\t\t\r\n\t\tfor (let next of node.next)\r\n\t\t{\r\n\t\t\tlet prevIndex = next.node.prev.findIndex(n => n.node == node)\r\n\t\t\tif (prevIndex >= 0)\r\n\t\t\t\tnext.node.prev.splice(prevIndex, 1)\r\n\t\t}\r\n\t\t\r\n\t\tthis.nodes.splice(this.nodes.findIndex(n => n == node), 1)\r\n\t}\r\n\t\r\n\t\r\n\tlinkNodes(node1, node2)\r\n\t{\r\n\t\tif (node1 == node2)\r\n\t\t\treturn\r\n\r\n\t\tlet node1NextIndex = node1.next.findIndex(n => n.node == node2)\r\n\t\tif (node1NextIndex >= 0)\r\n\t\t\tnode1.next[node1NextIndex].count += 1\r\n\t\telse\r\n\t\t\tnode1.next.push({ node: node2, count: 1 })\r\n\t\t\r\n\t\tlet node2PrevIndex = node2.prev.findIndex(n => n.node == node1)\r\n\t\tif (node2PrevIndex >= 0)\r\n\t\t\tnode2.prev[node2PrevIndex].count += 1\r\n\t\telse\r\n\t\t\tnode2.prev.push({ node: node1, count: 1 })\r\n\t}\r\n\t\r\n\t\r\n\tunlinkNodes(node1, node2)\r\n\t{\r\n\t\tlet node1NextIndex = node1.next.findIndex(n => n.node == node2)\r\n\t\tif (node1NextIndex >= 0)\r\n\t\t{\r\n\t\t\tnode1.next[node1NextIndex].count -= 1\r\n\t\t\tif (node1.next[node1NextIndex].count <= 0)\r\n\t\t\t\tnode1.next.splice(node1NextIndex, 1)\r\n\t\t}\r\n\t\t\r\n\t\tlet node2PrevIndex = node2.prev.findIndex(n => n.node == node1)\r\n\t\tif (node2PrevIndex >= 0)\r\n\t\t{\r\n\t\t\tnode2.prev[node2PrevIndex].count -= 1\r\n\t\t\tif (node2.prev[node2PrevIndex].count <= 0)\r\n\t\t\t\tnode2.prev.splice(node2PrevIndex, 1)\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tclone()\r\n\t{\r\n\t\tlet clonedNodes = []\r\n\t\tlet clonedNodesMap = new Map()\r\n\t\tfor (let node of this.nodes)\r\n\t\t{\r\n\t\t\tlet clonedNode =\r\n\t\t\t{\r\n\t\t\t\tnext: [],\r\n\t\t\t\tprev: []\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.onCloneNode(clonedNode, node)\r\n\t\t\t\r\n\t\t\tclonedNodesMap.set(node, clonedNode)\r\n\t\t\tclonedNodes.push(clonedNode)\r\n\t\t}\r\n\t\t\r\n\t\tfor (let node of this.nodes)\r\n\t\t{\r\n\t\t\tlet clonedNode = clonedNodesMap.get(node)\r\n\t\t\t\r\n\t\t\tfor (let next of node.next)\r\n\t\t\t{\r\n\t\t\t\tclonedNode.next.push({\r\n\t\t\t\t\tnode: clonedNodesMap.get(next.node),\r\n\t\t\t\t\tcount: next.count\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let prev of node.prev)\r\n\t\t\t{\r\n\t\t\t\tclonedNode.prev.push({\r\n\t\t\t\t\tnode: clonedNodesMap.get(prev.node),\r\n\t\t\t\t\tcount: prev.count\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tlet graph = new NodeGraph()\r\n\t\tgraph.nodes = clonedNodes\r\n\t\tgraph.maxNextNodes = this.maxNextNodes\r\n\t\tgraph.maxPrevNodes = this.maxPrevNodes\r\n\t\tgraph.headerData = this.headerData\r\n\t\tgraph.onAddNode = this.onAddNode\r\n\t\tgraph.onCloneNode = this.onCloneNode\r\n\t\treturn graph\r\n\t}\r\n\t\r\n\t\r\n\tconvertToStorageFormat(asBattle = false)\r\n\t{\r\n\t\tlet paths = []\r\n\t\t\r\n\t\tlet nodesToHandle = this.nodes.map(n => n)\r\n\t\tlet nodesToPath = new Map()\r\n\t\t\r\n\t\tconst firstNode = this.findFirstNode(this.nodes) || (this.nodes.length > 0 ? this.nodes[0] : null)\r\n\t\tif (firstNode)\r\n\t\t{\r\n\t\t\tnodesToHandle.filter(n => n !== firstNode)\r\n\t\t\tnodesToHandle.unshift(firstNode)\r\n\t\t}\r\n\t\t\r\n\t\tconst nodeIsBattleDispatcher = (node) => (asBattle && node.next.length + node.prev.length > 2)\r\n\t\t\r\n\t\twhile (nodesToHandle.length > 0)\r\n\t\t{\r\n\t\t\tconst node = nodesToHandle[0]\r\n\t\t\t\r\n\t\t\tconst pathIndex = paths.length\r\n\t\t\tlet path = { nodes: [], next: [], prev: [] }\r\n\t\t\tpaths.push(path)\r\n\t\t\t\r\n\t\t\tif (nodeIsBattleDispatcher(node))\r\n\t\t\t{\r\n\t\t\t\tnode.pathIndex = pathIndex\r\n\t\t\t\tpath.nodes.push(node)\r\n\t\t\t\tnodesToPath.set(node, path)\r\n\t\t\t\tnodesToHandle = nodesToHandle.filter(n => n !== node)\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet nodeAtPathStart = node\r\n\t\t\tif (node !== firstNode)\r\n\t\t\t{\r\n\t\t\t\twhile (nodeAtPathStart.prev.length == 1 && nodeAtPathStart.prev[0].node.next.length == 1 && !nodeIsBattleDispatcher(nodeAtPathStart.prev[0].node))\r\n\t\t\t\t{\r\n\t\t\t\t\tif (nodesToPath.get(nodeAtPathStart.prev[0].node, path))\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t\r\n\t\t\t\t\tnodeAtPathStart = nodeAtPathStart.prev[0].node\r\n\t\t\t\t\tif (nodeAtPathStart === node)\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tnodeAtPathStart.pathIndex = pathIndex\r\n\t\t\tpath.nodes.push(nodeAtPathStart)\r\n\t\t\tnodesToPath.set(nodeAtPathStart, path)\r\n\t\t\tnodesToHandle = nodesToHandle.filter(n => n !== nodeAtPathStart)\r\n\t\t\t\r\n\t\t\tlet nodeAtPath = nodeAtPathStart\r\n\t\t\twhile (nodeAtPath.next.length == 1 && nodeAtPath.next[0].node.prev.length == 1 && !nodeIsBattleDispatcher(nodeAtPath.next[0].node))\r\n\t\t\t{\r\n\t\t\t\tnodeAtPath = nodeAtPath.next[0].node\r\n\t\t\t\tif (nodesToPath.get(nodeAtPath, path))\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\r\n\t\t\t\tif ('firstInPath' in nodeAtPath && nodeAtPath.firstInPath)\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\r\n\t\t\t\tnodeAtPath.pathIndex = pathIndex\r\n\t\t\t\tpath.nodes.push(nodeAtPath)\r\n\t\t\t\tnodesToPath.set(nodeAtPath, path)\r\n\t\t\t\tnodesToHandle = nodesToHandle.filter(n => n !== nodeAtPath)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet pointIndex = 0\r\n\t\tfor (let path of paths)\r\n\t\t{\r\n\t\t\tlet lastNode = path.nodes[path.nodes.length - 1]\r\n\t\t\t\r\n\t\t\tfor (let next of lastNode.next)\r\n\t\t\t{\r\n\t\t\t\tlet nextPath = nodesToPath.get(next.node)\r\n\t\t\t\tfor (let i = 0; i < next.count; i++)\r\n\t\t\t\t\tpath.next.push(nextPath)\r\n\t\t\t\t\r\n\t\t\t\tnextPath.prev.push(path)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < path.nodes.length; i++)\r\n\t\t\t{\r\n\t\t\t\tpath.nodes[i].pathPointIndex = i\r\n\t\t\t\tpath.nodes[i].pointIndex = pointIndex\r\n\t\t\t\tpointIndex += 1\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet checkpointPaths = paths.filter(p => 'firstInPath' in p.nodes[0])\r\n\t\tif (checkpointPaths.length > 0)\r\n\t\t{\r\n\t\t\tfor (let group of checkpointPaths) {\r\n\t\t\t\tgroup.layer = -1\r\n\t\t\t\tfor (let node of group.nodes)\r\n\t\t\t\t\tnode.pathLayer = null\r\n\t\t\t}\r\n\r\n\t\t\tconst calculateGroupLayers = (group, layer) =>\r\n\t\t\t{\r\n\t\t\t\tgroup.layer = layer\r\n\t\t\t\tif (layer > this.maxLayer)\r\n\t\t\t\t\tthis.maxLayer = layer\r\n\t\t\t\tif (checkpointPaths.length > 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (let next of group.next)\r\n\t\t\t\t\t\tif (next.layer === -1)\r\n\t\t\t\t\t\t\tcalculateGroupLayers(next, layer + 1)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\r\n\t\t\tthis.maxLayer = 0\r\n\t\t\tcalculateGroupLayers(checkpointPaths[0], 0)\r\n\t\t\r\n\t\t\tfor (let path of checkpointPaths)\r\n\t\t\t\tfor (let node of path.nodes)\r\n\t\t\t\t{\r\n\t\t\t\t\tnode.pathLen = path.nodes.length\r\n\t\t\t\t\tnode.pathLayer = path.layer\r\n\t\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (asBattle)\r\n\t\t{\r\n\t\t\tfor (let path of paths)\r\n\t\t\t{\r\n\t\t\t\tif (path.nodes.length == 1 && path.next.length + path.prev.length > 2)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (let prev of path.prev)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (path.next.find(g => g === prev))\r\n\t\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tpath.next.push(prev)\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tpath.prev = []\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn paths\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { KmpData }\r\n", "const { BinaryParser } = require(\"./binaryParser.js\")\r\nconst { ModelBuilder } = require(\"./modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\n\r\n\r\nconst cat = (isDeath, isInvis, isEffect, isWall, isItem) => { return { isDeath, isInvis, isEffect, isWall, isItem }}\r\nconst collisionTypeData =\r\n[\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [1.0, 1.0, 1.0, 1.0], priority: 0, name: \"Road\"                      },\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [1.0, 0.9, 0.8, 1.0], priority: 0, name: \"Slippery Road (sand/dirt)\" },\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [0.0, 0.8, 0.0, 1.0], priority: 0, name: \"Weak Off-Road\"             },\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [0.0, 0.6, 0.0, 1.0], priority: 0, name: \"Off-Road\"                  },\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [0.0, 0.4, 0.0, 1.0], priority: 0, name: \"Heavy Off-Road\"            },\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [0.8, 0.9, 1.0, 1.0], priority: 0, name: \"Slippery Road (ice)\"       },\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [1.0, 0.5, 0.0, 1.0], priority: 0, name: \"Boost Panel\"               },\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [1.0, 0.6, 0.0, 1.0], priority: 0, name: \"Boost Ramp\"                },\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [1.0, 0.8, 0.0, 1.0], priority: 0, name: \"Slow Ramp\"                 },\r\n\t{ f: cat(0, 0, 0, 0, 1), c: [0.9, 0.9, 1.0, 0.5], priority: 2, name: \"Item Road\"                 },\r\n\t{ f: cat(1, 0, 0, 0, 0), c: [0.7, 0.1, 0.1, 1.0], priority: 0, name: \"Solid Fall\"                },\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [0.0, 0.5, 1.0, 1.0], priority: 0, name: \"Moving Water\"              },\r\n\t{ f: cat(0, 0, 0, 1, 0), c: [0.6, 0.6, 0.6, 1.0], priority: 0, name: \"Wall\"                      },\r\n\t{ f: cat(0, 1, 0, 1, 0), c: [0.0, 0.0, 0.6, 0.8], priority: 3, name: \"Invisible Wall\"            },\r\n\t{ f: cat(0, 0, 0, 0, 1), c: [0.6, 0.6, 0.7, 0.5], priority: 2, name: \"Item Wall\"                 },\r\n\t{ f: cat(0, 0, 0, 1, 0), c: [0.6, 0.6, 0.6, 1.0], priority: 0, name: \"Wall 2\"                    },\r\n\t{ f: cat(1, 0, 0, 0, 0), c: [0.8, 0.0, 0.0, 0.8], priority: 4, name: \"Fall Boundary\"             },\r\n\t{ f: cat(0, 0, 1, 0, 0), c: [1.0, 0.0, 0.5, 0.8], priority: 1, name: \"Cannon Activator\"          },\r\n\t{ f: cat(0, 0, 1, 0, 0), c: [0.5, 0.0, 1.0, 0.5], priority: 1, name: \"Force Recalculation\"       },\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [0.0, 0.3, 1.0, 1.0], priority: 0, name: \"Half-pipe Ramp\"            },\r\n\t{ f: cat(0, 1, 0, 1, 0), c: [0.8, 0.4, 0.0, 0.8], priority: 1, name: \"Player-Only Wall\"          },\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [0.9, 0.9, 1.0, 1.0], priority: 0, name: \"Moving Road\"               },\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [0.9, 0.7, 1.0, 1.0], priority: 0, name: \"Sticky Road\"               },\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [1.0, 1.0, 1.0, 1.0], priority: 0, name: \"Road 2\"                    },\r\n\t{ f: cat(0, 0, 1, 0, 0), c: [1.0, 0.0, 1.0, 0.8], priority: 1, name: \"Sound Trigger\"             },\r\n\t{ f: cat(0, 1, 0, 1, 0), c: [0.4, 0.6, 0.4, 0.8], priority: 1, name: \"Weak Wall\"                 },\r\n\t{ f: cat(0, 0, 1, 0, 0), c: [0.8, 0.0, 1.0, 0.8], priority: 1, name: \"Effect Trigger\"            },\r\n\t{ f: cat(0, 0, 1, 0, 0), c: [1.0, 0.0, 1.0, 0.5], priority: 1, name: \"Item State Modifier\"       },\r\n\t{ f: cat(0, 1, 0, 1, 0), c: [0.0, 0.6, 0.0, 0.8], priority: 3, name: \"Half-pipe Invis Wall\"      },\r\n\t{ f: cat(0, 0, 0, 0, 0), c: [0.9, 0.9, 1.0, 1.0], priority: 0, name: \"Rotating Road\"             },\r\n\t{ f: cat(0, 0, 0, 1, 0), c: [0.8, 0.7, 0.8, 1.0], priority: 0, name: \"Special Wall\"              },\r\n\t{ f: cat(0, 1, 0, 1, 0), c: [0.0, 0.0, 0.6, 0.8], priority: 3, name: \"Invisible Wall 2\"          },\r\n]\r\n\r\n\r\nclass KclLoader\r\n{\r\n\tstatic load(bytes, cfg, hl)\r\n\t{\r\n\t\tlet parser = new BinaryParser(bytes)\r\n\t\t\r\n\t\tlet section1Offset = parser.readUInt32()\r\n\t\tlet section2Offset = parser.readUInt32()\r\n\t\tlet section3Offset = parser.readUInt32()\r\n\t\tlet section4Offset = parser.readUInt32()\r\n\r\n\t\tlet triLists = [ [], [], [], [], [] ]\r\n\t\t\r\n\t\tlet vertices = []\r\n\t\tparser.seek(section1Offset)\r\n\t\twhile (parser.head < section2Offset)\r\n\t\t{\r\n\t\t\tlet x = parser.readFloat32()\r\n\t\t\tlet y = parser.readFloat32()\r\n\t\t\tlet z = parser.readFloat32()\r\n\t\t\tvertices.push(new Vec3(x, -z, -y))\r\n\t\t}\r\n\t\t\r\n\t\tlet normals = []\r\n\t\tparser.seek(section2Offset)\r\n\t\twhile (parser.head < section3Offset + 0x10)\r\n\t\t{\r\n\t\t\tlet x = parser.readFloat32()\r\n\t\t\tlet y = parser.readFloat32()\r\n\t\t\tlet z = parser.readFloat32()\r\n\t\t\tnormals.push(new Vec3(x, -z, -y))\r\n\t\t}\r\n\t\t\r\n\t\tlet model = new ModelBuilder()\r\n\r\n\t\tif (!cfg.kclEnableModel)\r\n\t\t{\r\n\t\t\tmodel.addTri(new Vec3(0, 0, 0), new Vec3(1, 0, 0), new Vec3(0, 1, 0))\r\n\t\t\treturn model.calculateNormals()\r\n\t\t}\r\n\r\n\t\tlet triIndex = -1;\r\n\t\t\r\n\t\tparser.seek(section3Offset + 0x10)\r\n\t\twhile (parser.head < section4Offset)\r\n\t\t{\r\n\t\t\ttriIndex++\r\n\r\n\t\t\tlet len = parser.readFloat32()\r\n\t\t\tlet posIndex = parser.readUInt16()\r\n\t\t\tlet dirIndex = parser.readUInt16()\r\n\t\t\tlet normAIndex = parser.readUInt16()\r\n\t\t\tlet normBIndex = parser.readUInt16()\r\n\t\t\tlet normCIndex = parser.readUInt16()\r\n\t\t\tlet collisionFlags = parser.readUInt16()\r\n\t\t\t\r\n\t\t\tif (posIndex >= vertices.length ||\r\n\t\t\t\tdirIndex >= normals.length ||\r\n\t\t\t\tnormAIndex >= normals.length ||\r\n\t\t\t\tnormBIndex >= normals.length ||\r\n\t\t\t\tnormCIndex >= normals.length)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tlet vertex = vertices[posIndex]\r\n\t\t\tlet direction = normals[dirIndex]\r\n\t\t\tlet normalA = normals[normAIndex]\r\n\t\t\tlet normalB = normals[normBIndex]\r\n\t\t\tlet normalC = normals[normCIndex]\r\n\t\t\t\r\n\t\t\tlet crossA = normalA.cross(direction)\r\n\t\t\tlet crossB = normalB.cross(direction)\r\n\t\t\tlet v1 = vertex\r\n\t\t\tlet v2 = vertex.add(crossB.scale(len / crossB.dot(normalC)))\r\n\t\t\tlet v3 = vertex.add(crossA.scale(len / crossA.dot(normalC)))\r\n\t\t\t\r\n\t\t\tif (!v1.isFinite() || !v2.isFinite() || !v3.isFinite())\r\n\t\t\t\tcontinue\r\n\r\n\t\t\tlet flagBasicType = collisionFlags & 0x1f\r\n\t\t\tif (flagBasicType >= collisionTypeData.length)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tlet data = collisionTypeData[flagBasicType]\r\n\t\t\t\r\n\t\t\tlet isTargetFlag = \r\n\t\t\t\t!(hl.baseType < 0 && hl.basicEffect < 0 && hl.blightEffect < 0 && hl.intensity < 0 && hl.collisionEffect < 0) &&\r\n\t\t\t\t(hl.baseType == -1 || flagBasicType == hl.baseType) &&\r\n\t\t\t\t(hl.basicEffect == -1 || ((collisionFlags >>> 5) & 0x7) == hl.basicEffect) &&\r\n\t\t\t\t(hl.blightEffect == -1 || ((collisionFlags >>> 8) & 0x7) == hl.blightEffect) &&\r\n\t\t\t\t(hl.intensity == -1 || ((collisionFlags >>> 11) & 0x3) == hl.intensity) &&\r\n\t\t\t\t(hl.collisionEffect == -1 || ((collisionFlags >>> 13) & 0x7) == hl.collisionEffect)\r\n\r\n\t\t\tif (isTargetFlag || (cfg.kclTriIndex[0] <= triIndex && cfg.kclTriIndex[1] >= triIndex))\r\n\t\t\t{\r\n\t\t\t\tlet color = [1, 1, 0, 1]\r\n\t\t\t\ttriLists[data.priority].push({ v1, v2, v3, color })\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\r\n\t\t\tif (cfg && data.f.isWall && cfg.kclEnableWalls !== undefined && !cfg.kclEnableWalls)\r\n\t\t\t\tcontinue\r\n\r\n\t\t\tif (cfg && data.f.isDeath && cfg.kclEnableDeathBarriers !== undefined && !cfg.kclEnableDeathBarriers)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tif (cfg && data.f.isInvis && cfg.kclEnableInvisible !== undefined && !cfg.kclEnableInvisible)\r\n\t\t\t\tcontinue\r\n\r\n\t\t\tif (cfg && data.f.isItem && cfg.kclEnableItemRoad !== undefined && !cfg.kclEnableItemRoad)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tif (cfg && data.f.isEffect && cfg.kclEnableEffects !== undefined && !cfg.kclEnableEffects)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tlet color = data.c\r\n\t\t\tif (cfg && cfg.kclEnableColors !== undefined && !cfg.kclEnableColors)\r\n\t\t\t\tcolor = [1, 1, 1, 1]\r\n\r\n\t\t\tif (cfg && cfg.kclHighlighter !== undefined)\r\n\t\t\t{\r\n\t\t\t\tlet v1to2 = v2.sub(v1)\r\n\t\t\t\tlet v1to3 = v3.sub(v1)\r\n\t\t\t\tlet normal = v1to2.cross(v1to3).normalize()\r\n\r\n\t\t\t\tlet highlighted = false\r\n\t\t\t\tswitch (cfg.kclHighlighter)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\thighlighted = collisionFlags & 0x2000\r\n\t\t\t\t\t\tbreak\r\n\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\thighlighted = data.f.isWall && normal.dot(new Vec3(0, 0, 1)) > 0.9\r\n\t\t\t\t\t\tbreak\r\n\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\thighlighted = data.f.isWall && collisionFlags & 0x8000\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t\r\n\t\t\t\t\tcase 6:\r\n\t\t\t\t\t\thighlighted = data.f.isWall && normal.dot(new Vec3(0, 0, 1)) > 0\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (highlighted)\r\n\t\t\t\t\tcolor = [1.0, 1.0, 0.0, 1.0]\r\n\t\t\t}\r\n\t\t\ttriLists[data.priority].push({ v1, v2, v3, color })\r\n\t\t}\r\n\r\n\t\tfor (let lis of triLists)\r\n\t\t\tfor (let tri of lis)\r\n\t\t\t\tmodel.addTri(tri.v1, tri.v2, tri.v3, tri.color, tri.color, tri.color)\r\n\r\n\t\treturn model.calculateNormals()\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { KclLoader, collisionTypeData }", "function readUInt32BE(bytes, offset)\n{\n\treturn (\n\t\t(bytes[offset + 0] << 24) |\n\t\t(bytes[offset + 1] << 16) |\n\t\t(bytes[offset + 2] << 8) |\n\t\t(bytes[offset + 3] << 0)\n\t) >>> 0\n}\n\n\nfunction writeUInt32BE(bytes, offset, value)\n{\n\tbytes[offset + 0] = (value >>> 24) & 0xff\n\tbytes[offset + 1] = (value >>> 16) & 0xff\n\tbytes[offset + 2] = (value >>> 8) & 0xff\n\tbytes[offset + 3] = (value >>> 0) & 0xff\n}\n\n\nfunction align(x, n)\n{\n\treturn ((x + n - 1) / n | 0) * n\n}\n\n\nfunction normalizeArchivePath(path)\n{\n\tif (path == null)\n\t\treturn \"\"\n\n\treturn path\n\t\t.replace(new RegExp(\"\\\\\\\\\", \"g\"), \"/\")\n\t\t.replace(/^\\/+/, \"\")\n\t\t.replace(/\\/+/g, \"/\")\n}\n\n\nclass SzsArchive\n{\n\tstatic parse(bytes)\n\t{\n\t\tlet input = (bytes instanceof Uint8Array ? bytes : new Uint8Array(bytes))\n\t\tlet archiveBytes = input\n\t\tlet wasCompressed = false\n\n\t\tif (input.length >= 4 && input[0] == 0x59 && input[1] == 0x61 && input[2] == 0x7a && input[3] == 0x30)\n\t\t{\n\t\t\tarchiveBytes = SzsArchive.decodeYaz0(input)\n\t\t\twasCompressed = true\n\t\t}\n\n\t\tlet entries = SzsArchive.parseU8(archiveBytes)\n\t\treturn { entries, wasCompressed }\n\t}\n\n\n\tstatic make(entries, compress = true)\n\t{\n\t\tlet u8 = SzsArchive.buildU8(entries)\n\t\treturn (compress ? SzsArchive.encodeYaz0LiteralOnly(u8) : u8)\n\t}\n\n\n\tstatic cloneEntries(entries)\n\t{\n\t\tlet map = new Map()\n\t\tif (entries == null)\n\t\t\treturn map\n\n\t\tfor (let [path, bytes] of entries)\n\t\t\tmap.set(path, new Uint8Array(bytes))\n\n\t\treturn map\n\t}\n\n\n\tstatic findPath(entries, filename)\n\t{\n\t\tif (entries == null || filename == null)\n\t\t\treturn null\n\n\t\tlet lowered = filename.toLowerCase()\n\t\tfor (let [path, _] of entries)\n\t\t{\n\t\t\tlet p = path.toLowerCase()\n\t\t\tif (p == lowered || p.endsWith(\"/\" + lowered))\n\t\t\t\treturn path\n\t\t}\n\t\treturn null\n\t}\n\n\n\tstatic parseU8(bytes)\n\t{\n\t\tif (bytes.length < 0x20)\n\t\t\tthrow \"szs: archive too small\"\n\n\t\tlet magic = readUInt32BE(bytes, 0)\n\t\tif (magic != 0x55aa382d)\n\t\t\tthrow \"szs: invalid U8 magic\"\n\n\t\tlet rootOffset = readUInt32BE(bytes, 4)\n\t\tif (rootOffset + 12 > bytes.length)\n\t\t\tthrow \"szs: invalid root node offset\"\n\n\t\tlet rootTypeAndName = readUInt32BE(bytes, rootOffset)\n\t\tlet rootType = rootTypeAndName >>> 24\n\t\tif (rootType != 1)\n\t\t\tthrow \"szs: invalid root node\"\n\n\t\tlet nodeCount = readUInt32BE(bytes, rootOffset + 8)\n\t\tlet nodeTableSize = nodeCount * 12\n\t\tlet stringTableOffset = rootOffset + nodeTableSize\n\t\tif (stringTableOffset > bytes.length)\n\t\t\tthrow \"szs: invalid node table size\"\n\n\t\tlet nodes = []\n\t\tfor (let i = 0; i < nodeCount; i++)\n\t\t{\n\t\t\tlet offset = rootOffset + i * 12\n\t\t\tlet typeAndName = readUInt32BE(bytes, offset + 0)\n\t\t\tnodes.push({\n\t\t\t\ttype: typeAndName >>> 24,\n\t\t\t\tnameOffset: typeAndName & 0x00ffffff,\n\t\t\t\tdataOffset: readUInt32BE(bytes, offset + 4),\n\t\t\t\tsize: readUInt32BE(bytes, offset + 8),\n\t\t\t\tname: \"\"\n\t\t\t})\n\t\t}\n\n\t\tlet readCString = (offset) =>\n\t\t{\n\t\t\tlet chars = []\n\t\t\tfor (let i = offset; i < bytes.length; i++)\n\t\t\t{\n\t\t\t\tlet c = bytes[i]\n\t\t\t\tif (c == 0)\n\t\t\t\t\tbreak\n\t\t\t\tchars.push(c)\n\t\t\t}\n\t\t\treturn new TextDecoder(\"utf-8\").decode(new Uint8Array(chars))\n\t\t}\n\n\t\tfor (let i = 0; i < nodes.length; i++)\n\t\t{\n\t\t\tlet nameOffset = stringTableOffset + nodes[i].nameOffset\n\t\t\tif (nameOffset < 0 || nameOffset >= bytes.length)\n\t\t\t\tnodes[i].name = \"\"\n\t\t\telse\n\t\t\t\tnodes[i].name = readCString(nameOffset)\n\t\t}\n\n\t\tlet entries = new Map()\n\n\t\tlet walkDirectory = (dirIndex, parentPath) =>\n\t\t{\n\t\t\tlet endIndex = nodes[dirIndex].size\n\t\t\tlet i = dirIndex + 1\n\t\t\twhile (i < endIndex)\n\t\t\t{\n\t\t\t\tlet node = nodes[i]\n\t\t\t\tlet fullPath = (parentPath == \"\" ? node.name : parentPath + \"/\" + node.name)\n\t\t\t\tif (node.type == 1)\n\t\t\t\t{\n\t\t\t\t\twalkDirectory(i, fullPath)\n\t\t\t\t\ti = node.size\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tlet dataStart = node.dataOffset\n\t\t\t\t\tlet dataEnd = node.dataOffset + node.size\n\t\t\t\t\tif (dataStart < 0 || dataEnd > bytes.length)\n\t\t\t\t\t\tthrow \"szs: invalid file range\"\n\t\t\t\t\tentries.set(fullPath, bytes.slice(dataStart, dataEnd))\n\t\t\t\t\ti += 1\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\twalkDirectory(0, \"\")\n\t\treturn entries\n\t}\n\n\n\tstatic buildU8(entries)\n\t{\n\t\tlet normalizedEntries = []\n\t\tfor (let [path, bytes] of entries)\n\t\t{\n\t\t\tlet normalizedPath = normalizeArchivePath(path)\n\t\t\tif (normalizedPath == \"\")\n\t\t\t\tcontinue\n\n\t\t\tlet fileBytes = (bytes instanceof Uint8Array ? bytes : new Uint8Array(bytes))\n\t\t\tnormalizedEntries.push({ path: normalizedPath, bytes: fileBytes })\n\t\t}\n\n\t\tlet root = {\n\t\t\tkind: \"dir\",\n\t\t\tname: \"\",\n\t\t\tchildren: [],\n\t\t\tchildDirs: new Map(),\n\t\t\tchildFiles: new Map()\n\t\t}\n\n\t\tfor (let entry of normalizedEntries)\n\t\t{\n\t\t\tlet parts = entry.path.split(\"/\").filter(x => x != \"\")\n\t\t\tif (parts.length == 0)\n\t\t\t\tcontinue\n\n\t\t\tlet node = root\n\t\t\tfor (let i = 0; i < parts.length - 1; i++)\n\t\t\t{\n\t\t\t\tlet dirName = parts[i]\n\t\t\t\tif (!node.childDirs.has(dirName))\n\t\t\t\t{\n\t\t\t\t\tlet child = {\n\t\t\t\t\t\tkind: \"dir\",\n\t\t\t\t\t\tname: dirName,\n\t\t\t\t\t\tchildren: [],\n\t\t\t\t\t\tchildDirs: new Map(),\n\t\t\t\t\t\tchildFiles: new Map()\n\t\t\t\t\t}\n\t\t\t\t\tnode.childDirs.set(dirName, child)\n\t\t\t\t\tnode.children.push(child)\n\t\t\t\t}\n\t\t\t\tnode = node.childDirs.get(dirName)\n\t\t\t}\n\n\t\t\tlet fileName = parts[parts.length - 1]\n\t\t\tif (node.childFiles.has(fileName))\n\t\t\t{\n\t\t\t\tnode.childFiles.get(fileName).bytes = entry.bytes\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet fileNode = { kind: \"file\", name: fileName, bytes: entry.bytes }\n\t\t\t\tnode.childFiles.set(fileName, fileNode)\n\t\t\t\tnode.children.push(fileNode)\n\t\t\t}\n\t\t}\n\n\t\tlet nodes = []\n\t\tlet appendNode = (node, parentIndex) =>\n\t\t{\n\t\t\tif (node.kind == \"dir\")\n\t\t\t{\n\t\t\t\tlet index = nodes.length\n\t\t\t\tnodes.push({\n\t\t\t\t\tkind: \"dir\",\n\t\t\t\t\tname: node.name,\n\t\t\t\t\tparentIndex,\n\t\t\t\t\tnextIndex: 0,\n\t\t\t\t\tnameOffset: 0\n\t\t\t\t})\n\n\t\t\t\tfor (let child of node.children)\n\t\t\t\t\tappendNode(child, index)\n\n\t\t\t\tnodes[index].nextIndex = nodes.length\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnodes.push({\n\t\t\t\t\tkind: \"file\",\n\t\t\t\t\tname: node.name,\n\t\t\t\t\tnameOffset: 0,\n\t\t\t\t\tdataOffset: 0,\n\t\t\t\t\tsize: node.bytes.length,\n\t\t\t\t\tbytes: node.bytes\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tappendNode(root, 0)\n\n\t\tlet stringTable = [0]\n\t\tlet encoder = new TextEncoder()\n\t\tfor (let i = 0; i < nodes.length; i++)\n\t\t{\n\t\t\tlet node = nodes[i]\n\t\t\tif (i == 0)\n\t\t\t{\n\t\t\t\tnode.nameOffset = 0\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tnode.nameOffset = stringTable.length\n\t\t\tlet nameBytes = encoder.encode(node.name)\n\t\t\tfor (let b of nameBytes)\n\t\t\t\tstringTable.push(b)\n\t\t\tstringTable.push(0)\n\t\t}\n\n\t\tlet rootOffset = 0x20\n\t\tlet nodeTableSize = nodes.length * 12\n\t\tlet stringOffset = rootOffset + nodeTableSize\n\t\tlet headerSize = stringOffset + stringTable.length\n\t\tlet dataOffset = align(headerSize, 0x20)\n\n\t\tlet curDataOffset = dataOffset\n\t\tfor (let node of nodes)\n\t\t{\n\t\t\tif (node.kind != \"file\")\n\t\t\t\tcontinue\n\n\t\t\tcurDataOffset = align(curDataOffset, 0x20)\n\t\t\tnode.dataOffset = curDataOffset\n\t\t\tcurDataOffset += node.size\n\t\t}\n\n\t\tlet out = new Uint8Array(curDataOffset)\n\t\twriteUInt32BE(out, 0x00, 0x55aa382d)\n\t\twriteUInt32BE(out, 0x04, rootOffset)\n\t\twriteUInt32BE(out, 0x08, headerSize)\n\t\twriteUInt32BE(out, 0x0c, dataOffset)\n\n\t\tfor (let i = 0; i < nodes.length; i++)\n\t\t{\n\t\t\tlet node = nodes[i]\n\t\t\tlet offset = rootOffset + i * 12\n\t\t\tlet type = (node.kind == \"dir\" ? 1 : 0)\n\t\t\tlet typeAndName = ((type << 24) | node.nameOffset) >>> 0\n\t\t\twriteUInt32BE(out, offset + 0, typeAndName)\n\t\t\tif (node.kind == \"dir\")\n\t\t\t{\n\t\t\t\twriteUInt32BE(out, offset + 4, i == 0 ? 0 : node.parentIndex)\n\t\t\t\twriteUInt32BE(out, offset + 8, node.nextIndex)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twriteUInt32BE(out, offset + 4, node.dataOffset)\n\t\t\t\twriteUInt32BE(out, offset + 8, node.size)\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < stringTable.length; i++)\n\t\t\tout[stringOffset + i] = stringTable[i]\n\n\t\tfor (let node of nodes)\n\t\t{\n\t\t\tif (node.kind != \"file\")\n\t\t\t\tcontinue\n\t\t\tout.set(node.bytes, node.dataOffset)\n\t\t}\n\n\t\treturn out\n\t}\n\n\n\tstatic decodeYaz0(bytes)\n\t{\n\t\tlet outSize = readUInt32BE(bytes, 4)\n\t\tlet out = new Uint8Array(outSize)\n\t\tlet srcPos = 16\n\t\tlet dstPos = 0\n\t\tlet code = 0\n\t\tlet validBits = 0\n\n\t\twhile (dstPos < outSize)\n\t\t{\n\t\t\tif (validBits == 0)\n\t\t\t{\n\t\t\t\tcode = bytes[srcPos++]\n\t\t\t\tvalidBits = 8\n\t\t\t}\n\n\t\t\tif ((code & 0x80) != 0)\n\t\t\t{\n\t\t\t\tout[dstPos++] = bytes[srcPos++]\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet b1 = bytes[srcPos++]\n\t\t\t\tlet b2 = bytes[srcPos++]\n\t\t\t\tlet dist = ((b1 & 0x0f) << 8) | b2\n\t\t\t\tlet copyPos = dstPos - (dist + 1)\n\n\t\t\t\tlet length = b1 >> 4\n\t\t\t\tif (length == 0)\n\t\t\t\t\tlength = bytes[srcPos++] + 0x12\n\t\t\t\telse\n\t\t\t\t\tlength += 2\n\n\t\t\t\tfor (let i = 0; i < length; i++)\n\t\t\t\t{\n\t\t\t\t\tout[dstPos++] = out[copyPos++]\n\t\t\t\t\tif (dstPos >= outSize)\n\t\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcode = (code << 1) & 0xff\n\t\t\tvalidBits -= 1\n\t\t}\n\n\t\treturn out\n\t}\n\n\n\tstatic encodeYaz0LiteralOnly(bytes)\n\t{\n\t\tlet input = (bytes instanceof Uint8Array ? bytes : new Uint8Array(bytes))\n\t\tlet out = []\n\t\tout.push(0x59, 0x61, 0x7a, 0x30)\n\n\t\tlet size = input.length >>> 0\n\t\tout.push((size >>> 24) & 0xff, (size >>> 16) & 0xff, (size >>> 8) & 0xff, size & 0xff)\n\t\tout.push(0, 0, 0, 0, 0, 0, 0, 0)\n\n\t\tlet pos = 0\n\t\twhile (pos < input.length)\n\t\t{\n\t\t\tlet count = Math.min(8, input.length - pos)\n\t\t\tout.push(0xff)\n\t\t\tfor (let i = 0; i < count; i++)\n\t\t\t\tout.push(input[pos++])\n\t\t}\n\n\t\treturn new Uint8Array(out)\n\t}\n}\n\n\nif (module)\n\tmodule.exports = { SzsArchive, normalizeArchivePath }\n", "const { ModelBuilder } = require(\"../util/modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\n\r\n\r\nclass ObjLoader\r\n{\r\n\tstatic load(bytes)\r\n\t{\r\n\t\tlet str = new TextDecoder(\"utf-8\").decode(bytes)\r\n\t\tlet lines = str.replace(\"\\r\\n\", \"\\n\").split(\"\\n\").map(s => s.trim())\r\n\t\t\r\n\t\tlet objects = []\r\n\t\tlet curObject = null\r\n\t\tlet curGeometry = null\r\n\t\t\r\n\t\tfor (let line of lines)\r\n\t\t{\r\n\t\t\tif (line.startsWith(\"#\"))\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tlet tagO = line.match(/^o[ ]+(.*)/)\r\n\t\t\tif (tagO != null)\r\n\t\t\t{\r\n\t\t\t\tlet object = {}\r\n\t\t\t\tobject.name = tagO[1]\r\n\t\t\t\tobject.vertices = []\r\n\t\t\t\tobject.normals = []\r\n\t\t\t\tobject.texCoords = []\r\n\t\t\t\tobject.geometries = []\r\n\t\t\t\t\r\n\t\t\t\tobjects.push(object)\r\n\t\t\t\tcurObject = object\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (curObject == null)\r\n\t\t\t{\r\n\t\t\t\tlet object = {}\r\n\t\t\t\tobject.name = \"Default Object\"\r\n\t\t\t\tobject.vertices = []\r\n\t\t\t\tobject.normals = []\r\n\t\t\t\tobject.texCoords = []\r\n\t\t\t\tobject.geometries = []\r\n\t\t\t\t\r\n\t\t\t\tobjects.push(object)\r\n\t\t\t\tcurObject = object\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet tagV = line.match(/^v[ ]+([0-9.-]+)[ ]+([0-9.-]+)[ ]+([0-9.-]+)/)\r\n\t\t\tif (tagV != null)\r\n\t\t\t{\r\n\t\t\t\tlet vertex = new Vec3(parseFloat(tagV[1]), -parseFloat(tagV[3]), -parseFloat(tagV[2]))\r\n\t\t\t\tcurObject.vertices.push(vertex)\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet tagVT = line.match(/^vt[ ]+([0-9.-]+)[ ]+([0-9.-]+)/)\r\n\t\t\tif (tagVT != null)\r\n\t\t\t{\r\n\t\t\t\tlet texCoord = new Vec3(parseFloat(tagVT[1]), parseFloat(tagVT[2]), 0)\r\n\t\t\t\tcurObject.texCoords.push(texCoord)\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet tagVN = line.match(/^vn[ ]+([0-9.-]+)[ ]+([0-9.-]+)[ ]+([0-9.-]+)/)\r\n\t\t\tif (tagVN != null)\r\n\t\t\t{\r\n\t\t\t\tlet normal = new Vec3(parseFloat(tagVN[1]), parseFloat(tagVN[2]), parseFloat(tagVN[3]))\r\n\t\t\t\tcurObject.normals.push(normal)\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet tagG = line.match(/^g[ ]+(.*)/)\r\n\t\t\tif (tagG != null)\r\n\t\t\t{\r\n\t\t\t\tlet geometry = {}\r\n\t\t\t\tgeometry.name = tagG[1]\r\n\t\t\t\tgeometry.faces = []\r\n\t\t\t\t\r\n\t\t\t\tcurObject.geometries.push(geometry)\r\n\t\t\t\tcurGeometry = geometry\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (curGeometry == null)\r\n\t\t\t\tcontinue\r\n\t\t\t\r\n\t\t\tif (line.startsWith(\"f\"))\r\n\t\t\t{\r\n\t\t\t\tlet splits = line.substr(1).split(\" \").map(v => v.trim())\r\n\t\t\t\t\r\n\t\t\t\tlet face = []\r\n\t\t\t\tfor (let split of splits)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (split == \"\")\r\n\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet indices = split.split(\"/\")\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet vertex = {}\r\n\t\t\t\t\tvertex.position = curObject.vertices[parseInt(indices[0]) - 1]\r\n\t\t\t\t\tvertex.texCoord = (indices.length < 2 ? new Vec3(0, 0, 0) : curObject.texCoords[parseInt(indices[1]) - 1])\r\n\t\t\t\t\tvertex.normal   = (indices.length < 3 ? new Vec3(0, 0, 0) : curObject.normals[parseInt(indices[2]) - 1])\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (vertex.position)\r\n\t\t\t\t\t\tface.push(vertex)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tcurGeometry.faces.push(face)\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn objects\r\n\t}\r\n\t\r\n\t\r\n\tstatic makeModelBuilder(bytes)\r\n\t{\r\n\t\tlet objects = ObjLoader.load(bytes)\r\n\t\t\r\n\t\tlet model = new ModelBuilder()\r\n\t\t\r\n\t\tfor (let object of objects)\r\n\t\t{\r\n\t\t\tfor (let geometry of object.geometries)\r\n\t\t\t{\r\n\t\t\t\tfor (let face of geometry.faces)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (face.length >= 3)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tmodel.addTri(face[0].position, face[1].position, face[2].position)\r\n\t\t\t\t\t\tmodel.addTri(face[0].position, face[2].position, face[1].position)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn model.calculateNormals()\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { ObjLoader }", "const { BinaryParser } = require(\"./binaryParser.js\")\r\nconst { ModelBuilder } = require(\"./modelBuilder.js\")\r\nconst { Vec3 } = require(\"../math/vec3.js\")\r\n\r\n\r\nclass BrresLoader\r\n{\r\n\tstatic load(bytes)\r\n\t{\r\n\t\tlet parser = new BinaryParser(bytes)\r\n\t\t\r\n\t\tif (parser.readAsciiLength(4) != \"bres\")\r\n\t\t\tthrow \"brres: invalid magic number\"\r\n\t\t\r\n\t\tlet byteOrderMark = parser.readUInt16()\r\n\t\tif (byteOrderMark != 0xfeff)\r\n\t\t\tthrow \"brres: unsupported endianness\"\r\n\t\t\r\n\t\tparser.readUInt16()\r\n\t\tlet fileLenInBytes = parser.readUInt32()\r\n\t\tlet rootSectionOffset = parser.readUInt16()\r\n\t\tlet sectionNum = parser.readUInt16()\r\n\t\t\r\n\t\tparser.seek(rootSectionOffset)\r\n\t\t\r\n\t\tlet rootSection = BrresLoader.readRootSection(parser)\r\n\t\tlet sections = []\r\n\t\t\r\n\t\tfor (let i = 0; i < rootSection.folders.length; i++)\r\n\t\t{\r\n\t\t\tfor (let j = 1; j < rootSection.folders[i].entries.length; j++)\r\n\t\t\t{\r\n\t\t\t\tparser.seek(rootSection.folders[i].addr + rootSection.folders[i].entries[j].dataOffset)\r\n\t\t\t\t\r\n\t\t\t\tlet sectionHeader = BrresLoader.readCommonSectionHeader(parser)\r\n\t\t\t\tsections.push(sectionHeader)\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tlet courseModelMDL0 = null\r\n\t\t\r\n\t\tlet debugStructure = \"BRRES File\\n\"\r\n\t\tfor (let i = 0; i < rootSection.folders.length; i++)\r\n\t\t{\r\n\t\t\tdebugStructure += \"\u2514 \" + rootSection.root.entries[i + 1].name + \"\\n\"\r\n\t\t\t\r\n\t\t\tfor (let j = 1; j < rootSection.folders[i].entries.length; j++)\r\n\t\t\t{\r\n\t\t\t\tlet entry = rootSection.folders[i].entries[j]\r\n\t\t\t\t\r\n\t\t\t\tdebugStructure += \"   \u2514 \" + entry.name + \" {\" + entry.dataTag + \"}\\n\"\r\n\t\t\t\t\r\n\t\t\t\tif (entry.name == \"course\" && entry.dataTag == \"MDL0\")\r\n\t\t\t\t\tcourseModelMDL0 = entry\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.log(debugStructure)\r\n\t\t\r\n\t\tif (courseModelMDL0 == null)\r\n\t\t\tthrow \"No course model found! Make sure to have a `course` MDL0 entry in your BRRES data!\"\r\n\t\t\r\n\t\tparser.seek(courseModelMDL0.offsetBase + courseModelMDL0.dataOffset)\r\n\t\tlet mdl0 = BrresLoader.readMdl0Section(parser)\r\n\t\t\r\n\t\tlet model = new ModelBuilder()\r\n\t\tfor (let polygon of mdl0.generatedPolygons)\r\n\t\t{\r\n\t\t\tfor (let instr of polygon.instructions)\r\n\t\t\t{\r\n\t\t\t\tif (instr.kind == \"DrawQuads\")\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (let i = 0; i < instr.count; i += 4)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet v0 = instr.vertices[i + 0]\r\n\t\t\t\t\t\tlet v1 = instr.vertices[i + 1]\r\n\t\t\t\t\t\tlet v2 = instr.vertices[i + 2]\r\n\t\t\t\t\t\tlet v3 = instr.vertices[i + 3]\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (v0 && v1 && v2 && v3 && v0.isFinite() && v1.isFinite() && v2.isFinite() && v3.isFinite())\r\n\t\t\t\t\t\t\tmodel.addQuad(v0, v1, v2, v3)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (instr.kind == \"DrawTriangles\")\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (let i = 0; i < instr.count; i += 3)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet v0 = instr.vertices[i + 0]\r\n\t\t\t\t\t\tlet v1 = instr.vertices[i + 1]\r\n\t\t\t\t\t\tlet v2 = instr.vertices[i + 2]\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (v0 && v1 && v2 && v0.isFinite() && v1.isFinite() && v2.isFinite())\r\n\t\t\t\t\t\t\tmodel.addTri(v0, v2, v1)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (instr.kind == \"DrawTriangleStrip\")\r\n\t\t\t\t{\r\n\t\t\t\t\tlet v0 = instr.vertices[0]\r\n\t\t\t\t\tlet v1 = instr.vertices[1]\r\n\t\t\t\t\tlet winding = false\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor (let i = 2; i < instr.count; i += 1)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet v2 = instr.vertices[i]\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (v0 && v1 && v2 && v0.isFinite() && v1.isFinite() && v2.isFinite())\r\n\t\t\t\t\t\t\tif (winding)\r\n\t\t\t\t\t\t\t\tmodel.addTri(v0, v1, v2)\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tmodel.addTri(v0, v2, v1)\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tv0 = v1\r\n\t\t\t\t\t\tv1 = v2\r\n\t\t\t\t\t\twinding = !winding\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (instr.kind == \"DrawTriangleFan\")\r\n\t\t\t\t{\r\n\t\t\t\t\tlet v0 = instr.vertices[0]\r\n\t\t\t\t\tlet v1 = instr.vertices[1]\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor (let i = 2; i < instr.count; i += 1)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet v2 = instr.vertices[i]\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (v0 && v1 && v2 && v0.isFinite() && v1.isFinite() && v2.isFinite())\r\n\t\t\t\t\t\t\tmodel.addTri(v0, v2, v1)\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tv1 = v2\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn model.calculateNormals()\r\n\t}\r\n\t\r\n\t\r\n\tstatic readRootSection(parser)\r\n\t{\r\n\t\tlet addr = parser.head\r\n\t\tlet tag = parser.readAsciiLength(4)\r\n\t\tif (tag != \"root\")\r\n\t\t\tthrow \"brres: invalid root section magic number\"\r\n\t\t\r\n\t\tlet len = parser.readInt32()\r\n\t\t\r\n\t\tlet root = BrresLoader.readIndexGroup(parser)\r\n\t\t\r\n\t\tlet folders = []\r\n\t\t\r\n\t\tfor (let i = 1; i < root.entries.length; i++)\r\n\t\t{\r\n\t\t\tparser.seek(root.addr + root.entries[i].dataOffset)\r\n\t\t\tfolders.push(BrresLoader.readIndexGroup(parser))\r\n\t\t}\r\n\t\t\r\n\t\treturn { addr, tag, len, root, folders }\r\n\t}\r\n\t\r\n\t\r\n\tstatic readIndexGroup(parser)\r\n\t{\r\n\t\tlet addr = parser.head\r\n\t\t\r\n\t\tlet len = parser.readInt32()\r\n\t\tlet entryNum = parser.readInt32()\r\n\t\t\r\n\t\tlet entries = []\r\n\t\t\r\n\t\tfor (let i = 0; i <= entryNum; i++)\r\n\t\t{\r\n\t\t\tlet entry = BrresLoader.readIndexEntry(parser)\r\n\t\t\tentry.offsetBase = addr\r\n\t\t\tentry.nameLen = 0\r\n\t\t\tentry.name = null\r\n\t\t\tentry.dataTag = null\r\n\t\t\t\r\n\t\t\tentries.push(entry)\r\n\t\t}\r\n\t\t\r\n\t\tfor (let i = 1; i < entries.length; i++)\r\n\t\t{\r\n\t\t\tparser.seek(addr + entries[i].nameOffset - 4)\r\n\t\t\tentries[i].nameLen = parser.readUInt32()\r\n\t\t\tentries[i].name = parser.readAsciiLength(entries[i].nameLen)\r\n\t\t\t\r\n\t\t\tif (entries[i].dataOffset != 0)\r\n\t\t\t{\r\n\t\t\t\tparser.seek(addr + entries[i].dataOffset)\r\n\t\t\t\tentries[i].dataTag = parser.readAsciiLength(4)\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tparser.seek(addr + 0x8 + entries.length * 0x10)\r\n\t\t\r\n\t\treturn { addr, len, entries }\r\n\t}\r\n\t\r\n\t\r\n\tstatic readIndexEntry(parser)\r\n\t{\r\n\t\tlet addr = parser.head\r\n\t\t\r\n\t\tlet id = parser.readUInt16()\r\n\t\tparser.readUInt16()\r\n\t\tlet left = parser.readUInt16()\r\n\t\tlet right = parser.readUInt16()\r\n\t\tlet nameOffset = parser.readInt32()\r\n\t\tlet dataOffset = parser.readInt32()\r\n\t\t\r\n\t\treturn { addr, id, left, right, nameOffset, dataOffset }\r\n\t}\r\n\t\r\n\t\r\n\tstatic readCommonSectionHeader(parser)\r\n\t{\r\n\t\tlet addr = parser.head\r\n\t\t\r\n\t\tlet tag = parser.readAsciiLength(4)\r\n\t\tlet len = parser.readInt32()\r\n\t\tlet version = parser.readInt32()\r\n\t\tlet offset = parser.readInt32()\r\n\t\t\r\n\t\treturn { addr, tag, len, version, offset }\r\n\t}\r\n\t\r\n\t\r\n\tstatic readMdl0Section(parser)\r\n\t{\r\n\t\tlet addr = parser.head\r\n\t\t\r\n\t\tif (parser.readAsciiLength(4) != \"MDL0\")\r\n\t\t\tthrow \"brres: invalid MDL0 magic number\"\r\n\t\t\r\n\t\tlet len = parser.readUInt32()\r\n\t\tlet version = parser.readUInt32()\r\n\t\tif (version != 11)\r\n\t\t\tthrow \"brres: unsupported MDL0 version\"\r\n\t\t\r\n\t\tlet parentOffset = parser.readInt32()\r\n\t\t\r\n\t\tlet sectionOffsets = []\r\n\t\tfor (let i = 0; i < 14; i++)\r\n\t\t\tsectionOffsets.push(parser.readInt32())\r\n\t\t\r\n\t\tlet nameOffset = parser.readInt32()\r\n\t\t\r\n\t\tlet header = BrresLoader.readMdl0Header(parser)\r\n\t\t\r\n\t\tlet sections = []\r\n\t\tfor (let i = 0; i < sectionOffsets.length; i++)\r\n\t\t{\r\n\t\t\tif (sectionOffsets[i] != 0)\r\n\t\t\t{\r\n\t\t\t\tparser.seek(addr + sectionOffsets[i])\r\n\t\t\t\tsections.push(BrresLoader.readIndexGroup(parser))\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tsections.push(null)\r\n\t\t}\r\n\t\t\r\n\t\tlet vertexGroups = []\r\n\t\tif (sections[2] != null)\r\n\t\t{\r\n\t\t\tfor (let i = 1; i < sections[2].entries.length; i++)\r\n\t\t\t{\r\n\t\t\t\tparser.seek(sections[2].addr + sections[2].entries[i].dataOffset)\r\n\t\t\t\tvertexGroups.push(BrresLoader.readMdl0VertexGroup(parser))\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tlet polygons = []\r\n\t\tif (sections[10] != null)\r\n\t\t{\r\n\t\t\tfor (let i = 1; i < sections[10].entries.length; i++)\r\n\t\t\t{\r\n\t\t\t\tparser.seek(sections[10].addr + sections[10].entries[i].dataOffset)\r\n\t\t\t\tlet polygon = BrresLoader.readMdl0Polygon(parser)\r\n\t\t\t\t\r\n\t\t\t\tfor (let vertexGroup of vertexGroups)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (vertexGroup.index == polygon.vertexGroupIndex)\r\n\t\t\t\t\t\tpolygon.vertexGroup = vertexGroup\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tpolygons.push(polygon)\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tlet generatedPolygons = []\r\n\t\tfor (let polygon of polygons)\r\n\t\t\tgeneratedPolygons.push(BrresLoader.generatePolygon(null, polygon))\r\n\t\t\r\n\t\treturn { generatedPolygons }\r\n\t}\r\n\t\r\n\t\r\n\tstatic readMdl0Header(parser)\r\n\t{\r\n\t\tlet addr = parser.head\r\n\t\tlet len = parser.readInt32()\r\n\t\tlet mdl0Offset = parser.readInt32()\r\n\t\tparser.readInt32()\r\n\t\tparser.readInt32()\r\n\t\tlet vertexCount = parser.readInt32()\r\n\t\tlet faceCount = parser.readInt32()\r\n\t\tparser.readInt32()\r\n\t\tlet boneCount = parser.readInt32()\r\n\t\tparser.readInt32()\r\n\t\tlet boneTableOffset = parser.readInt32()\r\n\t\t\r\n\t\tparser.readFloat32()\r\n\t\tparser.readFloat32()\r\n\t\tparser.readFloat32()\r\n\t\t\r\n\t\tparser.readFloat32()\r\n\t\tparser.readFloat32()\r\n\t\tparser.readFloat32()\r\n\t\t\r\n\t\treturn { addr, len, mdl0Offset, vertexCount, faceCount, boneCount, boneTableOffset }\r\n\t}\r\n\t\r\n\t\r\n\tstatic readMdl0VertexGroup(parser)\r\n\t{\r\n\t\tlet addr = parser.head\r\n\t\t\r\n\t\tlet len = parser.readInt32()\r\n\t\tlet mdl0Offset = parser.readInt32()\r\n\t\tlet dataOffset = parser.readInt32()\r\n\t\tlet nameOffset = parser.readInt32()\r\n\t\tlet index = parser.readInt32()\r\n\t\tparser.readUInt32()\r\n\t\tlet type = parser.readInt32()\r\n\t\tlet divisor = Math.pow(2, parser.readByte())\r\n\t\tlet stride = parser.readByte()\r\n\t\tlet vertexCount = parser.readInt16()\r\n\t\t\r\n\t\tparser.readFloat32()\r\n\t\tparser.readFloat32()\r\n\t\tparser.readFloat32()\r\n\t\t\r\n\t\tparser.readFloat32()\r\n\t\tparser.readFloat32()\r\n\t\tparser.readFloat32()\r\n\t\t\r\n\t\tparser.seek(addr + dataOffset)\r\n\t\t\r\n\t\tlet vertices = []\r\n\t\tfor (let i = 0; i < vertexCount; i++)\r\n\t\t{\r\n\t\t\tlet x = 0\r\n\t\t\tlet y = 0\r\n\t\t\tlet z = 0\r\n\t\t\t\r\n\t\t\tswitch (type)\r\n\t\t\t{\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tx = parser.readByte() / divisor\r\n\t\t\t\t\ty = parser.readByte() / divisor\r\n\t\t\t\t\tz = parser.readByte() / divisor\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tx = parser.readSByte() / divisor\r\n\t\t\t\t\ty = parser.readSByte() / divisor\r\n\t\t\t\t\tz = parser.readSByte() / divisor\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tx = parser.readUInt16() / divisor\r\n\t\t\t\t\ty = parser.readUInt16() / divisor\r\n\t\t\t\t\tz = parser.readUInt16() / divisor\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tx = parser.readInt16() / divisor\r\n\t\t\t\t\ty = parser.readInt16() / divisor\r\n\t\t\t\t\tz = parser.readInt16() / divisor\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\tx = parser.readFloat32()\r\n\t\t\t\t\ty = parser.readFloat32()\r\n\t\t\t\t\tz = parser.readFloat32()\r\n\t\t\t\t\tbreak\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow \"brres: mdl0 invalid vertex group type\"\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet vec = new Vec3(x, -z, -y)\r\n\t\t\tvec.index = i\r\n\t\t\tvertices.push(vec)\r\n\t\t}\r\n\t\t\r\n\t\treturn { addr, len, mdl0Offset, dataOffset, nameOffset, index, type, divisor, stride, vertexCount, vertices }\r\n\t}\r\n\t\r\n\t\r\n\tstatic readMdl0Polygon(parser)\r\n\t{\r\n\t\tlet addr = parser.head\r\n\t\t\r\n\t\tlet len = parser.readInt32()\r\n\t\tlet mdl0Offset = parser.readInt32()\r\n\t\tlet boneIndex = parser.readInt32()\r\n\t\tparser.readInt32()\r\n\t\tparser.readInt32()\r\n\t\tparser.readInt32()\r\n\t\t\r\n\t\tlet sections = []\r\n\t\tfor (let i = 0; i < 2; i++)\r\n\t\t{\r\n\t\t\tlet sectionAddr = parser.head\r\n\t\t\tlet size = parser.readInt32()\r\n\t\t\tlet size2 = parser.readInt32()\r\n\t\t\tlet offset = parser.readInt32()\r\n\t\t\tsections.push({ addr: sectionAddr, size, size2, offset })\r\n\t\t}\r\n\t\t\r\n\t\tparser.readInt32()\r\n\t\tparser.readInt32()\r\n\t\t\r\n\t\tlet nameOffset = parser.readInt32()\r\n\t\tlet index = parser.readInt32()\r\n\t\tlet vertexCount = parser.readInt32()\r\n\t\tlet faceCount = parser.readInt32()\r\n\t\tlet vertexGroupIndex = parser.readInt16()\r\n\t\tlet normalGroupIndex = parser.readInt16()\r\n\t\tlet colorGroupIndices = [parser.readInt16(), parser.readInt16()]\r\n\t\tlet texCoordGroupIndices = []\r\n\t\tfor (let i = 0; i < 8; i++)\r\n\t\t\ttexCoordGroupIndices.push(parser.readInt16())\r\n\t\t\r\n\t\tparser.readInt32()\r\n\t\tlet boneTableOffset = parser.readInt32()\r\n\t\t\r\n\t\tparser.seek(sections[0].addr + sections[0].offset)\r\n\t\tlet vertexDefinitions = parser.readBytes(sections[0].size)\r\n\t\t\r\n\t\tparser.seek(sections[1].addr + sections[1].offset)\r\n\t\tlet vertexData = parser.readBytes(sections[1].size)\r\n\t\t\r\n\t\treturn {\r\n\t\t\taddr, len, mdl0Offset, boneIndex, sections,\r\n\t\t\tnameOffset, index, vertexCount, faceCount,\r\n\t\t\tvertexGroupIndex, normalGroupIndex,\r\n\t\t\tcolorGroupIndices, texCoordGroupIndices, boneTableOffset,\r\n\t\t\tvertexDefinitions, vertexData,\r\n\t\t\tvertexGroup: null }\r\n\t}\r\n\t\r\n\t\r\n\tstatic generatePolygon(mdl0, polygon)\r\n\t{\r\n\t\tlet parser = new BinaryParser(polygon.vertexData)\r\n\t\t\r\n\t\tlet vertexDescription = BrresLoader.readVertexDescription(polygon.vertexDefinitions)\r\n\t\tlet instructions = []\r\n\t\t\r\n\t\tend: while (parser.head < polygon.vertexData.length)\r\n\t\t{\r\n\t\t\tlet opcode = parser.readByte()\r\n\t\t\tlet count = 0\r\n\t\t\tlet instr = { kind: null }\r\n\t\t\t\r\n\t\t\tswitch (opcode & 0xf8)\r\n\t\t\t{\r\n\t\t\t\tcase 0x00:\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\t\r\n\t\t\t\tcase 0x20:\r\n\t\t\t\t\tconsole.error(\"brres: unimplemented SetMatrix instruction\")\r\n\t\t\t\t\tparser.readUInt16()\r\n\t\t\t\t\tparser.readInt16()\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\t\r\n\t\t\t\tcase 0x28:\r\n\t\t\t\tcase 0x30:\r\n\t\t\t\tcase 0x38:\r\n\t\t\t\t\tparser.readInt32()\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\t\r\n\t\t\t\tcase 0x80:\r\n\t\t\t\t\tinstr.kind = \"DrawQuads\"\r\n\t\t\t\t\tinstr.count = parser.readUInt16()\r\n\t\t\t\t\tinstr.vertices = BrresLoader.readVertices(parser, polygon, vertexDescription, instr.count)\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\t\r\n\t\t\t\tcase 0x90:\r\n\t\t\t\t\tinstr.kind = \"DrawTriangles\"\r\n\t\t\t\t\tinstr.count = parser.readUInt16()\r\n\t\t\t\t\tinstr.vertices = BrresLoader.readVertices(parser, polygon, vertexDescription, instr.count)\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\t\r\n\t\t\t\tcase 0x98:\r\n\t\t\t\t\tinstr.kind = \"DrawTriangleStrip\"\r\n\t\t\t\t\tinstr.count = parser.readUInt16()\r\n\t\t\t\t\tinstr.vertices = BrresLoader.readVertices(parser, polygon, vertexDescription, instr.count)\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\t\r\n\t\t\t\tcase 0xa0:\r\n\t\t\t\t\tinstr.kind = \"DrawTriangleFan\"\r\n\t\t\t\t\tinstr.count = parser.readUInt16()\r\n\t\t\t\t\tinstr.vertices = BrresLoader.readVertices(parser, polygon, vertexDescription, instr.count)\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\t\r\n\t\t\t\tcase 0xa8:\r\n\t\t\t\t\tinstr.kind = \"DrawLines\"\r\n\t\t\t\t\tinstr.count = parser.readUInt16()\r\n\t\t\t\t\tinstr.vertices = BrresLoader.readVertices(parser, polygon, vertexDescription, instr.count)\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\t\r\n\t\t\t\tcase 0xb0:\r\n\t\t\t\t\tinstr.kind = \"DrawLineStrip\"\r\n\t\t\t\t\tinstr.count = parser.readUInt16()\r\n\t\t\t\t\tinstr.vertices = BrresLoader.readVertices(parser, polygon, vertexDescription, instr.count)\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\t\r\n\t\t\t\tcase 0xb8:\r\n\t\t\t\t\tinstr.kind = \"DrawPoints\"\r\n\t\t\t\t\tinstr.count = parser.readUInt16()\r\n\t\t\t\t\tinstr.vertices = BrresLoader.readVertices(parser, polygon, vertexDescription, instr.count)\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\t\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak end\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (instr.kind != null)\r\n\t\t\t\tinstructions.push(instr)\r\n\t\t}\r\n\t\t\r\n\t\treturn { vertexDescription, instructions }\r\n\t}\r\n\t\r\n\t\r\n\tstatic readVertexDescription(bytes)\r\n\t{\r\n\t\tlet parser = new BinaryParser(bytes)\r\n\t\t\r\n\t\tlet byteDequant = 0\r\n\t\tlet normalIndex3 = 0\r\n\t\t\r\n\t\tlet matrix =\r\n\t\t{\r\n\t\t\tpos: false, norm: false,\r\n\t\t\tcolfalse: false, col1: false,\r\n\t\t\ttexfalse: false, tex1: false, tex2: false, tex3: false,\r\n\t\t\ttex4: false, tex5: false, tex6: false, tex7: false\r\n\t\t}\t\t\r\n\t\t\r\n\t\tlet presence =\r\n\t\t{\r\n\t\t\tpos: 0, norm: 0,\r\n\t\t\tcol0: 0, col1: 0,\r\n\t\t\ttex0: 0, tex1: 0, tex2: 0, tex3: 0,\r\n\t\t\ttex4: 0, tex5: 0, tex6: 0, tex7: 0\r\n\t\t}\r\n\t\t\r\n\t\tlet fields =\r\n\t\t{\r\n\t\t\tpos: 0, norm: 0,\r\n\t\t\tcol0: 0, col1: 0,\r\n\t\t\ttex0: 0, tex1: 0, tex2: 0, tex3: 0,\r\n\t\t\ttex4: 0, tex5: 0, tex6: 0, tex7: 0\r\n\t\t}\r\n\t\t\r\n\t\tlet format =\r\n\t\t{\r\n\t\t\tpos: 0, norm: 0,\r\n\t\t\tcol0: 0, col1: 0,\r\n\t\t\ttex0: 0, tex1: 0, tex2: 0, tex3: 0,\r\n\t\t\ttex4: 0, tex5: 0, tex6: 0, tex7: 0\r\n\t\t}\r\n\t\t\r\n\t\tlet scale = \r\n\t\t{\r\n\t\t\tpos: 0, norm: 0,\r\n\t\t\tcol0: 0, col1: 0,\r\n\t\t\ttex0: 0, tex1: 0, tex2: 0, tex3: 0,\r\n\t\t\ttex4: 0, tex5: 0, tex6: 0, tex7: 0\r\n\t\t}\r\n\t\t\r\n\t\tlet colorCount = 0\r\n\t\tlet normalCount = 0\r\n\t\tlet textureCount = 0\r\n\t\t\r\n\t\tend: while (parser.head < bytes.length)\r\n\t\t{\r\n\t\t\tlet opcode = parser.readByte()\r\n\t\t\tlet current = 0\r\n\t\t\t\r\n\t\t\tswitch (opcode)\r\n\t\t\t{\r\n\t\t\t\tcase 0x0:\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\r\n\t\t\t\tcase 0x8:\r\n\t\t\t\t{\r\n\t\t\t\t\tlet opcode2 = parser.readByte()\r\n\t\t\t\t\tswitch (opcode2 & 0xf0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcase 0x50:\r\n\t\t\t\t\t\t\tparser.readByte()\r\n\t\t\t\t\t\t\tcurrent = parser.readByte()\r\n\t\t\t\t\t\t\tpresence.col1 = (current << 1 & 0x2)\r\n\t\t\t\t\t\t\tcurrent = parser.readByte()\r\n\t\t\t\t\t\t\tpresence.col1 |= (current >> 7 & 0x1)\r\n\t\t\t\t\t\t\tpresence.col0 = (current >> 5 & 0x3)\r\n\t\t\t\t\t\t\tpresence.norm = (current >> 3 & 0x3)\r\n\t\t\t\t\t\t\tpresence.pos = (current >> 1 & 0x3)\r\n\t\t\t\t\t\t\tmatrix.tex7 = (current & 0x1) > 0\r\n\t\t\t\t\t\t\tcurrent = parser.readByte()\r\n\t\t\t\t\t\t\tmatrix.tex6 = (current & 0x80) > 0\r\n\t\t\t\t\t\t\tmatrix.tex5 = (current & 0x40) > 0\r\n\t\t\t\t\t\t\tmatrix.tex4 = (current & 0x20) > 0\r\n\t\t\t\t\t\t\tmatrix.tex3 = (current & 0x10) > 0\r\n\t\t\t\t\t\t\tmatrix.tex2 = (current & 0x8) > 0\r\n\t\t\t\t\t\t\tmatrix.tex1 = (current & 0x4) > 0\r\n\t\t\t\t\t\t\tmatrix.tex0 = (current & 0x2) > 0\r\n\t\t\t\t\t\t\tmatrix.pos = (current & 0x1) > 0\r\n\t\t\t\t\t\t\tbreak\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tcase 0x60:\r\n\t\t\t\t\t\t\tparser.readByte()\r\n\t\t\t\t\t\t\tparser.readByte()\r\n\t\t\t\t\t\t\tcurrent = parser.readByte()\r\n\t\t\t\t\t\t\tpresence.tex7 = (current >> 6 & 0x3)\r\n\t\t\t\t\t\t\tpresence.tex6 = (current >> 4 & 0x3)\r\n\t\t\t\t\t\t\tpresence.tex5 = (current >> 2 & 0x3)\r\n\t\t\t\t\t\t\tpresence.tex4 = (current >> 0 & 0x3)\r\n\t\t\t\t\t\t\tcurrent = parser.readByte()\r\n\t\t\t\t\t\t\tpresence.tex3 = (current >> 6 & 0x3)\r\n\t\t\t\t\t\t\tpresence.tex2 = (current >> 4 & 0x3)\r\n\t\t\t\t\t\t\tpresence.tex1 = (current >> 2 & 0x3)\r\n\t\t\t\t\t\t\tpresence.tex0 = ((current >> 0) & 0x3)\r\n\t\t\t\t\t\t\tbreak\r\n\r\n\t\t\t\t\t\tcase 0x70:\r\n\t\t\t\t\t\t\tcurrent = parser.readByte()\r\n\t\t\t\t\t\t\tnormalIndex3 = (current & 0x80) > 0\r\n\t\t\t\t\t\t\tbyteDequant = (current & 0x40) > 0\r\n\t\t\t\t\t\t\tscale.tex0 = current >> 1 & 0x1f\r\n\t\t\t\t\t\t\tformat.tex0 = (current << 2 & 0x4)\r\n\t\t\t\t\t\t\tcurrent = parser.readByte()\r\n\t\t\t\t\t\t\tformat.tex0 |= (current >> 6 & 0x3)\r\n\t\t\t\t\t\t\tfields.tex0 = ((current & 0x20) > 0) ? 2 : 1 // not implemented\r\n\t\t\t\t\t\t\tformat.col1 = (current >> 2 & 0x7)\r\n\t\t\t\t\t\t\tfields.col1 = ((current & 0x2) > 0) ? 4 : 3 // not implemented\r\n\t\t\t\t\t\t\tformat.col0 = (current << 2 & 0x4)\r\n\t\t\t\t\t\t\tcurrent = parser.readByte()\r\n\t\t\t\t\t\t\tformat.col0 |= (current >> 6 & 0x3)\r\n\t\t\t\t\t\t\tfields.col0 = ((current & 0x20) > 0) ? 4 : 3 // not implemented\r\n\t\t\t\t\t\t\tformat.norm = (current >> 2 & 0x7)\r\n\t\t\t\t\t\t\tfields.norm = ((current & 0x2) > 0) ? 3 : 1 // not implemented\r\n\t\t\t\t\t\t\tscale.pos = (current << 4 & 0x10) + ((current = parser.readByte()) >> 4 & 0xf)\r\n\t\t\t\t\t\t\tformat.pos = (current >> 1 & 0x7)\r\n\t\t\t\t\t\t\tfields.pos = ((current & 0x1) > 0) ? 3 : 2 // not implemented                                    \r\n\t\t\t\t\t\t\tbreak\r\n\t\t\t\t\t\tcase 0x80:\r\n\t\t\t\t\t\t\tcurrent = parser.readByte()\r\n\t\t\t\t\t\t\tformat.tex4 = (current >> 4 & 0x3)\r\n\t\t\t\t\t\t\tfields.tex4 = ((current & 0x8) > 0) ? 2 : 1 // not implemented\r\n\t\t\t\t\t\t\tscale.tex3 = (current << 2 & 0x1c) + ((current = parser.readByte()) >> 6 & 0x3)\r\n\t\t\t\t\t\t\tformat.tex3 = (current >> 3 & 0x3)\r\n\t\t\t\t\t\t\tfields.tex3 = ((current & 0x4) > 0) ? 2 : 1 // not implemented\r\n\t\t\t\t\t\t\tscale.tex2 = (current << 3 & 0x18) + ((current = parser.readByte()) >> 5 & 0x7)\r\n\t\t\t\t\t\t\tformat.tex2 = (current >> 2 & 0x3)\r\n\t\t\t\t\t\t\tfields.tex2 = ((current & 0x2) > 0) ? 2 : 1 // not implemented\r\n\t\t\t\t\t\t\tscale.tex1 = (current << 4 & 0x10) + ((current = parser.readByte()) >> 4 & 0xf)\r\n\t\t\t\t\t\t\tformat.tex1 = (current >> 1 & 0x3)\r\n\t\t\t\t\t\t\tfields.tex1 = ((current & 0x1) > 0) ? 2 : 1 // not implemented\r\n\t\t\t\t\t\t\tbreak\r\n\t\t\t\t\t\tcase 0x90:\r\n\t\t\t\t\t\t\tcurrent = parser.readByte()\r\n\t\t\t\t\t\t\tscale.tex7 = current >> 3 & 0x1f\r\n\t\t\t\t\t\t\tformat.tex7 = (current >> 0 & 0x3)\r\n\t\t\t\t\t\t\tcurrent = parser.readByte()\r\n\t\t\t\t\t\t\tfields.tex7 = ((current & 0x80) > 0) ? 2 : 1 // not implemented\r\n\t\t\t\t\t\t\tscale.tex6 = current >> 2 & 0x1f\r\n\t\t\t\t\t\t\tformat.tex6 = (current << 1 & 0x2)\r\n\t\t\t\t\t\t\tcurrent = parser.readByte()\r\n\t\t\t\t\t\t\tformat.tex6 |= (current >> 7 & 0x1)\r\n\t\t\t\t\t\t\tfields.tex6 = ((current & 0x40) > 0) ? 2 : 1 // not implemented\r\n\t\t\t\t\t\t\tscale.tex5 = current >> 1 & 0x1f\r\n\t\t\t\t\t\t\tcurrent = parser.readByte()\r\n\t\t\t\t\t\t\tformat.tex5 |= (current >> 6 & 0x3)\r\n\t\t\t\t\t\t\tfields.tex5 = ((current & 0x20) > 0) ? 2 : 1 // not implemented\r\n\t\t\t\t\t\t\tscale.tex4 = current >> 0 & 0x1f\r\n\t\t\t\t\t\t\tbreak\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tparser.readByte()\r\n\t\t\t\t\t\t\tparser.readByte()\r\n\t\t\t\t\t\t\tparser.readByte()\r\n\t\t\t\t\t\t\tparser.readByte()\r\n\t\t\t\t\t\t\tbreak\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tcase 0x10:\r\n\t\t\t\t\tparser.readByte()\r\n\t\t\t\t\tcurrent = parser.readByte()\r\n\r\n\t\t\t\t\tswitch (parser.readInt16())\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcase 0x0810:\r\n\t\t\t\t\t\t\tparser.readByte()\r\n\t\t\t\t\t\t\tparser.readByte()\r\n\t\t\t\t\t\t\tparser.readByte()\r\n\t\t\t\t\t\t\tparser.readByte()\r\n\t\t\t\t\t\t\tcurrent = parser.readByte()\r\n\r\n\t\t\t\t\t\t\ttextureCount = current >> 4 & 0xf\r\n\t\t\t\t\t\t\tnormalCount = current >> 2 & 0x3\r\n\t\t\t\t\t\t\tcolorCount = current >> 0 & 0x3\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tfor (let i = 0; i < 1 + 4 * ((current & 0xf) + 1); i++)\r\n\t\t\t\t\t\t\t\tparser.readByte()\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tbreak\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak\r\n\t\t\t\t\t\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak end\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn { matrix, presence, fields, format, scale, colorCount, normalCount, textureCount }\r\n\t}\r\n\t\r\n\t\r\n\tstatic readVertices(parser, polygon, descr, count)\r\n\t{\r\n\t\tlet vertices = []\r\n\t\t\r\n\t\tfor (let i = 0; i < count; i++)\r\n\t\t{\r\n\t\t\tif (descr.matrix.pos ||\r\n\t\t\t\tdescr.matrix.tex0 || descr.matrix.tex1 || descr.matrix.tex2 || descr.matrix.tex3 ||\r\n\t\t\t\tdescr.matrix.tex4 || descr.matrix.tex5 || descr.matrix.tex6 || descr.matrix.tex7)\r\n\t\t\t\tthrow \"brres: mdl0 unsupported vertex description matrix\"\r\n\t\t\t\t\r\n\t\t\tswitch (descr.presence.pos)\r\n\t\t\t{\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tthrow \"brres: mdl0 unsupported direct vertex presence\"\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tvertices.push(polygon.vertexGroup.vertices[parser.readByte()])\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tvertices.push(polygon.vertexGroup.vertices[parser.readUInt16()])\r\n\t\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tswitch (descr.presence.norm)\r\n\t\t\t{\r\n\t\t\t\tcase 0: break\r\n\t\t\t\tcase 1: throw \"brres: mdl0 unsupported direct normal presence\"\r\n\t\t\t\tcase 2: parser.readByte(); break\r\n\t\t\t\tcase 3: parser.readUInt16(); break\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tswitch (descr.presence.col0)\r\n\t\t\t{\r\n\t\t\t\tcase 0: break\r\n\t\t\t\tcase 1: throw \"brres: mdl0 unsupported direct col0 presence\"\r\n\t\t\t\tcase 2: parser.readByte(); break\r\n\t\t\t\tcase 3: parser.readUInt16(); break\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tswitch (descr.presence.col1)\r\n\t\t\t{\r\n\t\t\t\tcase 0: break\r\n\t\t\t\tcase 1: throw \"brres: mdl0 unsupported direct col1 presence\"\r\n\t\t\t\tcase 2: parser.readByte(); break\r\n\t\t\t\tcase 3: parser.readUInt16(); break\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tswitch (descr.presence.tex0)\r\n\t\t\t{\r\n\t\t\t\tcase 0: break\r\n\t\t\t\tcase 1: throw \"brres: mdl0 unsupported direct tex0 presence\"\r\n\t\t\t\tcase 2: parser.readByte(); break\r\n\t\t\t\tcase 3: parser.readUInt16(); break\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tswitch (descr.presence.tex1)\r\n\t\t\t{\r\n\t\t\t\tcase 0: break\r\n\t\t\t\tcase 1: throw \"brres: mdl0 unsupported direct tex1 presence\"\r\n\t\t\t\tcase 2: parser.readByte(); break\r\n\t\t\t\tcase 3: parser.readUInt16(); break\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tswitch (descr.presence.tex2)\r\n\t\t\t{\r\n\t\t\t\tcase 0: break\r\n\t\t\t\tcase 1: throw \"brres: mdl0 unsupported direct tex2 presence\"\r\n\t\t\t\tcase 2: parser.readByte(); break\r\n\t\t\t\tcase 3: parser.readUInt16(); break\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tswitch (descr.presence.tex3)\r\n\t\t\t{\r\n\t\t\t\tcase 0: break\r\n\t\t\t\tcase 1: throw \"brres: mdl0 unsupported direct tex3 presence\"\r\n\t\t\t\tcase 2: parser.readByte(); break\r\n\t\t\t\tcase 3: parser.readUInt16(); break\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tswitch (descr.presence.tex4)\r\n\t\t\t{\r\n\t\t\t\tcase 0: break\r\n\t\t\t\tcase 1: throw \"brres: mdl0 unsupported direct tex4 presence\"\r\n\t\t\t\tcase 2: parser.readByte(); break\r\n\t\t\t\tcase 3: parser.readUInt16(); break\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tswitch (descr.presence.tex5)\r\n\t\t\t{\r\n\t\t\t\tcase 0: break\r\n\t\t\t\tcase 1: throw \"brres: mdl0 unsupported direct tex5 presence\"\r\n\t\t\t\tcase 2: parser.readByte(); break\r\n\t\t\t\tcase 3: parser.readUInt16(); break\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tswitch (descr.presence.tex6)\r\n\t\t\t{\r\n\t\t\t\tcase 0: break\r\n\t\t\t\tcase 1: throw \"brres: mdl0 unsupported direct tex6 presence\"\r\n\t\t\t\tcase 2: parser.readByte(); break\r\n\t\t\t\tcase 3: parser.readUInt16(); break\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tswitch (descr.presence.tex7)\r\n\t\t\t{\r\n\t\t\t\tcase 0: break\r\n\t\t\t\tcase 1: throw \"brres: mdl0 unsupported direct tex7 presence\"\r\n\t\t\t\tcase 2: parser.readByte(); break\r\n\t\t\t\tcase 3: parser.readUInt16(); break\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn vertices\r\n\t}\r\n}\r\n\r\n\r\nif (module)\r\n\tmodule.exports = { BrresLoader }", "const { Viewer } = require(\"./viewer/viewer.js\")\nconst { ModelBuilder } = require(\"./util/modelBuilder.js\")\nconst { KmpData } = require(\"./util/kmpData.js\")\nconst { KclLoader, collisionTypeData } = require(\"./util/kclLoader.js\")\nconst { SzsArchive, normalizeArchivePath } = require(\"./util/szs.js\")\n\n\nlet gMainWindow = null\nconst APP_VERSION = (typeof __APP_VERSION__ !== \"undefined\" ? __APP_VERSION__ : \"web\")\n\n\nfunction main()\n{\n\tgMainWindow = new MainWindow()\t\n}\n\n\nfunction isMacPlatform()\n{\n\treturn /Mac|iPhone|iPad|iPod/i.test(window.navigator.platform)\n}\n\n\nfunction normalizeFilename(str)\n{\n\tif (str == null)\n\t\treturn null\n\n\treturn str.replace(new RegExp(\"\\\\\\\\\", \"g\"), \"/\")\n}\n\n\nfunction getExtension(filename)\n{\n\tif (filename == null)\n\t\treturn \"\"\n\n\tconst i = filename.lastIndexOf(\".\")\n\tif (i < 0)\n\t\treturn \"\"\n\treturn filename.substring(i).toLowerCase()\n}\n\n\nclass MainWindow\n{\n\tconstructor()\n\t{\n\t\tthis.currentKmpFileHandle = null\n\t\tthis.currentDirectoryHandle = null\n\t\tthis.currentKclFileHandle = null\n\t\tthis.currentKclBytes = null\n\t\tthis.currentModelFileHandle = null\n\t\tthis.currentSzsFileHandle = null\n\t\tthis.currentArchiveEntries = null\n\t\tthis.currentArchiveKmpPath = null\n\t\tthis.currentArchiveKclPath = null\n\t\tthis.currentArchiveSourceName = null\n\n\t\tdocument.body.onresize = () => this.onResize()\n\t\twindow.addEventListener(\"beforeunload\", (ev) => this.onClose(ev))\n\t\tthis.bindToolbar()\n\t\tthis.setupDragAndDropSzsImport()\n\t\t\n\t\t// To prevent strange bug with the browser undoing/redoing changes in destroyed input elements\n\t\tdocument.body.onkeydown = (ev) =>\n\t\t{\n\t\t\tconst isMod = (ev.ctrlKey || ev.metaKey)\n\t\t\tconst key = ev.key.toLowerCase()\n\n\t\t\tif (!isMod)\n\t\t\t\treturn\n\n\t\t\tif (key === \"z\")\n\t\t\t{\n\t\t\t\tev.preventDefault()\n\t\t\t\tev.stopPropagation()\n\t\t\t\tif (ev.shiftKey)\n\t\t\t\t\tthis.redo()\n\t\t\t\telse\n\t\t\t\t\tthis.undo()\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (key === \"y\")\n\t\t\t{\n\t\t\t\tev.preventDefault()\n\t\t\t\tev.stopPropagation()\n\t\t\t\tthis.redo()\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (key === \"n\")\n\t\t\t{\n\t\t\t\tev.preventDefault()\n\t\t\t\tev.stopPropagation()\n\t\t\t\tvoid this.newKmp()\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (key === \"o\")\n\t\t\t{\n\t\t\t\tev.preventDefault()\n\t\t\t\tev.stopPropagation()\n\t\t\t\tvoid this.askOpenKmp()\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (key === \"s\")\n\t\t\t{\n\t\t\t\tev.preventDefault()\n\t\t\t\tev.stopPropagation()\n\t\t\t\tif (ev.shiftKey)\n\t\t\t\t\tvoid this.saveKmpAs()\n\t\t\t\telse\n\t\t\t\t\tvoid this.saveKmp(this.currentKmpFilename)\n\t\t\t}\n\t\t}\n\t\t\r\n\t\tthis.noModelLoaded = true\r\n\t\t\r\n\t\tthis.cfg =\n\t\t{\n\t\t\tisBattleTrack: false,\n\t\t\tuseOrthoProjection: false,\n\t\t\tcameraMovementSpeed: 0.5,\n\t\t\tpointScale: 1,\n\t\t\tshadingFactor: 0.3,\n\t\t\tfogFactor: 0.0000025,\n\r\n\t\t\tkclEnableModel: true,\r\n\t\t\tkclEnableColors: true,\r\n\t\t\tkclEnableWalls: true,\r\n\t\t\tkclEnableDeathBarriers: true,\r\n\t\t\tkclEnableInvisible: true,\r\n\t\t\tkclEnableItemRoad: false,\r\n\t\t\tkclEnableEffects: false,\r\n\t\t\tkclHighlighter: 0,\r\n\t\t\tkclTriIndex: [-1, -1],\r\n\r\n\t\t\tenableRotationRender: true,\r\n\r\n\t\t\tstartPointsEnableZoneRender: true,\r\n\r\n\t\t\tenemyPathsEnableSizeRender: true,\r\n\r\n\t\t\tcheckpointsEnableVerticalPanels: true,\r\n\t\t\tcheckpointsEnableRespawnPointLinks: true,\r\n\t\t\tcheckpointsEnableDirectionArrows: true,\r\n\r\n\t\t\trespawnsEnablePlayerSlots: true,\r\n\r\n\t\t\tobjectsEnableSignedSettings: false,\r\n\r\n\t\t\tcannonsEnableDirectionRender: false,\r\n\t\t\tcannonsEnableKclHighlight: true,\r\n\r\n\t\t\tsnapToCollision: true,\r\n\t\t\tlockAxisX: false,\r\n\t\t\tlockAxisY: false,\r\n\t\t\tlockAxisZ: false,\r\n\t\t\tunlockAxes() \r\n\t\t\t{\r\n\t\t\t\tthis.lockAxisX = false\r\n\t\t\t\tthis.lockAxisY = false\r\n\t\t\t\tthis.lockAxisZ = false\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.hl = \r\n\t\t{\r\n\t\t\tbaseType: -1,\r\n\t\t\tbasicEffect: -1,\r\n\t\t\tblightEffect: -1,\r\n\t\t\tintensity: -1,\r\n\t\t\tcollisionEffect: -1\r\n\t\t}\r\n\t\tthis.hl.reset = () =>\r\n\t\t{\r\n\t\t\tthis.hl.baseType = -1,\r\n\t\t\tthis.hl.basicEffect = -1,\r\n\t\t\tthis.hl.blightEffect = -1,\r\n\t\t\tthis.hl.intensity = -1,\r\n\t\t\tthis.hl.collisionEffect = -1\r\n\t\t}\r\n\r\n\t\t\r\n\t\tthis.currentKmpFilename = null\r\n\t\tthis.currentKclFilename = null\r\n\t\tthis.currentKmpData = new KmpData()\r\n\t\tthis.currentNotSaved = false\r\n\t\t\r\n\t\t\tthis.undoNeedsNewSlot = false\n\t\t\tthis.undoStack = []\n\t\t\tthis.undoPointer = -1\n\t\t\tthis.savedUndoSlot = -1\n\t\t\t\n\t\t\tthis.panels = []\n\t\t\tthis.ui =\n\t\t\t{\n\t\t\t\tpanelSearch: \"\",\n\t\t\t\tfocusMode: true\n\t\t\t}\n\n\t\t\tthis.refreshTitle()\n\t\t\tthis.setupCameraSpeedControl()\n\t\t\tthis.setupPanelNavigationControls()\n\n\t\t\tthis.sidePanelDiv = document.getElementById(\"divSidePanel\")\n\t\t\tthis.viewer = new Viewer(this, document.getElementById(\"canvasMain\"), this.cfg, this.currentKmpData)\n\t\tthis.refreshPanels()\n\t\t\n\t\tvoid this.newKmp(false)\n\t}\n\n\n\tonResize()\n\t{\r\n\t\tthis.viewer.resize()\r\n\t\tthis.viewer.render()\r\n\t}\r\n\t\r\n\t\r\n\tonReload()\n\t{\n\t\twindow.location.reload()\n\t}\n\t\n\t\n\tonClose(ev)\n\t{\n\t\tif (!this.currentNotSaved)\n\t\t\treturn\n\n\t\tev.preventDefault()\n\t\tev.returnValue = \"\"\n\t}\n\n\n\topenExternalLink(link)\n\t{\n\t\twindow.open(link, \"_blank\", \"noopener,noreferrer\")\n\t}\n\n\n\tsetupCameraSpeedControl()\n\t{\n\t\tlet input = document.getElementById(\"inputCameraSpeed\")\n\t\tif (input == null)\n\t\t\treturn\n\n\t\tlet applySpeed = (valueRaw) =>\n\t\t{\n\t\t\tlet value = parseFloat(valueRaw)\n\t\t\tif (isNaN(value) || !isFinite(value))\n\t\t\t\tvalue = this.cfg.cameraMovementSpeed\n\n\t\t\tvalue = Math.max(0.1, Math.min(10, value))\n\t\t\tthis.cfg.cameraMovementSpeed = value\n\t\t\tinput.value = value.toFixed(2).replace(/\\.?0+$/, \"\")\n\t\t}\n\n\t\tinput.value = this.cfg.cameraMovementSpeed.toFixed(2).replace(/\\.?0+$/, \"\")\n\t\tinput.onchange = () => applySpeed(input.value)\n\t\tinput.onblur = () => applySpeed(input.value)\n\t}\n\n\n\tsetupPanelNavigationControls()\n\t{\n\t\tconst sectionSelect = document.getElementById(\"selectSection\")\n\t\tconst panelSearchInput = document.getElementById(\"inputPanelSearch\")\n\t\tconst focusModeToggle = document.getElementById(\"toggleFocusMode\")\n\n\t\tif (sectionSelect != null)\n\t\t{\n\t\t\tsectionSelect.onchange = () =>\n\t\t\t{\n\t\t\t\tconst i = parseInt(sectionSelect.value)\n\t\t\t\tif (isNaN(i) || i < 0 || i >= this.viewer.subviewers.length)\n\t\t\t\t\treturn\n\n\t\t\t\tthis.viewer.setSubviewer(this.viewer.subviewers[i])\n\t\t\t}\n\t\t}\n\n\t\tif (panelSearchInput != null)\n\t\t{\n\t\t\tpanelSearchInput.oninput = () =>\n\t\t\t{\n\t\t\t\tthis.ui.panelSearch = panelSearchInput.value.trim().toLowerCase()\n\t\t\t\tthis.applyPanelVisibility()\n\t\t\t}\n\t\t}\n\n\t\tif (focusModeToggle != null)\n\t\t{\n\t\t\tfocusModeToggle.checked = this.ui.focusMode\n\t\t\tfocusModeToggle.onchange = () =>\n\t\t\t{\n\t\t\t\tthis.ui.focusMode = focusModeToggle.checked\n\t\t\t\tthis.applyPanelVisibility()\n\t\t\t}\n\t\t}\n\t}\n\n\n\tupdateSectionSelectOptions()\n\t{\n\t\tconst sectionSelect = document.getElementById(\"selectSection\")\n\t\tif (sectionSelect == null || this.viewer == null || this.viewer.subviewers == null)\n\t\t\treturn\n\n\t\tlet selectedIndex = this.viewer.subviewers.findIndex(v => v === this.viewer.currentSubviewer)\n\t\tif (selectedIndex < 0)\n\t\t\tselectedIndex = 0\n\n\t\tsectionSelect.innerHTML = \"\"\n\t\tfor (let i = 0; i < this.viewer.subviewers.length; i++)\n\t\t{\n\t\t\tconst subviewer = this.viewer.subviewers[i]\n\t\t\tconst option = document.createElement(\"option\")\n\t\t\toption.value = i\n\t\t\toption.text = (subviewer != null && subviewer.panel != null ? subviewer.panel.name : \"Section \" + (i + 1))\n\t\t\tsectionSelect.appendChild(option)\n\t\t}\n\n\t\tsectionSelect.value = selectedIndex.toString()\n\t}\n\n\n\tapplyPanelVisibility()\n\t{\n\t\tconst activeName = (this.viewer != null && this.viewer.currentSubviewer != null && this.viewer.currentSubviewer.panel != null)\n\t\t\t? this.viewer.currentSubviewer.panel.name\n\t\t\t: null\n\t\tconst panelSearch = this.ui.panelSearch\n\n\t\tfor (const panel of this.panels)\n\t\t{\n\t\t\tconst isModelPanel = (panel.name == \"Model\")\n\t\t\tconst matchesSearch = (panelSearch == \"\" || panel.name.toLowerCase().includes(panelSearch))\n\t\t\tlet visible = (isModelPanel ? true : matchesSearch)\n\n\t\t\tif (this.ui.focusMode && !isModelPanel)\n\t\t\t\tvisible = visible && (panel.name == activeName)\n\n\t\t\tpanel.panelDiv.style.display = (visible ? \"block\" : \"none\")\n\t\t}\n\t}\n\n\n\tonSubviewerChanged(subviewer)\n\t{\n\t\tthis.updateSectionSelectOptions()\n\t\tthis.applyPanelVisibility()\n\t}\n\n\n\tbindToolbar()\n\t{\n\t\tconst byId = (id) => document.getElementById(id)\n\t\tconst bind = (id, fn) =>\n\t\t{\n\t\t\tconst button = byId(id)\n\t\t\tif (button != null)\n\t\t\t\tbutton.onclick = () => { void fn() }\n\t\t}\n\n\t\tbind(\"btnNewKmp\", () => this.newKmp())\n\t\tbind(\"btnOpenKmp\", () => this.askOpenKmp())\n\t\tbind(\"btnOpenTrackFolder\", () => this.askOpenTrackFolder())\n\t\tbind(\"btnImportSzs\", () => this.askImportSzs())\n\t\tbind(\"btnSaveKmp\", () => this.saveKmp(this.currentKmpFilename))\n\t\tbind(\"btnSaveKmpAs\", () => this.saveKmpAs())\n\t\tbind(\"btnOpenModel\", () => this.openCustomModel())\n\t\tbind(\"btnUndo\", () => { this.undo(); return Promise.resolve() })\n\t\tbind(\"btnRedo\", () => { this.redo(); return Promise.resolve() })\n\t}\n\n\n\tsetupDragAndDropSzsImport()\n\t{\n\t\tconst hasSzsFile = (dataTransfer) =>\n\t\t{\n\t\t\tif (dataTransfer == null || dataTransfer.files == null)\n\t\t\t\treturn false\n\t\t\tfor (const file of dataTransfer.files)\n\t\t\t{\n\t\t\t\tif ((file.name || \"\").toLowerCase().endsWith(\".szs\"))\n\t\t\t\t\treturn true\n\t\t\t}\n\t\t\treturn false\n\t\t}\n\n\t\twindow.addEventListener(\"dragover\", (ev) =>\n\t\t{\n\t\t\tif (!hasSzsFile(ev.dataTransfer))\n\t\t\t\treturn\n\n\t\t\tev.preventDefault()\n\t\t\tev.dataTransfer.dropEffect = \"copy\"\n\t\t})\n\n\t\twindow.addEventListener(\"drop\", async (ev) =>\n\t\t{\n\t\t\tif (!hasSzsFile(ev.dataTransfer))\n\t\t\t\treturn\n\n\t\t\tev.preventDefault()\n\t\t\tif (!await this.askSaveChanges())\n\t\t\t\treturn\n\n\t\t\tfor (const file of ev.dataTransfer.files)\n\t\t\t{\n\t\t\t\tif (!(file.name || \"\").toLowerCase().endsWith(\".szs\"))\n\t\t\t\t\tcontinue\n\n\t\t\t\tconst bytes = new Uint8Array(await file.arrayBuffer())\n\t\t\t\tawait this.openSzsFromBytes(file.name, bytes)\n\t\t\t\tbreak\n\t\t\t}\n\t\t})\n\t}\n\n\n\tasync pickSingleFileFromInput(accept, directory = false)\n\t{\n\t\treturn await new Promise((resolve) =>\n\t\t{\n\t\t\tconst input = document.createElement(\"input\")\n\t\t\tinput.type = \"file\"\n\t\t\tinput.style.display = \"none\"\n\t\t\tinput.accept = accept\n\t\t\tif (directory)\n\t\t\t{\n\t\t\t\tinput.setAttribute(\"webkitdirectory\", \"\")\n\t\t\t\tinput.setAttribute(\"directory\", \"\")\n\t\t\t}\n\n\t\t\tinput.onchange = () =>\n\t\t\t{\n\t\t\t\tconst files = input.files\n\t\t\t\tif (directory)\n\t\t\t\t\tresolve(files)\n\t\t\t\telse if (files != null && files.length > 0)\n\t\t\t\t\tresolve(files[0])\n\t\t\t\telse\n\t\t\t\t\tresolve(null)\n\t\t\t\tinput.remove()\n\t\t\t}\n\n\t\t\tdocument.body.appendChild(input)\n\t\t\tinput.click()\n\t\t})\n\t}\n\n\n\tasync pickFileHandle(options)\n\t{\n\t\tif (window.showOpenFilePicker == null)\n\t\t\treturn null\n\n\t\ttry\n\t\t{\n\t\t\tconst handles = await window.showOpenFilePicker(options)\n\t\t\tif (handles != null && handles.length > 0)\n\t\t\t\treturn handles[0]\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tif (e.name !== \"AbortError\")\n\t\t\t\tconsole.error(e)\n\t\t}\n\t\treturn null\n\t}\n\n\n\tasync pickDirectoryHandle()\n\t{\n\t\tif (window.showDirectoryPicker == null)\n\t\t\treturn null\n\n\t\ttry\n\t\t{\n\t\t\treturn await window.showDirectoryPicker()\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tif (e.name !== \"AbortError\")\n\t\t\t\tconsole.error(e)\n\t\t}\n\t\treturn null\n\t}\n\n\n\tasync readHandleBytes(fileHandle)\n\t{\n\t\tconst file = await fileHandle.getFile()\n\t\treturn new Uint8Array(await file.arrayBuffer())\n\t}\n\n\n\tasync readFileBytesFromDirectory(directoryHandle, filename)\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst fileHandle = await directoryHandle.getFileHandle(filename)\n\t\t\treturn {\n\t\t\t\tfilename,\n\t\t\t\tfileHandle,\n\t\t\t\tbytes: await this.readHandleBytes(fileHandle)\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\treturn null\n\t\t}\n\t}\n\n\n\tasync readAllFilesFromDirectoryHandle(directoryHandle, prefix = \"\")\n\t{\n\t\tlet entries = new Map()\n\n\t\tfor await (const [name, handle] of directoryHandle.entries())\n\t\t{\n\t\t\tconst localPath = (prefix == \"\" ? name : prefix + \"/\" + name)\n\t\t\tif (handle.kind == \"directory\")\n\t\t\t{\n\t\t\t\tconst childEntries = await this.readAllFilesFromDirectoryHandle(handle, localPath)\n\t\t\t\tfor (const [childPath, childBytes] of childEntries)\n\t\t\t\t\tentries.set(childPath, childBytes)\n\t\t\t}\n\t\t\telse if (handle.kind == \"file\")\n\t\t\t{\n\t\t\t\tentries.set(localPath, await this.readHandleBytes(handle))\n\t\t\t}\n\t\t}\n\n\t\treturn entries\n\t}\n\n\n\tgetCurrentKmpStorageBytes()\n\t{\n\t\treturn new Uint8Array(this.currentKmpData.convertToStorageFormat(this.cfg.isBattleTrack))\n\t}\n\n\n\tgetCurrentArchiveEntriesForSzs()\n\t{\n\t\tlet entries = SzsArchive.cloneEntries(this.currentArchiveEntries)\n\t\tlet kmpPath = (this.currentArchiveKmpPath != null ? this.currentArchiveKmpPath : SzsArchive.findPath(entries, \"course.kmp\"))\n\t\tif (kmpPath == null)\n\t\t\tkmpPath = \"course.kmp\"\n\n\t\tentries.set(normalizeArchivePath(kmpPath), this.getCurrentKmpStorageBytes())\n\n\t\tlet kclPath = (this.currentArchiveKclPath != null ? this.currentArchiveKclPath : SzsArchive.findPath(entries, \"course.kcl\"))\n\t\tif (kclPath == null && this.currentKclBytes != null)\n\t\t\tkclPath = \"course.kcl\"\n\t\tif (kclPath != null && this.currentKclBytes != null)\n\t\t{\n\t\t\tkclPath = normalizeArchivePath(kclPath)\n\t\t\tif (!entries.has(kclPath))\n\t\t\t\tentries.set(kclPath, new Uint8Array(this.currentKclBytes))\n\t\t}\n\n\t\treturn entries\n\t}\n\n\n\tasync writeBytesToHandle(fileHandle, bytes)\n\t{\n\t\tconst writable = await fileHandle.createWritable()\n\t\tawait writable.write(new Uint8Array(bytes))\n\t\tawait writable.close()\n\t}\n\n\n\tbuildKmpFileTypeFilter()\n\t{\n\t\treturn {\n\t\t\tdescription: \"KMP Files (*.kmp)\",\n\t\t\taccept: { \"application/octet-stream\": [\".kmp\"] }\n\t\t}\n\t}\n\n\n\tbuildModelFileTypeFilter()\n\t{\n\t\treturn {\n\t\t\tdescription: \"Supported model formats (*.obj, *.brres, *.kcl)\",\n\t\t\taccept: { \"application/octet-stream\": [\".obj\", \".brres\", \".kcl\"] }\n\t\t}\n\t}\n\n\n\tbuildSzsFileTypeFilter()\n\t{\n\t\treturn {\n\t\t\tdescription: \"Mario Kart Wii archive (*.szs)\",\n\t\t\taccept: { \"application/octet-stream\": [\".szs\"] }\n\t\t}\n\t}\n\n\n\tgetKmpDownloadName()\n\t{\n\t\tif (this.currentKmpFilename == null)\n\t\t\treturn \"course.kmp\"\n\n\t\tlet name = this.currentKmpFilename\n\t\tif (name.includes(\"/\"))\n\t\t\tname = name.substring(name.lastIndexOf(\"/\") + 1)\n\t\treturn name\n\t}\n\n\n\tgetSzsDownloadName()\n\t{\n\t\tif (this.currentArchiveSourceName != null && this.currentArchiveSourceName.toLowerCase().endsWith(\".szs\"))\n\t\t\treturn this.currentArchiveSourceName\n\n\t\tlet base = \"track.szs\"\n\t\tif (this.currentKmpFilename != null)\n\t\t{\n\t\t\tlet simple = this.currentKmpFilename\n\t\t\tif (simple.includes(\"/\"))\n\t\t\t\tsimple = simple.substring(simple.lastIndexOf(\"/\") + 1)\n\t\t\tif (simple.toLowerCase().endsWith(\".kmp\"))\n\t\t\t\tsimple = simple.substring(0, simple.length - 4) + \".szs\"\n\t\t\telse if (!simple.toLowerCase().endsWith(\".szs\"))\n\t\t\t\tsimple += \".szs\"\n\t\t\tbase = simple\n\t\t}\n\t\treturn base\n\t}\n\n\n\taskSaveAsFormat()\n\t{\n\t\tlet defaultFormat = (this.currentArchiveEntries != null ? \"szs\" : \"kmp\")\n\t\tlet answer = window.prompt(\"Save format: type 'szs' for full archive, or 'kmp' for only KMP.\", defaultFormat)\n\t\tif (answer == null)\n\t\t\treturn null\n\n\t\tanswer = answer.trim().toLowerCase()\n\t\tif (answer == \"szs\")\n\t\t\treturn \"szs\"\n\t\tif (answer == \"kmp\")\n\t\t\treturn \"kmp\"\n\n\t\twindow.alert(\"Invalid format. Please type exactly 'szs' or 'kmp'.\")\n\t\treturn null\n\t}\n\n\n\tdownloadBytes(bytes, filename)\n\t{\n\t\tconst blob = new Blob([new Uint8Array(bytes)], { type: \"application/octet-stream\" })\n\t\tconst url = URL.createObjectURL(blob)\n\t\tconst a = document.createElement(\"a\")\n\t\ta.href = url\n\t\ta.download = filename\n\t\ta.style.display = \"none\"\n\t\tdocument.body.appendChild(a)\n\t\ta.click()\n\t\ta.remove()\n\t\tURL.revokeObjectURL(url)\n\t}\n\t\r\n\t\r\n\trefreshPanels()\r\n\t{\r\n\t\tlet panel = this.addPanel(\"Model\")\r\n\t\tpanel.addText(null, \"<strong>Hold Right Mouse:</strong> Look Around\")\r\n\t\tpanel.addText(null, \"<strong>Hold Right Mouse + WASDQE:</strong> Move Camera\")\r\n\t\tpanel.addText(null, \"<strong>Middle Mouse:</strong> Rotate Camera\")\r\n\t\tpanel.addText(null, \"<strong>Hold Shift + Middle Mouse:</strong> Pan Camera\")\r\n\t\tpanel.addText(null, \"<strong>Mouse Wheel:</strong> Zoom\")\r\n\t\tpanel.addText(null, \"<strong>Double Right Click:</strong> Focus Camera\")\r\n\t\tpanel.addSpacer(null)\r\n\t\t\t//panel.addButton(null, \"Load course_model.brres\", () => this.openCourseBrres())\n\t\t\t//panel.addButton(null, \"Load course.kcl\", () => this.openCourseKcl())\n\t\t\tpanel.addButton(null, \"Load KMP\", () => this.askOpenKmp())\n\t\t\tpanel.addButton(null, \"Load Track Folder\", () => this.askOpenTrackFolder())\n\t\t\tpanel.addButton(null, \"Import .szs\", () => this.askImportSzs())\n\t\t\tpanel.addButton(null, \"Load Model\", () => this.openCustomModel())\n\t\tpanel.addButton(null, \"(5) Toggle Projection\", () => this.cfg.useOrthoProjection = !this.cfg.useOrthoProjection)\r\n\t\tpanel.addButton(null, \"Center view\", () => this.viewer.centerView())\r\n\t\tpanel.addSlider(null, \"Shading\", 0, 1, this.cfg.shadingFactor, 0.05, (x) => this.cfg.shadingFactor = x)\r\n\t\tpanel.addSlider(null, \"Fog\", 0.0000001, 0.0002, this.cfg.fogFactor, 0.0000001, (x) => this.cfg.fogFactor = x)\r\n\t\tpanel.addSlider(null, \"Point Scale\", 0.1, 5, this.cfg.pointScale, 0.1, (x) => this.cfg.pointScale = x)\r\n\t\tpanel.addSpacer(null)\r\n\t\t\r\n\t\tlet kclGroup = panel.addGroup(null, \"Collision data:\")\r\n\t\t//panel.addCheckbox(kclGroup, \"Enable model\", this.cfg.kclEnableModel, (x) => { this.cfg.kclEnableModel = x; this.openKcl(this.currentKclFilename) })\r\n\t\tpanel.addCheckbox(kclGroup, \"Use colors\", this.cfg.kclEnableColors, (x) => { this.cfg.kclEnableColors = x; this.reloadCurrentKcl() })\n\t\tpanel.addCheckbox(kclGroup, \"Show walls\", this.cfg.kclEnableWalls, (x) => { this.cfg.kclEnableWalls = x; this.reloadCurrentKcl() })\n\t\tpanel.addCheckbox(kclGroup, \"Show death barriers\", this.cfg.kclEnableDeathBarriers, (x) => { this.cfg.kclEnableDeathBarriers = x; this.reloadCurrentKcl() })\n\t\tpanel.addCheckbox(kclGroup, \"Show invisible walls\", this.cfg.kclEnableInvisible, (x) => { this.cfg.kclEnableInvisible = x; this.reloadCurrentKcl() })\n\t\tpanel.addCheckbox(kclGroup, \"Show item road/wall\", this.cfg.kclEnableItemRoad, (x) => { this.cfg.kclEnableItemRoad = x; this.reloadCurrentKcl() })\n\t\tpanel.addCheckbox(kclGroup, \"Show effects/triggers\", this.cfg.kclEnableEffects, (x) => { this.cfg.kclEnableEffects = x; this.reloadCurrentKcl() })\n\t\tpanel.addSpacer(kclGroup)\r\n\r\n\t\tlet hlOptions =\r\n\t\t[\r\n\t\t\t{ str: \"None\", value: 0 },\r\n\t\t\t{ str: \"Trickable Road\", value: 1 },\r\n\t\t\t{ str: \"Horizontal Walls\", value: 2 },\r\n\t\t\t{ str: \"Barrel Roll Walls\", value: 3 },\r\n\t\t\t{ str: \"Custom Flag\", value: 4 },\r\n\t\t\t{ str: \"Triangle Index\", value: 5 },\r\n\t\t\t{ str: \"Sloped Walls\", value: 6 },\r\n\t\t]\r\n\t\tpanel.addSelectionDropdown(kclGroup, \"Highlight\", this.cfg.kclHighlighter, hlOptions, true, false, (x) => { this.cfg.kclHighlighter = x; this.refreshPanels() })\r\n\t\r\n\t\tconst onBlur = (x) =>\n\t\t{\n\t\t\tthis.reloadCurrentKcl()\n\t\t\tthis.viewer.render()\n\t\t\treturn x\n\t\t}\n\t\t\r\n\t\tif (this.cfg.kclHighlighter === 4)\r\n\t\t{\t\r\n\t\t\tlet flagOptions = [{ str: \"None\", value: -1 }]\r\n\t\t\tfor (let i = 0; i <= 0x1f; i++)\r\n\t\t\t\tflagOptions.push({ str: \"(0x\" + i.toString(16) + \") \" + collisionTypeData[i].name, value: i })\r\n\r\n\t\t\tpanel.addSelectionDropdown(kclGroup, \"Base Type\", this.hl.baseType, flagOptions, true, false, (x, i) => { this.hl.baseType = x; onBlur(null) })\r\n\t\t\t\r\n\t\t\tpanel.addSelectionNumericInput(kclGroup, \"Variant\", \t \t -1, 0x7,  this.hl.basicEffect, \t1.0, 0.0, true, false, (x) => { this.hl.basicEffect = x \t}, onBlur)\r\n\t\t\tpanel.addSelectionNumericInput(kclGroup, \"BLIGHT Index\", \t -1, 0x7,  this.hl.blightEffect, \t1.0, 0.0, true, false, (x) => { this.hl.blightEffect = x \t}, onBlur)\r\n\t\t\tpanel.addSelectionNumericInput(kclGroup, \"Wheel Depth\", \t -1, 0x3,  this.hl.intensity, \t\t1.0, 0.0, true, false, (x) => { this.hl.intensity = x\t \t}, onBlur)\r\n\t\t\tpanel.addSelectionNumericInput(kclGroup, \"Collision Effect\", -1, 0x7,  this.hl.collisionEffect, 1.0, 0.0, true, false, (x) => { this.hl.collisionEffect = x }, onBlur)\r\n\t\t}\r\n\t\telse if (this.cfg.kclHighlighter === 5)\r\n\t\t{\r\n\t\t\tpanel.addSelectionNumericInput(kclGroup, \"Tri Index Min\", -1, 0xffff,  this.cfg.kclTriIndex[0], 1.0, 1.0, true, false, (x) => { this.cfg.kclTriIndex[0] = x }, onBlur)\r\n\t\t\tpanel.addSelectionNumericInput(kclGroup, \"Tri Index Max\", -1, 0xffff,  this.cfg.kclTriIndex[1], 1.0, 1.0, true, false, (x) => { this.cfg.kclTriIndex[1] = x }, onBlur)\r\n\t\t}\r\n\t\telse\n\t\t{\n\t\t\tthis.hl.reset()\n\t\t\tthis.reloadCurrentKcl()\n\t\t}\n\t\tpanel.addSpacer(null)\r\n\r\n\t\tlet moveGroup = panel.addGroup(null, \"Movement:\")\r\n\t\tpanel.addCheckbox(moveGroup, \"Snap to collision\", this.cfg.snapToCollision, (x) => { this.cfg.snapToCollision = x; if (x) this.cfg.unlockAxes(); this.refreshPanels() })\r\n\t\tpanel.addCheckbox(moveGroup, \"Lock X axis\", this.cfg.lockAxisX, (x) => { this.cfg.lockAxisX = x; if (x) this.cfg.snapToCollision = false; this.refreshPanels() })\r\n\t\tpanel.addCheckbox(moveGroup, \"Lock Y axis\", this.cfg.lockAxisY, (x) => { this.cfg.lockAxisY = x; if (x) this.cfg.snapToCollision = false; this.refreshPanels() })\r\n\t\t\tpanel.addCheckbox(moveGroup, \"Lock Z axis\", this.cfg.lockAxisZ, (x) => { this.cfg.lockAxisZ = x; if (x) this.cfg.snapToCollision = false; this.refreshPanels() })\n\t\t\t\n\t\t\tthis.refreshTitle()\n\t\t\tthis.viewer.refreshPanels()\n\t\t\tthis.updateSectionSelectOptions()\n\t\t\tthis.applyPanelVisibility()\n\t\t}\n\t\r\n\t\r\n\trefreshTitle()\n\t{\n\t\tconst title =\n\t\t\t(this.currentKmpFilename == null ? \"[New File]\" : \"[\" + this.currentKmpFilename + \"]\") +\n\t\t\t(this.currentNotSaved ? \"*\" : \"\") +\n\t\t\t\" -- Lorenzi's KMP Editor v\" + APP_VERSION\n\n\t\tdocument.title = title\n\n\t\tconst status = document.getElementById(\"lblFileStatus\")\n\t\tif (status != null)\n\t\t\tstatus.textContent = (this.currentKmpFilename == null ? \"New File\" : this.currentKmpFilename) + (this.currentNotSaved ? \" *\" : \"\")\n\t}\n\t\r\n\t\r\n\taddPanel(name, open = true, onToggle = null, closable = false)\n\t{\n\t\tlet panel = this.panels.find(p => p.name == name)\n\t\tif (panel != null)\n\t\t{\n\t\t\tpanel.clearContent()\n\t\t\tthis.applyPanelVisibility()\n\t\t\treturn panel\n\t\t}\n\t\t\n\t\tpanel = new Panel(this, this.sidePanelDiv, name, open, onToggle, closable, () => { this.viewer.render() })\n\t\tthis.panels.push(panel)\n\t\tthis.applyPanelVisibility()\n\t\treturn panel\n\t}\n\t\r\n\t\r\n\tsetNotSaved()\r\n\t{\r\n\t\tthis.undoNeedsNewSlot = true\r\n\t\t\r\n\t\tif (!this.currentNotSaved)\r\n\t\t{\r\n\t\t\tthis.currentNotSaved = true\r\n\t\t\tthis.refreshTitle()\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tsetUndoPoint()\r\n\t{\r\n\t\tif (!this.undoNeedsNewSlot)\r\n\t\t{\r\n\t\t\tthis.undoStack[this.undoPointer].subviewer = this.viewer.currentSubviewer\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tthis.undoStack.splice(this.undoPointer + 1, this.undoStack.length - this.undoPointer - 1)\t\t\r\n\t\t\r\n\t\tthis.undoStack.push({\r\n\t\t\tdata: this.currentKmpData.clone(),\r\n\t\t\tsubviewer: this.viewer.currentSubviewer,\r\n\t\t\tcurrentRouteIndex: this.viewer.subviewerRoutes.currentRouteIndex\r\n\t\t})\r\n\t\t\r\n\t\tthis.undoPointer += 1\r\n\t\tthis.undoNeedsNewSlot = false\r\n\t\t\r\n\t\tthis.currentKmpData.refreshIndices(this.cfg.isBattleTrack)\r\n\t}\r\n\t\r\n\t\r\n\tresetUndoStack()\r\n\t{\r\n\t\tthis.undoNeedsNewSlot = true\r\n\t\tthis.undoStack = []\r\n\t\tthis.undoPointer = -1\r\n\t\t\r\n\t\tthis.currentKmpData.refreshIndices(this.cfg.isBattleTrack)\r\n\t}\r\n\t\r\n\t\r\n\tundo()\r\n\t{\r\n\t\tif (this.undoPointer <= 0)\r\n\t\t\treturn\r\n\t\t\r\n\t\tthis.setUndoPoint()\r\n\t\t\r\n\t\tthis.undoPointer -= 1\r\n\t\tthis.currentKmpData = this.undoStack[this.undoPointer].data.clone()\r\n\t\tthis.currentKmpData.refreshIndices(this.cfg.isBattleTrack)\r\n\t\tthis.viewer.setSubviewer(this.undoStack[this.undoPointer].subviewer)\r\n\t\tthis.viewer.subviewerRoutes.currentRouteIndex = this.undoStack[this.undoPointer].currentRouteIndex\r\n\t\t\r\n\t\tthis.setNotSaved()\r\n\t\tthis.undoNeedsNewSlot = false\r\n\t\tthis.viewer.setData(this.currentKmpData)\r\n\t\tthis.viewer.render()\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\t\r\n\tredo()\r\n\t{\r\n\t\tif (this.undoPointer >= this.undoStack.length - 1)\r\n\t\t\treturn\r\n\t\t\r\n\t\tthis.undoPointer += 1\r\n\t\tthis.currentKmpData = this.undoStack[this.undoPointer].data.clone()\r\n\t\tthis.viewer.setSubviewer(this.undoStack[this.undoPointer].subviewer)\r\n\t\tthis.viewer.subviewerRoutes.currentRouteIndex = this.undoStack[this.undoPointer].currentRouteIndex\r\n\t\t\r\n\t\tthis.setNotSaved()\r\n\t\tthis.undoNeedsNewSlot = false\r\n\t\tthis.viewer.setData(this.currentKmpData)\r\n\t\tthis.viewer.render()\r\n\t\tthis.refreshPanels()\r\n\t}\r\n\t\r\n\t\r\n\tasync askSaveChanges()\n\t{\n\t\tif (!this.currentNotSaved)\n\t\t\treturn true\n\n\t\tif (window.confirm(\"Save current changes?\\n\\nOK = Save\\nCancel = more options\"))\n\t\t\treturn await this.saveKmp(this.currentKmpFilename)\n\n\t\tif (window.confirm(\"Discard unsaved changes?\\n\\nOK = Don't Save\\nCancel = Keep Editing\"))\n\t\t\treturn true\n\n\t\treturn false\n\t}\n\t\n\t\n\tasync newKmp(checkSavePrompt = true)\n\t{\n\t\tif (checkSavePrompt && !await this.askSaveChanges())\n\t\t\treturn false\n\t\t\n\t\tthis.currentKmpFilename = null\n\t\tthis.currentKmpFileHandle = null\n\t\tthis.currentDirectoryHandle = null\n\t\tthis.currentSzsFileHandle = null\n\t\tthis.currentArchiveEntries = null\n\t\tthis.currentArchiveKmpPath = null\n\t\tthis.currentArchiveKclPath = null\n\t\tthis.currentArchiveSourceName = null\n\t\tthis.currentKmpData = new KmpData()\n\t\tthis.currentNotSaved = false\n\t\tthis.cfg.isBattleTrack = false\n\t\t\r\n\t\tthis.resetUndoStack()\r\n\t\t\r\n\t\tthis.viewer.setData(this.currentKmpData)\n\t\tthis.setDefaultModel()\n\t\tthis.refreshPanels()\n\t\tthis.viewer.render()\n\t\tthis.noModelLoaded = true\n\t\treturn true\n\t}\n\n\n\tasync askOpenKmp()\n\t{\n\t\tif (!await this.askSaveChanges())\n\t\t\treturn\n\n\t\tif (window.showOpenFilePicker != null)\n\t\t{\n\t\t\tconst handle = await this.pickFileHandle({\n\t\t\t\tmultiple: false,\n\t\t\t\ttypes: [this.buildKmpFileTypeFilter()]\n\t\t\t})\n\n\t\t\tif (handle == null)\n\t\t\t\treturn\n\n\t\t\tconst bytes = await this.readHandleBytes(handle)\n\t\t\tawait this.openKmpFromBytes(handle.name, bytes, {\n\t\t\t\tkmpHandle: handle\n\t\t\t})\n\t\t\treturn\n\t\t}\n\n\t\tconst file = await this.pickSingleFileFromInput(\".kmp\")\n\t\tif (file == null)\n\t\t\treturn\n\n\t\tawait this.openKmpFromBytes(file.name, new Uint8Array(await file.arrayBuffer()))\n\t}\n\n\n\tasync askImportSzs()\n\t{\n\t\tif (!await this.askSaveChanges())\n\t\t\treturn\n\n\t\tif (window.showOpenFilePicker != null)\n\t\t{\n\t\t\tconst handle = await this.pickFileHandle({\n\t\t\t\tmultiple: false,\n\t\t\t\ttypes: [this.buildSzsFileTypeFilter()]\n\t\t\t})\n\n\t\t\tif (handle == null)\n\t\t\t\treturn\n\n\t\t\tawait this.openSzsFromBytes(handle.name, await this.readHandleBytes(handle), handle)\n\t\t\treturn\n\t\t}\n\n\t\tconst file = await this.pickSingleFileFromInput(\".szs\")\n\t\tif (file == null)\n\t\t\treturn\n\n\t\tawait this.openSzsFromBytes(file.name, new Uint8Array(await file.arrayBuffer()))\n\t}\n\n\n\tasync openSzsFromBytes(filename, bytes, fileHandle = null)\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst parsed = SzsArchive.parse(bytes)\n\t\t\tconst kmpPath = SzsArchive.findPath(parsed.entries, \"course.kmp\")\n\t\t\tif (kmpPath == null)\n\t\t\t\tthrow \"szs: course.kmp was not found in the archive\"\n\n\t\t\tconst kclPath = SzsArchive.findPath(parsed.entries, \"course.kcl\")\n\n\t\t\tawait this.openKmpFromBytes(filename + \"/\" + kmpPath, parsed.entries.get(kmpPath), {\n\t\t\t\tkclBytes: (kclPath == null ? null : parsed.entries.get(kclPath)),\n\t\t\t\tkclFilename: (kclPath == null ? null : filename + \"/\" + kclPath),\n\t\t\t\tszsHandle: fileHandle,\n\t\t\t\tarchiveEntries: parsed.entries,\n\t\t\t\tarchiveKmpPath: kmpPath,\n\t\t\t\tarchiveKclPath: kclPath,\n\t\t\t\tarchiveSourceName: filename\n\t\t\t})\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error(e)\n\t\t\twindow.alert(\"SZS import error!\\n\\n\" + e.toString())\n\t\t}\n\t}\n\t\n\t\n\tasync askOpenTrackFolder()\n\t{\n\t\tif (!await this.askSaveChanges())\n\t\t\treturn\n\n\t\tif (window.showDirectoryPicker != null)\n\t\t{\n\t\t\tconst directoryHandle = await this.pickDirectoryHandle()\n\t\t\tif (directoryHandle == null)\n\t\t\t\treturn\n\n\t\t\tconst archiveEntries = await this.readAllFilesFromDirectoryHandle(directoryHandle)\n\t\t\tconst kmpPath = SzsArchive.findPath(archiveEntries, \"course.kmp\")\n\t\t\tif (kmpPath == null)\n\t\t\t{\n\t\t\t\twindow.alert(\"No course.kmp was found in the selected folder.\")\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst kclPath = SzsArchive.findPath(archiveEntries, \"course.kcl\")\n\n\t\t\tawait this.openKmpFromBytes(directoryHandle.name + \"/\" + kmpPath, archiveEntries.get(kmpPath), {\n\t\t\t\tdirectoryHandle,\n\t\t\t\tkclBytes: (kclPath == null ? null : archiveEntries.get(kclPath)),\n\t\t\t\tkclFilename: (kclPath == null ? null : directoryHandle.name + \"/\" + kclPath),\n\t\t\t\tarchiveEntries,\n\t\t\t\tarchiveKmpPath: kmpPath,\n\t\t\t\tarchiveKclPath: kclPath,\n\t\t\t\tarchiveSourceName: directoryHandle.name\n\t\t\t})\n\t\t\treturn\n\t\t}\n\n\t\tconst files = await this.pickSingleFileFromInput(\"\", true)\n\t\tif (files == null || files.length <= 0)\n\t\t\treturn\n\n\t\tlet archiveEntries = new Map()\n\t\tfor (const file of files)\n\t\t{\n\t\t\tlet relativePath = normalizeArchivePath(file.webkitRelativePath || file.name)\n\t\t\tlet parts = relativePath.split(\"/\")\n\t\t\tif (parts.length > 1)\n\t\t\t\trelativePath = parts.slice(1).join(\"/\")\n\n\t\t\tarchiveEntries.set(relativePath, new Uint8Array(await file.arrayBuffer()))\n\t\t}\n\n\t\tconst kmpPath = SzsArchive.findPath(archiveEntries, \"course.kmp\")\n\t\tif (kmpPath == null)\n\t\t{\n\t\t\twindow.alert(\"No course.kmp was found in the selected folder.\")\n\t\t\treturn\n\t\t}\n\n\t\tconst firstPath = normalizeArchivePath(files[0].webkitRelativePath || files[0].name)\n\t\tconst folderName = (firstPath.includes(\"/\") ? firstPath.split(\"/\")[0] : \"track\")\n\t\tconst kclPath = SzsArchive.findPath(archiveEntries, \"course.kcl\")\n\n\t\tawait this.openKmpFromBytes(folderName + \"/\" + kmpPath, archiveEntries.get(kmpPath), {\n\t\t\tkclBytes: (kclPath == null ? null : archiveEntries.get(kclPath)),\n\t\t\tkclFilename: (kclPath == null ? null : folderName + \"/\" + kclPath),\n\t\t\tarchiveEntries,\n\t\t\tarchiveKmpPath: kmpPath,\n\t\t\tarchiveKclPath: kclPath,\n\t\t\tarchiveSourceName: folderName\n\t\t})\n\t}\n\n\n\tasync openKmpFromBytes(filename, bytes, source = {})\n\t{\n\t\t// Detect when run from `npm start`\n\t\tif (filename == \".\")\n\t\t\treturn\n\t\t\n\t\ttry\n\t\t{\n\t\t\tthis.currentKmpFilename = normalizeFilename(filename)\n\t\t\tthis.currentKmpFileHandle = (source.kmpHandle == null ? null : source.kmpHandle)\n\t\t\tthis.currentDirectoryHandle = (source.directoryHandle == null ? null : source.directoryHandle)\n\t\t\tthis.currentSzsFileHandle = (source.szsHandle == null ? null : source.szsHandle)\n\t\t\tthis.currentArchiveEntries = (source.archiveEntries == null ? null : SzsArchive.cloneEntries(source.archiveEntries))\n\t\t\tthis.currentArchiveKmpPath = (source.archiveKmpPath == null ? null : normalizeArchivePath(source.archiveKmpPath))\n\t\t\tthis.currentArchiveKclPath = (source.archiveKclPath == null ? null : normalizeArchivePath(source.archiveKclPath))\n\t\t\tthis.currentArchiveSourceName = (source.archiveSourceName == null ? null : source.archiveSourceName)\n\t\t\tthis.currentKmpData = KmpData.convertToWorkingFormat(KmpData.load(bytes))\n\t\t\tthis.currentNotSaved = false\n\t\t\t\n\t\t\tthis.cfg.isBattleTrack = this.currentKmpData.isBattleTrack\n\t\t\t\n\t\t\tthis.resetUndoStack()\n\n\t\t\tif (source.kclBytes != null)\n\t\t\t\tthis.openKclFromBytes(source.kclFilename, source.kclBytes, source.kclHandle)\n\t\t\telse if (this.currentDirectoryHandle != null)\n\t\t\t{\n\t\t\t\tconst kclFile = await this.readFileBytesFromDirectory(this.currentDirectoryHandle, \"course.kcl\")\n\t\t\t\tif (kclFile != null)\n\t\t\t\t\tthis.openKclFromBytes(this.currentDirectoryHandle.name + \"/course.kcl\", kclFile.bytes, kclFile.fileHandle)\n\t\t\t\telse\n\t\t\t\t\tthis.setDefaultModel()\n\t\t\t}\n\t\t\telse\n\t\t\t\tthis.setDefaultModel()\n\t\t\t\n\t\t\tthis.viewer.setData(this.currentKmpData)\r\n\t\t\tthis.viewer.centerView()\r\n\t\t\tthis.refreshPanels()\r\n\t\t\tthis.viewer.render()\r\n\t\t\tthis.noModelLoaded = false\r\n\t\t}\r\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error(e)\n\t\t\talert(\"KMP open error!\\n\\n\" + e)\n\t\t\tawait this.newKmp(false)\n\t\t}\n\t}\n\t\n\t\n\tasync saveKmp(filename)\n\t{\n\t\tif (this.currentSzsFileHandle != null && this.currentArchiveEntries != null)\n\t\t\treturn await this.saveSzsToHandle(this.currentSzsFileHandle)\n\n\t\tif (this.currentArchiveEntries != null && this.currentKmpFileHandle == null)\n\t\t\treturn await this.saveKmpAs()\n\n\t\tif (this.currentKmpFileHandle == null && filename == null)\n\t\t\treturn await this.saveKmpAs()\n\t\t\n\t\ttry\n\t\t{\n\t\t\tconst bytes = this.getCurrentKmpStorageBytes()\n\n\t\t\tif (this.currentKmpFileHandle != null)\n\t\t\t{\n\t\t\t\tawait this.writeBytesToHandle(this.currentKmpFileHandle, bytes)\n\t\t\t\tthis.currentKmpFilename = normalizeFilename(this.currentKmpFileHandle.name)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst outName = normalizeFilename(filename || this.getKmpDownloadName())\n\t\t\t\tthis.downloadBytes(bytes, outName)\n\t\t\t\tthis.currentKmpFilename = outName\n\t\t\t}\n\t\t\t\n\t\t\tthis.currentNotSaved = false\n\t\t\tthis.savedUndoSlot = this.undoPointer\n\t\t\tthis.refreshPanels()\n\t\t\treturn true\r\n\t\t}\r\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error(e)\n\t\t\talert(\"KMP save error!\\n\\n\" + e)\n\t\t\treturn false\n\t\t}\n\t}\n\t\n\t\n\tasync saveKmpAs()\n\t{\n\t\tlet format = this.askSaveAsFormat()\n\t\tif (format == null)\n\t\t\treturn false\n\n\t\tif (format == \"szs\")\n\t\t\treturn await this.saveSzsAs()\n\n\t\treturn await this.saveKmpAsKmp()\n\t}\n\n\n\tasync saveKmpAsKmp()\n\t{\n\t\tif (window.showSaveFilePicker != null)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst filename = this.getKmpDownloadName()\n\t\t\t\tconst suggestedName = (filename.includes(\"/\") ? filename.substring(filename.lastIndexOf(\"/\") + 1) : filename)\n\t\t\t\tconst handle = await window.showSaveFilePicker({\n\t\t\t\t\tsuggestedName,\n\t\t\t\t\ttypes: [this.buildKmpFileTypeFilter()]\n\t\t\t\t})\n\n\t\t\t\tif (handle == null)\n\t\t\t\t\treturn false\n\n\t\t\t\tthis.currentKmpFileHandle = handle\n\t\t\t\tthis.currentKmpFilename = normalizeFilename(handle.name)\n\t\t\t\treturn await this.saveKmp(this.currentKmpFilename)\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.name === \"AbortError\")\n\t\t\t\t\treturn false\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\n\t\treturn await this.saveKmp(this.getKmpDownloadName())\n\t}\n\n\n\tasync saveSzsToHandle(fileHandle)\n\t{\n\t\ttry\n\t\t{\n\t\t\tlet bytes = SzsArchive.make(this.getCurrentArchiveEntriesForSzs(), true)\n\t\t\tawait this.writeBytesToHandle(fileHandle, bytes)\n\n\t\t\tthis.currentSzsFileHandle = fileHandle\n\t\t\tthis.currentArchiveSourceName = fileHandle.name\n\t\t\tthis.currentNotSaved = false\n\t\t\tthis.savedUndoSlot = this.undoPointer\n\t\t\tthis.refreshPanels()\n\t\t\treturn true\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error(e)\n\t\t\twindow.alert(\"SZS save error!\\n\\n\" + e)\n\t\t\treturn false\n\t\t}\n\t}\n\n\n\tasync saveSzsAs()\n\t{\n\t\ttry\n\t\t{\n\t\t\tlet bytes = SzsArchive.make(this.getCurrentArchiveEntriesForSzs(), true)\n\t\t\tif (window.showSaveFilePicker != null)\n\t\t\t{\n\t\t\t\tconst filename = this.getSzsDownloadName()\n\t\t\t\tconst suggestedName = (filename.includes(\"/\") ? filename.substring(filename.lastIndexOf(\"/\") + 1) : filename)\n\t\t\t\tconst handle = await window.showSaveFilePicker({\n\t\t\t\t\tsuggestedName,\n\t\t\t\t\ttypes: [this.buildSzsFileTypeFilter()]\n\t\t\t\t})\n\n\t\t\t\tif (handle == null)\n\t\t\t\t\treturn false\n\n\t\t\t\tawait this.writeBytesToHandle(handle, bytes)\n\t\t\t\tthis.currentSzsFileHandle = handle\n\t\t\t\tthis.currentArchiveSourceName = handle.name\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.downloadBytes(bytes, this.getSzsDownloadName())\n\t\t\t}\n\n\t\t\tthis.currentNotSaved = false\n\t\t\tthis.savedUndoSlot = this.undoPointer\n\t\t\tthis.refreshPanels()\n\t\t\treturn true\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tif (e.name === \"AbortError\")\n\t\t\t\treturn false\n\n\t\t\tconsole.error(e)\n\t\t\twindow.alert(\"SZS save error!\\n\\n\" + e)\n\t\t\treturn false\n\t\t}\n\t}\n\t\r\n\t\r\n\tsetDefaultModel()\n\t{\n\t\tlet model = new ModelBuilder()\n\t\t\t.addCube(-5000, -5000, -3, 5000, 5000, 3)\n\t\t\t.calculateNormals()\n\t\t\n\t\tthis.noModelLoaded = true\n\t\tthis.viewer.setModel(model)\n\t\tthis.viewer.centerView()\n\t\tthis.currentKclFilename = null\n\t\tthis.currentKclFileHandle = null\n\t\tthis.currentKclBytes = null\n\t}\n\t\n\t\n\tasync openCourseBrres()\n\t{\n\t\tif (this.currentDirectoryHandle == null)\n\t\t\treturn\n\n\t\tconst brresFile = await this.readFileBytesFromDirectory(this.currentDirectoryHandle, \"course_model.brres\")\n\t\tif (brresFile != null)\n\t\t\tthis.openBrresFromBytes(this.currentDirectoryHandle.name + \"/course_model.brres\", brresFile.bytes, brresFile.fileHandle)\n\t}\n\t\n\t\n\tasync openCourseKcl()\n\t{\n\t\tif (this.currentDirectoryHandle == null)\n\t\t\treturn\n\n\t\tconst kclFile = await this.readFileBytesFromDirectory(this.currentDirectoryHandle, \"course.kcl\")\n\t\tif (kclFile != null)\n\t\t\tthis.openKclFromBytes(this.currentDirectoryHandle.name + \"/course.kcl\", kclFile.bytes, kclFile.fileHandle)\n\t}\n\t\n\t\n\tasync openCustomModel()\n\t{\n\t\tif (window.showOpenFilePicker != null)\n\t\t{\n\t\t\tconst handle = await this.pickFileHandle({\n\t\t\t\tmultiple: false,\n\t\t\t\ttypes: [this.buildModelFileTypeFilter()]\n\t\t\t})\n\n\t\t\tif (handle == null)\n\t\t\t\treturn\n\n\t\t\tconst bytes = await this.readHandleBytes(handle)\n\t\t\tthis.openModelFromBytes(handle.name, bytes, handle)\n\t\t\treturn\n\t\t}\n\n\t\tconst file = await this.pickSingleFileFromInput(\".obj,.brres,.kcl\")\n\t\tif (file == null)\n\t\t\treturn\n\n\t\tthis.openModelFromBytes(file.name, new Uint8Array(await file.arrayBuffer()))\n\t}\n\t\n\t\n\topenModelFromBytes(filename, bytes, fileHandle = null)\n\t{\n\t\tconst ext = getExtension(filename)\n\t\tif (ext === \".brres\")\n\t\t{\n\t\t\tthis.openBrresFromBytes(filename, bytes, fileHandle)\n\t\t\treturn\n\t\t}\n\t\tif (ext === \".kcl\")\n\t\t{\n\t\t\tthis.openKclFromBytes(filename, bytes, fileHandle)\n\t\t\treturn\n\t\t}\n\n\t\tconst modelBuilder = require(\"./util/objLoader.js\").ObjLoader.makeModelBuilder(bytes)\n\t\tthis.viewer.setModel(modelBuilder)\n\t\tthis.currentKclFilename = null\n\t\tthis.currentKclFileHandle = null\n\t\tthis.currentKclBytes = null\n\t\tthis.currentModelFileHandle = fileHandle\n\t\t\n\t\tif (this.noModelLoaded)\n\t\t\tthis.viewer.centerView()\n\t\t\n\t\tthis.noModelLoaded = false\n\t}\n\n\n\topenBrresFromBytes(filename, bytes, fileHandle = null)\n\t{\n\t\tif (bytes == null)\n\t\t\treturn\n\n\t\tlet modelBuilder = null\n\t\ttry\n\t\t{\n\t\t\tmodelBuilder = require(\"./util/brresLoader.js\").BrresLoader.load(bytes)\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\twindow.alert(\"Error opening BRRES file!\\n\\n\" + e.toString())\r\n\t\t\treturn\r\n\t\t}\r\n\t\t\n\t\tthis.viewer.setModel(modelBuilder)\n\t\tthis.currentKclFilename = null\n\t\tthis.currentKclFileHandle = null\n\t\tthis.currentKclBytes = null\n\t\tthis.currentModelFileHandle = fileHandle\n\t\t\n\t\tif (this.noModelLoaded)\n\t\t\tthis.viewer.centerView()\n\t\t\r\n\t\tthis.noModelLoaded = false\r\n\t}\n\t\n\t\n\topenKclFromBytes(filename, bytes, fileHandle = null)\n\t{\n\t\tif (bytes == null)\n\t\t\treturn\n\n\t\tlet normalizedBytes = (bytes instanceof Uint8Array ? bytes : new Uint8Array(bytes))\n\t\tlet modelBuilder = KclLoader.load(normalizedBytes, this.cfg, this.hl)\n\t\tthis.viewer.setModel(modelBuilder)\n\t\tthis.currentKclFilename = normalizeFilename(filename)\n\t\tthis.currentKclBytes = new Uint8Array(normalizedBytes)\n\t\tthis.currentKclFileHandle = fileHandle\n\t\t\n\t\tif (this.noModelLoaded)\n\t\t\tthis.viewer.centerView()\n\t\t\n\t\tthis.noModelLoaded = false\n\t}\n\n\n\treloadCurrentKcl()\n\t{\n\t\tif (this.currentKclBytes == null)\n\t\t\treturn\n\n\t\tthis.openKclFromBytes(this.currentKclFilename, this.currentKclBytes, this.currentKclFileHandle)\n\t}\n}\n\r\n\r\nclass Panel\r\n{\r\n\tconstructor(window, parentDiv, name, open = true, onToggle = null, closable = true, onRefreshView = null)\r\n\t{\r\n\t\tthis.window = window\r\n\t\tthis.parentDiv = parentDiv\r\n\t\tthis.name = name\r\n\t\tthis.closable = closable\r\n\t\tthis.open = open\r\n\t\tthis.onToggle = onToggle\r\n\t\t\r\n\t\tthis.panelDiv = document.createElement(\"div\")\r\n\t\tthis.panelDiv.className = \"panel\"\r\n\t\tthis.parentDiv.appendChild(this.panelDiv)\r\n\t\t\r\n\t\tthis.titleButton = document.createElement(\"button\")\r\n\t\tthis.titleButton.className = \"panelTitle\"\r\n\t\tthis.titleButton.innerHTML = \"\u25B6 \" + name\r\n\t\tthis.panelDiv.appendChild(this.titleButton)\r\n\t\t\r\n\t\tthis.contentDiv = document.createElement(\"div\")\r\n\t\tthis.contentDiv.className = \"panelContent\"\r\n\t\tthis.contentDiv.style.display = \"none\"\r\n\t\tthis.panelDiv.appendChild(this.contentDiv)\r\n\t\t\r\n\t\tthis.titleButton.onclick = () => this.toggleOpen()\r\n\t\tthis.onRefreshView = (onRefreshView != null ? onRefreshView : () => { })\r\n\t\t\r\n\t\tthis.onDestroy = []\r\n\t\t\r\n\t\tthis.refreshOpen()\r\n\t}\r\n\t\r\n\t\r\n\tdestroy()\r\n\t{\r\n\t\tfor (let f of this.onDestroy)\r\n\t\t\tf()\r\n\t\t\r\n\t\tthis.onDestroy = []\r\n\t\t\r\n\t\tif (this.panelDiv)\r\n\t\t\tthis.parentDiv.removeChild(this.panelDiv)\r\n\t}\r\n\t\r\n\t\r\n\tclearContent()\r\n\t{\r\n\t\tfor (let f of this.onDestroy)\r\n\t\t\tf()\r\n\t\t\r\n\t\tthis.onDestroy = []\r\n\t\t\r\n\t\twhile (this.contentDiv.lastChild)\r\n\t\t\tthis.contentDiv.removeChild(this.contentDiv.lastChild)\r\n\t}\r\n\t\r\n\t\r\n\tsetOpen(open)\r\n\t{\r\n\t\tlet changed = (this.open != open)\r\n\t\t\r\n\t\tthis.open = open\r\n\t\tthis.refreshOpen()\r\n\t\t\r\n\t\tif (changed && this.onToggle != null)\r\n\t\t\tthis.onToggle(this.open)\r\n\t}\r\n\t\r\n\t\r\n\ttoggleOpen()\r\n\t{\r\n\t\tthis.open = !this.open\r\n\t\tthis.refreshOpen()\r\n\t\t\r\n\t\tif (this.onToggle != null)\r\n\t\t\tthis.onToggle(this.open)\r\n\t}\r\n\t\r\n\t\r\n\trefreshOpen()\r\n\t{\r\n\t\tif (this.open)\r\n\t\t{\r\n\t\t\tthis.contentDiv.style.display = \"block\"\r\n\t\t\tthis.titleButton.innerHTML = \"\u25BC \" + this.name\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.contentDiv.style.display = \"none\"\r\n\t\t\tthis.titleButton.innerHTML = \"\u25B6 \" + this.name\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\taddGroup(group, str)\r\n\t{\r\n\t\tlet div = document.createElement(\"div\")\r\n\t\tdiv.className = \"panelGroup\"\r\n\t\t\r\n\t\tlet labelDiv = document.createElement(\"div\")\r\n\t\tlabelDiv.className = \"panelRowElement\"\r\n\t\tdiv.appendChild(labelDiv)\r\n\t\t\r\n\t\tlet label = document.createElement(\"div\")\r\n\t\tlabel.className = \"panelGroupTitle\"\r\n\t\tlabel.innerHTML = str\r\n\t\tlabelDiv.appendChild(label)\r\n\t\t\r\n\t\tif (group == null)\r\n\t\t\tthis.contentDiv.appendChild(div)\r\n\t\telse\r\n\t\t\tgroup.appendChild(div)\r\n\t\t\r\n\t\treturn div\r\n\t}\r\n\t\r\n\t\r\n\taddSpacer(group, n=1)\r\n\t{\r\n\t\tfor (let i=0; i < n; i++)\r\n\t\t{\r\n\t\t\tlet div = document.createElement(\"div\")\r\n\t\t\tdiv.className = \"panelRowElement\"\r\n\t\t\t\r\n\t\t\tif (group == null)\r\n\t\t\t\tthis.contentDiv.appendChild(div)\r\n\t\t\telse\r\n\t\t\t\tgroup.appendChild(div)\r\n\t\t}\r\n\t\treturn null\r\n\t}\r\n\r\n\r\n\taddText(group, str)\n\t{\n\t\tif (isMacPlatform())\n\t\t{\n\t\t\tstr = str.replace(\"Alt\", \"\u2325\")\n\t\t\tstr = str.replace(\"Ctrl\", \"\u2318\")\n\t\t}\r\n\r\n\t\tlet div = document.createElement(\"div\")\r\n\t\tdiv.className = \"panelRowElement\"\r\n\t\t\r\n\t\tlet text = document.createElement(\"span\")\r\n\t\ttext.className = \"panelLabel\"\r\n\t\ttext.innerHTML = str\r\n\t\tdiv.appendChild(text)\r\n\t\t\r\n\t\tif (group == null)\r\n\t\t\tthis.contentDiv.appendChild(div)\r\n\t\telse\r\n\t\t\tgroup.appendChild(div)\r\n\t\t\r\n\t\treturn text\r\n\t}\r\n\t\r\n\t\r\n\taddButton(group, str, onclick = null)\r\n\t{\r\n\t\tlet div = document.createElement(\"div\")\r\n\t\tdiv.className = \"panelRowElement\"\r\n\t\t\r\n\t\tlet label = document.createElement(\"label\")\r\n\t\tdiv.appendChild(label)\r\n\t\t\r\n\t\tlet button = document.createElement(\"button\")\r\n\t\tbutton.className = \"panelButton\"\r\n\t\tbutton.innerHTML = str\r\n\t\tbutton.onclick = () => { onclick(); this.onRefreshView() }\r\n\t\t\r\n\t\tlabel.appendChild(button)\r\n\t\t\r\n\t\tif (group == null)\r\n\t\t\tthis.contentDiv.appendChild(div)\r\n\t\telse\r\n\t\t\tgroup.appendChild(div)\r\n\t\t\r\n\t\treturn button\r\n\t}\r\n\t\r\n\t\r\n\taddCheckbox(group, str, checked = false, onchange = null)\r\n\t{\r\n\t\tlet div = document.createElement(\"div\")\r\n\t\tdiv.className = \"panelRowElement\"\r\n\t\t\r\n\t\tlet label = document.createElement(\"label\")\r\n\t\tdiv.appendChild(label)\r\n\t\t\r\n\t\tlet checkbox = document.createElement(\"input\")\r\n\t\tcheckbox.className = \"panelCheckbox\"\r\n\t\tcheckbox.type = \"checkbox\"\r\n\t\tcheckbox.checked = checked\r\n\t\tcheckbox.onchange = () => { onchange(checkbox.checked); this.onRefreshView() }\r\n\t\t\r\n\t\tlet text = document.createElement(\"span\")\r\n\t\ttext.className = \"panelLabel\"\r\n\t\ttext.innerHTML = str\r\n\t\t\r\n\t\tlabel.appendChild(checkbox)\r\n\t\tlabel.appendChild(text)\r\n\t\t\r\n\t\tif (group == null)\r\n\t\t\tthis.contentDiv.appendChild(div)\r\n\t\telse\r\n\t\t\tgroup.appendChild(div)\r\n\t\t\r\n\t\treturn checkbox\r\n\t}\r\n\t\r\n\t\r\n\taddSlider(group, str, min = 0, max = 1, value = 0, step = 0.1, onchange = null)\r\n\t{\r\n\t\tlet div = document.createElement(\"div\")\r\n\t\tdiv.className = \"panelRowElement\"\r\n\t\t\r\n\t\tlet label = document.createElement(\"label\")\r\n\t\tdiv.appendChild(label)\r\n\t\t\r\n\t\tlet slider = document.createElement(\"input\")\r\n\t\tslider.className = \"panelCheckbox\"\r\n\t\tslider.type = \"range\"\r\n\t\tslider.min = min\r\n\t\tslider.max = max\r\n\t\tslider.step = step\r\n\t\tslider.value = value\r\n\t\tslider.oninput = () => { onchange(slider.value); this.onRefreshView() }\r\n\t\t\r\n\t\tlet text = document.createElement(\"span\")\r\n\t\ttext.className = \"panelLabel\"\r\n\t\ttext.innerHTML = str\r\n\t\t\r\n\t\tlabel.appendChild(text)\r\n\t\tlabel.appendChild(slider)\r\n\t\t\r\n\t\tif (group == null)\r\n\t\t\tthis.contentDiv.appendChild(div)\r\n\t\telse\r\n\t\t\tgroup.appendChild(div)\r\n\t\t\r\n\t\treturn slider\r\n\t}\r\n\t\r\n\t\r\n\taddSelectionNumericInput(group, str, min = 0, max = 1, values = 0, step = 0.1, dragStep = 0.1, enabled = true, multiedit = false, onchange = null, modify = null)\r\n\t{\r\n\t\tlet div = document.createElement(\"div\")\r\n\t\tdiv.className = \"panelRowElement\"\r\n\t\t\r\n\t\tlet label = document.createElement(\"label\")\r\n\t\tdiv.appendChild(label)\r\n\t\t\r\n\t\tif (!(values instanceof Array))\r\n\t\t\tvalues = [values]\r\n\t\t\r\n\t\tif (onchange == null)\r\n\t\t\tonchange = (x, i) => { }\r\n\t\t\r\n\t\tif (modify == null)\r\n\t\t\tmodify = (x) => { return x }\r\n\t\t\r\n\t\tlet input = document.createElement(\"input\")\r\n\t\tinput.className = \"panelNumericInput\"\r\n\t\tinput.type = \"input\"\r\n\t\tinput.value = (enabled && values.every(v => v === values[0]) ? values[0] : \"\")\r\n\t\tinput.disabled = !enabled\r\n\r\n\t\tinput.lastInput = input.value\r\n\t\t\r\n\t\tlet inFocus = false\r\n\t\tinput.onfocus = () => { inFocus = true; this.window.setUndoPoint() }\r\n\t\tinput.onblur = () => { inFocus = false; this.window.setUndoPoint(); this.window.viewer.canvas.focus(); input.value = modify(input.lastInput) }\r\n\t\tinput.onkeydown = (ev) => {\r\n\t\t\tif (inFocus)\r\n\t\t\t{\r\n\t\t\t\tif (ev.key === \"Enter\")\r\n\t\t\t\t\tinput.value = modify(input.lastInput)\r\n\t\t\t\telse\r\n\t\t\t\t\tev.stopPropagation()\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tlet safeParseFloat = (s) =>\r\n\t\t{\r\n\t\t\tlet x = 0\r\n\t\t\tif (s.substring(0, 2) == '0x')\r\n\t\t\t\tx = parseInt(s, 16)\r\n\t\t\telse\r\n\t\t\t\tx = parseFloat(s)\r\n\r\n\t\t\tif (isNaN(x) || !isFinite(x))\r\n\t\t\t\treturn 0\r\n\t\t\t\r\n\t\t\treturn x\r\n\t\t}\r\n\t\t\r\n\t\tlet clampValue = (x) =>\r\n\t\t{\r\n\t\t\tif (step != null)\r\n\t\t\t\tx = Math.round(x / step) * step\r\n\t\t\t\r\n\t\t\tx = Math.max(x, min)\r\n\t\t\tx = Math.min(x, max)\r\n\t\t\treturn x\r\n\t\t}\r\n\t\t\r\n\t\tlet valueDelta = 0\r\n\t\t\r\n\t\tinput.oninput = () =>\r\n\t\t{\r\n\t\t\tif (!enabled)\r\n\t\t\t\treturn\r\n\t\t\t\r\n\t\t\tvalueDelta = 0\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < values.length; i++)\r\n\t\t\t\tonchange(input.value != \"\" ? clampValue(safeParseFloat(input.value)) : values[i], i)\r\n\t\t\t\r\n\t\t\tinput.lastInput = (input.value != \"\" ? clampValue(safeParseFloat(input.value)) : lastInput)\r\n\r\n\t\t\tthis.onRefreshView()\r\n\t\t}\r\n\t\t\r\n\t\tlet text = document.createElement(\"div\")\r\n\t\ttext.className = \"panelNumericInputLabel\"\r\n\t\ttext.innerHTML = str\r\n\t\t\r\n\t\tlet mouseDown = false\r\n\t\tlet lastEv = null\r\n\t\ttext.onmousedown = (ev) =>\r\n\t\t{\r\n\t\t\tif (!enabled)\r\n\t\t\t\treturn\r\n\t\t\t\r\n\t\t\tlastEv = ev\r\n\t\t\tmouseDown = true\r\n\t\t\tthis.window.setUndoPoint()\r\n\t\t}\r\n\t\t\r\n\t\tlet onMouseUp = (ev) =>\r\n\t\t{\r\n\t\t\tif (!mouseDown)\r\n\t\t\t\treturn\r\n\t\t\t\r\n\t\t\tmouseDown = false\r\n\t\t}\r\n\t\t\r\n\t\tlet onMouseMove = (ev) =>\r\n\t\t{\r\n\t\t\tif (mouseDown && dragStep > 0)\r\n\t\t\t{\r\n\t\t\t\tlet dy = lastEv.screenY - ev.screenY\r\n\t\t\t\tlet value = safeParseFloat(input.value)\r\n\t\t\t\t\r\n\t\t\t\tvalueDelta += (dy * dragStep)\r\n\t\t\t\tvalue += (dy * dragStep)\r\n\t\t\t\tvalue = clampValue(value)\r\n\t\t\t\t\r\n\t\t\t\tif (!multiedit)\r\n\t\t\t\t{\r\n\t\t\t\t\tinput.value = modify(value.toFixed(5))\r\n\t\t\t\t\tfor (let i = 0; i < values.length; i++)\r\n\t\t\t\t\t\tonchange(value, i)\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tinput.value = values.every(v => v === values[0]) ? modify(clampValue(values[0] + valueDelta)) : \"\"\r\n\t\t\t\t\tfor (let i = 0; i < values.length; i++)\r\n\t\t\t\t\t\tonchange(clampValue(values[i] + valueDelta), i)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlastEv = ev\r\n\t\t\t\tinput.lastInput = input.value\r\n\t\t\t\t\r\n\t\t\t\tthis.onRefreshView()\r\n\t\t\t\t\r\n\t\t\t\tev.preventDefault()\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tdocument.addEventListener(\"mousemove\", onMouseMove)\r\n\t\tdocument.addEventListener(\"mouseup\", onMouseUp)\r\n\t\tdocument.addEventListener(\"mouseleave\", onMouseUp)\r\n\t\t\r\n\t\tthis.onDestroy.push(() =>\r\n\t\t{\r\n\t\t\tdocument.removeEventListener(\"mousemove\", onMouseMove)\r\n\t\t\tdocument.removeEventListener(\"mouseup\", onMouseUp)\r\n\t\t\tdocument.removeEventListener(\"mouseleave\", onMouseUp)\r\n\t\t})\r\n\t\t\r\n\t\tlabel.appendChild(text)\r\n\t\tlabel.appendChild(input)\r\n\t\t\r\n\t\tif (group == null)\r\n\t\t\tthis.contentDiv.appendChild(div)\r\n\t\telse\r\n\t\t\tgroup.appendChild(div)\r\n\t\t\r\n\t\treturn input\r\n\t}\r\n\t\r\n\t\r\n\taddSelectionDropdown(group, str, values = 0, options = [], enabled = true, multiedit = false, onchange = null)\r\n\t{\r\n\t\tlet div = document.createElement(\"div\")\r\n\t\tdiv.className = \"panelRowElement\"\r\n\t\t\r\n\t\tlet label = document.createElement(\"label\")\r\n\t\tdiv.appendChild(label)\r\n\t\t\r\n\t\tif (!(values instanceof Array))\r\n\t\t\tvalues = [values]\r\n\t\t\r\n\t\tif (onchange == null)\r\n\t\t\tonchange = (x, i) => { }\r\n\t\t\r\n\t\tlet select = document.createElement(\"select\")\r\n\t\tselect.className = \"panelSelect\"\r\n\t\tselect.disabled = !enabled\r\n\t\t\r\n\t\tfor (let option of options)\r\n\t\t{\r\n\t\t\tlet selectOption = document.createElement(\"option\")\r\n\t\t\tselectOption.innerHTML = option.str\r\n\t\t\tselectOption.value = option.value\r\n\t\t\tselect.appendChild(selectOption)\r\n\t\t}\r\n\r\n\t\tif (enabled && values.every(v => v === values[0]))\r\n\t\t\tselect.selectedIndex = options.findIndex(op => op.value == values[0])\r\n\t\telse\r\n\t\t\tselect.selectedIndex = -1\r\n\t\t\r\n\t\tselect.onchange = () =>\r\n\t\t{\r\n\t\t\tif (select.selectedIndex < 0)\r\n\t\t\t\treturn\r\n\t\t\t\r\n\t\t\tthis.window.setUndoPoint()\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < values.length; i++)\r\n\t\t\t\tonchange(options[select.selectedIndex].value, i)\r\n\t\t\t\r\n\t\t\tthis.onRefreshView()\r\n\t\t}\r\n\t\t\r\n\t\tlet text = document.createElement(\"div\")\r\n\t\ttext.className = \"panelInputLabel\"\r\n\t\ttext.innerHTML = str\r\n\t\t\r\n\t\tlabel.appendChild(text)\r\n\t\tlabel.appendChild(select)\r\n\t\t\r\n\t\tif (group == null)\r\n\t\t\tthis.contentDiv.appendChild(div)\r\n\t\telse\r\n\t\t\tgroup.appendChild(div)\r\n\t\t\r\n\t\treturn select\r\n\t}\r\n}\r\n\r\n\r\nmodule.exports = { main, MainWindow, gMainWindow }\r\n"],
  "mappings": "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,KAAK,EAAE,CAAC,EAAE,CAAC;AACxB,gBAAM,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC;AACxB,gBAAM,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC;AACxB,gBAAM,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC;AACxB,gBAAM,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC;AACxB,gBAAM,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC;AACxB,gBAAM,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC;AACxB,gBAAM,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC;AACxB,gBAAM,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC;AACxB,gBAAM,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC;AACxB,gBAAM,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC;AACxB,gBAAM,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC;AAExB,gBAAM,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC;AACzB,gBAAM,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC;AACzB,gBAAM,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC;AACzB,gBAAM,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC;AACzB,gBAAM,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC;AACzB,gBAAM,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC;AACzB,gBAAM,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC;AACzB,gBAAM,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC;AACzB,gBAAM,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC;AACzB,gBAAM,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC;AACzB,gBAAM,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC;AACzB,gBAAM,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC;AACzB,gBAAM,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC;AACzB,gBAAM,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC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EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC;AACtE,gBAAM,QAAQ,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC;AACtE,gBAAM,QAAQ,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC;AACtE,gBAAM,QAAQ,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC;AACtE,gBAAM,QAAQ,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC;AACtE,gBAAM,QAAQ,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC;AACtE,gBAAM,QAAQ,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC;AACtE,gBAAM,QAAQ,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC;AACtE,gBAAM,QAAQ,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC;AACtE,gBAAM,QAAQ,KAAK,EAAE,CAAC,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,EAAE,CAAC,IA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,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAI,IAAK;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAAY,GAAK,IAAI;AACrB,kBAA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",
  "names": ["window", "hit", "window", "window", "hit", "window", "window", "window", "prevIsRendered", "wraps", "progress", "window", "window", "window", "window", "window", "window", "window", "window", "ray", "hit", "cameraPos", "bytes", "color", "archiveEntries", "kmpPath", "kclPath", "window"]
}
